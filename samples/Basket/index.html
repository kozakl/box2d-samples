<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
        <meta name="viewport" content="minimum-scale=1,
                                       maximum-scale=1,
                                       initial-scale=1, minimal-ui">
        <title>Basket</title>
        
        <style type="text/css">
            body {
                background-color: #333333;
                overflow: hidden;
                margin: 0;
            }
        </style>
        
	<script>var Box2D={};
(function(c,m){function n(){}if(!(Object.prototype.defineProperty instanceof Function)&&Object.prototype.__defineGetter__ instanceof Function&&Object.prototype.__defineSetter__ instanceof Function)Object.defineProperty=function(c,k,a){a.get instanceof Function&&c.__defineGetter__(k,a.get);a.set instanceof Function&&c.__defineSetter__(k,a.set)};c.inherit=function(c,k){n.prototype=k.prototype;c.prototype=new n;c.prototype.constructor=c};c.generateCallback=function(c,k){return function(){k.apply(c,arguments)}};
c.NVector=function(c){c===m&&(c=0);for(var k=Array(c||0),a=0;a<c;++a)k[a]=0;return k};c.is=function(c,k){return null===c?!1:k instanceof Function&&c instanceof k||c.constructor.__implements!=m&&c.constructor.__implements[k]?!0:!1};c.parseUInt=function(c){return Math.abs(parseInt(c))}})(Box2D);var Vector=Array,Vector_a2j_Number=Box2D.NVector;"undefined"===typeof Box2D&&(Box2D={});if("undefined"===typeof Box2D.Collision)Box2D.Collision={};
if("undefined"===typeof Box2D.Collision.Shapes)Box2D.Collision.Shapes={};if("undefined"===typeof Box2D.Common)Box2D.Common={};if("undefined"===typeof Box2D.Common.Math)Box2D.Common.Math={};if("undefined"===typeof Box2D.Dynamics)Box2D.Dynamics={};if("undefined"===typeof Box2D.Dynamics.Contacts)Box2D.Dynamics.Contacts={};if("undefined"===typeof Box2D.Dynamics.Controllers)Box2D.Dynamics.Controllers={};if("undefined"===typeof Box2D.Dynamics.Joints)Box2D.Dynamics.Joints={};
(function(){function c(){c.b2AABB.apply(this,arguments)}function m(){m.b2Bound.apply(this,arguments)}function n(){n.b2BoundValues.apply(this,arguments);this.constructor===n&&this.b2BoundValues.apply(this,arguments)}function o(){o.b2Collision.apply(this,arguments)}function k(){k.b2ContactID.apply(this,arguments);this.constructor===k&&this.b2ContactID.apply(this,arguments)}function a(){a.b2ContactPoint.apply(this,arguments)}function b(){b.b2Distance.apply(this,arguments)}function e(){e.b2DistanceInput.apply(this,
arguments)}function d(){d.b2DistanceOutput.apply(this,arguments)}function f(){f.b2DistanceProxy.apply(this,arguments)}function h(){h.b2DynamicTree.apply(this,arguments);this.constructor===h&&this.b2DynamicTree.apply(this,arguments)}function g(){g.b2DynamicTreeBroadPhase.apply(this,arguments)}function j(){j.b2DynamicTreeNode.apply(this,arguments)}function q(){q.b2DynamicTreePair.apply(this,arguments)}function p(){p.b2Manifold.apply(this,arguments);this.constructor===p&&this.b2Manifold.apply(this,arguments)}
function A(){A.b2ManifoldPoint.apply(this,arguments);this.constructor===A&&this.b2ManifoldPoint.apply(this,arguments)}function l(){l.b2Point.apply(this,arguments)}function B(){B.b2RayCastInput.apply(this,arguments);this.constructor===B&&this.b2RayCastInput.apply(this,arguments)}function t(){t.b2RayCastOutput.apply(this,arguments)}function x(){x.b2Segment.apply(this,arguments)}function v(){v.b2SeparationFunction.apply(this,arguments)}function y(){y.b2Simplex.apply(this,arguments);this.constructor===
y&&this.b2Simplex.apply(this,arguments)}function z(){z.b2SimplexCache.apply(this,arguments)}function G(){G.b2SimplexVertex.apply(this,arguments)}function D(){D.b2TimeOfImpact.apply(this,arguments)}function F(){F.b2TOIInput.apply(this,arguments)}function K(){K.b2WorldManifold.apply(this,arguments);this.constructor===K&&this.b2WorldManifold.apply(this,arguments)}function J(){J.ClipVertex.apply(this,arguments)}function s(){s.Features.apply(this,arguments)}function u(){u.b2CircleShape.apply(this,arguments);
this.constructor===u&&this.b2CircleShape.apply(this,arguments)}function C(){C.b2EdgeChainDef.apply(this,arguments);this.constructor===C&&this.b2EdgeChainDef.apply(this,arguments)}function E(){E.b2EdgeShape.apply(this,arguments);this.constructor===E&&this.b2EdgeShape.apply(this,arguments)}function H(){H.b2MassData.apply(this,arguments)}function M(){M.b2PolygonShape.apply(this,arguments);this.constructor===M&&this.b2PolygonShape.apply(this,arguments)}function L(){L.b2Shape.apply(this,arguments);this.constructor===
L&&this.b2Shape.apply(this,arguments)}function w(){w.b2Color.apply(this,arguments);this.constructor===w&&this.b2Color.apply(this,arguments)}function r(){r.b2Settings.apply(this,arguments)}function I(){I.b2Mat22.apply(this,arguments);this.constructor===I&&this.b2Mat22.apply(this,arguments)}function N(){N.b2Mat33.apply(this,arguments);this.constructor===N&&this.b2Mat33.apply(this,arguments)}function P(){P.b2Math.apply(this,arguments)}function Q(){Q.b2Sweep.apply(this,arguments)}function O(){O.b2Transform.apply(this,
arguments);this.constructor===O&&this.b2Transform.apply(this,arguments)}function R(){R.b2Vec2.apply(this,arguments);this.constructor===R&&this.b2Vec2.apply(this,arguments)}function S(){S.b2Vec3.apply(this,arguments);this.constructor===S&&this.b2Vec3.apply(this,arguments)}function T(){T.b2Body.apply(this,arguments);this.constructor===T&&this.b2Body.apply(this,arguments)}function U(){U.b2BodyDef.apply(this,arguments);this.constructor===U&&this.b2BodyDef.apply(this,arguments)}function Aa(){Aa.b2ContactFilter.apply(this,
arguments)}function Ba(){Ba.b2ContactImpulse.apply(this,arguments)}function Ca(){Ca.b2ContactListener.apply(this,arguments)}function V(){V.b2ContactManager.apply(this,arguments);this.constructor===V&&this.b2ContactManager.apply(this,arguments)}function W(){W.b2DebugDraw.apply(this,arguments);this.constructor===W&&this.b2DebugDraw.apply(this,arguments)}function Da(){Da.b2DestructionListener.apply(this,arguments)}function Ea(){Ea.b2FilterData.apply(this,arguments)}function X(){X.b2Fixture.apply(this,
arguments);this.constructor===X&&this.b2Fixture.apply(this,arguments)}function Y(){Y.b2FixtureDef.apply(this,arguments);this.constructor===Y&&this.b2FixtureDef.apply(this,arguments)}function Z(){Z.b2Island.apply(this,arguments);this.constructor===Z&&this.b2Island.apply(this,arguments)}function Fa(){Fa.b2TimeStep.apply(this,arguments)}function $(){$.b2World.apply(this,arguments);this.constructor===$&&this.b2World.apply(this,arguments)}function Ga(){Ga.b2CircleContact.apply(this,arguments)}function aa(){aa.b2Contact.apply(this,
arguments);this.constructor===aa&&this.b2Contact.apply(this,arguments)}function ba(){ba.b2ContactConstraint.apply(this,arguments);this.constructor===ba&&this.b2ContactConstraint.apply(this,arguments)}function Ha(){Ha.b2ContactConstraintPoint.apply(this,arguments)}function Ia(){Ia.b2ContactEdge.apply(this,arguments)}function ca(){ca.b2ContactFactory.apply(this,arguments);this.constructor===ca&&this.b2ContactFactory.apply(this,arguments)}function Ja(){Ja.b2ContactRegister.apply(this,arguments)}function Ka(){Ka.b2ContactResult.apply(this,
arguments)}function da(){da.b2ContactSolver.apply(this,arguments);this.constructor===da&&this.b2ContactSolver.apply(this,arguments)}function La(){La.b2EdgeAndCircleContact.apply(this,arguments)}function ea(){ea.b2NullContact.apply(this,arguments);this.constructor===ea&&this.b2NullContact.apply(this,arguments)}function Ma(){Ma.b2PolyAndCircleContact.apply(this,arguments)}function Na(){Na.b2PolyAndEdgeContact.apply(this,arguments)}function Oa(){Oa.b2PolygonContact.apply(this,arguments)}function fa(){fa.b2PositionSolverManifold.apply(this,
arguments);this.constructor===fa&&this.b2PositionSolverManifold.apply(this,arguments)}function Pa(){Pa.b2BuoyancyController.apply(this,arguments)}function Qa(){Qa.b2ConstantAccelController.apply(this,arguments)}function Ra(){Ra.b2ConstantForceController.apply(this,arguments)}function Sa(){Sa.b2Controller.apply(this,arguments)}function Ta(){Ta.b2ControllerEdge.apply(this,arguments)}function Ua(){Ua.b2GravityController.apply(this,arguments)}function Va(){Va.b2TensorDampingController.apply(this,arguments)}
function ga(){ga.b2DistanceJoint.apply(this,arguments);this.constructor===ga&&this.b2DistanceJoint.apply(this,arguments)}function ha(){ha.b2DistanceJointDef.apply(this,arguments);this.constructor===ha&&this.b2DistanceJointDef.apply(this,arguments)}function ia(){ia.b2FrictionJoint.apply(this,arguments);this.constructor===ia&&this.b2FrictionJoint.apply(this,arguments)}function ja(){ja.b2FrictionJointDef.apply(this,arguments);this.constructor===ja&&this.b2FrictionJointDef.apply(this,arguments)}function ka(){ka.b2GearJoint.apply(this,
arguments);this.constructor===ka&&this.b2GearJoint.apply(this,arguments)}function la(){la.b2GearJointDef.apply(this,arguments);this.constructor===la&&this.b2GearJointDef.apply(this,arguments)}function Wa(){Wa.b2Jacobian.apply(this,arguments)}function ma(){ma.b2Joint.apply(this,arguments);this.constructor===ma&&this.b2Joint.apply(this,arguments)}function na(){na.b2JointDef.apply(this,arguments);this.constructor===na&&this.b2JointDef.apply(this,arguments)}function Xa(){Xa.b2JointEdge.apply(this,arguments)}
function oa(){oa.b2LineJoint.apply(this,arguments);this.constructor===oa&&this.b2LineJoint.apply(this,arguments)}function pa(){pa.b2LineJointDef.apply(this,arguments);this.constructor===pa&&this.b2LineJointDef.apply(this,arguments)}function qa(){qa.b2MouseJoint.apply(this,arguments);this.constructor===qa&&this.b2MouseJoint.apply(this,arguments)}function ra(){ra.b2MouseJointDef.apply(this,arguments);this.constructor===ra&&this.b2MouseJointDef.apply(this,arguments)}function sa(){sa.b2PrismaticJoint.apply(this,
arguments);this.constructor===sa&&this.b2PrismaticJoint.apply(this,arguments)}function ta(){ta.b2PrismaticJointDef.apply(this,arguments);this.constructor===ta&&this.b2PrismaticJointDef.apply(this,arguments)}function ua(){ua.b2PulleyJoint.apply(this,arguments);this.constructor===ua&&this.b2PulleyJoint.apply(this,arguments)}function va(){va.b2PulleyJointDef.apply(this,arguments);this.constructor===va&&this.b2PulleyJointDef.apply(this,arguments)}function wa(){wa.b2RevoluteJoint.apply(this,arguments);
this.constructor===wa&&this.b2RevoluteJoint.apply(this,arguments)}function xa(){xa.b2RevoluteJointDef.apply(this,arguments);this.constructor===xa&&this.b2RevoluteJointDef.apply(this,arguments)}function ya(){ya.b2WeldJoint.apply(this,arguments);this.constructor===ya&&this.b2WeldJoint.apply(this,arguments)}function za(){za.b2WeldJointDef.apply(this,arguments);this.constructor===za&&this.b2WeldJointDef.apply(this,arguments)}Box2D.Collision.IBroadPhase="Box2D.Collision.IBroadPhase";Box2D.Collision.b2AABB=
c;Box2D.Collision.b2Bound=m;Box2D.Collision.b2BoundValues=n;Box2D.Collision.b2Collision=o;Box2D.Collision.b2ContactID=k;Box2D.Collision.b2ContactPoint=a;Box2D.Collision.b2Distance=b;Box2D.Collision.b2DistanceInput=e;Box2D.Collision.b2DistanceOutput=d;Box2D.Collision.b2DistanceProxy=f;Box2D.Collision.b2DynamicTree=h;Box2D.Collision.b2DynamicTreeBroadPhase=g;Box2D.Collision.b2DynamicTreeNode=j;Box2D.Collision.b2DynamicTreePair=q;Box2D.Collision.b2Manifold=p;Box2D.Collision.b2ManifoldPoint=A;Box2D.Collision.b2Point=
l;Box2D.Collision.b2RayCastInput=B;Box2D.Collision.b2RayCastOutput=t;Box2D.Collision.b2Segment=x;Box2D.Collision.b2SeparationFunction=v;Box2D.Collision.b2Simplex=y;Box2D.Collision.b2SimplexCache=z;Box2D.Collision.b2SimplexVertex=G;Box2D.Collision.b2TimeOfImpact=D;Box2D.Collision.b2TOIInput=F;Box2D.Collision.b2WorldManifold=K;Box2D.Collision.ClipVertex=J;Box2D.Collision.Features=s;Box2D.Collision.Shapes.b2CircleShape=u;Box2D.Collision.Shapes.b2EdgeChainDef=C;Box2D.Collision.Shapes.b2EdgeShape=E;Box2D.Collision.Shapes.b2MassData=
H;Box2D.Collision.Shapes.b2PolygonShape=M;Box2D.Collision.Shapes.b2Shape=L;Box2D.Common.b2internal="Box2D.Common.b2internal";Box2D.Common.b2Color=w;Box2D.Common.b2Settings=r;Box2D.Common.Math.b2Mat22=I;Box2D.Common.Math.b2Mat33=N;Box2D.Common.Math.b2Math=P;Box2D.Common.Math.b2Sweep=Q;Box2D.Common.Math.b2Transform=O;Box2D.Common.Math.b2Vec2=R;Box2D.Common.Math.b2Vec3=S;Box2D.Dynamics.b2Body=T;Box2D.Dynamics.b2BodyDef=U;Box2D.Dynamics.b2ContactFilter=Aa;Box2D.Dynamics.b2ContactImpulse=Ba;Box2D.Dynamics.b2ContactListener=
Ca;Box2D.Dynamics.b2ContactManager=V;Box2D.Dynamics.b2DebugDraw=W;Box2D.Dynamics.b2DestructionListener=Da;Box2D.Dynamics.b2FilterData=Ea;Box2D.Dynamics.b2Fixture=X;Box2D.Dynamics.b2FixtureDef=Y;Box2D.Dynamics.b2Island=Z;Box2D.Dynamics.b2TimeStep=Fa;Box2D.Dynamics.b2World=$;Box2D.Dynamics.Contacts.b2CircleContact=Ga;Box2D.Dynamics.Contacts.b2Contact=aa;Box2D.Dynamics.Contacts.b2ContactConstraint=ba;Box2D.Dynamics.Contacts.b2ContactConstraintPoint=Ha;Box2D.Dynamics.Contacts.b2ContactEdge=Ia;Box2D.Dynamics.Contacts.b2ContactFactory=
ca;Box2D.Dynamics.Contacts.b2ContactRegister=Ja;Box2D.Dynamics.Contacts.b2ContactResult=Ka;Box2D.Dynamics.Contacts.b2ContactSolver=da;Box2D.Dynamics.Contacts.b2EdgeAndCircleContact=La;Box2D.Dynamics.Contacts.b2NullContact=ea;Box2D.Dynamics.Contacts.b2PolyAndCircleContact=Ma;Box2D.Dynamics.Contacts.b2PolyAndEdgeContact=Na;Box2D.Dynamics.Contacts.b2PolygonContact=Oa;Box2D.Dynamics.Contacts.b2PositionSolverManifold=fa;Box2D.Dynamics.Controllers.b2BuoyancyController=Pa;Box2D.Dynamics.Controllers.b2ConstantAccelController=
Qa;Box2D.Dynamics.Controllers.b2ConstantForceController=Ra;Box2D.Dynamics.Controllers.b2Controller=Sa;Box2D.Dynamics.Controllers.b2ControllerEdge=Ta;Box2D.Dynamics.Controllers.b2GravityController=Ua;Box2D.Dynamics.Controllers.b2TensorDampingController=Va;Box2D.Dynamics.Joints.b2DistanceJoint=ga;Box2D.Dynamics.Joints.b2DistanceJointDef=ha;Box2D.Dynamics.Joints.b2FrictionJoint=ia;Box2D.Dynamics.Joints.b2FrictionJointDef=ja;Box2D.Dynamics.Joints.b2GearJoint=ka;Box2D.Dynamics.Joints.b2GearJointDef=la;
Box2D.Dynamics.Joints.b2Jacobian=Wa;Box2D.Dynamics.Joints.b2Joint=ma;Box2D.Dynamics.Joints.b2JointDef=na;Box2D.Dynamics.Joints.b2JointEdge=Xa;Box2D.Dynamics.Joints.b2LineJoint=oa;Box2D.Dynamics.Joints.b2LineJointDef=pa;Box2D.Dynamics.Joints.b2MouseJoint=qa;Box2D.Dynamics.Joints.b2MouseJointDef=ra;Box2D.Dynamics.Joints.b2PrismaticJoint=sa;Box2D.Dynamics.Joints.b2PrismaticJointDef=ta;Box2D.Dynamics.Joints.b2PulleyJoint=ua;Box2D.Dynamics.Joints.b2PulleyJointDef=va;Box2D.Dynamics.Joints.b2RevoluteJoint=
wa;Box2D.Dynamics.Joints.b2RevoluteJointDef=xa;Box2D.Dynamics.Joints.b2WeldJoint=ya;Box2D.Dynamics.Joints.b2WeldJointDef=za})();Box2D.postDefs=[];
(function(){var c=Box2D.Collision.Shapes.b2CircleShape,m=Box2D.Collision.Shapes.b2PolygonShape,n=Box2D.Collision.Shapes.b2Shape,o=Box2D.Common.b2Settings,k=Box2D.Common.Math.b2Math,a=Box2D.Common.Math.b2Sweep,b=Box2D.Common.Math.b2Transform,e=Box2D.Common.Math.b2Vec2,d=Box2D.Collision.b2AABB,f=Box2D.Collision.b2Bound,h=Box2D.Collision.b2BoundValues,g=Box2D.Collision.b2Collision,j=Box2D.Collision.b2ContactID,q=Box2D.Collision.b2ContactPoint,p=Box2D.Collision.b2Distance,A=Box2D.Collision.b2DistanceInput,
l=Box2D.Collision.b2DistanceOutput,B=Box2D.Collision.b2DistanceProxy,t=Box2D.Collision.b2DynamicTree,x=Box2D.Collision.b2DynamicTreeBroadPhase,v=Box2D.Collision.b2DynamicTreeNode,y=Box2D.Collision.b2DynamicTreePair,z=Box2D.Collision.b2Manifold,G=Box2D.Collision.b2ManifoldPoint,D=Box2D.Collision.b2Point,F=Box2D.Collision.b2RayCastInput,K=Box2D.Collision.b2RayCastOutput,J=Box2D.Collision.b2Segment,s=Box2D.Collision.b2SeparationFunction,u=Box2D.Collision.b2Simplex,C=Box2D.Collision.b2SimplexCache,E=
Box2D.Collision.b2SimplexVertex,H=Box2D.Collision.b2TimeOfImpact,M=Box2D.Collision.b2TOIInput,L=Box2D.Collision.b2WorldManifold,w=Box2D.Collision.ClipVertex,r=Box2D.Collision.Features,I=Box2D.Collision.IBroadPhase;d.b2AABB=function(){this.lowerBound=new e;this.upperBound=new e};d.prototype.IsValid=function(){var a=this.upperBound.y-this.lowerBound.y;return 0<=this.upperBound.x-this.lowerBound.x&&0<=a&&this.lowerBound.IsValid()&&this.upperBound.IsValid()};d.prototype.GetCenter=function(){return new e((this.lowerBound.x+
this.upperBound.x)/2,(this.lowerBound.y+this.upperBound.y)/2)};d.prototype.GetExtents=function(){return new e((this.upperBound.x-this.lowerBound.x)/2,(this.upperBound.y-this.lowerBound.y)/2)};d.prototype.Contains=function(a){return this.lowerBound.x<=a.lowerBound.x&&this.lowerBound.y<=a.lowerBound.y&&a.upperBound.x<=this.upperBound.x&&a.upperBound.y<=this.upperBound.y};d.prototype.RayCast=function(a,b){var e=-Number.MAX_VALUE,c=Number.MAX_VALUE,d=b.p1.x,w=b.p1.y,f=b.p2.x-b.p1.x,g=b.p2.y-b.p1.y,r=
Math.abs(g),s=a.normal,h=0,l=0,j=0;if(Math.abs(f)<Number.MIN_VALUE){if(d<this.lowerBound.x||this.upperBound.x<d)return!1}else{h=1/f;l=(this.lowerBound.x-d)*h;h*=this.upperBound.x-d;j=-1;l>h&&(j=l,l=h,h=j,j=1);if(l>e)s.x=j,s.y=0,e=l;c=Math.min(c,h);if(e>c)return!1}if(r<Number.MIN_VALUE){if(w<this.lowerBound.y||this.upperBound.y<w)return!1}else{h=1/g;l=(this.lowerBound.y-w)*h;h*=this.upperBound.y-w;j=-1;l>h&&(j=l,l=h,h=j,j=1);if(l>e)s.y=j,s.x=0,e=l;c=Math.min(c,h);if(e>c)return!1}a.fraction=e;return!0};
d.prototype.TestOverlap=function(a){var b=a.lowerBound.y-this.upperBound.y,e=this.lowerBound.y-a.upperBound.y;return 0<a.lowerBound.x-this.upperBound.x||0<b||0<this.lowerBound.x-a.upperBound.x||0<e?!1:!0};d.Combine=function(a,b){var e=new d;e.Combine(a,b);return e};d.prototype.Combine=function(a,b){this.lowerBound.x=Math.min(a.lowerBound.x,b.lowerBound.x);this.lowerBound.y=Math.min(a.lowerBound.y,b.lowerBound.y);this.upperBound.x=Math.max(a.upperBound.x,b.upperBound.x);this.upperBound.y=Math.max(a.upperBound.y,
b.upperBound.y)};f.b2Bound=function(){};f.prototype.IsLower=function(){return 0==(this.value&1)};f.prototype.IsUpper=function(){return 1==(this.value&1)};f.prototype.Swap=function(a){var b=this.value,e=this.proxy,c=this.stabbingCount;this.value=a.value;this.proxy=a.proxy;this.stabbingCount=a.stabbingCount;a.value=b;a.proxy=e;a.stabbingCount=c};h.b2BoundValues=function(){};h.prototype.b2BoundValues=function(){this.lowerValues=new Vector_a2j_Number;this.lowerValues[0]=0;this.lowerValues[1]=0;this.upperValues=
new Vector_a2j_Number;this.upperValues[0]=0;this.upperValues[1]=0};g.b2Collision=function(){};g.ClipSegmentToLine=function(a,b,e,c){void 0===c&&(c=0);var d,w=0;d=b[0];var f=d.v;d=b[1];var g=d.v,r=e.x*f.x+e.y*f.y-c;d=e.x*g.x+e.y*g.y-c;0>=r&&a[w++].Set(b[0]);0>=d&&a[w++].Set(b[1]);if(0>r*d)e=r/(r-d),d=a[w],d=d.v,d.x=f.x+e*(g.x-f.x),d.y=f.y+e*(g.y-f.y),d=a[w],d.id=(0<r?b[0]:b[1]).id,++w;return w};g.EdgeSeparation=function(a,b,e,c,d){void 0===e&&(e=0);parseInt(a.m_vertexCount);var w=a.m_vertices,a=a.m_normals,
f=parseInt(c.m_vertexCount),g=c.m_vertices,r,h;r=b.R;h=a[e];a=r.col1.x*h.x+r.col2.x*h.y;c=r.col1.y*h.x+r.col2.y*h.y;r=d.R;var s=r.col1.x*a+r.col1.y*c;r=r.col2.x*a+r.col2.y*c;for(var l=0,j=Number.MAX_VALUE,u=0;u<f;++u)h=g[u],h=h.x*s+h.y*r,h<j&&(j=h,l=u);h=w[e];r=b.R;e=b.position.x+(r.col1.x*h.x+r.col2.x*h.y);b=b.position.y+(r.col1.y*h.x+r.col2.y*h.y);h=g[l];r=d.R;w=d.position.x+(r.col1.x*h.x+r.col2.x*h.y);d=d.position.y+(r.col1.y*h.x+r.col2.y*h.y);return(w-e)*a+(d-b)*c};g.FindMaxSeparation=function(a,
b,e,c,d){var w=parseInt(b.m_vertexCount),f=b.m_normals,r,h;h=d.R;r=c.m_centroid;var s=d.position.x+(h.col1.x*r.x+h.col2.x*r.y),l=d.position.y+(h.col1.y*r.x+h.col2.y*r.y);h=e.R;r=b.m_centroid;s-=e.position.x+(h.col1.x*r.x+h.col2.x*r.y);l-=e.position.y+(h.col1.y*r.x+h.col2.y*r.y);h=s*e.R.col1.x+l*e.R.col1.y;for(var l=s*e.R.col2.x+l*e.R.col2.y,s=0,j=-Number.MAX_VALUE,u=0;u<w;++u)r=f[u],r=r.x*h+r.y*l,r>j&&(j=r,s=u);f=g.EdgeSeparation(b,e,s,c,d);r=parseInt(0<=s-1?s-1:w-1);h=g.EdgeSeparation(b,e,r,c,d);
var l=parseInt(s+1<w?s+1:0),j=g.EdgeSeparation(b,e,l,c,d),E=0,I=0;if(h>f&&h>j)I=-1,u=r,E=h;else if(j>f)I=1,u=l,E=j;else return a[0]=s,f;for(;;)if(s=-1==I?0<=u-1?u-1:w-1:u+1<w?u+1:0,f=g.EdgeSeparation(b,e,s,c,d),f>E)u=s,E=f;else break;a[0]=u;return E};g.FindIncidentEdge=function(a,b,e,c,d,w){void 0===c&&(c=0);parseInt(b.m_vertexCount);var f=b.m_normals,r=parseInt(d.m_vertexCount),b=d.m_vertices,d=d.m_normals,g;g=e.R;var e=f[c],f=g.col1.x*e.x+g.col2.x*e.y,h=g.col1.y*e.x+g.col2.y*e.y;g=w.R;e=g.col1.x*
f+g.col1.y*h;h=g.col2.x*f+g.col2.y*h;f=e;g=0;for(var s=Number.MAX_VALUE,l=0;l<r;++l)e=d[l],e=f*e.x+h*e.y,e<s&&(s=e,g=l);d=parseInt(g);f=parseInt(d+1<r?d+1:0);r=a[0];e=b[d];g=w.R;r.v.x=w.position.x+(g.col1.x*e.x+g.col2.x*e.y);r.v.y=w.position.y+(g.col1.y*e.x+g.col2.y*e.y);r.id.features.referenceEdge=c;r.id.features.incidentEdge=d;r.id.features.incidentVertex=0;r=a[1];e=b[f];g=w.R;r.v.x=w.position.x+(g.col1.x*e.x+g.col2.x*e.y);r.v.y=w.position.y+(g.col1.y*e.x+g.col2.y*e.y);r.id.features.referenceEdge=
c;r.id.features.incidentEdge=f;r.id.features.incidentVertex=1};g.MakeClipPointVector=function(){var a=new Vector(2);a[0]=new w;a[1]=new w;return a};g.CollidePolygons=function(a,b,e,c,d){var w;a.m_pointCount=0;var f=b.m_radius+c.m_radius;g.s_edgeAO[0]=0;var r=g.FindMaxSeparation(g.s_edgeAO,b,e,c,d);w=g.s_edgeAO[0];if(!(r>f)){var h;g.s_edgeBO[0]=0;var s=g.FindMaxSeparation(g.s_edgeBO,c,d,b,e);h=g.s_edgeBO[0];if(!(s>f)){var l=0,j=0;s>0.98*r+0.0010?(r=c,c=b,b=d,l=h,a.m_type=z.e_faceB,j=1):(r=b,b=e,e=
d,l=w,a.m_type=z.e_faceA,j=0);w=g.s_incidentEdge;g.FindIncidentEdge(w,r,b,l,c,e);h=parseInt(r.m_vertexCount);var d=r.m_vertices,r=d[l],u;u=l+1<h?d[parseInt(l+1)]:d[0];l=g.s_localTangent;l.Set(u.x-r.x,u.y-r.y);l.Normalize();d=g.s_localNormal;d.x=l.y;d.y=-l.x;c=g.s_planePoint;c.Set(0.5*(r.x+u.x),0.5*(r.y+u.y));s=g.s_tangent;h=b.R;s.x=h.col1.x*l.x+h.col2.x*l.y;s.y=h.col1.y*l.x+h.col2.y*l.y;var E=g.s_tangent2;E.x=-s.x;E.y=-s.y;l=g.s_normal;l.x=s.y;l.y=-s.x;var I=g.s_v11,C=g.s_v12;I.x=b.position.x+(h.col1.x*
r.x+h.col2.x*r.y);I.y=b.position.y+(h.col1.y*r.x+h.col2.y*r.y);C.x=b.position.x+(h.col1.x*u.x+h.col2.x*u.y);C.y=b.position.y+(h.col1.y*u.x+h.col2.y*u.y);b=l.x*I.x+l.y*I.y;h=s.x*C.x+s.y*C.y+f;u=g.s_clipPoints1;r=g.s_clipPoints2;C=g.ClipSegmentToLine(u,w,E,-s.x*I.x-s.y*I.y+f);if(!(2>C)&&(C=g.ClipSegmentToLine(r,u,s,h),!(2>C))){a.m_localPlaneNormal.SetV(d);a.m_localPoint.SetV(c);for(c=d=0;c<o.b2_maxManifoldPoints;++c)if(w=r[c],l.x*w.v.x+l.y*w.v.y-b<=f)s=a.m_points[d],h=e.R,E=w.v.x-e.position.x,I=w.v.y-
e.position.y,s.m_localPoint.x=E*h.col1.x+I*h.col1.y,s.m_localPoint.y=E*h.col2.x+I*h.col2.y,s.m_id.Set(w.id),s.m_id.features.flip=j,++d;a.m_pointCount=d}}}};g.CollideCircles=function(a,b,e,c,d){a.m_pointCount=0;var w,f;w=e.R;f=b.m_p;var r=e.position.x+(w.col1.x*f.x+w.col2.x*f.y),e=e.position.y+(w.col1.y*f.x+w.col2.y*f.y);w=d.R;f=c.m_p;r=d.position.x+(w.col1.x*f.x+w.col2.x*f.y)-r;d=d.position.y+(w.col1.y*f.x+w.col2.y*f.y)-e;w=b.m_radius+c.m_radius;if(!(r*r+d*d>w*w))a.m_type=z.e_circles,a.m_localPoint.SetV(b.m_p),
a.m_localPlaneNormal.SetZero(),a.m_pointCount=1,a.m_points[0].m_localPoint.SetV(c.m_p),a.m_points[0].m_id.key=0};g.CollidePolygonAndCircle=function(a,b,e,c,d){var w=a.m_pointCount=0,f=0,r,h;h=d.R;r=c.m_p;var g=d.position.y+(h.col1.y*r.x+h.col2.y*r.y),w=d.position.x+(h.col1.x*r.x+h.col2.x*r.y)-e.position.x,f=g-e.position.y;h=e.R;e=w*h.col1.x+f*h.col1.y;h=w*h.col2.x+f*h.col2.y;for(var s=0,g=-Number.MAX_VALUE,d=b.m_radius+c.m_radius,l=parseInt(b.m_vertexCount),j=b.m_vertices,b=b.m_normals,u=0;u<l;++u){r=
j[u];w=e-r.x;f=h-r.y;r=b[u];w=r.x*w+r.y*f;if(w>d)return;w>g&&(g=w,s=u)}w=parseInt(s);f=parseInt(w+1<l?w+1:0);r=j[w];j=j[f];if(g<Number.MIN_VALUE)a.m_pointCount=1,a.m_type=z.e_faceA,a.m_localPlaneNormal.SetV(b[s]),a.m_localPoint.x=0.5*(r.x+j.x),a.m_localPoint.y=0.5*(r.y+j.y);else if(g=(e-j.x)*(r.x-j.x)+(h-j.y)*(r.y-j.y),0>=(e-r.x)*(j.x-r.x)+(h-r.y)*(j.y-r.y)){if((e-r.x)*(e-r.x)+(h-r.y)*(h-r.y)>d*d)return;a.m_pointCount=1;a.m_type=z.e_faceA;a.m_localPlaneNormal.x=e-r.x;a.m_localPlaneNormal.y=h-r.y;
a.m_localPlaneNormal.Normalize();a.m_localPoint.SetV(r)}else if(0>=g){if((e-j.x)*(e-j.x)+(h-j.y)*(h-j.y)>d*d)return;a.m_pointCount=1;a.m_type=z.e_faceA;a.m_localPlaneNormal.x=e-j.x;a.m_localPlaneNormal.y=h-j.y;a.m_localPlaneNormal.Normalize();a.m_localPoint.SetV(j)}else{s=0.5*(r.x+j.x);r=0.5*(r.y+j.y);g=(e-s)*b[w].x+(h-r)*b[w].y;if(g>d)return;a.m_pointCount=1;a.m_type=z.e_faceA;a.m_localPlaneNormal.x=b[w].x;a.m_localPlaneNormal.y=b[w].y;a.m_localPlaneNormal.Normalize();a.m_localPoint.Set(s,r)}a.m_points[0].m_localPoint.SetV(c.m_p);
a.m_points[0].m_id.key=0};g.TestOverlap=function(a,b){var e=b.lowerBound,c=a.upperBound,d=e.x-c.x,w=e.y-c.y,e=a.lowerBound,c=b.upperBound,f=e.y-c.y;return 0<d||0<w||0<e.x-c.x||0<f?!1:!0};Box2D.postDefs.push(function(){Box2D.Collision.b2Collision.s_incidentEdge=g.MakeClipPointVector();Box2D.Collision.b2Collision.s_clipPoints1=g.MakeClipPointVector();Box2D.Collision.b2Collision.s_clipPoints2=g.MakeClipPointVector();Box2D.Collision.b2Collision.s_edgeAO=new Vector_a2j_Number(1);Box2D.Collision.b2Collision.s_edgeBO=
new Vector_a2j_Number(1);Box2D.Collision.b2Collision.s_localTangent=new e;Box2D.Collision.b2Collision.s_localNormal=new e;Box2D.Collision.b2Collision.s_planePoint=new e;Box2D.Collision.b2Collision.s_normal=new e;Box2D.Collision.b2Collision.s_tangent=new e;Box2D.Collision.b2Collision.s_tangent2=new e;Box2D.Collision.b2Collision.s_v11=new e;Box2D.Collision.b2Collision.s_v12=new e;Box2D.Collision.b2Collision.b2CollidePolyTempVec=new e;Box2D.Collision.b2Collision.b2_nullFeature=255});j.b2ContactID=function(){this.features=
new r};j.prototype.b2ContactID=function(){this.features._m_id=this};j.prototype.Set=function(a){this.key=a._key};j.prototype.Copy=function(){var a=new j;a.key=this.key;return a};Object.defineProperty(j.prototype,"key",{enumerable:!1,configurable:!0,get:function(){return this._key}});Object.defineProperty(j.prototype,"key",{enumerable:!1,configurable:!0,set:function(a){void 0===a&&(a=0);this._key=a;this.features._referenceEdge=this._key&255;this.features._incidentEdge=(this._key&65280)>>8&255;this.features._incidentVertex=
(this._key&16711680)>>16&255;this.features._flip=(this._key&4278190080)>>24&255}});q.b2ContactPoint=function(){this.position=new e;this.velocity=new e;this.normal=new e;this.id=new j};p.b2Distance=function(){};p.Distance=function(a,b,c){++p.b2_gjkCalls;var d=c.proxyA,w=c.proxyB,f=c.transformA,r=c.transformB,h=p.s_simplex;h.ReadCache(b,d,f,w,r);var g=h.m_vertices,s=p.s_saveA,l=p.s_saveB,j=0;h.GetClosestPoint().LengthSquared();for(var u=0,E,I=0;20>I;){j=h.m_count;for(u=0;u<j;u++)s[u]=g[u].indexA,l[u]=
g[u].indexB;switch(h.m_count){case 1:break;case 2:h.Solve2();break;case 3:h.Solve3();break;default:o.b2Assert(!1)}if(3==h.m_count)break;E=h.GetClosestPoint();E.LengthSquared();u=h.GetSearchDirection();if(u.LengthSquared()<Number.MIN_VALUE*Number.MIN_VALUE)break;E=g[h.m_count];E.indexA=d.GetSupport(k.MulTMV(f.R,u.GetNegative()));E.wA=k.MulX(f,d.GetVertex(E.indexA));E.indexB=w.GetSupport(k.MulTMV(r.R,u));E.wB=k.MulX(r,w.GetVertex(E.indexB));E.w=k.SubtractVV(E.wB,E.wA);++I;++p.b2_gjkIters;for(var C=
!1,u=0;u<j;u++)if(E.indexA==s[u]&&E.indexB==l[u]){C=!0;break}if(C)break;++h.m_count}p.b2_gjkMaxIters=k.Max(p.b2_gjkMaxIters,I);h.GetWitnessPoints(a.pointA,a.pointB);a.distance=k.SubtractVV(a.pointA,a.pointB).Length();a.iterations=I;h.WriteCache(b);if(c.useRadii)b=d.m_radius,w=w.m_radius,a.distance>b+w&&a.distance>Number.MIN_VALUE?(a.distance-=b+w,c=k.SubtractVV(a.pointB,a.pointA),c.Normalize(),a.pointA.x+=b*c.x,a.pointA.y+=b*c.y,a.pointB.x-=w*c.x,a.pointB.y-=w*c.y):(E=new e,E.x=0.5*(a.pointA.x+a.pointB.x),
E.y=0.5*(a.pointA.y+a.pointB.y),a.pointA.x=a.pointB.x=E.x,a.pointA.y=a.pointB.y=E.y,a.distance=0)};Box2D.postDefs.push(function(){Box2D.Collision.b2Distance.s_simplex=new u;Box2D.Collision.b2Distance.s_saveA=new Vector_a2j_Number(3);Box2D.Collision.b2Distance.s_saveB=new Vector_a2j_Number(3)});A.b2DistanceInput=function(){};l.b2DistanceOutput=function(){this.pointA=new e;this.pointB=new e};B.b2DistanceProxy=function(){};B.prototype.Set=function(a){switch(a.GetType()){case n.e_circleShape:a=a instanceof
c?a:null;this.m_vertices=new Vector(1,!0);this.m_vertices[0]=a.m_p;this.m_count=1;this.m_radius=a.m_radius;break;case n.e_polygonShape:a=a instanceof m?a:null;this.m_vertices=a.m_vertices;this.m_count=a.m_vertexCount;this.m_radius=a.m_radius;break;default:o.b2Assert(!1)}};B.prototype.GetSupport=function(a){for(var b=0,e=this.m_vertices[0].x*a.x+this.m_vertices[0].y*a.y,c=1;c<this.m_count;++c){var d=this.m_vertices[c].x*a.x+this.m_vertices[c].y*a.y;d>e&&(b=c,e=d)}return b};B.prototype.GetSupportVertex=
function(a){for(var b=0,e=this.m_vertices[0].x*a.x+this.m_vertices[0].y*a.y,c=1;c<this.m_count;++c){var d=this.m_vertices[c].x*a.x+this.m_vertices[c].y*a.y;d>e&&(b=c,e=d)}return this.m_vertices[b]};B.prototype.GetVertexCount=function(){return this.m_count};B.prototype.GetVertex=function(a){void 0===a&&(a=0);o.b2Assert(0<=a&&a<this.m_count);return this.m_vertices[a]};t.b2DynamicTree=function(){};t.prototype.b2DynamicTree=function(){this.m_freeList=this.m_root=null;this.m_insertionCount=this.m_path=
0};t.prototype.CreateProxy=function(a,b){var e=this.AllocateNode(),c=o.b2_aabbExtension,d=o.b2_aabbExtension;e.aabb.lowerBound.x=a.lowerBound.x-c;e.aabb.lowerBound.y=a.lowerBound.y-d;e.aabb.upperBound.x=a.upperBound.x+c;e.aabb.upperBound.y=a.upperBound.y+d;e.userData=b;this.InsertLeaf(e);return e};t.prototype.DestroyProxy=function(a){this.RemoveLeaf(a);this.FreeNode(a)};t.prototype.MoveProxy=function(a,b,e){o.b2Assert(a.IsLeaf());if(a.aabb.Contains(b))return!1;this.RemoveLeaf(a);var c=o.b2_aabbExtension+
o.b2_aabbMultiplier*(0<e.x?e.x:-e.x),e=o.b2_aabbExtension+o.b2_aabbMultiplier*(0<e.y?e.y:-e.y);a.aabb.lowerBound.x=b.lowerBound.x-c;a.aabb.lowerBound.y=b.lowerBound.y-e;a.aabb.upperBound.x=b.upperBound.x+c;a.aabb.upperBound.y=b.upperBound.y+e;this.InsertLeaf(a);return!0};t.prototype.Rebalance=function(a){void 0===a&&(a=0);if(null!=this.m_root)for(var b=0;b<a;b++){for(var e=this.m_root,c=0;!1==e.IsLeaf();)e=this.m_path>>c&1?e.child2:e.child1,c=c+1&31;++this.m_path;this.RemoveLeaf(e);this.InsertLeaf(e)}};
t.prototype.GetFatAABB=function(a){return a.aabb};t.prototype.GetUserData=function(a){return a.userData};t.prototype.Query=function(a,b){if(null!=this.m_root){var e=new Vector,c=0;for(e[c++]=this.m_root;0<c;){var d=e[--c];if(d.aabb.TestOverlap(b))if(d.IsLeaf()){if(!a(d))break}else e[c++]=d.child1,e[c++]=d.child2}}};t.prototype.RayCast=function(a,b){if(null!=this.m_root){var e=b.p1,c=b.p2,w=k.SubtractVV(e,c);w.Normalize();var w=k.CrossFV(1,w),f=k.AbsV(w),r=b.maxFraction,h=new d,g=0,s=0,g=e.x+r*(c.x-
e.x),s=e.y+r*(c.y-e.y);h.lowerBound.x=Math.min(e.x,g);h.lowerBound.y=Math.min(e.y,s);h.upperBound.x=Math.max(e.x,g);h.upperBound.y=Math.max(e.y,s);var l=new Vector,j=0;for(l[j++]=this.m_root;0<j;)if(r=l[--j],!1!=r.aabb.TestOverlap(h)&&(g=r.aabb.GetCenter(),s=r.aabb.GetExtents(),!(0<Math.abs(w.x*(e.x-g.x)+w.y*(e.y-g.y))-f.x*s.x-f.y*s.y)))if(r.IsLeaf()){g=new F;g.p1=b.p1;g.p2=b.p2;g.maxFraction=b.maxFraction;r=a(g,r);if(0==r)break;if(0<r)g=e.x+r*(c.x-e.x),s=e.y+r*(c.y-e.y),h.lowerBound.x=Math.min(e.x,
g),h.lowerBound.y=Math.min(e.y,s),h.upperBound.x=Math.max(e.x,g),h.upperBound.y=Math.max(e.y,s)}else l[j++]=r.child1,l[j++]=r.child2}};t.prototype.AllocateNode=function(){if(this.m_freeList){var a=this.m_freeList;this.m_freeList=a.parent;a.parent=null;a.child1=null;a.child2=null;return a}return new v};t.prototype.FreeNode=function(a){a.parent=this.m_freeList;this.m_freeList=a};t.prototype.InsertLeaf=function(a){++this.m_insertionCount;if(null==this.m_root)this.m_root=a,this.m_root.parent=null;else{var b=
a.aabb.GetCenter(),e=this.m_root;if(!1==e.IsLeaf()){do var c=e.child1,e=e.child2,e=Math.abs((c.aabb.lowerBound.x+c.aabb.upperBound.x)/2-b.x)+Math.abs((c.aabb.lowerBound.y+c.aabb.upperBound.y)/2-b.y)<Math.abs((e.aabb.lowerBound.x+e.aabb.upperBound.x)/2-b.x)+Math.abs((e.aabb.lowerBound.y+e.aabb.upperBound.y)/2-b.y)?c:e;while(!1==e.IsLeaf())}b=e.parent;c=this.AllocateNode();c.parent=b;c.userData=null;c.aabb.Combine(a.aabb,e.aabb);if(b){e.parent.child1==e?b.child1=c:b.child2=c;c.child1=e;c.child2=a;e.parent=
c;a.parent=c;do{if(b.aabb.Contains(c.aabb))break;b.aabb.Combine(b.child1.aabb,b.child2.aabb);c=b;b=b.parent}while(b)}else c.child1=e,c.child2=a,e.parent=c,this.m_root=a.parent=c}};t.prototype.RemoveLeaf=function(a){if(a==this.m_root)this.m_root=null;else{var b=a.parent,e=b.parent,a=b.child1==a?b.child2:b.child1;if(e){e.child1==b?e.child1=a:e.child2=a;a.parent=e;for(this.FreeNode(b);e;){b=e.aabb;e.aabb=d.Combine(e.child1.aabb,e.child2.aabb);if(b.Contains(e.aabb))break;e=e.parent}}else this.m_root=
a,a.parent=null,this.FreeNode(b)}};x.b2DynamicTreeBroadPhase=function(){this.m_tree=new t;this.m_moveBuffer=new Vector;this.m_pairBuffer=new Vector;this.m_pairCount=0};x.prototype.CreateProxy=function(a,b){var e=this.m_tree.CreateProxy(a,b);++this.m_proxyCount;this.BufferMove(e);return e};x.prototype.DestroyProxy=function(a){this.UnBufferMove(a);--this.m_proxyCount;this.m_tree.DestroyProxy(a)};x.prototype.MoveProxy=function(a,b,e){this.m_tree.MoveProxy(a,b,e)&&this.BufferMove(a)};x.prototype.TestOverlap=
function(a,b){var e=this.m_tree.GetFatAABB(a),c=this.m_tree.GetFatAABB(b);return e.TestOverlap(c)};x.prototype.GetUserData=function(a){return this.m_tree.GetUserData(a)};x.prototype.GetFatAABB=function(a){return this.m_tree.GetFatAABB(a)};x.prototype.GetProxyCount=function(){return this.m_proxyCount};x.prototype.UpdatePairs=function(a){for(var b=this,e=b.m_pairCount=0,c,e=0;e<b.m_moveBuffer.length;++e){c=b.m_moveBuffer[e];var d=b.m_tree.GetFatAABB(c);b.m_tree.Query(function(a){if(a==c)return!0;b.m_pairCount==
b.m_pairBuffer.length&&(b.m_pairBuffer[b.m_pairCount]=new y);var e=b.m_pairBuffer[b.m_pairCount];e.proxyA=a<c?a:c;e.proxyB=a>=c?a:c;++b.m_pairCount;return!0},d)}for(e=b.m_moveBuffer.length=0;e<b.m_pairCount;){var d=b.m_pairBuffer[e],w=b.m_tree.GetUserData(d.proxyA),f=b.m_tree.GetUserData(d.proxyB);a(w,f);for(++e;e<b.m_pairCount;){w=b.m_pairBuffer[e];if(w.proxyA!=d.proxyA||w.proxyB!=d.proxyB)break;++e}}};x.prototype.Query=function(a,b){this.m_tree.Query(a,b)};x.prototype.RayCast=function(a,b){this.m_tree.RayCast(a,
b)};x.prototype.Validate=function(){};x.prototype.Rebalance=function(a){void 0===a&&(a=0);this.m_tree.Rebalance(a)};x.prototype.BufferMove=function(a){this.m_moveBuffer[this.m_moveBuffer.length]=a};x.prototype.UnBufferMove=function(a){this.m_moveBuffer.splice(parseInt(this.m_moveBuffer.indexOf(a)),1)};x.prototype.ComparePairs=function(){return 0};x.__implements={};x.__implements[I]=!0;v.b2DynamicTreeNode=function(){this.aabb=new d};v.prototype.IsLeaf=function(){return null==this.child1};y.b2DynamicTreePair=
function(){};z.b2Manifold=function(){this.m_pointCount=0};z.prototype.b2Manifold=function(){this.m_points=new Vector(o.b2_maxManifoldPoints);for(var a=0;a<o.b2_maxManifoldPoints;a++)this.m_points[a]=new G;this.m_localPlaneNormal=new e;this.m_localPoint=new e};z.prototype.Reset=function(){for(var a=0;a<o.b2_maxManifoldPoints;a++)(this.m_points[a]instanceof G?this.m_points[a]:null).Reset();this.m_localPlaneNormal.SetZero();this.m_localPoint.SetZero();this.m_pointCount=this.m_type=0};z.prototype.Set=
function(a){this.m_pointCount=a.m_pointCount;for(var b=0;b<o.b2_maxManifoldPoints;b++)(this.m_points[b]instanceof G?this.m_points[b]:null).Set(a.m_points[b]);this.m_localPlaneNormal.SetV(a.m_localPlaneNormal);this.m_localPoint.SetV(a.m_localPoint);this.m_type=a.m_type};z.prototype.Copy=function(){var a=new z;a.Set(this);return a};Box2D.postDefs.push(function(){Box2D.Collision.b2Manifold.e_circles=1;Box2D.Collision.b2Manifold.e_faceA=2;Box2D.Collision.b2Manifold.e_faceB=4});G.b2ManifoldPoint=function(){this.m_localPoint=
new e;this.m_id=new j};G.prototype.b2ManifoldPoint=function(){this.Reset()};G.prototype.Reset=function(){this.m_localPoint.SetZero();this.m_tangentImpulse=this.m_normalImpulse=0;this.m_id.key=0};G.prototype.Set=function(a){this.m_localPoint.SetV(a.m_localPoint);this.m_normalImpulse=a.m_normalImpulse;this.m_tangentImpulse=a.m_tangentImpulse;this.m_id.Set(a.m_id)};D.b2Point=function(){this.p=new e};D.prototype.Support=function(){return this.p};D.prototype.GetFirstVertex=function(){return this.p};F.b2RayCastInput=
function(){this.p1=new e;this.p2=new e};F.prototype.b2RayCastInput=function(a,b,e){void 0===a&&(a=null);void 0===b&&(b=null);void 0===e&&(e=1);a&&this.p1.SetV(a);b&&this.p2.SetV(b);this.maxFraction=e};K.b2RayCastOutput=function(){this.normal=new e};J.b2Segment=function(){this.p1=new e;this.p2=new e};J.prototype.TestSegment=function(a,b,e,c){void 0===c&&(c=0);var d=e.p1,w=e.p2.x-d.x,f=e.p2.y-d.y,e=this.p2.y-this.p1.y,r=-(this.p2.x-this.p1.x),h=100*Number.MIN_VALUE,g=-(w*e+f*r);if(g>h){var s=d.x-this.p1.x,
l=d.y-this.p1.y,d=s*e+l*r;if(0<=d&&d<=c*g&&(c=-w*l+f*s,-h*g<=c&&c<=g*(1+h)))return d/=g,c=Math.sqrt(e*e+r*r),a[0]=d,b.Set(e/c,r/c),!0}return!1};J.prototype.Extend=function(a){this.ExtendForward(a);this.ExtendBackward(a)};J.prototype.ExtendForward=function(a){var b=this.p2.x-this.p1.x,e=this.p2.y-this.p1.y,a=Math.min(0<b?(a.upperBound.x-this.p1.x)/b:0>b?(a.lowerBound.x-this.p1.x)/b:Number.POSITIVE_INFINITY,0<e?(a.upperBound.y-this.p1.y)/e:0>e?(a.lowerBound.y-this.p1.y)/e:Number.POSITIVE_INFINITY);
this.p2.x=this.p1.x+b*a;this.p2.y=this.p1.y+e*a};J.prototype.ExtendBackward=function(a){var b=-this.p2.x+this.p1.x,e=-this.p2.y+this.p1.y,a=Math.min(0<b?(a.upperBound.x-this.p2.x)/b:0>b?(a.lowerBound.x-this.p2.x)/b:Number.POSITIVE_INFINITY,0<e?(a.upperBound.y-this.p2.y)/e:0>e?(a.lowerBound.y-this.p2.y)/e:Number.POSITIVE_INFINITY);this.p1.x=this.p2.x+b*a;this.p1.y=this.p2.y+e*a};s.b2SeparationFunction=function(){this.m_localPoint=new e;this.m_axis=new e};s.prototype.Initialize=function(a,b,c,d,w){this.m_proxyA=
b;this.m_proxyB=d;var f=parseInt(a.count);o.b2Assert(0<f&&3>f);var r,h,g,l,j=0,u=0;1==f?(this.m_type=s.e_points,r=this.m_proxyA.GetVertex(a.indexA[0]),h=this.m_proxyB.GetVertex(a.indexB[0]),f=r,a=c.R,b=c.position.x+(a.col1.x*f.x+a.col2.x*f.y),d=c.position.y+(a.col1.y*f.x+a.col2.y*f.y),f=h,a=w.R,g=w.position.x+(a.col1.x*f.x+a.col2.x*f.y),l=w.position.y+(a.col1.y*f.x+a.col2.y*f.y),this.m_axis.x=g-b,this.m_axis.y=l-d,this.m_axis.Normalize()):(a.indexB[0]==a.indexB[1]?(this.m_type=s.e_faceA,b=this.m_proxyA.GetVertex(a.indexA[0]),
d=this.m_proxyA.GetVertex(a.indexA[1]),h=this.m_proxyB.GetVertex(a.indexB[0]),this.m_localPoint.x=0.5*(b.x+d.x),this.m_localPoint.y=0.5*(b.y+d.y),this.m_axis=k.CrossVF(k.SubtractVV(d,b),1),this.m_axis.Normalize(),f=this.m_axis,a=c.R,j=a.col1.x*f.x+a.col2.x*f.y,u=a.col1.y*f.x+a.col2.y*f.y,f=this.m_localPoint,a=c.R,b=c.position.x+(a.col1.x*f.x+a.col2.x*f.y),d=c.position.y+(a.col1.y*f.x+a.col2.y*f.y),f=h,a=w.R,g=w.position.x+(a.col1.x*f.x+a.col2.x*f.y),l=w.position.y+(a.col1.y*f.x+a.col2.y*f.y),j=(g-
b)*j+(l-d)*u):a.indexA[0]==a.indexA[0]?(this.m_type=s.e_faceB,g=this.m_proxyB.GetVertex(a.indexB[0]),l=this.m_proxyB.GetVertex(a.indexB[1]),r=this.m_proxyA.GetVertex(a.indexA[0]),this.m_localPoint.x=0.5*(g.x+l.x),this.m_localPoint.y=0.5*(g.y+l.y),this.m_axis=k.CrossVF(k.SubtractVV(l,g),1),this.m_axis.Normalize(),f=this.m_axis,a=w.R,j=a.col1.x*f.x+a.col2.x*f.y,u=a.col1.y*f.x+a.col2.y*f.y,f=this.m_localPoint,a=w.R,g=w.position.x+(a.col1.x*f.x+a.col2.x*f.y),l=w.position.y+(a.col1.y*f.x+a.col2.y*f.y),
f=r,a=c.R,b=c.position.x+(a.col1.x*f.x+a.col2.x*f.y),d=c.position.y+(a.col1.y*f.x+a.col2.y*f.y),j=(b-g)*j+(d-l)*u):(b=this.m_proxyA.GetVertex(a.indexA[0]),d=this.m_proxyA.GetVertex(a.indexA[1]),g=this.m_proxyB.GetVertex(a.indexB[0]),l=this.m_proxyB.GetVertex(a.indexB[1]),k.MulX(c,r),r=k.MulMV(c.R,k.SubtractVV(d,b)),k.MulX(w,h),j=k.MulMV(w.R,k.SubtractVV(l,g)),w=r.x*r.x+r.y*r.y,h=j.x*j.x+j.y*j.y,a=k.SubtractVV(j,r),c=r.x*a.x+r.y*a.y,a=j.x*a.x+j.y*a.y,r=r.x*j.x+r.y*j.y,u=w*h-r*r,j=0,0!=u&&(j=k.Clamp((r*
a-c*h)/u,0,1)),0>(r*j+a)/h&&(j=k.Clamp((r-c)/w,0,1)),r=new e,r.x=b.x+j*(d.x-b.x),r.y=b.y+j*(d.y-b.y),h=new e,h.x=g.x+j*(l.x-g.x),h.y=g.y+j*(l.y-g.y),0==j||1==j?(this.m_type=s.e_faceB,this.m_axis=k.CrossVF(k.SubtractVV(l,g),1),this.m_axis.Normalize(),this.m_localPoint=h):(this.m_type=s.e_faceA,this.m_axis=k.CrossVF(k.SubtractVV(d,b),1),this.m_localPoint=r)),0>j&&this.m_axis.NegativeSelf())};s.prototype.Evaluate=function(a,b){var e,c,d=0;switch(this.m_type){case s.e_points:return e=k.MulTMV(a.R,this.m_axis),
c=k.MulTMV(b.R,this.m_axis.GetNegative()),e=this.m_proxyA.GetSupportVertex(e),c=this.m_proxyB.GetSupportVertex(c),e=k.MulX(a,e),c=k.MulX(b,c),(c.x-e.x)*this.m_axis.x+(c.y-e.y)*this.m_axis.y;case s.e_faceA:return d=k.MulMV(a.R,this.m_axis),e=k.MulX(a,this.m_localPoint),c=k.MulTMV(b.R,d.GetNegative()),c=this.m_proxyB.GetSupportVertex(c),c=k.MulX(b,c),(c.x-e.x)*d.x+(c.y-e.y)*d.y;case s.e_faceB:return d=k.MulMV(b.R,this.m_axis),c=k.MulX(b,this.m_localPoint),e=k.MulTMV(a.R,d.GetNegative()),e=this.m_proxyA.GetSupportVertex(e),
e=k.MulX(a,e),(e.x-c.x)*d.x+(e.y-c.y)*d.y;default:return o.b2Assert(!1),0}};Box2D.postDefs.push(function(){Box2D.Collision.b2SeparationFunction.e_points=1;Box2D.Collision.b2SeparationFunction.e_faceA=2;Box2D.Collision.b2SeparationFunction.e_faceB=4});u.b2Simplex=function(){this.m_v1=new E;this.m_v2=new E;this.m_v3=new E;this.m_vertices=new Vector(3)};u.prototype.b2Simplex=function(){this.m_vertices[0]=this.m_v1;this.m_vertices[1]=this.m_v2;this.m_vertices[2]=this.m_v3};u.prototype.ReadCache=function(a,
b,e,c,d){o.b2Assert(0<=a.count&&3>=a.count);var w,f;this.m_count=a.count;for(var r=this.m_vertices,h=0;h<this.m_count;h++){var g=r[h];g.indexA=a.indexA[h];g.indexB=a.indexB[h];w=b.GetVertex(g.indexA);f=c.GetVertex(g.indexB);g.wA=k.MulX(e,w);g.wB=k.MulX(d,f);g.w=k.SubtractVV(g.wB,g.wA);g.a=0}if(1<this.m_count&&(a=a.metric,w=this.GetMetric(),w<0.5*a||2*a<w||w<Number.MIN_VALUE))this.m_count=0;if(0==this.m_count)g=r[0],g.indexA=0,g.indexB=0,w=b.GetVertex(0),f=c.GetVertex(0),g.wA=k.MulX(e,w),g.wB=k.MulX(d,
f),g.w=k.SubtractVV(g.wB,g.wA),this.m_count=1};u.prototype.WriteCache=function(a){a.metric=this.GetMetric();a.count=Box2D.parseUInt(this.m_count);for(var b=this.m_vertices,e=0;e<this.m_count;e++)a.indexA[e]=Box2D.parseUInt(b[e].indexA),a.indexB[e]=Box2D.parseUInt(b[e].indexB)};u.prototype.GetSearchDirection=function(){switch(this.m_count){case 1:return this.m_v1.w.GetNegative();case 2:var a=k.SubtractVV(this.m_v2.w,this.m_v1.w);return 0<k.CrossVV(a,this.m_v1.w.GetNegative())?k.CrossFV(1,a):k.CrossVF(a,
1);default:return o.b2Assert(!1),new e}};u.prototype.GetClosestPoint=function(){switch(this.m_count){case 0:return o.b2Assert(!1),new e;case 1:return this.m_v1.w;case 2:return new e(this.m_v1.a*this.m_v1.w.x+this.m_v2.a*this.m_v2.w.x,this.m_v1.a*this.m_v1.w.y+this.m_v2.a*this.m_v2.w.y);default:return o.b2Assert(!1),new e}};u.prototype.GetWitnessPoints=function(a,b){switch(this.m_count){case 0:o.b2Assert(!1);break;case 1:a.SetV(this.m_v1.wA);b.SetV(this.m_v1.wB);break;case 2:a.x=this.m_v1.a*this.m_v1.wA.x+
this.m_v2.a*this.m_v2.wA.x;a.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y;b.x=this.m_v1.a*this.m_v1.wB.x+this.m_v2.a*this.m_v2.wB.x;b.y=this.m_v1.a*this.m_v1.wB.y+this.m_v2.a*this.m_v2.wB.y;break;case 3:b.x=a.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x+this.m_v3.a*this.m_v3.wA.x;b.y=a.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y+this.m_v3.a*this.m_v3.wA.y;break;default:o.b2Assert(!1)}};u.prototype.GetMetric=function(){switch(this.m_count){case 0:return o.b2Assert(!1),
0;case 1:return 0;case 2:return k.SubtractVV(this.m_v1.w,this.m_v2.w).Length();case 3:return k.CrossVV(k.SubtractVV(this.m_v2.w,this.m_v1.w),k.SubtractVV(this.m_v3.w,this.m_v1.w));default:return o.b2Assert(!1),0}};u.prototype.Solve2=function(){var a=this.m_v1.w,b=this.m_v2.w,e=k.SubtractVV(b,a),a=-(a.x*e.x+a.y*e.y);0>=a?this.m_count=this.m_v1.a=1:(b=b.x*e.x+b.y*e.y,0>=b?(this.m_count=this.m_v2.a=1,this.m_v1.Set(this.m_v2)):(e=1/(b+a),this.m_v1.a=b*e,this.m_v2.a=a*e,this.m_count=2))};u.prototype.Solve3=
function(){var a=this.m_v1.w,b=this.m_v2.w,e=this.m_v3.w,c=k.SubtractVV(b,a),d=k.Dot(a,c),w=k.Dot(b,c),d=-d,f=k.SubtractVV(e,a),r=k.Dot(a,f),h=k.Dot(e,f),r=-r,g=k.SubtractVV(e,b),s=k.Dot(b,g),g=k.Dot(e,g),s=-s,f=k.CrossVV(c,f),c=f*k.CrossVV(b,e),e=f*k.CrossVV(e,a),a=f*k.CrossVV(a,b);0>=d&&0>=r?this.m_count=this.m_v1.a=1:0<w&&0<d&&0>=a?(h=1/(w+d),this.m_v1.a=w*h,this.m_v2.a=d*h,this.m_count=2):0<h&&0<r&&0>=e?(w=1/(h+r),this.m_v1.a=h*w,this.m_v3.a=r*w,this.m_count=2,this.m_v2.Set(this.m_v3)):0>=w&&
0>=s?(this.m_count=this.m_v2.a=1,this.m_v1.Set(this.m_v2)):0>=h&&0>=g?(this.m_count=this.m_v3.a=1,this.m_v1.Set(this.m_v3)):0<g&&0<s&&0>=c?(w=1/(g+s),this.m_v2.a=g*w,this.m_v3.a=s*w,this.m_count=2,this.m_v1.Set(this.m_v3)):(w=1/(c+e+a),this.m_v1.a=c*w,this.m_v2.a=e*w,this.m_v3.a=a*w,this.m_count=3)};C.b2SimplexCache=function(){this.indexA=new Vector_a2j_Number(3);this.indexB=new Vector_a2j_Number(3)};E.b2SimplexVertex=function(){};E.prototype.Set=function(a){this.wA.SetV(a.wA);this.wB.SetV(a.wB);
this.w.SetV(a.w);this.a=a.a;this.indexA=a.indexA;this.indexB=a.indexB};H.b2TimeOfImpact=function(){};H.TimeOfImpact=function(a){++H.b2_toiCalls;var b=a.proxyA,e=a.proxyB,c=a.sweepA,d=a.sweepB;o.b2Assert(c.t0==d.t0);o.b2Assert(1-c.t0>Number.MIN_VALUE);var w=b.m_radius+e.m_radius,a=a.tolerance,f=0,r=0,h=0;H.s_cache.count=0;for(H.s_distanceInput.useRadii=!1;;){c.GetTransform(H.s_xfA,f);d.GetTransform(H.s_xfB,f);H.s_distanceInput.proxyA=b;H.s_distanceInput.proxyB=e;H.s_distanceInput.transformA=H.s_xfA;
H.s_distanceInput.transformB=H.s_xfB;p.Distance(H.s_distanceOutput,H.s_cache,H.s_distanceInput);if(0>=H.s_distanceOutput.distance){f=1;break}H.s_fcn.Initialize(H.s_cache,b,H.s_xfA,e,H.s_xfB);var g=H.s_fcn.Evaluate(H.s_xfA,H.s_xfB);if(0>=g){f=1;break}0==r&&(h=g>w?k.Max(w-a,0.75*w):k.Max(g-a,0.02*w));if(g-h<0.5*a){if(0==r){f=1;break}break}var s=f,l=f,j=1;c.GetTransform(H.s_xfA,j);d.GetTransform(H.s_xfB,j);var u=H.s_fcn.Evaluate(H.s_xfA,H.s_xfB);if(u>=h){f=1;break}for(var E=0;;){var I=0,I=E&1?l+(h-g)*
(j-l)/(u-g):0.5*(l+j);c.GetTransform(H.s_xfA,I);d.GetTransform(H.s_xfB,I);var C=H.s_fcn.Evaluate(H.s_xfA,H.s_xfB);if(k.Abs(C-h)<0.025*a){s=I;break}C>h?(l=I,g=C):(j=I,u=C);++E;++H.b2_toiRootIters;if(50==E)break}H.b2_toiMaxRootIters=k.Max(H.b2_toiMaxRootIters,E);if(s<(1+100*Number.MIN_VALUE)*f)break;f=s;r++;++H.b2_toiIters;if(1E3==r)break}H.b2_toiMaxIters=k.Max(H.b2_toiMaxIters,r);return f};Box2D.postDefs.push(function(){Box2D.Collision.b2TimeOfImpact.b2_toiCalls=0;Box2D.Collision.b2TimeOfImpact.b2_toiIters=
0;Box2D.Collision.b2TimeOfImpact.b2_toiMaxIters=0;Box2D.Collision.b2TimeOfImpact.b2_toiRootIters=0;Box2D.Collision.b2TimeOfImpact.b2_toiMaxRootIters=0;Box2D.Collision.b2TimeOfImpact.s_cache=new C;Box2D.Collision.b2TimeOfImpact.s_distanceInput=new A;Box2D.Collision.b2TimeOfImpact.s_xfA=new b;Box2D.Collision.b2TimeOfImpact.s_xfB=new b;Box2D.Collision.b2TimeOfImpact.s_fcn=new s;Box2D.Collision.b2TimeOfImpact.s_distanceOutput=new l});M.b2TOIInput=function(){this.proxyA=new B;this.proxyB=new B;this.sweepA=
new a;this.sweepB=new a};L.b2WorldManifold=function(){this.m_normal=new e};L.prototype.b2WorldManifold=function(){this.m_points=new Vector(o.b2_maxManifoldPoints);for(var a=0;a<o.b2_maxManifoldPoints;a++)this.m_points[a]=new e};L.prototype.Initialize=function(a,b,e,c,d){void 0===e&&(e=0);void 0===d&&(d=0);if(0!=a.m_pointCount){var w=0,f,r,h=0,g=0,s=0,l=0,j=0;switch(a.m_type){case z.e_circles:r=b.R;f=a.m_localPoint;w=b.position.x+r.col1.x*f.x+r.col2.x*f.y;b=b.position.y+r.col1.y*f.x+r.col2.y*f.y;r=
c.R;f=a.m_points[0].m_localPoint;a=c.position.x+r.col1.x*f.x+r.col2.x*f.y;c=c.position.y+r.col1.y*f.x+r.col2.y*f.y;f=a-w;r=c-b;h=f*f+r*r;h>Number.MIN_VALUE*Number.MIN_VALUE?(h=Math.sqrt(h),this.m_normal.x=f/h,this.m_normal.y=r/h):(this.m_normal.x=1,this.m_normal.y=0);f=b+e*this.m_normal.y;c-=d*this.m_normal.y;this.m_points[0].x=0.5*(w+e*this.m_normal.x+(a-d*this.m_normal.x));this.m_points[0].y=0.5*(f+c);break;case z.e_faceA:r=b.R;f=a.m_localPlaneNormal;h=r.col1.x*f.x+r.col2.x*f.y;g=r.col1.y*f.x+r.col2.y*
f.y;r=b.R;f=a.m_localPoint;s=b.position.x+r.col1.x*f.x+r.col2.x*f.y;l=b.position.y+r.col1.y*f.x+r.col2.y*f.y;this.m_normal.x=h;this.m_normal.y=g;for(w=0;w<a.m_pointCount;w++)r=c.R,f=a.m_points[w].m_localPoint,j=c.position.x+r.col1.x*f.x+r.col2.x*f.y,f=c.position.y+r.col1.y*f.x+r.col2.y*f.y,this.m_points[w].x=j+0.5*(e-(j-s)*h-(f-l)*g-d)*h,this.m_points[w].y=f+0.5*(e-(j-s)*h-(f-l)*g-d)*g;break;case z.e_faceB:r=c.R;f=a.m_localPlaneNormal;h=r.col1.x*f.x+r.col2.x*f.y;g=r.col1.y*f.x+r.col2.y*f.y;r=c.R;
f=a.m_localPoint;s=c.position.x+r.col1.x*f.x+r.col2.x*f.y;l=c.position.y+r.col1.y*f.x+r.col2.y*f.y;this.m_normal.x=-h;this.m_normal.y=-g;for(w=0;w<a.m_pointCount;w++)r=b.R,f=a.m_points[w].m_localPoint,j=b.position.x+r.col1.x*f.x+r.col2.x*f.y,f=b.position.y+r.col1.y*f.x+r.col2.y*f.y,this.m_points[w].x=j+0.5*(d-(j-s)*h-(f-l)*g-e)*h,this.m_points[w].y=f+0.5*(d-(j-s)*h-(f-l)*g-e)*g}}};w.ClipVertex=function(){this.v=new e;this.id=new j};w.prototype.Set=function(a){this.v.SetV(a.v);this.id.Set(a.id)};r.Features=
function(){};Object.defineProperty(r.prototype,"referenceEdge",{enumerable:!1,configurable:!0,get:function(){return this._referenceEdge}});Object.defineProperty(r.prototype,"referenceEdge",{enumerable:!1,configurable:!0,set:function(a){void 0===a&&(a=0);this._referenceEdge=a;this._m_id._key=this._m_id._key&4294967040|this._referenceEdge&255}});Object.defineProperty(r.prototype,"incidentEdge",{enumerable:!1,configurable:!0,get:function(){return this._incidentEdge}});Object.defineProperty(r.prototype,
"incidentEdge",{enumerable:!1,configurable:!0,set:function(a){void 0===a&&(a=0);this._incidentEdge=a;this._m_id._key=this._m_id._key&4294902015|this._incidentEdge<<8&65280}});Object.defineProperty(r.prototype,"incidentVertex",{enumerable:!1,configurable:!0,get:function(){return this._incidentVertex}});Object.defineProperty(r.prototype,"incidentVertex",{enumerable:!1,configurable:!0,set:function(a){void 0===a&&(a=0);this._incidentVertex=a;this._m_id._key=this._m_id._key&4278255615|this._incidentVertex<<
16&16711680}});Object.defineProperty(r.prototype,"flip",{enumerable:!1,configurable:!0,get:function(){return this._flip}});Object.defineProperty(r.prototype,"flip",{enumerable:!1,configurable:!0,set:function(a){void 0===a&&(a=0);this._flip=a;this._m_id._key=this._m_id._key&16777215|this._flip<<24&4278190080}})})();
(function(){var c=Box2D.Common.b2Settings,m=Box2D.Collision.Shapes.b2CircleShape,n=Box2D.Collision.Shapes.b2EdgeChainDef,o=Box2D.Collision.Shapes.b2EdgeShape,k=Box2D.Collision.Shapes.b2MassData,a=Box2D.Collision.Shapes.b2PolygonShape,b=Box2D.Collision.Shapes.b2Shape,e=Box2D.Common.Math.b2Mat22,d=Box2D.Common.Math.b2Math,f=Box2D.Common.Math.b2Transform,h=Box2D.Common.Math.b2Vec2,g=Box2D.Collision.b2Distance,j=Box2D.Collision.b2DistanceInput,q=Box2D.Collision.b2DistanceOutput,p=Box2D.Collision.b2DistanceProxy,
A=Box2D.Collision.b2SimplexCache;Box2D.inherit(m,Box2D.Collision.Shapes.b2Shape);m.prototype.__super=Box2D.Collision.Shapes.b2Shape.prototype;m.b2CircleShape=function(){Box2D.Collision.Shapes.b2Shape.b2Shape.apply(this,arguments);this.m_p=new h};m.prototype.Copy=function(){var a=new m;a.Set(this);return a};m.prototype.Set=function(a){this.__super.Set.call(this,a);Box2D.is(a,m)&&this.m_p.SetV((a instanceof m?a:null).m_p)};m.prototype.TestPoint=function(a,b){var e=a.R,c=a.position.x+(e.col1.x*this.m_p.x+
e.col2.x*this.m_p.y),e=a.position.y+(e.col1.y*this.m_p.x+e.col2.y*this.m_p.y),c=b.x-c,e=b.y-e;return c*c+e*e<=this.m_radius*this.m_radius};m.prototype.RayCast=function(a,b,e){var c=e.R,d=b.p1.x-(e.position.x+(c.col1.x*this.m_p.x+c.col2.x*this.m_p.y)),e=b.p1.y-(e.position.y+(c.col1.y*this.m_p.x+c.col2.y*this.m_p.y)),c=b.p2.x-b.p1.x,f=b.p2.y-b.p1.y,h=d*c+e*f,g=c*c+f*f,j=h*h-g*(d*d+e*e-this.m_radius*this.m_radius);if(0>j||g<Number.MIN_VALUE)return!1;h=-(h+Math.sqrt(j));return 0<=h&&h<=b.maxFraction*
g?(h/=g,a.fraction=h,a.normal.x=d+h*c,a.normal.y=e+h*f,a.normal.Normalize(),!0):!1};m.prototype.ComputeAABB=function(a,b){var e=b.R,c=b.position.x+(e.col1.x*this.m_p.x+e.col2.x*this.m_p.y),e=b.position.y+(e.col1.y*this.m_p.x+e.col2.y*this.m_p.y);a.lowerBound.Set(c-this.m_radius,e-this.m_radius);a.upperBound.Set(c+this.m_radius,e+this.m_radius)};m.prototype.ComputeMass=function(a,b){void 0===b&&(b=0);a.mass=b*c.b2_pi*this.m_radius*this.m_radius;a.center.SetV(this.m_p);a.I=a.mass*(0.5*this.m_radius*
this.m_radius+(this.m_p.x*this.m_p.x+this.m_p.y*this.m_p.y))};m.prototype.ComputeSubmergedArea=function(a,b,e,c){void 0===b&&(b=0);var e=d.MulX(e,this.m_p),f=-(d.Dot(a,e)-b);if(f<-this.m_radius+Number.MIN_VALUE)return 0;if(f>this.m_radius)return c.SetV(e),Math.PI*this.m_radius*this.m_radius;var b=this.m_radius*this.m_radius,h=f*f,f=b*(Math.asin(f/this.m_radius)+Math.PI/2)+f*Math.sqrt(b-h),b=-2/3*Math.pow(b-h,1.5)/f;c.x=e.x+a.x*b;c.y=e.y+a.y*b;return f};m.prototype.GetLocalPosition=function(){return this.m_p};
m.prototype.SetLocalPosition=function(a){this.m_p.SetV(a)};m.prototype.GetRadius=function(){return this.m_radius};m.prototype.SetRadius=function(a){void 0===a&&(a=0);this.m_radius=a};m.prototype.b2CircleShape=function(a){void 0===a&&(a=0);this.__super.b2Shape.call(this);this.m_type=b.e_circleShape;this.m_radius=a};n.b2EdgeChainDef=function(){};n.prototype.b2EdgeChainDef=function(){this.vertexCount=0;this.isALoop=!0;this.vertices=[]};Box2D.inherit(o,Box2D.Collision.Shapes.b2Shape);o.prototype.__super=
Box2D.Collision.Shapes.b2Shape.prototype;o.b2EdgeShape=function(){Box2D.Collision.Shapes.b2Shape.b2Shape.apply(this,arguments);this.s_supportVec=new h;this.m_v1=new h;this.m_v2=new h;this.m_coreV1=new h;this.m_coreV2=new h;this.m_normal=new h;this.m_direction=new h;this.m_cornerDir1=new h;this.m_cornerDir2=new h};o.prototype.TestPoint=function(){return!1};o.prototype.RayCast=function(a,b,e){var c,d=b.p2.x-b.p1.x,f=b.p2.y-b.p1.y;c=e.R;var h=e.position.x+(c.col1.x*this.m_v1.x+c.col2.x*this.m_v1.y),
g=e.position.y+(c.col1.y*this.m_v1.x+c.col2.y*this.m_v1.y),j=e.position.y+(c.col1.y*this.m_v2.x+c.col2.y*this.m_v2.y)-g,e=-(e.position.x+(c.col1.x*this.m_v2.x+c.col2.x*this.m_v2.y)-h);c=100*Number.MIN_VALUE;var q=-(d*j+f*e);if(q>c){var h=b.p1.x-h,k=b.p1.y-g,g=h*j+k*e;if(0<=g&&g<=b.maxFraction*q&&(b=-d*k+f*h,-c*q<=b&&b<=q*(1+c)))return a.fraction=g/q,b=Math.sqrt(j*j+e*e),a.normal.x=j/b,a.normal.y=e/b,!0}return!1};o.prototype.ComputeAABB=function(a,b){var e=b.R,c=b.position.x+(e.col1.x*this.m_v1.x+
e.col2.x*this.m_v1.y),d=b.position.y+(e.col1.y*this.m_v1.x+e.col2.y*this.m_v1.y),f=b.position.x+(e.col1.x*this.m_v2.x+e.col2.x*this.m_v2.y),e=b.position.y+(e.col1.y*this.m_v2.x+e.col2.y*this.m_v2.y);c<f?(a.lowerBound.x=c,a.upperBound.x=f):(a.lowerBound.x=f,a.upperBound.x=c);d<e?(a.lowerBound.y=d,a.upperBound.y=e):(a.lowerBound.y=e,a.upperBound.y=d)};o.prototype.ComputeMass=function(a){a.mass=0;a.center.SetV(this.m_v1);a.I=0};o.prototype.ComputeSubmergedArea=function(a,b,e,c){void 0===b&&(b=0);var f=
new h(a.x*b,a.y*b),g=d.MulX(e,this.m_v1),e=d.MulX(e,this.m_v2),j=d.Dot(a,g)-b,a=d.Dot(a,e)-b;if(0<j){if(0<a)return 0;g.x=-a/(j-a)*g.x+j/(j-a)*e.x;g.y=-a/(j-a)*g.y+j/(j-a)*e.y}else if(0<a)e.x=-a/(j-a)*g.x+j/(j-a)*e.x,e.y=-a/(j-a)*g.y+j/(j-a)*e.y;c.x=(f.x+g.x+e.x)/3;c.y=(f.y+g.y+e.y)/3;return 0.5*((g.x-f.x)*(e.y-f.y)-(g.y-f.y)*(e.x-f.x))};o.prototype.GetLength=function(){return this.m_length};o.prototype.GetVertex1=function(){return this.m_v1};o.prototype.GetVertex2=function(){return this.m_v2};o.prototype.GetCoreVertex1=
function(){return this.m_coreV1};o.prototype.GetCoreVertex2=function(){return this.m_coreV2};o.prototype.GetNormalVector=function(){return this.m_normal};o.prototype.GetDirectionVector=function(){return this.m_direction};o.prototype.GetCorner1Vector=function(){return this.m_cornerDir1};o.prototype.GetCorner2Vector=function(){return this.m_cornerDir2};o.prototype.Corner1IsConvex=function(){return this.m_cornerConvex1};o.prototype.Corner2IsConvex=function(){return this.m_cornerConvex2};o.prototype.GetFirstVertex=
function(a){var b=a.R;return new h(a.position.x+(b.col1.x*this.m_coreV1.x+b.col2.x*this.m_coreV1.y),a.position.y+(b.col1.y*this.m_coreV1.x+b.col2.y*this.m_coreV1.y))};o.prototype.GetNextEdge=function(){return this.m_nextEdge};o.prototype.GetPrevEdge=function(){return this.m_prevEdge};o.prototype.Support=function(a,b,e){void 0===b&&(b=0);void 0===e&&(e=0);var c=a.R,d=a.position.x+(c.col1.x*this.m_coreV1.x+c.col2.x*this.m_coreV1.y),f=a.position.y+(c.col1.y*this.m_coreV1.x+c.col2.y*this.m_coreV1.y),
h=a.position.x+(c.col1.x*this.m_coreV2.x+c.col2.x*this.m_coreV2.y),a=a.position.y+(c.col1.y*this.m_coreV2.x+c.col2.y*this.m_coreV2.y);d*b+f*e>h*b+a*e?(this.s_supportVec.x=d,this.s_supportVec.y=f):(this.s_supportVec.x=h,this.s_supportVec.y=a);return this.s_supportVec};o.prototype.b2EdgeShape=function(a,e){this.__super.b2Shape.call(this);this.m_type=b.e_edgeShape;this.m_nextEdge=this.m_prevEdge=null;this.m_v1=a;this.m_v2=e;this.m_direction.Set(this.m_v2.x-this.m_v1.x,this.m_v2.y-this.m_v1.y);this.m_length=
this.m_direction.Normalize();this.m_normal.Set(this.m_direction.y,-this.m_direction.x);this.m_coreV1.Set(-c.b2_toiSlop*(this.m_normal.x-this.m_direction.x)+this.m_v1.x,-c.b2_toiSlop*(this.m_normal.y-this.m_direction.y)+this.m_v1.y);this.m_coreV2.Set(-c.b2_toiSlop*(this.m_normal.x+this.m_direction.x)+this.m_v2.x,-c.b2_toiSlop*(this.m_normal.y+this.m_direction.y)+this.m_v2.y);this.m_cornerDir1=this.m_normal;this.m_cornerDir2.Set(-this.m_normal.x,-this.m_normal.y)};o.prototype.SetPrevEdge=function(a,
b,e,c){this.m_prevEdge=a;this.m_coreV1=b;this.m_cornerDir1=e;this.m_cornerConvex1=c};o.prototype.SetNextEdge=function(a,b,e,c){this.m_nextEdge=a;this.m_coreV2=b;this.m_cornerDir2=e;this.m_cornerConvex2=c};k.b2MassData=function(){this.mass=0;this.center=new h(0,0);this.I=0};Box2D.inherit(a,Box2D.Collision.Shapes.b2Shape);a.prototype.__super=Box2D.Collision.Shapes.b2Shape.prototype;a.b2PolygonShape=function(){Box2D.Collision.Shapes.b2Shape.b2Shape.apply(this,arguments)};a.prototype.Copy=function(){var b=
new a;b.Set(this);return b};a.prototype.Set=function(b){this.__super.Set.call(this,b);if(Box2D.is(b,a)){b=b instanceof a?b:null;this.m_centroid.SetV(b.m_centroid);this.m_vertexCount=b.m_vertexCount;this.Reserve(this.m_vertexCount);for(var e=0;e<this.m_vertexCount;e++)this.m_vertices[e].SetV(b.m_vertices[e]),this.m_normals[e].SetV(b.m_normals[e])}};a.prototype.SetAsArray=function(a,b){void 0===b&&(b=0);for(var e=new Vector,c=0,d,c=0;c<a.length;++c)d=a[c],e.push(d);this.SetAsVector(e,b)};a.AsArray=
function(b,e){void 0===e&&(e=0);var c=new a;c.SetAsArray(b,e);return c};a.prototype.SetAsVector=function(b,e){void 0===e&&(e=0);if(0==e)e=b.length;c.b2Assert(2<=e);this.m_vertexCount=e;this.Reserve(e);for(var f=0,f=0;f<this.m_vertexCount;f++)this.m_vertices[f].SetV(b[f]);for(f=0;f<this.m_vertexCount;++f){var h=parseInt(f),g=parseInt(f+1<this.m_vertexCount?f+1:0),h=d.SubtractVV(this.m_vertices[g],this.m_vertices[h]);c.b2Assert(h.LengthSquared()>Number.MIN_VALUE);this.m_normals[f].SetV(d.CrossVF(h,
1));this.m_normals[f].Normalize()}this.m_centroid=a.ComputeCentroid(this.m_vertices,this.m_vertexCount)};a.AsVector=function(b,e){void 0===e&&(e=0);var c=new a;c.SetAsVector(b,e);return c};a.prototype.SetAsBox=function(a,b){void 0===a&&(a=0);void 0===b&&(b=0);this.m_vertexCount=4;this.Reserve(4);this.m_vertices[0].Set(-a,-b);this.m_vertices[1].Set(a,-b);this.m_vertices[2].Set(a,b);this.m_vertices[3].Set(-a,b);this.m_normals[0].Set(0,-1);this.m_normals[1].Set(1,0);this.m_normals[2].Set(0,1);this.m_normals[3].Set(-1,
0);this.m_centroid.SetZero()};a.AsBox=function(b,e){void 0===b&&(b=0);void 0===e&&(e=0);var c=new a;c.SetAsBox(b,e);return c};a.prototype.SetAsOrientedBox=function(a,b,e,c){void 0===a&&(a=0);void 0===b&&(b=0);void 0===e&&(e=null);void 0===c&&(c=0);this.m_vertexCount=4;this.Reserve(4);this.m_vertices[0].Set(-a,-b);this.m_vertices[1].Set(a,-b);this.m_vertices[2].Set(a,b);this.m_vertices[3].Set(-a,b);this.m_normals[0].Set(0,-1);this.m_normals[1].Set(1,0);this.m_normals[2].Set(0,1);this.m_normals[3].Set(-1,
0);this.m_centroid=e;a=new f;a.position=e;a.R.Set(c);for(e=0;e<this.m_vertexCount;++e)this.m_vertices[e]=d.MulX(a,this.m_vertices[e]),this.m_normals[e]=d.MulMV(a.R,this.m_normals[e])};a.AsOrientedBox=function(b,e,c,d){void 0===b&&(b=0);void 0===e&&(e=0);void 0===c&&(c=null);void 0===d&&(d=0);var f=new a;f.SetAsOrientedBox(b,e,c,d);return f};a.prototype.SetAsEdge=function(a,b){this.m_vertexCount=2;this.Reserve(2);this.m_vertices[0].SetV(a);this.m_vertices[1].SetV(b);this.m_centroid.x=0.5*(a.x+b.x);
this.m_centroid.y=0.5*(a.y+b.y);this.m_normals[0]=d.CrossVF(d.SubtractVV(b,a),1);this.m_normals[0].Normalize();this.m_normals[1].x=-this.m_normals[0].x;this.m_normals[1].y=-this.m_normals[0].y};a.AsEdge=function(b,e){var c=new a;c.SetAsEdge(b,e);return c};a.prototype.TestPoint=function(a,b){var e;e=a.R;for(var c=b.x-a.position.x,d=b.y-a.position.y,f=c*e.col1.x+d*e.col1.y,h=c*e.col2.x+d*e.col2.y,g=0;g<this.m_vertexCount;++g)if(e=this.m_vertices[g],c=f-e.x,d=h-e.y,e=this.m_normals[g],0<e.x*c+e.y*d)return!1;
return!0};a.prototype.RayCast=function(a,b,e){var c=0,d=b.maxFraction,f=0,h=0,g,j,f=b.p1.x-e.position.x,h=b.p1.y-e.position.y;g=e.R;var q=f*g.col1.x+h*g.col1.y,k=f*g.col2.x+h*g.col2.y,f=b.p2.x-e.position.x,h=b.p2.y-e.position.y;g=e.R;b=f*g.col1.x+h*g.col1.y-q;g=f*g.col2.x+h*g.col2.y-k;for(var p=-1,s=0;s<this.m_vertexCount;++s){j=this.m_vertices[s];f=j.x-q;h=j.y-k;j=this.m_normals[s];f=j.x*f+j.y*h;h=j.x*b+j.y*g;if(0==h){if(0>f)return!1}else 0>h&&f<c*h?(c=f/h,p=s):0<h&&f<d*h&&(d=f/h);if(d<c-Number.MIN_VALUE)return!1}return 0<=
p?(a.fraction=c,g=e.R,j=this.m_normals[p],a.normal.x=g.col1.x*j.x+g.col2.x*j.y,a.normal.y=g.col1.y*j.x+g.col2.y*j.y,!0):!1};a.prototype.ComputeAABB=function(a,b){for(var e=b.R,c=this.m_vertices[0],d=b.position.x+(e.col1.x*c.x+e.col2.x*c.y),f=b.position.y+(e.col1.y*c.x+e.col2.y*c.y),h=d,g=f,j=1;j<this.m_vertexCount;++j)var c=this.m_vertices[j],q=b.position.x+(e.col1.x*c.x+e.col2.x*c.y),c=b.position.y+(e.col1.y*c.x+e.col2.y*c.y),d=d<q?d:q,f=f<c?f:c,h=h>q?h:q,g=g>c?g:c;a.lowerBound.x=d-this.m_radius;
a.lowerBound.y=f-this.m_radius;a.upperBound.x=h+this.m_radius;a.upperBound.y=g+this.m_radius};a.prototype.ComputeMass=function(a,b){void 0===b&&(b=0);if(2==this.m_vertexCount)a.center.x=0.5*(this.m_vertices[0].x+this.m_vertices[1].x),a.center.y=0.5*(this.m_vertices[0].y+this.m_vertices[1].y),a.mass=0,a.I=0;else{for(var e=0,c=0,d=0,f=0,h=1/3,g=0;g<this.m_vertexCount;++g)var j=this.m_vertices[g],q=g+1<this.m_vertexCount?this.m_vertices[parseInt(g+1)]:this.m_vertices[0],k=j.x-0,p=j.y-0,s=q.x-0,u=q.y-
0,C=k*u-p*s,E=0.5*C,d=d+E,e=e+E*h*(0+j.x+q.x),c=c+E*h*(0+j.y+q.y),j=k,f=f+C*(h*(0.25*(j*j+s*j+s*s)+(0*j+0*s))+0+(h*(0.25*(p*p+u*p+u*u)+(0*p+0*u))+0));a.mass=b*d;a.center.Set(e*(1/d),c*(1/d));a.I=b*f}};a.prototype.ComputeSubmergedArea=function(a,b,e,c){void 0===b&&(b=0);for(var f=d.MulTMV(e.R,a),g=b-d.Dot(a,e.position),j=new Vector_a2j_Number,q=0,p=-1,b=-1,A=!1,a=a=0;a<this.m_vertexCount;++a){j[a]=d.Dot(f,this.m_vertices[a])-g;var m=j[a]<-Number.MIN_VALUE;0<a&&(m?A||(p=a-1,q++):A&&(b=a-1,q++));A=m}switch(q){case 0:return A?
(a=new k,this.ComputeMass(a,1),c.SetV(d.MulX(e,a.center)),a.mass):0;case 1:-1==p?p=this.m_vertexCount-1:b=this.m_vertexCount-1}a=parseInt((p+1)%this.m_vertexCount);f=parseInt((b+1)%this.m_vertexCount);g=(0-j[p])/(j[a]-j[p]);j=(0-j[b])/(j[f]-j[b]);p=new h(this.m_vertices[p].x*(1-g)+this.m_vertices[a].x*g,this.m_vertices[p].y*(1-g)+this.m_vertices[a].y*g);b=new h(this.m_vertices[b].x*(1-j)+this.m_vertices[f].x*j,this.m_vertices[b].y*(1-j)+this.m_vertices[f].y*j);j=0;g=new h;for(q=this.m_vertices[a];a!=
f;)a=(a+1)%this.m_vertexCount,A=a==f?b:this.m_vertices[a],m=0.5*((q.x-p.x)*(A.y-p.y)-(q.y-p.y)*(A.x-p.x)),j+=m,g.x+=m*(p.x+q.x+A.x)/3,g.y+=m*(p.y+q.y+A.y)/3,q=A;g.Multiply(1/j);c.SetV(d.MulX(e,g));return j};a.prototype.GetVertexCount=function(){return this.m_vertexCount};a.prototype.GetVertices=function(){return this.m_vertices};a.prototype.GetNormals=function(){return this.m_normals};a.prototype.GetSupport=function(a){for(var b=0,e=this.m_vertices[0].x*a.x+this.m_vertices[0].y*a.y,c=1;c<this.m_vertexCount;++c){var d=
this.m_vertices[c].x*a.x+this.m_vertices[c].y*a.y;d>e&&(b=c,e=d)}return b};a.prototype.GetSupportVertex=function(a){for(var b=0,e=this.m_vertices[0].x*a.x+this.m_vertices[0].y*a.y,c=1;c<this.m_vertexCount;++c){var d=this.m_vertices[c].x*a.x+this.m_vertices[c].y*a.y;d>e&&(b=c,e=d)}return this.m_vertices[b]};a.prototype.Validate=function(){return!1};a.prototype.b2PolygonShape=function(){this.__super.b2Shape.call(this);this.m_type=b.e_polygonShape;this.m_centroid=new h;this.m_vertices=new Vector;this.m_normals=
new Vector};a.prototype.Reserve=function(a){void 0===a&&(a=0);for(var b=parseInt(this.m_vertices.length);b<a;b++)this.m_vertices[b]=new h,this.m_normals[b]=new h};a.ComputeCentroid=function(a,b){void 0===b&&(b=0);for(var e=new h,c=0,d=1/3,f=0;f<b;++f){var g=a[f],j=f+1<b?a[parseInt(f+1)]:a[0],q=0.5*((g.x-0)*(j.y-0)-(g.y-0)*(j.x-0)),c=c+q;e.x+=q*d*(0+g.x+j.x);e.y+=q*d*(0+g.y+j.y)}e.x*=1/c;e.y*=1/c;return e};a.ComputeOBB=function(a,b,e){void 0===e&&(e=0);for(var c=0,d=new Vector(e+1),c=0;c<e;++c)d[c]=
b[c];d[e]=d[0];b=Number.MAX_VALUE;for(c=1;c<=e;++c){for(var f=d[parseInt(c-1)],g=d[c].x-f.x,h=d[c].y-f.y,j=Math.sqrt(g*g+h*h),g=g/j,h=h/j,q=-h,k=g,p=j=Number.MAX_VALUE,s=-Number.MAX_VALUE,u=-Number.MAX_VALUE,C=0;C<e;++C){var E=d[C].x-f.x,H=d[C].y-f.y,M=g*E+h*H,E=q*E+k*H;M<j&&(j=M);E<p&&(p=E);M>s&&(s=M);E>u&&(u=E)}C=(s-j)*(u-p);if(C<0.95*b)b=C,a.R.col1.x=g,a.R.col1.y=h,a.R.col2.x=q,a.R.col2.y=k,g=0.5*(j+s),h=0.5*(p+u),q=a.R,a.center.x=f.x+(q.col1.x*g+q.col2.x*h),a.center.y=f.y+(q.col1.y*g+q.col2.y*
h),a.extents.x=0.5*(s-j),a.extents.y=0.5*(u-p)}};Box2D.postDefs.push(function(){Box2D.Collision.Shapes.b2PolygonShape.s_mat=new e});b.b2Shape=function(){};b.prototype.Copy=function(){return null};b.prototype.Set=function(a){this.m_radius=a.m_radius};b.prototype.GetType=function(){return this.m_type};b.prototype.TestPoint=function(){return!1};b.prototype.RayCast=function(){return!1};b.prototype.ComputeAABB=function(){};b.prototype.ComputeMass=function(){};b.prototype.ComputeSubmergedArea=function(){return 0};
b.TestOverlap=function(a,b,e,c){var d=new j;d.proxyA=new p;d.proxyA.Set(a);d.proxyB=new p;d.proxyB.Set(e);d.transformA=b;d.transformB=c;d.useRadii=!0;a=new A;a.count=0;b=new q;g.Distance(b,a,d);return b.distance<10*Number.MIN_VALUE};b.prototype.b2Shape=function(){this.m_type=b.e_unknownShape;this.m_radius=c.b2_linearSlop};Box2D.postDefs.push(function(){Box2D.Collision.Shapes.b2Shape.e_unknownShape=-1;Box2D.Collision.Shapes.b2Shape.e_circleShape=0;Box2D.Collision.Shapes.b2Shape.e_polygonShape=1;Box2D.Collision.Shapes.b2Shape.e_edgeShape=
2;Box2D.Collision.Shapes.b2Shape.e_shapeTypeCount=3;Box2D.Collision.Shapes.b2Shape.e_hitCollide=1;Box2D.Collision.Shapes.b2Shape.e_missCollide=0;Box2D.Collision.Shapes.b2Shape.e_startsInsideCollide=-1})})();
(function(){var c=Box2D.Common.b2Color,m=Box2D.Common.b2Settings,n=Box2D.Common.Math.b2Math;c.b2Color=function(){this._b=this._g=this._r=0};c.prototype.b2Color=function(c,k,a){void 0===c&&(c=0);void 0===k&&(k=0);void 0===a&&(a=0);this._r=Box2D.parseUInt(255*n.Clamp(c,0,1));this._g=Box2D.parseUInt(255*n.Clamp(k,0,1));this._b=Box2D.parseUInt(255*n.Clamp(a,0,1))};c.prototype.Set=function(c,k,a){void 0===c&&(c=0);void 0===k&&(k=0);void 0===a&&(a=0);this._r=Box2D.parseUInt(255*n.Clamp(c,0,1));this._g=
Box2D.parseUInt(255*n.Clamp(k,0,1));this._b=Box2D.parseUInt(255*n.Clamp(a,0,1))};Object.defineProperty(c.prototype,"r",{enumerable:!1,configurable:!0,set:function(c){void 0===c&&(c=0);this._r=Box2D.parseUInt(255*n.Clamp(c,0,1))}});Object.defineProperty(c.prototype,"g",{enumerable:!1,configurable:!0,set:function(c){void 0===c&&(c=0);this._g=Box2D.parseUInt(255*n.Clamp(c,0,1))}});Object.defineProperty(c.prototype,"b",{enumerable:!1,configurable:!0,set:function(c){void 0===c&&(c=0);this._b=Box2D.parseUInt(255*
n.Clamp(c,0,1))}});Object.defineProperty(c.prototype,"color",{enumerable:!1,configurable:!0,get:function(){return this._r<<16|this._g<<8|this._b}});m.b2Settings=function(){};m.b2MixFriction=function(c,k){void 0===c&&(c=0);void 0===k&&(k=0);return Math.sqrt(c*k)};m.b2MixRestitution=function(c,k){void 0===c&&(c=0);void 0===k&&(k=0);return c>k?c:k};m.b2Assert=function(c){if(!c)throw"Assertion Failed";};Box2D.postDefs.push(function(){Box2D.Common.b2Settings.VERSION="2.1alpha";Box2D.Common.b2Settings.USHRT_MAX=
65535;Box2D.Common.b2Settings.b2_pi=Math.PI;Box2D.Common.b2Settings.b2_maxManifoldPoints=2;Box2D.Common.b2Settings.b2_aabbExtension=0.1;Box2D.Common.b2Settings.b2_aabbMultiplier=2;Box2D.Common.b2Settings.b2_polygonRadius=2*m.b2_linearSlop;Box2D.Common.b2Settings.b2_linearSlop=0.0050;Box2D.Common.b2Settings.b2_angularSlop=2/180*m.b2_pi;Box2D.Common.b2Settings.b2_toiSlop=8*m.b2_linearSlop;Box2D.Common.b2Settings.b2_maxTOIContactsPerIsland=32;Box2D.Common.b2Settings.b2_maxTOIJointsPerIsland=32;Box2D.Common.b2Settings.b2_velocityThreshold=
1;Box2D.Common.b2Settings.b2_maxLinearCorrection=0.2;Box2D.Common.b2Settings.b2_maxAngularCorrection=8/180*m.b2_pi;Box2D.Common.b2Settings.b2_maxTranslation=2;Box2D.Common.b2Settings.b2_maxTranslationSquared=m.b2_maxTranslation*m.b2_maxTranslation;Box2D.Common.b2Settings.b2_maxRotation=0.5*m.b2_pi;Box2D.Common.b2Settings.b2_maxRotationSquared=m.b2_maxRotation*m.b2_maxRotation;Box2D.Common.b2Settings.b2_contactBaumgarte=0.2;Box2D.Common.b2Settings.b2_timeToSleep=0.5;Box2D.Common.b2Settings.b2_linearSleepTolerance=
0.01;Box2D.Common.b2Settings.b2_angularSleepTolerance=2/180*m.b2_pi})})();
(function(){var c=Box2D.Common.Math.b2Mat22,m=Box2D.Common.Math.b2Mat33,n=Box2D.Common.Math.b2Math,o=Box2D.Common.Math.b2Sweep,k=Box2D.Common.Math.b2Transform,a=Box2D.Common.Math.b2Vec2,b=Box2D.Common.Math.b2Vec3;c.b2Mat22=function(){this.col1=new a;this.col2=new a};c.prototype.b2Mat22=function(){this.SetIdentity()};c.FromAngle=function(a){void 0===a&&(a=0);var b=new c;b.Set(a);return b};c.FromVV=function(a,b){var f=new c;f.SetVV(a,b);return f};c.prototype.Set=function(a){void 0===a&&(a=0);var b=
Math.cos(a),a=Math.sin(a);this.col1.x=b;this.col2.x=-a;this.col1.y=a;this.col2.y=b};c.prototype.SetVV=function(a,b){this.col1.SetV(a);this.col2.SetV(b)};c.prototype.Copy=function(){var a=new c;a.SetM(this);return a};c.prototype.SetM=function(a){this.col1.SetV(a.col1);this.col2.SetV(a.col2)};c.prototype.AddM=function(a){this.col1.x+=a.col1.x;this.col1.y+=a.col1.y;this.col2.x+=a.col2.x;this.col2.y+=a.col2.y};c.prototype.SetIdentity=function(){this.col1.x=1;this.col2.x=0;this.col1.y=0;this.col2.y=1};
c.prototype.SetZero=function(){this.col1.x=0;this.col2.x=0;this.col1.y=0;this.col2.y=0};c.prototype.GetAngle=function(){return Math.atan2(this.col1.y,this.col1.x)};c.prototype.GetInverse=function(a){var b=this.col1.x,c=this.col2.x,h=this.col1.y,g=this.col2.y,j=b*g-c*h;0!=j&&(j=1/j);a.col1.x=j*g;a.col2.x=-j*c;a.col1.y=-j*h;a.col2.y=j*b;return a};c.prototype.Solve=function(a,b,c){void 0===b&&(b=0);void 0===c&&(c=0);var h=this.col1.x,g=this.col2.x,j=this.col1.y,q=this.col2.y,k=h*q-g*j;0!=k&&(k=1/k);
a.x=k*(q*b-g*c);a.y=k*(h*c-j*b);return a};c.prototype.Abs=function(){this.col1.Abs();this.col2.Abs()};m.b2Mat33=function(){this.col1=new b;this.col2=new b;this.col3=new b};m.prototype.b2Mat33=function(a,b,c){void 0===a&&(a=null);void 0===b&&(b=null);void 0===c&&(c=null);!a&&!b&&!c?(this.col1.SetZero(),this.col2.SetZero(),this.col3.SetZero()):(this.col1.SetV(a),this.col2.SetV(b),this.col3.SetV(c))};m.prototype.SetVVV=function(a,b,c){this.col1.SetV(a);this.col2.SetV(b);this.col3.SetV(c)};m.prototype.Copy=
function(){return new m(this.col1,this.col2,this.col3)};m.prototype.SetM=function(a){this.col1.SetV(a.col1);this.col2.SetV(a.col2);this.col3.SetV(a.col3)};m.prototype.AddM=function(a){this.col1.x+=a.col1.x;this.col1.y+=a.col1.y;this.col1.z+=a.col1.z;this.col2.x+=a.col2.x;this.col2.y+=a.col2.y;this.col2.z+=a.col2.z;this.col3.x+=a.col3.x;this.col3.y+=a.col3.y;this.col3.z+=a.col3.z};m.prototype.SetIdentity=function(){this.col1.x=1;this.col2.x=0;this.col3.x=0;this.col1.y=0;this.col2.y=1;this.col3.y=0;
this.col1.z=0;this.col2.z=0;this.col3.z=1};m.prototype.SetZero=function(){this.col1.x=0;this.col2.x=0;this.col3.x=0;this.col1.y=0;this.col2.y=0;this.col3.y=0;this.col1.z=0;this.col2.z=0;this.col3.z=0};m.prototype.Solve22=function(a,b,c){void 0===b&&(b=0);void 0===c&&(c=0);var h=this.col1.x,g=this.col2.x,j=this.col1.y,q=this.col2.y,k=h*q-g*j;0!=k&&(k=1/k);a.x=k*(q*b-g*c);a.y=k*(h*c-j*b);return a};m.prototype.Solve33=function(a,b,c,h){void 0===b&&(b=0);void 0===c&&(c=0);void 0===h&&(h=0);var g=this.col1.x,
j=this.col1.y,q=this.col1.z,k=this.col2.x,A=this.col2.y,l=this.col2.z,m=this.col3.x,n=this.col3.y,o=this.col3.z,v=g*(A*o-l*n)+j*(l*m-k*o)+q*(k*n-A*m);0!=v&&(v=1/v);a.x=v*(b*(A*o-l*n)+c*(l*m-k*o)+h*(k*n-A*m));a.y=v*(g*(c*o-h*n)+j*(h*m-b*o)+q*(b*n-c*m));a.z=v*(g*(A*h-l*c)+j*(l*b-k*h)+q*(k*c-A*b));return a};n.b2Math=function(){};n.IsValid=function(a){void 0===a&&(a=0);return isFinite(a)};n.Dot=function(a,b){return a.x*b.x+a.y*b.y};n.CrossVV=function(a,b){return a.x*b.y-a.y*b.x};n.CrossVF=function(b,
c){void 0===c&&(c=0);return new a(c*b.y,-c*b.x)};n.CrossFV=function(b,c){void 0===b&&(b=0);return new a(-b*c.y,b*c.x)};n.MulMV=function(b,c){return new a(b.col1.x*c.x+b.col2.x*c.y,b.col1.y*c.x+b.col2.y*c.y)};n.MulTMV=function(b,c){return new a(n.Dot(c,b.col1),n.Dot(c,b.col2))};n.MulX=function(a,b){var c=n.MulMV(a.R,b);c.x+=a.position.x;c.y+=a.position.y;return c};n.MulXT=function(a,b){var c=n.SubtractVV(b,a.position),h=c.x*a.R.col1.x+c.y*a.R.col1.y;c.y=c.x*a.R.col2.x+c.y*a.R.col2.y;c.x=h;return c};
n.AddVV=function(b,c){return new a(b.x+c.x,b.y+c.y)};n.SubtractVV=function(b,c){return new a(b.x-c.x,b.y-c.y)};n.Distance=function(a,b){var c=a.x-b.x,h=a.y-b.y;return Math.sqrt(c*c+h*h)};n.DistanceSquared=function(a,b){var c=a.x-b.x,h=a.y-b.y;return c*c+h*h};n.MulFV=function(b,c){void 0===b&&(b=0);return new a(b*c.x,b*c.y)};n.AddMM=function(a,b){return c.FromVV(n.AddVV(a.col1,b.col1),n.AddVV(a.col2,b.col2))};n.MulMM=function(a,b){return c.FromVV(n.MulMV(a,b.col1),n.MulMV(a,b.col2))};n.MulTMM=function(b,
d){var f=new a(n.Dot(b.col1,d.col1),n.Dot(b.col2,d.col1)),h=new a(n.Dot(b.col1,d.col2),n.Dot(b.col2,d.col2));return c.FromVV(f,h)};n.Abs=function(a){void 0===a&&(a=0);return 0<a?a:-a};n.AbsV=function(b){return new a(n.Abs(b.x),n.Abs(b.y))};n.AbsM=function(a){return c.FromVV(n.AbsV(a.col1),n.AbsV(a.col2))};n.Min=function(a,b){void 0===a&&(a=0);void 0===b&&(b=0);return a<b?a:b};n.MinV=function(b,c){return new a(n.Min(b.x,c.x),n.Min(b.y,c.y))};n.Max=function(a,b){void 0===a&&(a=0);void 0===b&&(b=0);
return a>b?a:b};n.MaxV=function(b,c){return new a(n.Max(b.x,c.x),n.Max(b.y,c.y))};n.Clamp=function(a,b,c){void 0===a&&(a=0);void 0===b&&(b=0);void 0===c&&(c=0);return a<b?b:a>c?c:a};n.ClampV=function(a,b,c){return n.MaxV(b,n.MinV(a,c))};n.Swap=function(a,b){var c=a[0];a[0]=b[0];b[0]=c};n.Random=function(){return 2*Math.random()-1};n.RandomRange=function(a,b){void 0===a&&(a=0);void 0===b&&(b=0);var c=Math.random();return(b-a)*c+a};n.NextPowerOfTwo=function(a){void 0===a&&(a=0);a|=a>>1&2147483647;a|=
a>>2&1073741823;a|=a>>4&268435455;a|=a>>8&16777215;return(a|a>>16&65535)+1};n.IsPowerOfTwo=function(a){void 0===a&&(a=0);return 0<a&&0==(a&a-1)};Box2D.postDefs.push(function(){Box2D.Common.Math.b2Math.b2Vec2_zero=new a(0,0);Box2D.Common.Math.b2Math.b2Mat22_identity=c.FromVV(new a(1,0),new a(0,1));Box2D.Common.Math.b2Math.b2Transform_identity=new k(n.b2Vec2_zero,n.b2Mat22_identity)});o.b2Sweep=function(){this.localCenter=new a;this.c0=new a;this.c=new a};o.prototype.Set=function(a){this.localCenter.SetV(a.localCenter);
this.c0.SetV(a.c0);this.c.SetV(a.c);this.a0=a.a0;this.a=a.a;this.t0=a.t0};o.prototype.Copy=function(){var a=new o;a.localCenter.SetV(this.localCenter);a.c0.SetV(this.c0);a.c.SetV(this.c);a.a0=this.a0;a.a=this.a;a.t0=this.t0;return a};o.prototype.GetTransform=function(a,b){void 0===b&&(b=0);a.position.x=(1-b)*this.c0.x+b*this.c.x;a.position.y=(1-b)*this.c0.y+b*this.c.y;a.R.Set((1-b)*this.a0+b*this.a);var c=a.R;a.position.x-=c.col1.x*this.localCenter.x+c.col2.x*this.localCenter.y;a.position.y-=c.col1.y*
this.localCenter.x+c.col2.y*this.localCenter.y};o.prototype.Advance=function(a){void 0===a&&(a=0);if(this.t0<a&&1-this.t0>Number.MIN_VALUE){var b=(a-this.t0)/(1-this.t0);this.c0.x=(1-b)*this.c0.x+b*this.c.x;this.c0.y=(1-b)*this.c0.y+b*this.c.y;this.a0=(1-b)*this.a0+b*this.a;this.t0=a}};k.b2Transform=function(){this.position=new a;this.R=new c};k.prototype.b2Transform=function(a,b){void 0===a&&(a=null);void 0===b&&(b=null);a&&(this.position.SetV(a),this.R.SetM(b))};k.prototype.Initialize=function(a,
b){this.position.SetV(a);this.R.SetM(b)};k.prototype.SetIdentity=function(){this.position.SetZero();this.R.SetIdentity()};k.prototype.Set=function(a){this.position.SetV(a.position);this.R.SetM(a.R)};k.prototype.GetAngle=function(){return Math.atan2(this.R.col1.y,this.R.col1.x)};a.b2Vec2=function(){};a.prototype.b2Vec2=function(a,b){void 0===a&&(a=0);void 0===b&&(b=0);this.x=a;this.y=b};a.prototype.SetZero=function(){this.y=this.x=0};a.prototype.Set=function(a,b){void 0===a&&(a=0);void 0===b&&(b=0);
this.x=a;this.y=b};a.prototype.SetV=function(a){this.x=a.x;this.y=a.y};a.prototype.GetNegative=function(){return new a(-this.x,-this.y)};a.prototype.NegativeSelf=function(){this.x=-this.x;this.y=-this.y};a.Make=function(b,c){void 0===b&&(b=0);void 0===c&&(c=0);return new a(b,c)};a.prototype.Copy=function(){return new a(this.x,this.y)};a.prototype.Add=function(a){this.x+=a.x;this.y+=a.y};a.prototype.Subtract=function(a){this.x-=a.x;this.y-=a.y};a.prototype.Multiply=function(a){void 0===a&&(a=0);this.x*=
a;this.y*=a};a.prototype.MulM=function(a){var b=this.x;this.x=a.col1.x*b+a.col2.x*this.y;this.y=a.col1.y*b+a.col2.y*this.y};a.prototype.MulTM=function(a){var b=n.Dot(this,a.col1);this.y=n.Dot(this,a.col2);this.x=b};a.prototype.CrossVF=function(a){void 0===a&&(a=0);var b=this.x;this.x=a*this.y;this.y=-a*b};a.prototype.CrossFV=function(a){void 0===a&&(a=0);var b=this.x;this.x=-a*this.y;this.y=a*b};a.prototype.MinV=function(a){this.x=this.x<a.x?this.x:a.x;this.y=this.y<a.y?this.y:a.y};a.prototype.MaxV=
function(a){this.x=this.x>a.x?this.x:a.x;this.y=this.y>a.y?this.y:a.y};a.prototype.Abs=function(){if(0>this.x)this.x=-this.x;if(0>this.y)this.y=-this.y};a.prototype.Length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)};a.prototype.LengthSquared=function(){return this.x*this.x+this.y*this.y};a.prototype.Normalize=function(){var a=Math.sqrt(this.x*this.x+this.y*this.y);if(a<Number.MIN_VALUE)return 0;var b=1/a;this.x*=b;this.y*=b;return a};a.prototype.IsValid=function(){return n.IsValid(this.x)&&
n.IsValid(this.y)};b.b2Vec3=function(){};b.prototype.b2Vec3=function(a,b,c){void 0===a&&(a=0);void 0===b&&(b=0);void 0===c&&(c=0);this.x=a;this.y=b;this.z=c};b.prototype.SetZero=function(){this.x=this.y=this.z=0};b.prototype.Set=function(a,b,c){void 0===a&&(a=0);void 0===b&&(b=0);void 0===c&&(c=0);this.x=a;this.y=b;this.z=c};b.prototype.SetV=function(a){this.x=a.x;this.y=a.y;this.z=a.z};b.prototype.GetNegative=function(){return new b(-this.x,-this.y,-this.z)};b.prototype.NegativeSelf=function(){this.x=
-this.x;this.y=-this.y;this.z=-this.z};b.prototype.Copy=function(){return new b(this.x,this.y,this.z)};b.prototype.Add=function(a){this.x+=a.x;this.y+=a.y;this.z+=a.z};b.prototype.Subtract=function(a){this.x-=a.x;this.y-=a.y;this.z-=a.z};b.prototype.Multiply=function(a){void 0===a&&(a=0);this.x*=a;this.y*=a;this.z*=a}})();
(function(){var c=Box2D.Common.Math.b2Math,m=Box2D.Common.Math.b2Sweep,n=Box2D.Common.Math.b2Transform,o=Box2D.Common.Math.b2Vec2,k=Box2D.Common.b2Color,a=Box2D.Common.b2Settings,b=Box2D.Collision.b2AABB,e=Box2D.Collision.b2ContactPoint,d=Box2D.Collision.b2DynamicTreeBroadPhase,f=Box2D.Collision.b2RayCastInput,h=Box2D.Collision.b2RayCastOutput,g=Box2D.Collision.Shapes.b2CircleShape,j=Box2D.Collision.Shapes.b2EdgeShape,q=Box2D.Collision.Shapes.b2MassData,p=Box2D.Collision.Shapes.b2PolygonShape,A=Box2D.Collision.Shapes.b2Shape,
l=Box2D.Dynamics.b2Body,B=Box2D.Dynamics.b2BodyDef,t=Box2D.Dynamics.b2ContactFilter,x=Box2D.Dynamics.b2ContactImpulse,v=Box2D.Dynamics.b2ContactListener,y=Box2D.Dynamics.b2ContactManager,z=Box2D.Dynamics.b2DebugDraw,G=Box2D.Dynamics.b2DestructionListener,D=Box2D.Dynamics.b2FilterData,F=Box2D.Dynamics.b2Fixture,K=Box2D.Dynamics.b2FixtureDef,J=Box2D.Dynamics.b2Island,s=Box2D.Dynamics.b2TimeStep,u=Box2D.Dynamics.b2World,C=Box2D.Dynamics.Contacts.b2Contact,E=Box2D.Dynamics.Contacts.b2ContactFactory,H=
Box2D.Dynamics.Contacts.b2ContactSolver,M=Box2D.Dynamics.Joints.b2Joint,L=Box2D.Dynamics.Joints.b2PulleyJoint;l.b2Body=function(){this.m_xf=new n;this.m_sweep=new m;this.m_linearVelocity=new o;this.m_force=new o};l.prototype.connectEdges=function(b,e,d){void 0===d&&(d=0);var f=Math.atan2(e.GetDirectionVector().y,e.GetDirectionVector().x),d=c.MulFV(Math.tan(0.5*(f-d)),e.GetDirectionVector()),d=c.SubtractVV(d,e.GetNormalVector()),d=c.MulFV(a.b2_toiSlop,d),d=c.AddVV(d,e.GetVertex1()),g=c.AddVV(b.GetDirectionVector(),
e.GetDirectionVector());g.Normalize();var h=0<c.Dot(b.GetDirectionVector(),e.GetNormalVector());b.SetNextEdge(e,d,g,h);e.SetPrevEdge(b,d,g,h);return f};l.prototype.CreateFixture=function(a){if(!0==this.m_world.IsLocked())return null;var b=new F;b.Create(this,this.m_xf,a);this.m_flags&l.e_activeFlag&&b.CreateProxy(this.m_world.m_contactManager.m_broadPhase,this.m_xf);b.m_next=this.m_fixtureList;this.m_fixtureList=b;++this.m_fixtureCount;b.m_body=this;0<b.m_density&&this.ResetMassData();this.m_world.m_flags|=
u.e_newFixture;return b};l.prototype.CreateFixture2=function(a,b){void 0===b&&(b=0);var c=new K;c.shape=a;c.density=b;return this.CreateFixture(c)};l.prototype.DestroyFixture=function(a){if(!0!=this.m_world.IsLocked()){for(var b=this.m_fixtureList,c=null;null!=b;){if(b==a){c?c.m_next=a.m_next:this.m_fixtureList=a.m_next;break}c=b;b=b.m_next}for(b=this.m_contactList;b;){var c=b.contact,b=b.next,e=c.GetFixtureA(),d=c.GetFixtureB();(a==e||a==d)&&this.m_world.m_contactManager.Destroy(c)}this.m_flags&
l.e_activeFlag&&a.DestroyProxy(this.m_world.m_contactManager.m_broadPhase);a.Destroy();a.m_body=null;a.m_next=null;--this.m_fixtureCount;this.ResetMassData()}};l.prototype.SetPositionAndAngle=function(a,b){void 0===b&&(b=0);var c;if(!0!=this.m_world.IsLocked()){this.m_xf.R.Set(b);this.m_xf.position.SetV(a);c=this.m_xf.R;var e=this.m_sweep.localCenter;this.m_sweep.c.x=c.col1.x*e.x+c.col2.x*e.y;this.m_sweep.c.y=c.col1.y*e.x+c.col2.y*e.y;this.m_sweep.c.x+=this.m_xf.position.x;this.m_sweep.c.y+=this.m_xf.position.y;
this.m_sweep.c0.SetV(this.m_sweep.c);this.m_sweep.a0=this.m_sweep.a=b;e=this.m_world.m_contactManager.m_broadPhase;for(c=this.m_fixtureList;c;c=c.m_next)c.Synchronize(e,this.m_xf,this.m_xf);this.m_world.m_contactManager.FindNewContacts()}};l.prototype.SetTransform=function(a){this.SetPositionAndAngle(a.position,a.GetAngle())};l.prototype.GetTransform=function(){return this.m_xf};l.prototype.GetPosition=function(){return this.m_xf.position};l.prototype.SetPosition=function(a){this.SetPositionAndAngle(a,
this.GetAngle())};l.prototype.GetAngle=function(){return this.m_sweep.a};l.prototype.SetAngle=function(a){void 0===a&&(a=0);this.SetPositionAndAngle(this.GetPosition(),a)};l.prototype.GetWorldCenter=function(){return this.m_sweep.c};l.prototype.GetLocalCenter=function(){return this.m_sweep.localCenter};l.prototype.SetLinearVelocity=function(a){this.m_type!=l.b2_staticBody&&this.m_linearVelocity.SetV(a)};l.prototype.GetLinearVelocity=function(){return this.m_linearVelocity};l.prototype.SetAngularVelocity=
function(a){void 0===a&&(a=0);if(this.m_type!=l.b2_staticBody)this.m_angularVelocity=a};l.prototype.GetAngularVelocity=function(){return this.m_angularVelocity};l.prototype.GetDefinition=function(){var a=new B;a.type=this.GetType();a.allowSleep=(this.m_flags&l.e_allowSleepFlag)==l.e_allowSleepFlag;a.angle=this.GetAngle();a.angularDamping=this.m_angularDamping;a.angularVelocity=this.m_angularVelocity;a.fixedRotation=(this.m_flags&l.e_fixedRotationFlag)==l.e_fixedRotationFlag;a.bullet=(this.m_flags&
l.e_bulletFlag)==l.e_bulletFlag;a.awake=(this.m_flags&l.e_awakeFlag)==l.e_awakeFlag;a.linearDamping=this.m_linearDamping;a.linearVelocity.SetV(this.GetLinearVelocity());a.position=this.GetPosition();a.userData=this.GetUserData();return a};l.prototype.ApplyForce=function(a,b){this.m_type==l.b2_dynamicBody&&(!1==this.IsAwake()&&this.SetAwake(!0),this.m_force.x+=a.x,this.m_force.y+=a.y,this.m_torque+=(b.x-this.m_sweep.c.x)*a.y-(b.y-this.m_sweep.c.y)*a.x)};l.prototype.ApplyTorque=function(a){void 0===
a&&(a=0);this.m_type==l.b2_dynamicBody&&(!1==this.IsAwake()&&this.SetAwake(!0),this.m_torque+=a)};l.prototype.ApplyImpulse=function(a,b){this.m_type==l.b2_dynamicBody&&(!1==this.IsAwake()&&this.SetAwake(!0),this.m_linearVelocity.x+=this.m_invMass*a.x,this.m_linearVelocity.y+=this.m_invMass*a.y,this.m_angularVelocity+=this.m_invI*((b.x-this.m_sweep.c.x)*a.y-(b.y-this.m_sweep.c.y)*a.x))};l.prototype.Split=function(a){for(var b=this.GetLinearVelocity().Copy(),e=this.GetAngularVelocity(),d=this.GetWorldCenter(),
f=this.m_world.CreateBody(this.GetDefinition()),g,h=this.m_fixtureList;h;)if(a(h)){var s=h.m_next;g?g.m_next=s:this.m_fixtureList=s;this.m_fixtureCount--;h.m_next=f.m_fixtureList;f.m_fixtureList=h;f.m_fixtureCount++;h.m_body=f;h=s}else g=h,h=h.m_next;this.ResetMassData();f.ResetMassData();g=this.GetWorldCenter();a=f.GetWorldCenter();g=c.AddVV(b,c.CrossFV(e,c.SubtractVV(g,d)));b=c.AddVV(b,c.CrossFV(e,c.SubtractVV(a,d)));this.SetLinearVelocity(g);f.SetLinearVelocity(b);this.SetAngularVelocity(e);f.SetAngularVelocity(e);
this.SynchronizeFixtures();f.SynchronizeFixtures();return f};l.prototype.Merge=function(a){var b;for(b=a.m_fixtureList;b;){var c=b.m_next;a.m_fixtureCount--;b.m_next=this.m_fixtureList;this.m_fixtureList=b;this.m_fixtureCount++;b.m_body=d;b=c}e.m_fixtureCount=0;var e=this,d=a;e.GetWorldCenter();d.GetWorldCenter();e.GetLinearVelocity().Copy();d.GetLinearVelocity().Copy();e.GetAngularVelocity();d.GetAngularVelocity();e.ResetMassData();this.SynchronizeFixtures()};l.prototype.GetMass=function(){return this.m_mass};
l.prototype.GetInertia=function(){return this.m_I};l.prototype.GetMassData=function(a){a.mass=this.m_mass;a.I=this.m_I;a.center.SetV(this.m_sweep.localCenter)};l.prototype.SetMassData=function(b){a.b2Assert(!1==this.m_world.IsLocked());if(!0!=this.m_world.IsLocked()&&this.m_type==l.b2_dynamicBody){this.m_invI=this.m_I=this.m_invMass=0;this.m_mass=b.mass;if(0>=this.m_mass)this.m_mass=1;this.m_invMass=1/this.m_mass;if(0<b.I&&0==(this.m_flags&l.e_fixedRotationFlag))this.m_I=b.I-this.m_mass*(b.center.x*
b.center.x+b.center.y*b.center.y),this.m_invI=1/this.m_I;var e=this.m_sweep.c.Copy();this.m_sweep.localCenter.SetV(b.center);this.m_sweep.c0.SetV(c.MulX(this.m_xf,this.m_sweep.localCenter));this.m_sweep.c.SetV(this.m_sweep.c0);this.m_linearVelocity.x+=this.m_angularVelocity*-(this.m_sweep.c.y-e.y);this.m_linearVelocity.y+=this.m_angularVelocity*+(this.m_sweep.c.x-e.x)}};l.prototype.ResetMassData=function(){this.m_invI=this.m_I=this.m_invMass=this.m_mass=0;this.m_sweep.localCenter.SetZero();if(!(this.m_type==
l.b2_staticBody||this.m_type==l.b2_kinematicBody)){for(var b=o.Make(0,0),e=this.m_fixtureList;e;e=e.m_next)if(0!=e.m_density){var d=e.GetMassData();this.m_mass+=d.mass;b.x+=d.center.x*d.mass;b.y+=d.center.y*d.mass;this.m_I+=d.I}0<this.m_mass?(this.m_invMass=1/this.m_mass,b.x*=this.m_invMass,b.y*=this.m_invMass):this.m_invMass=this.m_mass=1;0<this.m_I&&0==(this.m_flags&l.e_fixedRotationFlag)?(this.m_I-=this.m_mass*(b.x*b.x+b.y*b.y),this.m_I*=this.m_inertiaScale,a.b2Assert(0<this.m_I),this.m_invI=1/
this.m_I):this.m_invI=this.m_I=0;e=this.m_sweep.c.Copy();this.m_sweep.localCenter.SetV(b);this.m_sweep.c0.SetV(c.MulX(this.m_xf,this.m_sweep.localCenter));this.m_sweep.c.SetV(this.m_sweep.c0);this.m_linearVelocity.x+=this.m_angularVelocity*-(this.m_sweep.c.y-e.y);this.m_linearVelocity.y+=this.m_angularVelocity*+(this.m_sweep.c.x-e.x)}};l.prototype.GetWorldPoint=function(a){var b=this.m_xf.R,a=new o(b.col1.x*a.x+b.col2.x*a.y,b.col1.y*a.x+b.col2.y*a.y);a.x+=this.m_xf.position.x;a.y+=this.m_xf.position.y;
return a};l.prototype.GetWorldVector=function(a){return c.MulMV(this.m_xf.R,a)};l.prototype.GetLocalPoint=function(a){return c.MulXT(this.m_xf,a)};l.prototype.GetLocalVector=function(a){return c.MulTMV(this.m_xf.R,a)};l.prototype.GetLinearVelocityFromWorldPoint=function(a){return new o(this.m_linearVelocity.x-this.m_angularVelocity*(a.y-this.m_sweep.c.y),this.m_linearVelocity.y+this.m_angularVelocity*(a.x-this.m_sweep.c.x))};l.prototype.GetLinearVelocityFromLocalPoint=function(a){var b=this.m_xf.R,
a=new o(b.col1.x*a.x+b.col2.x*a.y,b.col1.y*a.x+b.col2.y*a.y);a.x+=this.m_xf.position.x;a.y+=this.m_xf.position.y;return new o(this.m_linearVelocity.x-this.m_angularVelocity*(a.y-this.m_sweep.c.y),this.m_linearVelocity.y+this.m_angularVelocity*(a.x-this.m_sweep.c.x))};l.prototype.GetLinearDamping=function(){return this.m_linearDamping};l.prototype.SetLinearDamping=function(a){void 0===a&&(a=0);this.m_linearDamping=a};l.prototype.GetAngularDamping=function(){return this.m_angularDamping};l.prototype.SetAngularDamping=
function(a){void 0===a&&(a=0);this.m_angularDamping=a};l.prototype.SetType=function(a){void 0===a&&(a=0);if(this.m_type!=a){this.m_type=a;this.ResetMassData();if(this.m_type==l.b2_staticBody)this.m_linearVelocity.SetZero(),this.m_angularVelocity=0;this.SetAwake(!0);this.m_force.SetZero();this.m_torque=0;for(a=this.m_contactList;a;a=a.next)a.contact.FlagForFiltering()}};l.prototype.GetType=function(){return this.m_type};l.prototype.SetBullet=function(a){this.m_flags=a?this.m_flags|l.e_bulletFlag:this.m_flags&
~l.e_bulletFlag};l.prototype.IsBullet=function(){return(this.m_flags&l.e_bulletFlag)==l.e_bulletFlag};l.prototype.SetSleepingAllowed=function(a){a?this.m_flags|=l.e_allowSleepFlag:(this.m_flags&=~l.e_allowSleepFlag,this.SetAwake(!0))};l.prototype.SetAwake=function(a){a?(this.m_flags|=l.e_awakeFlag,this.m_sleepTime=0):(this.m_flags&=~l.e_awakeFlag,this.m_sleepTime=0,this.m_linearVelocity.SetZero(),this.m_angularVelocity=0,this.m_force.SetZero(),this.m_torque=0)};l.prototype.IsAwake=function(){return(this.m_flags&
l.e_awakeFlag)==l.e_awakeFlag};l.prototype.SetFixedRotation=function(a){this.m_flags=a?this.m_flags|l.e_fixedRotationFlag:this.m_flags&~l.e_fixedRotationFlag;this.ResetMassData()};l.prototype.IsFixedRotation=function(){return(this.m_flags&l.e_fixedRotationFlag)==l.e_fixedRotationFlag};l.prototype.SetActive=function(a){if(a!=this.IsActive()){var b;if(a){this.m_flags|=l.e_activeFlag;a=this.m_world.m_contactManager.m_broadPhase;for(b=this.m_fixtureList;b;b=b.m_next)b.CreateProxy(a,this.m_xf)}else{this.m_flags&=
~l.e_activeFlag;a=this.m_world.m_contactManager.m_broadPhase;for(b=this.m_fixtureList;b;b=b.m_next)b.DestroyProxy(a);for(a=this.m_contactList;a;)b=a,a=a.next,this.m_world.m_contactManager.Destroy(b.contact);this.m_contactList=null}}};l.prototype.IsActive=function(){return(this.m_flags&l.e_activeFlag)==l.e_activeFlag};l.prototype.IsSleepingAllowed=function(){return(this.m_flags&l.e_allowSleepFlag)==l.e_allowSleepFlag};l.prototype.GetFixtureList=function(){return this.m_fixtureList};l.prototype.GetJointList=
function(){return this.m_jointList};l.prototype.GetControllerList=function(){return this.m_controllerList};l.prototype.GetContactList=function(){return this.m_contactList};l.prototype.GetNext=function(){return this.m_next};l.prototype.GetUserData=function(){return this.m_userData};l.prototype.SetUserData=function(a){this.m_userData=a};l.prototype.GetWorld=function(){return this.m_world};l.prototype.b2Body=function(a,b){this.m_flags=0;a.bullet&&(this.m_flags|=l.e_bulletFlag);a.fixedRotation&&(this.m_flags|=
l.e_fixedRotationFlag);a.allowSleep&&(this.m_flags|=l.e_allowSleepFlag);a.awake&&(this.m_flags|=l.e_awakeFlag);a.active&&(this.m_flags|=l.e_activeFlag);this.m_world=b;this.m_xf.position.SetV(a.position);this.m_xf.R.Set(a.angle);this.m_sweep.localCenter.SetZero();this.m_sweep.t0=1;this.m_sweep.a0=this.m_sweep.a=a.angle;var c=this.m_xf.R,e=this.m_sweep.localCenter;this.m_sweep.c.x=c.col1.x*e.x+c.col2.x*e.y;this.m_sweep.c.y=c.col1.y*e.x+c.col2.y*e.y;this.m_sweep.c.x+=this.m_xf.position.x;this.m_sweep.c.y+=
this.m_xf.position.y;this.m_sweep.c0.SetV(this.m_sweep.c);this.m_contactList=this.m_controllerList=this.m_jointList=null;this.m_controllerCount=0;this.m_next=this.m_prev=null;this.m_linearVelocity.SetV(a.linearVelocity);this.m_angularVelocity=a.angularVelocity;this.m_linearDamping=a.linearDamping;this.m_angularDamping=a.angularDamping;this.m_force.Set(0,0);this.m_sleepTime=this.m_torque=0;this.m_type=a.type;this.m_invMass=this.m_type==l.b2_dynamicBody?this.m_mass=1:this.m_mass=0;this.m_invI=this.m_I=
0;this.m_inertiaScale=a.inertiaScale;this.m_userData=a.userData;this.m_fixtureList=null;this.m_fixtureCount=0};l.prototype.SynchronizeFixtures=function(){var a=l.s_xf1;a.R.Set(this.m_sweep.a0);var b=a.R,c=this.m_sweep.localCenter;a.position.x=this.m_sweep.c0.x-(b.col1.x*c.x+b.col2.x*c.y);a.position.y=this.m_sweep.c0.y-(b.col1.y*c.x+b.col2.y*c.y);c=this.m_world.m_contactManager.m_broadPhase;for(b=this.m_fixtureList;b;b=b.m_next)b.Synchronize(c,a,this.m_xf)};l.prototype.SynchronizeTransform=function(){this.m_xf.R.Set(this.m_sweep.a);
var a=this.m_xf.R,b=this.m_sweep.localCenter;this.m_xf.position.x=this.m_sweep.c.x-(a.col1.x*b.x+a.col2.x*b.y);this.m_xf.position.y=this.m_sweep.c.y-(a.col1.y*b.x+a.col2.y*b.y)};l.prototype.ShouldCollide=function(a){if(this.m_type!=l.b2_dynamicBody&&a.m_type!=l.b2_dynamicBody)return!1;for(var b=this.m_jointList;b;b=b.next)if(b.other==a&&!1==b.joint.m_collideConnected)return!1;return!0};l.prototype.Advance=function(a){void 0===a&&(a=0);this.m_sweep.Advance(a);this.m_sweep.c.SetV(this.m_sweep.c0);this.m_sweep.a=
this.m_sweep.a0;this.SynchronizeTransform()};Box2D.postDefs.push(function(){Box2D.Dynamics.b2Body.s_xf1=new n;Box2D.Dynamics.b2Body.e_islandFlag=1;Box2D.Dynamics.b2Body.e_awakeFlag=2;Box2D.Dynamics.b2Body.e_allowSleepFlag=4;Box2D.Dynamics.b2Body.e_bulletFlag=8;Box2D.Dynamics.b2Body.e_fixedRotationFlag=16;Box2D.Dynamics.b2Body.e_activeFlag=32;Box2D.Dynamics.b2Body.b2_staticBody=0;Box2D.Dynamics.b2Body.b2_kinematicBody=1;Box2D.Dynamics.b2Body.b2_dynamicBody=2});B.b2BodyDef=function(){this.position=
new o;this.linearVelocity=new o};B.prototype.b2BodyDef=function(){this.userData=null;this.position.Set(0,0);this.angle=0;this.linearVelocity.Set(0,0);this.angularDamping=this.linearDamping=this.angularVelocity=0;this.awake=this.allowSleep=!0;this.bullet=this.fixedRotation=!1;this.type=l.b2_staticBody;this.active=!0;this.inertiaScale=1};t.b2ContactFilter=function(){};t.prototype.ShouldCollide=function(a,b){var c=a.GetFilterData(),e=b.GetFilterData();return c.groupIndex==e.groupIndex&&0!=c.groupIndex?
0<c.groupIndex:0!=(c.maskBits&e.categoryBits)&&0!=(c.categoryBits&e.maskBits)};t.prototype.RayCollide=function(a,b){return!a?!0:this.ShouldCollide(a instanceof F?a:null,b)};Box2D.postDefs.push(function(){Box2D.Dynamics.b2ContactFilter.b2_defaultFilter=new t});x.b2ContactImpulse=function(){this.normalImpulses=new Vector_a2j_Number(a.b2_maxManifoldPoints);this.tangentImpulses=new Vector_a2j_Number(a.b2_maxManifoldPoints)};v.b2ContactListener=function(){};v.prototype.BeginContact=function(){};v.prototype.EndContact=
function(){};v.prototype.PreSolve=function(){};v.prototype.PostSolve=function(){};Box2D.postDefs.push(function(){Box2D.Dynamics.b2ContactListener.b2_defaultListener=new v});y.b2ContactManager=function(){};y.prototype.b2ContactManager=function(){this.m_world=null;this.m_contactCount=0;this.m_contactFilter=t.b2_defaultFilter;this.m_contactListener=v.b2_defaultListener;this.m_contactFactory=new E(this.m_allocator);this.m_broadPhase=new d};y.prototype.AddPair=function(a,b){var c=a instanceof F?a:null,
e=b instanceof F?b:null,d=c.GetBody(),f=e.GetBody();if(d!=f){for(var g=f.GetContactList();g;){if(g.other==d){var h=g.contact.GetFixtureA(),s=g.contact.GetFixtureB();if(h==c&&s==e||h==e&&s==c)return}g=g.next}if(!1!=f.ShouldCollide(d)&&!1!=this.m_contactFilter.ShouldCollide(c,e)){g=this.m_contactFactory.Create(c,e);c=g.GetFixtureA();e=g.GetFixtureB();d=c.m_body;f=e.m_body;g.m_prev=null;g.m_next=this.m_world.m_contactList;if(null!=this.m_world.m_contactList)this.m_world.m_contactList.m_prev=g;this.m_world.m_contactList=
g;g.m_nodeA.contact=g;g.m_nodeA.other=f;g.m_nodeA.prev=null;g.m_nodeA.next=d.m_contactList;if(null!=d.m_contactList)d.m_contactList.prev=g.m_nodeA;d.m_contactList=g.m_nodeA;g.m_nodeB.contact=g;g.m_nodeB.other=d;g.m_nodeB.prev=null;g.m_nodeB.next=f.m_contactList;if(null!=f.m_contactList)f.m_contactList.prev=g.m_nodeB;f.m_contactList=g.m_nodeB;++this.m_world.m_contactCount}}};y.prototype.FindNewContacts=function(){this.m_broadPhase.UpdatePairs(Box2D.generateCallback(this,this.AddPair))};y.prototype.Destroy=
function(a){var b=a.GetFixtureA(),c=a.GetFixtureB(),b=b.GetBody(),c=c.GetBody();a.IsTouching()&&this.m_contactListener.EndContact(a);if(a.m_prev)a.m_prev.m_next=a.m_next;if(a.m_next)a.m_next.m_prev=a.m_prev;if(a==this.m_world.m_contactList)this.m_world.m_contactList=a.m_next;if(a.m_nodeA.prev)a.m_nodeA.prev.next=a.m_nodeA.next;if(a.m_nodeA.next)a.m_nodeA.next.prev=a.m_nodeA.prev;if(a.m_nodeA==b.m_contactList)b.m_contactList=a.m_nodeA.next;if(a.m_nodeB.prev)a.m_nodeB.prev.next=a.m_nodeB.next;if(a.m_nodeB.next)a.m_nodeB.next.prev=
a.m_nodeB.prev;if(a.m_nodeB==c.m_contactList)c.m_contactList=a.m_nodeB.next;this.m_contactFactory.Destroy(a);--this.m_contactCount};y.prototype.Collide=function(){for(var a=this.m_world.m_contactList;a;){var b=a.GetFixtureA(),c=a.GetFixtureB(),e=b.GetBody(),d=c.GetBody();if(!1==e.IsAwake()&&!1==d.IsAwake())a=a.GetNext();else{if(a.m_flags&C.e_filterFlag){if(!1==d.ShouldCollide(e)){b=a;a=b.GetNext();this.Destroy(b);continue}if(!1==this.m_contactFilter.ShouldCollide(b,c)){b=a;a=b.GetNext();this.Destroy(b);
continue}a.m_flags&=~C.e_filterFlag}!1==this.m_broadPhase.TestOverlap(b.m_proxy,c.m_proxy)?(b=a,a=b.GetNext(),this.Destroy(b)):(a.Update(this.m_contactListener),a=a.GetNext())}}};Box2D.postDefs.push(function(){Box2D.Dynamics.b2ContactManager.s_evalCP=new e});z.b2DebugDraw=function(){};z.prototype.b2DebugDraw=function(){};z.prototype.SetFlags=function(){};z.prototype.GetFlags=function(){};z.prototype.AppendFlags=function(){};z.prototype.ClearFlags=function(){};z.prototype.SetSprite=function(){};z.prototype.GetSprite=
function(){};z.prototype.SetDrawScale=function(){};z.prototype.GetDrawScale=function(){};z.prototype.SetLineThickness=function(){};z.prototype.GetLineThickness=function(){};z.prototype.SetAlpha=function(){};z.prototype.GetAlpha=function(){};z.prototype.SetFillAlpha=function(){};z.prototype.GetFillAlpha=function(){};z.prototype.SetXFormScale=function(){};z.prototype.GetXFormScale=function(){};z.prototype.DrawPolygon=function(){};z.prototype.DrawSolidPolygon=function(){};z.prototype.DrawCircle=function(){};
z.prototype.DrawSolidCircle=function(){};z.prototype.DrawSegment=function(){};z.prototype.DrawTransform=function(){};Box2D.postDefs.push(function(){Box2D.Dynamics.b2DebugDraw.e_shapeBit=1;Box2D.Dynamics.b2DebugDraw.e_jointBit=2;Box2D.Dynamics.b2DebugDraw.e_aabbBit=4;Box2D.Dynamics.b2DebugDraw.e_pairBit=8;Box2D.Dynamics.b2DebugDraw.e_centerOfMassBit=16;Box2D.Dynamics.b2DebugDraw.e_controllerBit=32});G.b2DestructionListener=function(){};G.prototype.SayGoodbyeJoint=function(){};G.prototype.SayGoodbyeFixture=
function(){};D.b2FilterData=function(){this.categoryBits=1;this.maskBits=65535;this.groupIndex=0};D.prototype.Copy=function(){var a=new D;a.categoryBits=this.categoryBits;a.maskBits=this.maskBits;a.groupIndex=this.groupIndex;return a};F.b2Fixture=function(){this.m_filter=new D};F.prototype.GetType=function(){return this.m_shape.GetType()};F.prototype.GetShape=function(){return this.m_shape};F.prototype.SetSensor=function(a){if(this.m_isSensor!=a&&(this.m_isSensor=a,null!=this.m_body))for(a=this.m_body.GetContactList();a;){var b=
a.contact,c=b.GetFixtureA(),e=b.GetFixtureB();if(c==this||e==this)b.SetSensor(c.IsSensor()||e.IsSensor());a=a.next}};F.prototype.IsSensor=function(){return this.m_isSensor};F.prototype.SetFilterData=function(a){this.m_filter=a.Copy();if(!this.m_body)for(a=this.m_body.GetContactList();a;){var b=a.contact,c=b.GetFixtureA(),e=b.GetFixtureB();(c==this||e==this)&&b.FlagForFiltering();a=a.next}};F.prototype.GetFilterData=function(){return this.m_filter.Copy()};F.prototype.GetBody=function(){return this.m_body};
F.prototype.GetNext=function(){return this.m_next};F.prototype.GetUserData=function(){return this.m_userData};F.prototype.SetUserData=function(a){this.m_userData=a};F.prototype.TestPoint=function(a){return this.m_shape.TestPoint(this.m_body.GetTransform(),a)};F.prototype.RayCast=function(a,b){return this.m_shape.RayCast(a,b,this.m_body.GetTransform())};F.prototype.GetMassData=function(a){void 0===a&&(a=null);null==a&&(a=new q);this.m_shape.ComputeMass(a,this.m_density);return a};F.prototype.SetDensity=
function(a){void 0===a&&(a=0);this.m_density=a};F.prototype.GetDensity=function(){return this.m_density};F.prototype.GetFriction=function(){return this.m_friction};F.prototype.SetFriction=function(a){void 0===a&&(a=0);this.m_friction=a};F.prototype.GetRestitution=function(){return this.m_restitution};F.prototype.SetRestitution=function(a){void 0===a&&(a=0);this.m_restitution=a};F.prototype.GetAABB=function(){return this.m_aabb};F.prototype.b2Fixture=function(){this.m_aabb=new b;this.m_shape=this.m_next=
this.m_body=this.m_userData=null;this.m_restitution=this.m_friction=this.m_density=0};F.prototype.Create=function(a,b,c){this.m_userData=c.userData;this.m_friction=c.friction;this.m_restitution=c.restitution;this.m_body=a;this.m_next=null;this.m_filter=c.filter.Copy();this.m_isSensor=c.isSensor;this.m_shape=c.shape.Copy();this.m_density=c.density};F.prototype.Destroy=function(){this.m_shape=null};F.prototype.CreateProxy=function(a,b){this.m_shape.ComputeAABB(this.m_aabb,b);this.m_proxy=a.CreateProxy(this.m_aabb,
this)};F.prototype.DestroyProxy=function(a){if(null!=this.m_proxy)a.DestroyProxy(this.m_proxy),this.m_proxy=null};F.prototype.Synchronize=function(a,e,d){if(this.m_proxy){var f=new b,g=new b;this.m_shape.ComputeAABB(f,e);this.m_shape.ComputeAABB(g,d);this.m_aabb.Combine(f,g);e=c.SubtractVV(d.position,e.position);a.MoveProxy(this.m_proxy,this.m_aabb,e)}};K.b2FixtureDef=function(){this.filter=new D};K.prototype.b2FixtureDef=function(){this.userData=this.shape=null;this.friction=0.2;this.density=this.restitution=
0;this.filter.categoryBits=1;this.filter.maskBits=65535;this.filter.groupIndex=0;this.isSensor=!1};J.b2Island=function(){};J.prototype.b2Island=function(){this.m_bodies=new Vector;this.m_contacts=new Vector;this.m_joints=new Vector};J.prototype.Initialize=function(a,b,c,e,d,f){void 0===a&&(a=0);void 0===b&&(b=0);void 0===c&&(c=0);var g=0;this.m_bodyCapacity=a;this.m_contactCapacity=b;this.m_jointCapacity=c;this.m_jointCount=this.m_contactCount=this.m_bodyCount=0;this.m_allocator=e;this.m_listener=
d;this.m_contactSolver=f;for(g=this.m_bodies.length;g<a;g++)this.m_bodies[g]=null;for(g=this.m_contacts.length;g<b;g++)this.m_contacts[g]=null;for(g=this.m_joints.length;g<c;g++)this.m_joints[g]=null};J.prototype.Clear=function(){this.m_jointCount=this.m_contactCount=this.m_bodyCount=0};J.prototype.Solve=function(b,e,d){for(var f=0,g=0,h,f=0;f<this.m_bodyCount;++f)g=this.m_bodies[f],g.GetType()==l.b2_dynamicBody&&(g.m_linearVelocity.x+=b.dt*(e.x+g.m_invMass*g.m_force.x),g.m_linearVelocity.y+=b.dt*
(e.y+g.m_invMass*g.m_force.y),g.m_angularVelocity+=b.dt*g.m_invI*g.m_torque,g.m_linearVelocity.Multiply(c.Clamp(1-b.dt*g.m_linearDamping,0,1)),g.m_angularVelocity*=c.Clamp(1-b.dt*g.m_angularDamping,0,1));this.m_contactSolver.Initialize(b,this.m_contacts,this.m_contactCount,this.m_allocator);e=this.m_contactSolver;e.InitVelocityConstraints(b);for(f=0;f<this.m_jointCount;++f)h=this.m_joints[f],h.InitVelocityConstraints(b);for(f=0;f<b.velocityIterations;++f){for(g=0;g<this.m_jointCount;++g)h=this.m_joints[g],
h.SolveVelocityConstraints(b);e.SolveVelocityConstraints()}for(f=0;f<this.m_jointCount;++f)h=this.m_joints[f],h.FinalizeVelocityConstraints();e.FinalizeVelocityConstraints();for(f=0;f<this.m_bodyCount;++f)if(g=this.m_bodies[f],g.GetType()!=l.b2_staticBody){var s=b.dt*g.m_linearVelocity.x,j=b.dt*g.m_linearVelocity.y;s*s+j*j>a.b2_maxTranslationSquared&&(g.m_linearVelocity.Normalize(),g.m_linearVelocity.x*=a.b2_maxTranslation*b.inv_dt,g.m_linearVelocity.y*=a.b2_maxTranslation*b.inv_dt);s=b.dt*g.m_angularVelocity;
if(s*s>a.b2_maxRotationSquared)g.m_angularVelocity=0>g.m_angularVelocity?-a.b2_maxRotation*b.inv_dt:a.b2_maxRotation*b.inv_dt;g.m_sweep.c0.SetV(g.m_sweep.c);g.m_sweep.a0=g.m_sweep.a;g.m_sweep.c.x+=b.dt*g.m_linearVelocity.x;g.m_sweep.c.y+=b.dt*g.m_linearVelocity.y;g.m_sweep.a+=b.dt*g.m_angularVelocity;g.SynchronizeTransform()}for(f=0;f<b.positionIterations;++f){s=e.SolvePositionConstraints(a.b2_contactBaumgarte);j=!0;for(g=0;g<this.m_jointCount;++g)h=this.m_joints[g],h=h.SolvePositionConstraints(a.b2_contactBaumgarte),
j=j&&h;if(s&&j)break}this.Report(e.m_constraints);if(d){d=Number.MAX_VALUE;e=a.b2_linearSleepTolerance*a.b2_linearSleepTolerance;s=a.b2_angularSleepTolerance*a.b2_angularSleepTolerance;for(f=0;f<this.m_bodyCount;++f)if(g=this.m_bodies[f],g.GetType()!=l.b2_staticBody){if(0==(g.m_flags&l.e_allowSleepFlag))d=g.m_sleepTime=0;0==(g.m_flags&l.e_allowSleepFlag)||g.m_angularVelocity*g.m_angularVelocity>s||c.Dot(g.m_linearVelocity,g.m_linearVelocity)>e?d=g.m_sleepTime=0:(g.m_sleepTime+=b.dt,d=c.Min(d,g.m_sleepTime))}if(d>=
a.b2_timeToSleep)for(f=0;f<this.m_bodyCount;++f)g=this.m_bodies[f],g.SetAwake(!1)}};J.prototype.SolveTOI=function(b){var c=0,e=0;this.m_contactSolver.Initialize(b,this.m_contacts,this.m_contactCount,this.m_allocator);for(var d=this.m_contactSolver,c=0;c<this.m_jointCount;++c)this.m_joints[c].InitVelocityConstraints(b);for(c=0;c<b.velocityIterations;++c){d.SolveVelocityConstraints();for(e=0;e<this.m_jointCount;++e)this.m_joints[e].SolveVelocityConstraints(b)}for(c=0;c<this.m_bodyCount;++c)if(e=this.m_bodies[c],
e.GetType()!=l.b2_staticBody){var f=b.dt*e.m_linearVelocity.x,g=b.dt*e.m_linearVelocity.y;f*f+g*g>a.b2_maxTranslationSquared&&(e.m_linearVelocity.Normalize(),e.m_linearVelocity.x*=a.b2_maxTranslation*b.inv_dt,e.m_linearVelocity.y*=a.b2_maxTranslation*b.inv_dt);f=b.dt*e.m_angularVelocity;if(f*f>a.b2_maxRotationSquared)e.m_angularVelocity=0>e.m_angularVelocity?-a.b2_maxRotation*b.inv_dt:a.b2_maxRotation*b.inv_dt;e.m_sweep.c0.SetV(e.m_sweep.c);e.m_sweep.a0=e.m_sweep.a;e.m_sweep.c.x+=b.dt*e.m_linearVelocity.x;
e.m_sweep.c.y+=b.dt*e.m_linearVelocity.y;e.m_sweep.a+=b.dt*e.m_angularVelocity;e.SynchronizeTransform()}for(c=0;c<b.positionIterations;++c){f=d.SolvePositionConstraints(0.75);g=!0;for(e=0;e<this.m_jointCount;++e)var h=this.m_joints[e].SolvePositionConstraints(a.b2_contactBaumgarte),g=g&&h;if(f&&g)break}this.Report(d.m_constraints)};J.prototype.Report=function(a){if(null!=this.m_listener)for(var b=0;b<this.m_contactCount;++b){for(var c=this.m_contacts[b],e=a[b],d=0;d<e.pointCount;++d)J.s_impulse.normalImpulses[d]=
e.points[d].normalImpulse,J.s_impulse.tangentImpulses[d]=e.points[d].tangentImpulse;this.m_listener.PostSolve(c,J.s_impulse)}};J.prototype.AddBody=function(a){a.m_islandIndex=this.m_bodyCount;this.m_bodies[this.m_bodyCount++]=a};J.prototype.AddContact=function(a){this.m_contacts[this.m_contactCount++]=a};J.prototype.AddJoint=function(a){this.m_joints[this.m_jointCount++]=a};Box2D.postDefs.push(function(){Box2D.Dynamics.b2Island.s_impulse=new x});s.b2TimeStep=function(){};s.prototype.Set=function(a){this.dt=
a.dt;this.inv_dt=a.inv_dt;this.positionIterations=a.positionIterations;this.velocityIterations=a.velocityIterations;this.warmStarting=a.warmStarting};u.b2World=function(){this.s_stack=new Vector;this.m_contactManager=new y;this.m_contactSolver=new H;this.m_island=new J};u.prototype.b2World=function(a,b){this.m_controllerList=this.m_jointList=this.m_contactList=this.m_bodyList=this.m_debugDraw=this.m_destructionListener=null;this.m_controllerCount=this.m_jointCount=this.m_contactCount=this.m_bodyCount=
0;u.m_warmStarting=!0;u.m_continuousPhysics=!0;this.m_allowSleep=b;this.m_gravity=a;this.m_inv_dt0=0;this.m_contactManager.m_world=this;this.m_groundBody=this.CreateBody(new B)};u.prototype.SetDestructionListener=function(a){this.m_destructionListener=a};u.prototype.SetContactFilter=function(a){this.m_contactManager.m_contactFilter=a};u.prototype.SetContactListener=function(a){this.m_contactManager.m_contactListener=a};u.prototype.SetDebugDraw=function(a){this.m_debugDraw=a};u.prototype.SetBroadPhase=
function(a){var b=this.m_contactManager.m_broadPhase;this.m_contactManager.m_broadPhase=a;for(var c=this.m_bodyList;c;c=c.m_next)for(var e=c.m_fixtureList;e;e=e.m_next)e.m_proxy=a.CreateProxy(b.GetFatAABB(e.m_proxy),e)};u.prototype.Validate=function(){this.m_contactManager.m_broadPhase.Validate()};u.prototype.GetProxyCount=function(){return this.m_contactManager.m_broadPhase.GetProxyCount()};u.prototype.CreateBody=function(a){if(!0==this.IsLocked())return null;a=new l(a,this);a.m_prev=null;if(a.m_next=
this.m_bodyList)this.m_bodyList.m_prev=a;this.m_bodyList=a;++this.m_bodyCount;return a};u.prototype.DestroyBody=function(a){if(!0!=this.IsLocked()){for(var b=a.m_jointList;b;){var c=b,b=b.next;this.m_destructionListener&&this.m_destructionListener.SayGoodbyeJoint(c.joint);this.DestroyJoint(c.joint)}for(b=a.m_controllerList;b;)c=b,b=b.nextController,c.controller.RemoveBody(a);for(b=a.m_contactList;b;)c=b,b=b.next,this.m_contactManager.Destroy(c.contact);a.m_contactList=null;for(b=a.m_fixtureList;b;)c=
b,b=b.m_next,this.m_destructionListener&&this.m_destructionListener.SayGoodbyeFixture(c),c.DestroyProxy(this.m_contactManager.m_broadPhase),c.Destroy();a.m_fixtureList=null;a.m_fixtureCount=0;if(a.m_prev)a.m_prev.m_next=a.m_next;if(a.m_next)a.m_next.m_prev=a.m_prev;if(a==this.m_bodyList)this.m_bodyList=a.m_next;--this.m_bodyCount}};u.prototype.CreateJoint=function(a){var b=M.Create(a,null);b.m_prev=null;if(b.m_next=this.m_jointList)this.m_jointList.m_prev=b;this.m_jointList=b;++this.m_jointCount;
b.m_edgeA.joint=b;b.m_edgeA.other=b.m_bodyB;b.m_edgeA.prev=null;if(b.m_edgeA.next=b.m_bodyA.m_jointList)b.m_bodyA.m_jointList.prev=b.m_edgeA;b.m_bodyA.m_jointList=b.m_edgeA;b.m_edgeB.joint=b;b.m_edgeB.other=b.m_bodyA;b.m_edgeB.prev=null;if(b.m_edgeB.next=b.m_bodyB.m_jointList)b.m_bodyB.m_jointList.prev=b.m_edgeB;b.m_bodyB.m_jointList=b.m_edgeB;var c=a.bodyA,e=a.bodyB;if(!1==a.collideConnected)for(a=e.GetContactList();a;)a.other==c&&a.contact.FlagForFiltering(),a=a.next;return b};u.prototype.DestroyJoint=
function(a){var b=a.m_collideConnected;if(a.m_prev)a.m_prev.m_next=a.m_next;if(a.m_next)a.m_next.m_prev=a.m_prev;if(a==this.m_jointList)this.m_jointList=a.m_next;var c=a.m_bodyA,e=a.m_bodyB;c.SetAwake(!0);e.SetAwake(!0);if(a.m_edgeA.prev)a.m_edgeA.prev.next=a.m_edgeA.next;if(a.m_edgeA.next)a.m_edgeA.next.prev=a.m_edgeA.prev;if(a.m_edgeA==c.m_jointList)c.m_jointList=a.m_edgeA.next;a.m_edgeA.prev=null;a.m_edgeA.next=null;if(a.m_edgeB.prev)a.m_edgeB.prev.next=a.m_edgeB.next;if(a.m_edgeB.next)a.m_edgeB.next.prev=
a.m_edgeB.prev;if(a.m_edgeB==e.m_jointList)e.m_jointList=a.m_edgeB.next;a.m_edgeB.prev=null;a.m_edgeB.next=null;M.Destroy(a,null);--this.m_jointCount;if(!1==b)for(a=e.GetContactList();a;)a.other==c&&a.contact.FlagForFiltering(),a=a.next};u.prototype.AddController=function(a){a.m_next=this.m_controllerList;a.m_prev=null;this.m_controllerList=a;a.m_world=this;this.m_controllerCount++;return a};u.prototype.RemoveController=function(a){if(a.m_prev)a.m_prev.m_next=a.m_next;if(a.m_next)a.m_next.m_prev=
a.m_prev;if(this.m_controllerList==a)this.m_controllerList=a.m_next;this.m_controllerCount--};u.prototype.CreateController=function(a){if(a.m_world!=this)throw Error("Controller can only be a member of one world");a.m_next=this.m_controllerList;a.m_prev=null;if(this.m_controllerList)this.m_controllerList.m_prev=a;this.m_controllerList=a;++this.m_controllerCount;a.m_world=this;return a};u.prototype.DestroyController=function(a){a.Clear();if(a.m_next)a.m_next.m_prev=a.m_prev;if(a.m_prev)a.m_prev.m_next=
a.m_next;if(a==this.m_controllerList)this.m_controllerList=a.m_next;--this.m_controllerCount};u.prototype.SetWarmStarting=function(a){u.m_warmStarting=a};u.prototype.SetContinuousPhysics=function(a){u.m_continuousPhysics=a};u.prototype.GetBodyCount=function(){return this.m_bodyCount};u.prototype.GetJointCount=function(){return this.m_jointCount};u.prototype.GetContactCount=function(){return this.m_contactCount};u.prototype.SetGravity=function(a){this.m_gravity=a};u.prototype.GetGravity=function(){return this.m_gravity};
u.prototype.GetGroundBody=function(){return this.m_groundBody};u.prototype.Step=function(a,b,c){void 0===a&&(a=0);void 0===b&&(b=0);void 0===c&&(c=0);this.m_flags&u.e_newFixture&&(this.m_contactManager.FindNewContacts(),this.m_flags&=~u.e_newFixture);this.m_flags|=u.e_locked;var e=u.s_timestep2;e.dt=a;e.velocityIterations=b;e.positionIterations=c;e.inv_dt=0<a?1/a:0;e.dtRatio=this.m_inv_dt0*a;e.warmStarting=u.m_warmStarting;this.m_contactManager.Collide();0<e.dt&&this.Solve(e);u.m_continuousPhysics&&
0<e.dt&&this.SolveTOI(e);if(0<e.dt)this.m_inv_dt0=e.inv_dt;this.m_flags&=~u.e_locked};u.prototype.ClearForces=function(){for(var a=this.m_bodyList;a;a=a.m_next)a.m_force.SetZero(),a.m_torque=0};u.prototype.DrawDebugData=function(){if(null!=this.m_debugDraw){this.m_debugDraw.m_sprite.graphics.clear();var a=this.m_debugDraw.GetFlags(),c,e,d;new o;new o;new o;var f;new b;new b;new o;new o;new o;new o;var g=new k(0,0,0);if(a&z.e_shapeBit)for(c=this.m_bodyList;c;c=c.m_next){f=c.m_xf;for(e=c.GetFixtureList();e;e=
e.m_next)d=e.GetShape(),!1==c.IsActive()?g.Set(0.5,0.5,0.3):c.GetType()==l.b2_staticBody?g.Set(0.5,0.9,0.5):c.GetType()==l.b2_kinematicBody?g.Set(0.5,0.5,0.9):!1==c.IsAwake()?g.Set(0.6,0.6,0.6):g.Set(0.9,0.7,0.7),this.DrawShape(d,f,g)}if(a&z.e_jointBit)for(c=this.m_jointList;c;c=c.m_next)this.DrawJoint(c);if(a&z.e_controllerBit)for(c=this.m_controllerList;c;c=c.m_next)c.Draw(this.m_debugDraw);if(a&z.e_pairBit){g.Set(0.3,0.9,0.9);for(c=this.m_contactManager.m_contactList;c;c=c.GetNext())d=c.GetFixtureA(),
e=c.GetFixtureB(),d=d.GetAABB().GetCenter(),e=e.GetAABB().GetCenter(),this.m_debugDraw.DrawSegment(d,e,g)}if(a&z.e_aabbBit){d=this.m_contactManager.m_broadPhase;f=[new o,new o,new o,new o];for(c=this.m_bodyList;c;c=c.GetNext())if(!1!=c.IsActive())for(e=c.GetFixtureList();e;e=e.GetNext()){var h=d.GetFatAABB(e.m_proxy);f[0].Set(h.lowerBound.x,h.lowerBound.y);f[1].Set(h.upperBound.x,h.lowerBound.y);f[2].Set(h.upperBound.x,h.upperBound.y);f[3].Set(h.lowerBound.x,h.upperBound.y);this.m_debugDraw.DrawPolygon(f,
4,g)}}if(a&z.e_centerOfMassBit)for(c=this.m_bodyList;c;c=c.m_next)f=u.s_xf,f.R=c.m_xf.R,f.position=c.GetWorldCenter(),this.m_debugDraw.DrawTransform(f)}};u.prototype.QueryAABB=function(a,b){var c=this.m_contactManager.m_broadPhase;c.Query(function(b){return a(c.GetUserData(b))},b)};u.prototype.QueryShape=function(a,c,e){void 0===e&&(e=null);null==e&&(e=new n,e.SetIdentity());var d=this.m_contactManager.m_broadPhase,f=new b;c.ComputeAABB(f,e);d.Query(function(b){b=d.GetUserData(b)instanceof F?d.GetUserData(b):
null;return A.TestOverlap(c,e,b.GetShape(),b.GetBody().GetTransform())?a(b):!0},f)};u.prototype.QueryPoint=function(c,e){var d=this.m_contactManager.m_broadPhase,f=new b;f.lowerBound.Set(e.x-a.b2_linearSlop,e.y-a.b2_linearSlop);f.upperBound.Set(e.x+a.b2_linearSlop,e.y+a.b2_linearSlop);d.Query(function(a){a=d.GetUserData(a)instanceof F?d.GetUserData(a):null;return a.TestPoint(e)?c(a):!0},f)};u.prototype.RayCast=function(a,b,c){var e=this.m_contactManager.m_broadPhase,d=new h,g=new f(b,c);e.RayCast(function(f,
g){var h=e.GetUserData(g),h=h instanceof F?h:null;if(h.RayCast(d,f)){var s=d.fraction,j=new o((1-s)*b.x+s*c.x,(1-s)*b.y+s*c.y);return a(h,j,d.normal,s)}return f.maxFraction},g)};u.prototype.RayCastOne=function(a,b){var c;this.RayCast(function(a,b,e,d){void 0===d&&(d=0);c=a;return d},a,b);return c};u.prototype.RayCastAll=function(a,b){var c=new Vector;this.RayCast(function(a){c[c.length]=a;return 1},a,b);return c};u.prototype.GetBodyList=function(){return this.m_bodyList};u.prototype.GetJointList=
function(){return this.m_jointList};u.prototype.GetContactList=function(){return this.m_contactList};u.prototype.IsLocked=function(){return 0<(this.m_flags&u.e_locked)};u.prototype.Solve=function(a){for(var b,c=this.m_controllerList;c;c=c.m_next)c.Step(a);c=this.m_island;c.Initialize(this.m_bodyCount,this.m_contactCount,this.m_jointCount,null,this.m_contactManager.m_contactListener,this.m_contactSolver);for(b=this.m_bodyList;b;b=b.m_next)b.m_flags&=~l.e_islandFlag;for(var e=this.m_contactList;e;e=
e.m_next)e.m_flags&=~C.e_islandFlag;for(e=this.m_jointList;e;e=e.m_next)e.m_islandFlag=!1;parseInt(this.m_bodyCount);for(var e=this.s_stack,d=this.m_bodyList;d;d=d.m_next)if(!(d.m_flags&l.e_islandFlag)&&!(!1==d.IsAwake()||!1==d.IsActive())&&d.GetType()!=l.b2_staticBody){c.Clear();var f=0;e[f++]=d;for(d.m_flags|=l.e_islandFlag;0<f;)if(b=e[--f],c.AddBody(b),!1==b.IsAwake()&&b.SetAwake(!0),b.GetType()!=l.b2_staticBody){for(var g,h=b.m_contactList;h;h=h.next)if(!(h.contact.m_flags&C.e_islandFlag)&&!(!0==
h.contact.IsSensor()||!1==h.contact.IsEnabled()||!1==h.contact.IsTouching()))c.AddContact(h.contact),h.contact.m_flags|=C.e_islandFlag,g=h.other,g.m_flags&l.e_islandFlag||(e[f++]=g,g.m_flags|=l.e_islandFlag);for(b=b.m_jointList;b;b=b.next)if(!0!=b.joint.m_islandFlag&&(g=b.other,!1!=g.IsActive()))c.AddJoint(b.joint),b.joint.m_islandFlag=!0,g.m_flags&l.e_islandFlag||(e[f++]=g,g.m_flags|=l.e_islandFlag)}c.Solve(a,this.m_gravity,this.m_allowSleep);for(f=0;f<c.m_bodyCount;++f)b=c.m_bodies[f],b.GetType()==
l.b2_staticBody&&(b.m_flags&=~l.e_islandFlag)}for(f=0;f<e.length&&e[f];++f)e[f]=null;for(b=this.m_bodyList;b;b=b.m_next)!1==b.IsAwake()||!1==b.IsActive()||b.GetType()!=l.b2_staticBody&&b.SynchronizeFixtures();this.m_contactManager.FindNewContacts()};u.prototype.SolveTOI=function(b){var c,e,d,f=this.m_island;f.Initialize(this.m_bodyCount,a.b2_maxTOIContactsPerIsland,a.b2_maxTOIJointsPerIsland,null,this.m_contactManager.m_contactListener,this.m_contactSolver);var g=u.s_queue;for(c=this.m_bodyList;c;c=
c.m_next)c.m_flags&=~l.e_islandFlag,c.m_sweep.t0=0;for(d=this.m_contactList;d;d=d.m_next)d.m_flags&=~(C.e_toiFlag|C.e_islandFlag);for(d=this.m_jointList;d;d=d.m_next)d.m_islandFlag=!1;for(;;){var h=null,s=1;for(d=this.m_contactList;d;d=d.m_next)if(!(!0==d.IsSensor()||!1==d.IsEnabled()||!1==d.IsContinuous())){if(d.m_flags&C.e_toiFlag)c=d.m_toi;else{c=d.m_fixtureA;e=d.m_fixtureB;c=c.m_body;e=e.m_body;if((c.GetType()!=l.b2_dynamicBody||!1==c.IsAwake())&&(e.GetType()!=l.b2_dynamicBody||!1==e.IsAwake()))continue;
var j=c.m_sweep.t0;if(c.m_sweep.t0<e.m_sweep.t0)j=e.m_sweep.t0,c.m_sweep.Advance(j);else if(e.m_sweep.t0<c.m_sweep.t0)j=c.m_sweep.t0,e.m_sweep.Advance(j);c=d.ComputeTOI(c.m_sweep,e.m_sweep);a.b2Assert(0<=c&&1>=c);0<c&&1>c&&(c=(1-c)*j+c,1<c&&(c=1));d.m_toi=c;d.m_flags|=C.e_toiFlag}Number.MIN_VALUE<c&&c<s&&(h=d,s=c)}if(null==h||1-100*Number.MIN_VALUE<s)break;c=h.m_fixtureA;e=h.m_fixtureB;c=c.m_body;e=e.m_body;u.s_backupA.Set(c.m_sweep);u.s_backupB.Set(e.m_sweep);c.Advance(s);e.Advance(s);h.Update(this.m_contactManager.m_contactListener);
h.m_flags&=~C.e_toiFlag;if(!0==h.IsSensor()||!1==h.IsEnabled())c.m_sweep.Set(u.s_backupA),e.m_sweep.Set(u.s_backupB),c.SynchronizeTransform(),e.SynchronizeTransform();else if(!1!=h.IsTouching()){c.GetType()!=l.b2_dynamicBody&&(c=e);f.Clear();h=d=0;g[d+h++]=c;for(c.m_flags|=l.e_islandFlag;0<h;)if(c=g[d++],--h,f.AddBody(c),!1==c.IsAwake()&&c.SetAwake(!0),c.GetType()==l.b2_dynamicBody){for(e=c.m_contactList;e&&!(f.m_contactCount==f.m_contactCapacity);e=e.next)if(!(e.contact.m_flags&C.e_islandFlag)&&
!(!0==e.contact.IsSensor()||!1==e.contact.IsEnabled()||!1==e.contact.IsTouching()))f.AddContact(e.contact),e.contact.m_flags|=C.e_islandFlag,j=e.other,j.m_flags&l.e_islandFlag||(j.GetType()!=l.b2_staticBody&&(j.Advance(s),j.SetAwake(!0)),g[d+h]=j,++h,j.m_flags|=l.e_islandFlag);for(c=c.m_jointList;c;c=c.next)if(f.m_jointCount!=f.m_jointCapacity&&!0!=c.joint.m_islandFlag&&(j=c.other,!1!=j.IsActive()))f.AddJoint(c.joint),c.joint.m_islandFlag=!0,j.m_flags&l.e_islandFlag||(j.GetType()!=l.b2_staticBody&&
(j.Advance(s),j.SetAwake(!0)),g[d+h]=j,++h,j.m_flags|=l.e_islandFlag)}d=u.s_timestep;d.warmStarting=!1;d.dt=(1-s)*b.dt;d.inv_dt=1/d.dt;d.dtRatio=0;d.velocityIterations=b.velocityIterations;d.positionIterations=b.positionIterations;f.SolveTOI(d);for(s=s=0;s<f.m_bodyCount;++s)if(c=f.m_bodies[s],c.m_flags&=~l.e_islandFlag,!1!=c.IsAwake()&&c.GetType()==l.b2_dynamicBody){c.SynchronizeFixtures();for(e=c.m_contactList;e;e=e.next)e.contact.m_flags&=~C.e_toiFlag}for(s=0;s<f.m_contactCount;++s)d=f.m_contacts[s],
d.m_flags&=~(C.e_toiFlag|C.e_islandFlag);for(s=0;s<f.m_jointCount;++s)d=f.m_joints[s],d.m_islandFlag=!1;this.m_contactManager.FindNewContacts()}}};u.prototype.DrawJoint=function(a){var b=a.GetBodyA(),c=a.GetBodyB(),e=b.m_xf.position,d=c.m_xf.position,f=a.GetAnchorA(),g=a.GetAnchorB(),h=u.s_jointColor;switch(a.m_type){case M.e_distanceJoint:this.m_debugDraw.DrawSegment(f,g,h);break;case M.e_pulleyJoint:b=a instanceof L?a:null;a=b.GetGroundAnchorA();b=b.GetGroundAnchorB();this.m_debugDraw.DrawSegment(a,
f,h);this.m_debugDraw.DrawSegment(b,g,h);this.m_debugDraw.DrawSegment(a,b,h);break;case M.e_mouseJoint:this.m_debugDraw.DrawSegment(f,g,h);break;default:b!=this.m_groundBody&&this.m_debugDraw.DrawSegment(e,f,h),this.m_debugDraw.DrawSegment(f,g,h),c!=this.m_groundBody&&this.m_debugDraw.DrawSegment(d,g,h)}};u.prototype.DrawShape=function(a,b,e){switch(a.m_type){case A.e_circleShape:var d=a instanceof g?a:null;this.m_debugDraw.DrawSolidCircle(c.MulX(b,d.m_p),d.m_radius,b.R.col1,e);break;case A.e_polygonShape:for(var d=
a instanceof p?a:null,a=parseInt(d.GetVertexCount()),f=d.GetVertices(),h=new Vector(a),d=0;d<a;++d)h[d]=c.MulX(b,f[d]);this.m_debugDraw.DrawSolidPolygon(h,a,e);break;case A.e_edgeShape:d=a instanceof j?a:null,this.m_debugDraw.DrawSegment(c.MulX(b,d.GetVertex1()),c.MulX(b,d.GetVertex2()),e)}};Box2D.postDefs.push(function(){Box2D.Dynamics.b2World.s_timestep2=new s;Box2D.Dynamics.b2World.s_xf=new n;Box2D.Dynamics.b2World.s_backupA=new m;Box2D.Dynamics.b2World.s_backupB=new m;Box2D.Dynamics.b2World.s_timestep=
new s;Box2D.Dynamics.b2World.s_queue=new Vector;Box2D.Dynamics.b2World.s_jointColor=new k(0.5,0.8,0.8);Box2D.Dynamics.b2World.e_newFixture=1;Box2D.Dynamics.b2World.e_locked=2})})();
(function(){var c=Box2D.Collision.Shapes.b2CircleShape,m=Box2D.Collision.Shapes.b2EdgeShape,n=Box2D.Collision.Shapes.b2PolygonShape,o=Box2D.Collision.Shapes.b2Shape,k=Box2D.Dynamics.Contacts.b2CircleContact,a=Box2D.Dynamics.Contacts.b2Contact,b=Box2D.Dynamics.Contacts.b2ContactConstraint,e=Box2D.Dynamics.Contacts.b2ContactConstraintPoint,d=Box2D.Dynamics.Contacts.b2ContactEdge,f=Box2D.Dynamics.Contacts.b2ContactFactory,h=Box2D.Dynamics.Contacts.b2ContactRegister,g=Box2D.Dynamics.Contacts.b2ContactResult,
j=Box2D.Dynamics.Contacts.b2ContactSolver,q=Box2D.Dynamics.Contacts.b2EdgeAndCircleContact,p=Box2D.Dynamics.Contacts.b2NullContact,A=Box2D.Dynamics.Contacts.b2PolyAndCircleContact,l=Box2D.Dynamics.Contacts.b2PolyAndEdgeContact,B=Box2D.Dynamics.Contacts.b2PolygonContact,t=Box2D.Dynamics.Contacts.b2PositionSolverManifold,x=Box2D.Dynamics.b2Body,v=Box2D.Dynamics.b2TimeStep,y=Box2D.Common.b2Settings,z=Box2D.Common.Math.b2Mat22,G=Box2D.Common.Math.b2Math,D=Box2D.Common.Math.b2Vec2,F=Box2D.Collision.b2Collision,
K=Box2D.Collision.b2ContactID,J=Box2D.Collision.b2Manifold,s=Box2D.Collision.b2TimeOfImpact,u=Box2D.Collision.b2TOIInput,C=Box2D.Collision.b2WorldManifold;Box2D.inherit(k,Box2D.Dynamics.Contacts.b2Contact);k.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype;k.b2CircleContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)};k.Create=function(){return new k};k.Destroy=function(){};k.prototype.Reset=function(a,b){this.__super.Reset.call(this,a,b)};k.prototype.Evaluate=
function(){var a=this.m_fixtureA.GetBody(),b=this.m_fixtureB.GetBody();F.CollideCircles(this.m_manifold,this.m_fixtureA.GetShape()instanceof c?this.m_fixtureA.GetShape():null,a.m_xf,this.m_fixtureB.GetShape()instanceof c?this.m_fixtureB.GetShape():null,b.m_xf)};a.b2Contact=function(){this.m_nodeA=new d;this.m_nodeB=new d;this.m_manifold=new J;this.m_oldManifold=new J};a.prototype.GetManifold=function(){return this.m_manifold};a.prototype.GetWorldManifold=function(a){var b=this.m_fixtureA.GetBody(),
c=this.m_fixtureB.GetBody(),e=this.m_fixtureA.GetShape(),d=this.m_fixtureB.GetShape();a.Initialize(this.m_manifold,b.GetTransform(),e.m_radius,c.GetTransform(),d.m_radius)};a.prototype.IsTouching=function(){return(this.m_flags&a.e_touchingFlag)==a.e_touchingFlag};a.prototype.IsContinuous=function(){return(this.m_flags&a.e_continuousFlag)==a.e_continuousFlag};a.prototype.SetSensor=function(b){this.m_flags=b?this.m_flags|a.e_sensorFlag:this.m_flags&~a.e_sensorFlag};a.prototype.IsSensor=function(){return(this.m_flags&
a.e_sensorFlag)==a.e_sensorFlag};a.prototype.SetEnabled=function(b){this.m_flags=b?this.m_flags|a.e_enabledFlag:this.m_flags&~a.e_enabledFlag};a.prototype.IsEnabled=function(){return(this.m_flags&a.e_enabledFlag)==a.e_enabledFlag};a.prototype.GetNext=function(){return this.m_next};a.prototype.GetFixtureA=function(){return this.m_fixtureA};a.prototype.GetFixtureB=function(){return this.m_fixtureB};a.prototype.FlagForFiltering=function(){this.m_flags|=a.e_filterFlag};a.prototype.b2Contact=function(){};
a.prototype.Reset=function(b,c){void 0===b&&(b=null);void 0===c&&(c=null);this.m_flags=a.e_enabledFlag;if(!b||!c)this.m_fixtureB=this.m_fixtureA=null;else{if(b.IsSensor()||c.IsSensor())this.m_flags|=a.e_sensorFlag;var e=b.GetBody(),d=c.GetBody();if(e.GetType()!=x.b2_dynamicBody||e.IsBullet()||d.GetType()!=x.b2_dynamicBody||d.IsBullet())this.m_flags|=a.e_continuousFlag;this.m_fixtureA=b;this.m_fixtureB=c;this.m_manifold.m_pointCount=0;this.m_next=this.m_prev=null;this.m_nodeA.contact=null;this.m_nodeA.prev=
null;this.m_nodeA.next=null;this.m_nodeA.other=null;this.m_nodeB.contact=null;this.m_nodeB.prev=null;this.m_nodeB.next=null;this.m_nodeB.other=null}};a.prototype.Update=function(b){var c=this.m_oldManifold;this.m_oldManifold=this.m_manifold;this.m_manifold=c;this.m_flags|=a.e_enabledFlag;var e=!1,c=(this.m_flags&a.e_touchingFlag)==a.e_touchingFlag,d=this.m_fixtureA.m_body,f=this.m_fixtureB.m_body,g=this.m_fixtureA.m_aabb.TestOverlap(this.m_fixtureB.m_aabb);if(this.m_flags&a.e_sensorFlag)g&&(e=this.m_fixtureA.GetShape(),
g=this.m_fixtureB.GetShape(),d=d.GetTransform(),f=f.GetTransform(),e=o.TestOverlap(e,d,g,f)),this.m_manifold.m_pointCount=0;else{this.m_flags=d.GetType()!=x.b2_dynamicBody||d.IsBullet()||f.GetType()!=x.b2_dynamicBody||f.IsBullet()?this.m_flags|a.e_continuousFlag:this.m_flags&~a.e_continuousFlag;if(g){this.Evaluate();e=0<this.m_manifold.m_pointCount;for(g=0;g<this.m_manifold.m_pointCount;++g){var h=this.m_manifold.m_points[g];h.m_normalImpulse=0;h.m_tangentImpulse=0;for(var s=h.m_id,j=0;j<this.m_oldManifold.m_pointCount;++j){var u=
this.m_oldManifold.m_points[j];if(u.m_id.key==s.key){h.m_normalImpulse=u.m_normalImpulse;h.m_tangentImpulse=u.m_tangentImpulse;break}}}}else this.m_manifold.m_pointCount=0;e!=c&&(d.SetAwake(!0),f.SetAwake(!0))}this.m_flags=e?this.m_flags|a.e_touchingFlag:this.m_flags&~a.e_touchingFlag;!1==c&&!0==e&&b.BeginContact(this);!0==c&&!1==e&&b.EndContact(this);0==(this.m_flags&a.e_sensorFlag)&&b.PreSolve(this,this.m_oldManifold)};a.prototype.Evaluate=function(){};a.prototype.ComputeTOI=function(b,c){a.s_input.proxyA.Set(this.m_fixtureA.GetShape());
a.s_input.proxyB.Set(this.m_fixtureB.GetShape());a.s_input.sweepA=b;a.s_input.sweepB=c;a.s_input.tolerance=y.b2_linearSlop;return s.TimeOfImpact(a.s_input)};Box2D.postDefs.push(function(){Box2D.Dynamics.Contacts.b2Contact.e_sensorFlag=1;Box2D.Dynamics.Contacts.b2Contact.e_continuousFlag=2;Box2D.Dynamics.Contacts.b2Contact.e_islandFlag=4;Box2D.Dynamics.Contacts.b2Contact.e_toiFlag=8;Box2D.Dynamics.Contacts.b2Contact.e_touchingFlag=16;Box2D.Dynamics.Contacts.b2Contact.e_enabledFlag=32;Box2D.Dynamics.Contacts.b2Contact.e_filterFlag=
64;Box2D.Dynamics.Contacts.b2Contact.s_input=new u});b.b2ContactConstraint=function(){this.localPlaneNormal=new D;this.localPoint=new D;this.normal=new D;this.normalMass=new z;this.K=new z};b.prototype.b2ContactConstraint=function(){this.points=new Vector(y.b2_maxManifoldPoints);for(var a=0;a<y.b2_maxManifoldPoints;a++)this.points[a]=new e};e.b2ContactConstraintPoint=function(){this.localPoint=new D;this.rA=new D;this.rB=new D};d.b2ContactEdge=function(){};f.b2ContactFactory=function(){};f.prototype.b2ContactFactory=
function(a){this.m_allocator=a;this.InitializeRegisters()};f.prototype.AddType=function(a,b,c,e){void 0===c&&(c=0);void 0===e&&(e=0);this.m_registers[c][e].createFcn=a;this.m_registers[c][e].destroyFcn=b;this.m_registers[c][e].primary=!0;if(c!=e)this.m_registers[e][c].createFcn=a,this.m_registers[e][c].destroyFcn=b,this.m_registers[e][c].primary=!1};f.prototype.InitializeRegisters=function(){this.m_registers=new Vector(o.e_shapeTypeCount);for(var a=0;a<o.e_shapeTypeCount;a++){this.m_registers[a]=
new Vector(o.e_shapeTypeCount);for(var b=0;b<o.e_shapeTypeCount;b++)this.m_registers[a][b]=new h}this.AddType(k.Create,k.Destroy,o.e_circleShape,o.e_circleShape);this.AddType(A.Create,A.Destroy,o.e_polygonShape,o.e_circleShape);this.AddType(B.Create,B.Destroy,o.e_polygonShape,o.e_polygonShape);this.AddType(q.Create,q.Destroy,o.e_edgeShape,o.e_circleShape);this.AddType(l.Create,l.Destroy,o.e_polygonShape,o.e_edgeShape)};f.prototype.Create=function(a,b){var c=parseInt(a.GetType()),e=parseInt(b.GetType()),
c=this.m_registers[c][e];if(c.pool)return e=c.pool,c.pool=e.m_next,c.poolCount--,e.Reset(a,b),e;e=c.createFcn;return null!=e?(c.primary?(e=e(this.m_allocator),e.Reset(a,b)):(e=e(this.m_allocator),e.Reset(b,a)),e):null};f.prototype.Destroy=function(a){0<a.m_manifold.m_pointCount&&(a.m_fixtureA.m_body.SetAwake(!0),a.m_fixtureB.m_body.SetAwake(!0));var b=parseInt(a.m_fixtureA.GetType()),c=parseInt(a.m_fixtureB.GetType()),b=this.m_registers[b][c];b.poolCount++;a.m_next=b.pool;b.pool=a;b=b.destroyFcn;
b(a,this.m_allocator)};h.b2ContactRegister=function(){};g.b2ContactResult=function(){this.position=new D;this.normal=new D;this.id=new K};j.b2ContactSolver=function(){this.m_step=new v;this.m_constraints=new Vector};j.prototype.b2ContactSolver=function(){};j.prototype.Initialize=function(a,c,e,d){void 0===e&&(e=0);var f;this.m_step.Set(a);this.m_allocator=d;for(this.m_constraintCount=e;this.m_constraints.length<this.m_constraintCount;)this.m_constraints[this.m_constraints.length]=new b;for(a=0;a<
e;++a){f=c[a];var d=f.m_fixtureA,g=f.m_fixtureB,h=d.m_shape.m_radius,s=g.m_shape.m_radius,u=d.m_body,l=g.m_body,q=f.GetManifold(),C=y.b2MixFriction(d.GetFriction(),g.GetFriction()),k=y.b2MixRestitution(d.GetRestitution(),g.GetRestitution()),p=u.m_linearVelocity.x,A=u.m_linearVelocity.y,m=l.m_linearVelocity.x,n=l.m_linearVelocity.y,o=u.m_angularVelocity,B=l.m_angularVelocity;y.b2Assert(0<q.m_pointCount);j.s_worldManifold.Initialize(q,u.m_xf,h,l.m_xf,s);g=j.s_worldManifold.m_normal.x;f=j.s_worldManifold.m_normal.y;
d=this.m_constraints[a];d.bodyA=u;d.bodyB=l;d.manifold=q;d.normal.x=g;d.normal.y=f;d.pointCount=q.m_pointCount;d.friction=C;d.restitution=k;d.localPlaneNormal.x=q.m_localPlaneNormal.x;d.localPlaneNormal.y=q.m_localPlaneNormal.y;d.localPoint.x=q.m_localPoint.x;d.localPoint.y=q.m_localPoint.y;d.radius=h+s;d.type=q.m_type;for(h=0;h<d.pointCount;++h){C=q.m_points[h];s=d.points[h];s.normalImpulse=C.m_normalImpulse;s.tangentImpulse=C.m_tangentImpulse;s.localPoint.SetV(C.m_localPoint);var C=s.rA.x=j.s_worldManifold.m_points[h].x-
u.m_sweep.c.x,k=s.rA.y=j.s_worldManifold.m_points[h].y-u.m_sweep.c.y,t=s.rB.x=j.s_worldManifold.m_points[h].x-l.m_sweep.c.x,v=s.rB.y=j.s_worldManifold.m_points[h].y-l.m_sweep.c.y,x=C*f-k*g,z=t*f-v*g,x=x*x,z=z*z;s.normalMass=1/(u.m_invMass+l.m_invMass+u.m_invI*x+l.m_invI*z);var D=u.m_mass*u.m_invMass+l.m_mass*l.m_invMass,D=D+(u.m_mass*u.m_invI*x+l.m_mass*l.m_invI*z);s.equalizedMass=1/D;z=f;D=-g;x=C*D-k*z;z=t*D-v*z;x*=x;z*=z;s.tangentMass=1/(u.m_invMass+l.m_invMass+u.m_invI*x+l.m_invI*z);s.velocityBias=
0;C=d.normal.x*(m+-B*v-p- -o*k)+d.normal.y*(n+B*t-A-o*C);C<-y.b2_velocityThreshold&&(s.velocityBias+=-d.restitution*C)}if(2==d.pointCount)n=d.points[0],m=d.points[1],q=u.m_invMass,u=u.m_invI,p=l.m_invMass,l=l.m_invI,A=n.rA.x*f-n.rA.y*g,n=n.rB.x*f-n.rB.y*g,o=m.rA.x*f-m.rA.y*g,m=m.rB.x*f-m.rB.y*g,g=q+p+u*A*A+l*n*n,f=q+p+u*o*o+l*m*m,l=q+p+u*A*o+l*n*m,g*g<100*(g*f-l*l)?(d.K.col1.Set(g,l),d.K.col2.Set(l,f),d.K.GetInverse(d.normalMass)):d.pointCount=1}};j.prototype.InitVelocityConstraints=function(a){for(var b=
0;b<this.m_constraintCount;++b){var c=this.m_constraints[b],e=c.bodyA,d=c.bodyB,f=e.m_invMass,g=e.m_invI,h=d.m_invMass,s=d.m_invI,j=c.normal.x,u=c.normal.y,l=u,q=-j,C=0,k=0;if(a.warmStarting){k=c.pointCount;for(C=0;C<k;++C){var p=c.points[C];p.normalImpulse*=a.dtRatio;p.tangentImpulse*=a.dtRatio;var m=p.normalImpulse*j+p.tangentImpulse*l,A=p.normalImpulse*u+p.tangentImpulse*q;e.m_angularVelocity-=g*(p.rA.x*A-p.rA.y*m);e.m_linearVelocity.x-=f*m;e.m_linearVelocity.y-=f*A;d.m_angularVelocity+=s*(p.rB.x*
A-p.rB.y*m);d.m_linearVelocity.x+=h*m;d.m_linearVelocity.y+=h*A}}else{k=c.pointCount;for(C=0;C<k;++C)e=c.points[C],e.normalImpulse=0,e.tangentImpulse=0}}};j.prototype.SolveVelocityConstraints=function(){for(var a=0,b,c=0,e=0,d=0,f=0,g=0,h=0,s=0,j,u=0;u<this.m_constraintCount;++u){var d=this.m_constraints[u],l=d.bodyA,q=d.bodyB,C=l.m_angularVelocity,k=q.m_angularVelocity,p=l.m_linearVelocity,m=q.m_linearVelocity,A=l.m_invMass,n=l.m_invI,o=q.m_invMass,B=q.m_invI,h=d.normal.x,t=s=d.normal.y;j=-h;g=d.friction;
for(a=0;a<d.pointCount;a++)b=d.points[a],c=m.x-k*b.rB.y-p.x+C*b.rA.y,e=m.y+k*b.rB.x-p.y-C*b.rA.x,c=c*t+e*j,c=b.tangentMass*-c,e=g*b.normalImpulse,e=G.Clamp(b.tangentImpulse+c,-e,e),c=e-b.tangentImpulse,f=c*t,c*=j,p.x-=A*f,p.y-=A*c,C-=n*(b.rA.x*c-b.rA.y*f),m.x+=o*f,m.y+=o*c,k+=B*(b.rB.x*c-b.rB.y*f),b.tangentImpulse=e;parseInt(d.pointCount);if(1==d.pointCount)b=d.points[0],c=m.x+-k*b.rB.y-p.x- -C*b.rA.y,e=m.y+k*b.rB.x-p.y-C*b.rA.x,d=c*h+e*s,c=-b.normalMass*(d-b.velocityBias),e=b.normalImpulse+c,e=0<
e?e:0,c=e-b.normalImpulse,f=c*h,c*=s,p.x-=A*f,p.y-=A*c,C-=n*(b.rA.x*c-b.rA.y*f),m.x+=o*f,m.y+=o*c,k+=B*(b.rB.x*c-b.rB.y*f),b.normalImpulse=e;else{b=d.points[0];var a=d.points[1],c=b.normalImpulse,g=a.normalImpulse,v=(m.x-k*b.rB.y-p.x+C*b.rA.y)*h+(m.y+k*b.rB.x-p.y-C*b.rA.x)*s,x=(m.x-k*a.rB.y-p.x+C*a.rA.y)*h+(m.y+k*a.rB.x-p.y-C*a.rA.x)*s,e=v-b.velocityBias,f=x-a.velocityBias;j=d.K;e-=j.col1.x*c+j.col2.x*g;for(f-=j.col1.y*c+j.col2.y*g;;){j=d.normalMass;t=-(j.col1.x*e+j.col2.x*f);j=-(j.col1.y*e+j.col2.y*
f);if(0<=t&&0<=j){c=t-c;g=j-g;d=c*h;c*=s;h*=g;s*=g;p.x-=A*(d+h);p.y-=A*(c+s);C-=n*(b.rA.x*c-b.rA.y*d+a.rA.x*s-a.rA.y*h);m.x+=o*(d+h);m.y+=o*(c+s);k+=B*(b.rB.x*c-b.rB.y*d+a.rB.x*s-a.rB.y*h);b.normalImpulse=t;a.normalImpulse=j;break}t=-b.normalMass*e;j=0;x=d.K.col1.y*t+f;if(0<=t&&0<=x){c=t-c;g=j-g;d=c*h;c*=s;h*=g;s*=g;p.x-=A*(d+h);p.y-=A*(c+s);C-=n*(b.rA.x*c-b.rA.y*d+a.rA.x*s-a.rA.y*h);m.x+=o*(d+h);m.y+=o*(c+s);k+=B*(b.rB.x*c-b.rB.y*d+a.rB.x*s-a.rB.y*h);b.normalImpulse=t;a.normalImpulse=j;break}t=0;
j=-a.normalMass*f;v=d.K.col2.x*j+e;if(0<=j&&0<=v){c=t-c;g=j-g;d=c*h;c*=s;h*=g;s*=g;p.x-=A*(d+h);p.y-=A*(c+s);C-=n*(b.rA.x*c-b.rA.y*d+a.rA.x*s-a.rA.y*h);m.x+=o*(d+h);m.y+=o*(c+s);k+=B*(b.rB.x*c-b.rB.y*d+a.rB.x*s-a.rB.y*h);b.normalImpulse=t;a.normalImpulse=j;break}j=t=0;v=e;x=f;if(0<=v&&0<=x){c=t-c;g=j-g;d=c*h;c*=s;h*=g;s*=g;p.x-=A*(d+h);p.y-=A*(c+s);C-=n*(b.rA.x*c-b.rA.y*d+a.rA.x*s-a.rA.y*h);m.x+=o*(d+h);m.y+=o*(c+s);k+=B*(b.rB.x*c-b.rB.y*d+a.rB.x*s-a.rB.y*h);b.normalImpulse=t;a.normalImpulse=j;break}break}}l.m_angularVelocity=
C;q.m_angularVelocity=k}};j.prototype.FinalizeVelocityConstraints=function(){for(var a=0;a<this.m_constraintCount;++a)for(var b=this.m_constraints[a],c=b.manifold,e=0;e<b.pointCount;++e){var d=c.m_points[e],f=b.points[e];d.m_normalImpulse=f.normalImpulse;d.m_tangentImpulse=f.tangentImpulse}};j.prototype.SolvePositionConstraints=function(a){void 0===a&&(a=0);for(var b=0,c=0;c<this.m_constraintCount;c++){var e=this.m_constraints[c],d=e.bodyA,f=e.bodyB,g=d.m_mass*d.m_invMass,h=d.m_mass*d.m_invI,s=f.m_mass*
f.m_invMass,u=f.m_mass*f.m_invI;j.s_psm.Initialize(e);for(var l=j.s_psm.m_normal,C=0;C<e.pointCount;C++){var q=e.points[C],k=j.s_psm.m_points[C],p=j.s_psm.m_separations[C],m=k.x-d.m_sweep.c.x,A=k.y-d.m_sweep.c.y,n=k.x-f.m_sweep.c.x,k=k.y-f.m_sweep.c.y,b=b<p?b:p,p=G.Clamp(a*(p+y.b2_linearSlop),-y.b2_maxLinearCorrection,0),p=-q.equalizedMass*p,q=p*l.x,p=p*l.y;d.m_sweep.c.x-=g*q;d.m_sweep.c.y-=g*p;d.m_sweep.a-=h*(m*p-A*q);d.SynchronizeTransform();f.m_sweep.c.x+=s*q;f.m_sweep.c.y+=s*p;f.m_sweep.a+=u*
(n*p-k*q);f.SynchronizeTransform()}}return b>-1.5*y.b2_linearSlop};Box2D.postDefs.push(function(){Box2D.Dynamics.Contacts.b2ContactSolver.s_worldManifold=new C;Box2D.Dynamics.Contacts.b2ContactSolver.s_psm=new t});Box2D.inherit(q,Box2D.Dynamics.Contacts.b2Contact);q.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype;q.b2EdgeAndCircleContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)};q.Create=function(){return new q};q.Destroy=function(){};q.prototype.Reset=
function(a,b){this.__super.Reset.call(this,a,b)};q.prototype.Evaluate=function(){var a=this.m_fixtureA.GetBody(),b=this.m_fixtureB.GetBody();this.b2CollideEdgeAndCircle(this.m_manifold,this.m_fixtureA.GetShape()instanceof m?this.m_fixtureA.GetShape():null,a.m_xf,this.m_fixtureB.GetShape()instanceof c?this.m_fixtureB.GetShape():null,b.m_xf)};q.prototype.b2CollideEdgeAndCircle=function(){};Box2D.inherit(p,Box2D.Dynamics.Contacts.b2Contact);p.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype;
p.b2NullContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)};p.prototype.b2NullContact=function(){this.__super.b2Contact.call(this)};p.prototype.Evaluate=function(){};Box2D.inherit(A,Box2D.Dynamics.Contacts.b2Contact);A.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype;A.b2PolyAndCircleContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)};A.Create=function(){return new A};A.Destroy=function(){};A.prototype.Reset=function(a,
b){this.__super.Reset.call(this,a,b);y.b2Assert(a.GetType()==o.e_polygonShape);y.b2Assert(b.GetType()==o.e_circleShape)};A.prototype.Evaluate=function(){var a=this.m_fixtureA.m_body,b=this.m_fixtureB.m_body;F.CollidePolygonAndCircle(this.m_manifold,this.m_fixtureA.GetShape()instanceof n?this.m_fixtureA.GetShape():null,a.m_xf,this.m_fixtureB.GetShape()instanceof c?this.m_fixtureB.GetShape():null,b.m_xf)};Box2D.inherit(l,Box2D.Dynamics.Contacts.b2Contact);l.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype;
l.b2PolyAndEdgeContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)};l.Create=function(){return new l};l.Destroy=function(){};l.prototype.Reset=function(a,b){this.__super.Reset.call(this,a,b);y.b2Assert(a.GetType()==o.e_polygonShape);y.b2Assert(b.GetType()==o.e_edgeShape)};l.prototype.Evaluate=function(){var a=this.m_fixtureA.GetBody(),b=this.m_fixtureB.GetBody();this.b2CollidePolyAndEdge(this.m_manifold,this.m_fixtureA.GetShape()instanceof n?this.m_fixtureA.GetShape():
null,a.m_xf,this.m_fixtureB.GetShape()instanceof m?this.m_fixtureB.GetShape():null,b.m_xf)};l.prototype.b2CollidePolyAndEdge=function(){};Box2D.inherit(B,Box2D.Dynamics.Contacts.b2Contact);B.prototype.__super=Box2D.Dynamics.Contacts.b2Contact.prototype;B.b2PolygonContact=function(){Box2D.Dynamics.Contacts.b2Contact.b2Contact.apply(this,arguments)};B.Create=function(){return new B};B.Destroy=function(){};B.prototype.Reset=function(a,b){this.__super.Reset.call(this,a,b)};B.prototype.Evaluate=function(){var a=
this.m_fixtureA.GetBody(),b=this.m_fixtureB.GetBody();F.CollidePolygons(this.m_manifold,this.m_fixtureA.GetShape()instanceof n?this.m_fixtureA.GetShape():null,a.m_xf,this.m_fixtureB.GetShape()instanceof n?this.m_fixtureB.GetShape():null,b.m_xf)};t.b2PositionSolverManifold=function(){};t.prototype.b2PositionSolverManifold=function(){this.m_normal=new D;this.m_separations=new Vector_a2j_Number(y.b2_maxManifoldPoints);this.m_points=new Vector(y.b2_maxManifoldPoints);for(var a=0;a<y.b2_maxManifoldPoints;a++)this.m_points[a]=
new D};t.prototype.Initialize=function(a){y.b2Assert(0<a.pointCount);var b=0,c=0,e=0,d,f=0,g=0;switch(a.type){case J.e_circles:d=a.bodyA.m_xf.R;e=a.localPoint;b=a.bodyA.m_xf.position.x+(d.col1.x*e.x+d.col2.x*e.y);c=a.bodyA.m_xf.position.y+(d.col1.y*e.x+d.col2.y*e.y);d=a.bodyB.m_xf.R;e=a.points[0].localPoint;f=a.bodyB.m_xf.position.x+(d.col1.x*e.x+d.col2.x*e.y);d=a.bodyB.m_xf.position.y+(d.col1.y*e.x+d.col2.y*e.y);var e=f-b,g=d-c,h=e*e+g*g;h>Number.MIN_VALUE*Number.MIN_VALUE?(h=Math.sqrt(h),this.m_normal.x=
e/h,this.m_normal.y=g/h):(this.m_normal.x=1,this.m_normal.y=0);this.m_points[0].x=0.5*(b+f);this.m_points[0].y=0.5*(c+d);this.m_separations[0]=e*this.m_normal.x+g*this.m_normal.y-a.radius;break;case J.e_faceA:d=a.bodyA.m_xf.R;e=a.localPlaneNormal;this.m_normal.x=d.col1.x*e.x+d.col2.x*e.y;this.m_normal.y=d.col1.y*e.x+d.col2.y*e.y;d=a.bodyA.m_xf.R;e=a.localPoint;f=a.bodyA.m_xf.position.x+(d.col1.x*e.x+d.col2.x*e.y);g=a.bodyA.m_xf.position.y+(d.col1.y*e.x+d.col2.y*e.y);d=a.bodyB.m_xf.R;for(b=0;b<a.pointCount;++b)e=
a.points[b].localPoint,c=a.bodyB.m_xf.position.x+(d.col1.x*e.x+d.col2.x*e.y),e=a.bodyB.m_xf.position.y+(d.col1.y*e.x+d.col2.y*e.y),this.m_separations[b]=(c-f)*this.m_normal.x+(e-g)*this.m_normal.y-a.radius,this.m_points[b].x=c,this.m_points[b].y=e;break;case J.e_faceB:d=a.bodyB.m_xf.R;e=a.localPlaneNormal;this.m_normal.x=d.col1.x*e.x+d.col2.x*e.y;this.m_normal.y=d.col1.y*e.x+d.col2.y*e.y;d=a.bodyB.m_xf.R;e=a.localPoint;f=a.bodyB.m_xf.position.x+(d.col1.x*e.x+d.col2.x*e.y);g=a.bodyB.m_xf.position.y+
(d.col1.y*e.x+d.col2.y*e.y);d=a.bodyA.m_xf.R;for(b=0;b<a.pointCount;++b)e=a.points[b].localPoint,c=a.bodyA.m_xf.position.x+(d.col1.x*e.x+d.col2.x*e.y),e=a.bodyA.m_xf.position.y+(d.col1.y*e.x+d.col2.y*e.y),this.m_separations[b]=(c-f)*this.m_normal.x+(e-g)*this.m_normal.y-a.radius,this.m_points[b].Set(c,e);this.m_normal.x*=-1;this.m_normal.y*=-1}};Box2D.postDefs.push(function(){Box2D.Dynamics.Contacts.b2PositionSolverManifold.circlePointA=new D;Box2D.Dynamics.Contacts.b2PositionSolverManifold.circlePointB=
new D})})();
(function(){var c=Box2D.Common.Math.b2Mat22,m=Box2D.Common.Math.b2Math,n=Box2D.Common.Math.b2Vec2,o=Box2D.Common.b2Color,k=Box2D.Dynamics.Controllers.b2BuoyancyController,a=Box2D.Dynamics.Controllers.b2ConstantAccelController,b=Box2D.Dynamics.Controllers.b2ConstantForceController,e=Box2D.Dynamics.Controllers.b2Controller,d=Box2D.Dynamics.Controllers.b2ControllerEdge,f=Box2D.Dynamics.Controllers.b2GravityController,h=Box2D.Dynamics.Controllers.b2TensorDampingController;Box2D.inherit(k,Box2D.Dynamics.Controllers.b2Controller);
k.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype;k.b2BuoyancyController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments);this.normal=new n(0,-1);this.density=this.offset=0;this.velocity=new n(0,0);this.linearDrag=2;this.angularDrag=1;this.useDensity=!1;this.useWorldGravity=!0;this.gravity=null};k.prototype.Step=function(){if(this.m_bodyList){if(this.useWorldGravity)this.gravity=this.GetWorld().GetGravity().Copy();for(var a=this.m_bodyList;a;a=
a.nextBody){var b=a.body;if(!1!=b.IsAwake()){for(var c=new n,e=new n,d=0,f=0,h=b.GetFixtureList();h;h=h.GetNext()){var k=new n,m=h.GetShape().ComputeSubmergedArea(this.normal,this.offset,b.GetTransform(),k),d=d+m;c.x+=m*k.x;c.y+=m*k.y;var o=0,o=1,f=f+m*o;e.x+=m*k.x*o;e.y+=m*k.y*o}c.x/=d;c.y/=d;e.x/=f;e.y/=f;d<Number.MIN_VALUE||(f=this.gravity.GetNegative(),f.Multiply(this.density*d),b.ApplyForce(f,e),e=b.GetLinearVelocityFromWorldPoint(c),e.Subtract(this.velocity),e.Multiply(-this.linearDrag*d),b.ApplyForce(e,
c),b.ApplyTorque(-b.GetInertia()/b.GetMass()*d*b.GetAngularVelocity()*this.angularDrag))}}}};k.prototype.Draw=function(a){var b=new n,c=new n;b.x=this.normal.x*this.offset+1E3*this.normal.y;b.y=this.normal.y*this.offset-1E3*this.normal.x;c.x=this.normal.x*this.offset-1E3*this.normal.y;c.y=this.normal.y*this.offset+1E3*this.normal.x;var e=new o(0,0,1);a.DrawSegment(b,c,e)};Box2D.inherit(a,Box2D.Dynamics.Controllers.b2Controller);a.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype;
a.b2ConstantAccelController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments);this.A=new n(0,0)};a.prototype.Step=function(a){for(var a=new n(this.A.x*a.dt,this.A.y*a.dt),b=this.m_bodyList;b;b=b.nextBody){var c=b.body;c.IsAwake()&&c.SetLinearVelocity(new n(c.GetLinearVelocity().x+a.x,c.GetLinearVelocity().y+a.y))}};Box2D.inherit(b,Box2D.Dynamics.Controllers.b2Controller);b.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype;b.b2ConstantForceController=
function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments);this.F=new n(0,0)};b.prototype.Step=function(){for(var a=this.m_bodyList;a;a=a.nextBody){var b=a.body;b.IsAwake()&&b.ApplyForce(this.F,b.GetWorldCenter())}};e.b2Controller=function(){};e.prototype.Step=function(){};e.prototype.Draw=function(){};e.prototype.AddBody=function(a){var b=new d;b.controller=this;b.body=a;b.nextBody=this.m_bodyList;b.prevBody=null;this.m_bodyList=b;if(b.nextBody)b.nextBody.prevBody=b;this.m_bodyCount++;
b.nextController=a.m_controllerList;b.prevController=null;a.m_controllerList=b;if(b.nextController)b.nextController.prevController=b;a.m_controllerCount++};e.prototype.RemoveBody=function(a){for(var b=a.m_controllerList;b&&b.controller!=this;)b=b.nextController;if(b.prevBody)b.prevBody.nextBody=b.nextBody;if(b.nextBody)b.nextBody.prevBody=b.prevBody;if(b.nextController)b.nextController.prevController=b.prevController;if(b.prevController)b.prevController.nextController=b.nextController;if(this.m_bodyList==
b)this.m_bodyList=b.nextBody;if(a.m_controllerList==b)a.m_controllerList=b.nextController;a.m_controllerCount--;this.m_bodyCount--};e.prototype.Clear=function(){for(;this.m_bodyList;)this.RemoveBody(this.m_bodyList.body)};e.prototype.GetNext=function(){return this.m_next};e.prototype.GetWorld=function(){return this.m_world};e.prototype.GetBodyList=function(){return this.m_bodyList};d.b2ControllerEdge=function(){};Box2D.inherit(f,Box2D.Dynamics.Controllers.b2Controller);f.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype;
f.b2GravityController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments);this.G=1;this.invSqr=!0};f.prototype.Step=function(){var a=null,b=null,c=null,e=0,d=null,f=null,h=null,k=0,m=0,o=0;if(this.invSqr)for(a=this.m_bodyList;a;a=a.nextBody){b=a.body;c=b.GetWorldCenter();e=b.GetMass();for(d=this.m_bodyList;d!=a;d=d.nextBody)f=d.body,h=f.GetWorldCenter(),k=h.x-c.x,m=h.y-c.y,o=k*k+m*m,o<Number.MIN_VALUE||(k=new n(k,m),k.Multiply(this.G/o/Math.sqrt(o)*e*f.GetMass()),
b.IsAwake()&&b.ApplyForce(k,c),k.Multiply(-1),f.IsAwake()&&f.ApplyForce(k,h))}else for(a=this.m_bodyList;a;a=a.nextBody){b=a.body;c=b.GetWorldCenter();e=b.GetMass();for(d=this.m_bodyList;d!=a;d=d.nextBody)f=d.body,h=f.GetWorldCenter(),k=h.x-c.x,m=h.y-c.y,o=k*k+m*m,o<Number.MIN_VALUE||(k=new n(k,m),k.Multiply(this.G/o*e*f.GetMass()),b.IsAwake()&&b.ApplyForce(k,c),k.Multiply(-1),f.IsAwake()&&f.ApplyForce(k,h))}};Box2D.inherit(h,Box2D.Dynamics.Controllers.b2Controller);h.prototype.__super=Box2D.Dynamics.Controllers.b2Controller.prototype;
h.b2TensorDampingController=function(){Box2D.Dynamics.Controllers.b2Controller.b2Controller.apply(this,arguments);this.T=new c;this.maxTimestep=0};h.prototype.SetAxisAligned=function(a,b){void 0===a&&(a=0);void 0===b&&(b=0);this.T.col1.x=-a;this.T.col1.y=0;this.T.col2.x=0;this.T.col2.y=-b;this.maxTimestep=0<a||0<b?1/Math.max(a,b):0};h.prototype.Step=function(a){a=a.dt;if(!(a<=Number.MIN_VALUE)){if(a>this.maxTimestep&&0<this.maxTimestep)a=this.maxTimestep;for(var b=this.m_bodyList;b;b=b.nextBody){var c=
b.body;if(c.IsAwake()){var e=c.GetWorldVector(m.MulMV(this.T,c.GetLocalVector(c.GetLinearVelocity())));c.SetLinearVelocity(new n(c.GetLinearVelocity().x+e.x*a,c.GetLinearVelocity().y+e.y*a))}}}}})();
(function(){var c=Box2D.Common.b2Settings,m=Box2D.Common.Math.b2Mat22,n=Box2D.Common.Math.b2Mat33,o=Box2D.Common.Math.b2Math,k=Box2D.Common.Math.b2Vec2,a=Box2D.Common.Math.b2Vec3,b=Box2D.Dynamics.Joints.b2DistanceJoint,e=Box2D.Dynamics.Joints.b2DistanceJointDef,d=Box2D.Dynamics.Joints.b2FrictionJoint,f=Box2D.Dynamics.Joints.b2FrictionJointDef,h=Box2D.Dynamics.Joints.b2GearJoint,g=Box2D.Dynamics.Joints.b2GearJointDef,j=Box2D.Dynamics.Joints.b2Jacobian,q=Box2D.Dynamics.Joints.b2Joint,p=Box2D.Dynamics.Joints.b2JointDef,
A=Box2D.Dynamics.Joints.b2JointEdge,l=Box2D.Dynamics.Joints.b2LineJoint,B=Box2D.Dynamics.Joints.b2LineJointDef,t=Box2D.Dynamics.Joints.b2MouseJoint,x=Box2D.Dynamics.Joints.b2MouseJointDef,v=Box2D.Dynamics.Joints.b2PrismaticJoint,y=Box2D.Dynamics.Joints.b2PrismaticJointDef,z=Box2D.Dynamics.Joints.b2PulleyJoint,G=Box2D.Dynamics.Joints.b2PulleyJointDef,D=Box2D.Dynamics.Joints.b2RevoluteJoint,F=Box2D.Dynamics.Joints.b2RevoluteJointDef,K=Box2D.Dynamics.Joints.b2WeldJoint,J=Box2D.Dynamics.Joints.b2WeldJointDef;
Box2D.inherit(b,Box2D.Dynamics.Joints.b2Joint);b.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;b.b2DistanceJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_localAnchor1=new k;this.m_localAnchor2=new k;this.m_u=new k};b.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};b.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};b.prototype.GetReactionForce=function(a){void 0===a&&(a=0);
return new k(a*this.m_impulse*this.m_u.x,a*this.m_impulse*this.m_u.y)};b.prototype.GetReactionTorque=function(){return 0};b.prototype.GetLength=function(){return this.m_length};b.prototype.SetLength=function(a){void 0===a&&(a=0);this.m_length=a};b.prototype.GetFrequency=function(){return this.m_frequencyHz};b.prototype.SetFrequency=function(a){void 0===a&&(a=0);this.m_frequencyHz=a};b.prototype.GetDampingRatio=function(){return this.m_dampingRatio};b.prototype.SetDampingRatio=function(a){void 0===
a&&(a=0);this.m_dampingRatio=a};b.prototype.b2DistanceJoint=function(a){this.__super.b2Joint.call(this,a);this.m_localAnchor1.SetV(a.localAnchorA);this.m_localAnchor2.SetV(a.localAnchorB);this.m_length=a.length;this.m_frequencyHz=a.frequencyHz;this.m_dampingRatio=a.dampingRatio;this.m_bias=this.m_gamma=this.m_impulse=0};b.prototype.InitVelocityConstraints=function(a){var b,e=0,d=this.m_bodyA,f=this.m_bodyB;b=d.m_xf.R;var g=this.m_localAnchor1.x-d.m_sweep.localCenter.x,h=this.m_localAnchor1.y-d.m_sweep.localCenter.y,
e=b.col1.x*g+b.col2.x*h,h=b.col1.y*g+b.col2.y*h,g=e;b=f.m_xf.R;var j=this.m_localAnchor2.x-f.m_sweep.localCenter.x,l=this.m_localAnchor2.y-f.m_sweep.localCenter.y,e=b.col1.x*j+b.col2.x*l,l=b.col1.y*j+b.col2.y*l,j=e;this.m_u.x=f.m_sweep.c.x+j-d.m_sweep.c.x-g;this.m_u.y=f.m_sweep.c.y+l-d.m_sweep.c.y-h;e=Math.sqrt(this.m_u.x*this.m_u.x+this.m_u.y*this.m_u.y);e>c.b2_linearSlop?this.m_u.Multiply(1/e):this.m_u.SetZero();b=g*this.m_u.y-h*this.m_u.x;var q=j*this.m_u.y-l*this.m_u.x;b=d.m_invMass+d.m_invI*
b*b+f.m_invMass+f.m_invI*q*q;this.m_mass=0!=b?1/b:0;if(0<this.m_frequencyHz){var e=e-this.m_length,q=2*Math.PI*this.m_frequencyHz,k=this.m_mass*q*q;this.m_gamma=a.dt*(2*this.m_mass*this.m_dampingRatio*q+a.dt*k);this.m_gamma=0!=this.m_gamma?1/this.m_gamma:0;this.m_bias=e*a.dt*k*this.m_gamma;this.m_mass=b+this.m_gamma;this.m_mass=0!=this.m_mass?1/this.m_mass:0}a.warmStarting?(this.m_impulse*=a.dtRatio,a=this.m_impulse*this.m_u.x,b=this.m_impulse*this.m_u.y,d.m_linearVelocity.x-=d.m_invMass*a,d.m_linearVelocity.y-=
d.m_invMass*b,d.m_angularVelocity-=d.m_invI*(g*b-h*a),f.m_linearVelocity.x+=f.m_invMass*a,f.m_linearVelocity.y+=f.m_invMass*b,f.m_angularVelocity+=f.m_invI*(j*b-l*a)):this.m_impulse=0};b.prototype.SolveVelocityConstraints=function(){var a,b=this.m_bodyA,c=this.m_bodyB;a=b.m_xf.R;var e=this.m_localAnchor1.x-b.m_sweep.localCenter.x,d=this.m_localAnchor1.y-b.m_sweep.localCenter.y,f=a.col1.x*e+a.col2.x*d,d=a.col1.y*e+a.col2.y*d,e=f;a=c.m_xf.R;var g=this.m_localAnchor2.x-c.m_sweep.localCenter.x,h=this.m_localAnchor2.y-
c.m_sweep.localCenter.y,f=a.col1.x*g+a.col2.x*h,h=a.col1.y*g+a.col2.y*h,g=f,f=-this.m_mass*(this.m_u.x*(c.m_linearVelocity.x+-c.m_angularVelocity*h-(b.m_linearVelocity.x+-b.m_angularVelocity*d))+this.m_u.y*(c.m_linearVelocity.y+c.m_angularVelocity*g-(b.m_linearVelocity.y+b.m_angularVelocity*e))+this.m_bias+this.m_gamma*this.m_impulse);this.m_impulse+=f;a=f*this.m_u.x;f*=this.m_u.y;b.m_linearVelocity.x-=b.m_invMass*a;b.m_linearVelocity.y-=b.m_invMass*f;b.m_angularVelocity-=b.m_invI*(e*f-d*a);c.m_linearVelocity.x+=
c.m_invMass*a;c.m_linearVelocity.y+=c.m_invMass*f;c.m_angularVelocity+=c.m_invI*(g*f-h*a)};b.prototype.SolvePositionConstraints=function(){var a;if(0<this.m_frequencyHz)return!0;var b=this.m_bodyA,e=this.m_bodyB;a=b.m_xf.R;var d=this.m_localAnchor1.x-b.m_sweep.localCenter.x,f=this.m_localAnchor1.y-b.m_sweep.localCenter.y,g=a.col1.x*d+a.col2.x*f,f=a.col1.y*d+a.col2.y*f,d=g;a=e.m_xf.R;var h=this.m_localAnchor2.x-e.m_sweep.localCenter.x,j=this.m_localAnchor2.y-e.m_sweep.localCenter.y,g=a.col1.x*h+a.col2.x*
j,j=a.col1.y*h+a.col2.y*j,h=g,g=e.m_sweep.c.x+h-b.m_sweep.c.x-d,l=e.m_sweep.c.y+j-b.m_sweep.c.y-f;a=Math.sqrt(g*g+l*l);g/=a;l/=a;a-=this.m_length;a=o.Clamp(a,-c.b2_maxLinearCorrection,c.b2_maxLinearCorrection);var q=-this.m_mass*a;this.m_u.Set(g,l);g=q*this.m_u.x;l=q*this.m_u.y;b.m_sweep.c.x-=b.m_invMass*g;b.m_sweep.c.y-=b.m_invMass*l;b.m_sweep.a-=b.m_invI*(d*l-f*g);e.m_sweep.c.x+=e.m_invMass*g;e.m_sweep.c.y+=e.m_invMass*l;e.m_sweep.a+=e.m_invI*(h*l-j*g);b.SynchronizeTransform();e.SynchronizeTransform();
return o.Abs(a)<c.b2_linearSlop};Box2D.inherit(e,Box2D.Dynamics.Joints.b2JointDef);e.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;e.b2DistanceJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.localAnchorA=new k;this.localAnchorB=new k};e.prototype.b2DistanceJointDef=function(){this.__super.b2JointDef.call(this);this.type=q.e_distanceJoint;this.length=1;this.dampingRatio=this.frequencyHz=0};e.prototype.Initialize=function(a,b,c,e){this.bodyA=
a;this.bodyB=b;this.localAnchorA.SetV(this.bodyA.GetLocalPoint(c));this.localAnchorB.SetV(this.bodyB.GetLocalPoint(e));a=e.x-c.x;c=e.y-c.y;this.length=Math.sqrt(a*a+c*c);this.dampingRatio=this.frequencyHz=0};Box2D.inherit(d,Box2D.Dynamics.Joints.b2Joint);d.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;d.b2FrictionJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_localAnchorA=new k;this.m_localAnchorB=new k;this.m_linearMass=new m;this.m_linearImpulse=
new k};d.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)};d.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)};d.prototype.GetReactionForce=function(a){void 0===a&&(a=0);return new k(a*this.m_linearImpulse.x,a*this.m_linearImpulse.y)};d.prototype.GetReactionTorque=function(a){void 0===a&&(a=0);return a*this.m_angularImpulse};d.prototype.SetMaxForce=function(a){void 0===a&&(a=0);this.m_maxForce=a};d.prototype.GetMaxForce=function(){return this.m_maxForce};
d.prototype.SetMaxTorque=function(a){void 0===a&&(a=0);this.m_maxTorque=a};d.prototype.GetMaxTorque=function(){return this.m_maxTorque};d.prototype.b2FrictionJoint=function(a){this.__super.b2Joint.call(this,a);this.m_localAnchorA.SetV(a.localAnchorA);this.m_localAnchorB.SetV(a.localAnchorB);this.m_linearMass.SetZero();this.m_angularMass=0;this.m_linearImpulse.SetZero();this.m_angularImpulse=0;this.m_maxForce=a.maxForce;this.m_maxTorque=a.maxTorque};d.prototype.InitVelocityConstraints=function(a){var b,
c=0,e=this.m_bodyA,d=this.m_bodyB;b=e.m_xf.R;var f=this.m_localAnchorA.x-e.m_sweep.localCenter.x,g=this.m_localAnchorA.y-e.m_sweep.localCenter.y,c=b.col1.x*f+b.col2.x*g,g=b.col1.y*f+b.col2.y*g,f=c;b=d.m_xf.R;var h=this.m_localAnchorB.x-d.m_sweep.localCenter.x,j=this.m_localAnchorB.y-d.m_sweep.localCenter.y,c=b.col1.x*h+b.col2.x*j,j=b.col1.y*h+b.col2.y*j,h=c;b=e.m_invMass;var c=d.m_invMass,l=e.m_invI,q=d.m_invI,k=new m;k.col1.x=b+c;k.col2.x=0;k.col1.y=0;k.col2.y=b+c;k.col1.x+=l*g*g;k.col2.x+=-l*f*
g;k.col1.y+=-l*f*g;k.col2.y+=l*f*f;k.col1.x+=q*j*j;k.col2.x+=-q*h*j;k.col1.y+=-q*h*j;k.col2.y+=q*h*h;k.GetInverse(this.m_linearMass);this.m_angularMass=l+q;if(0<this.m_angularMass)this.m_angularMass=1/this.m_angularMass;a.warmStarting?(this.m_linearImpulse.x*=a.dtRatio,this.m_linearImpulse.y*=a.dtRatio,this.m_angularImpulse*=a.dtRatio,a=this.m_linearImpulse,e.m_linearVelocity.x-=b*a.x,e.m_linearVelocity.y-=b*a.y,e.m_angularVelocity-=l*(f*a.y-g*a.x+this.m_angularImpulse),d.m_linearVelocity.x+=c*a.x,
d.m_linearVelocity.y+=c*a.y,d.m_angularVelocity+=q*(h*a.y-j*a.x+this.m_angularImpulse)):(this.m_linearImpulse.SetZero(),this.m_angularImpulse=0)};d.prototype.SolveVelocityConstraints=function(a){var b,c=0,e=this.m_bodyA,d=this.m_bodyB,f=e.m_linearVelocity,g=e.m_angularVelocity,h=d.m_linearVelocity,j=d.m_angularVelocity,l=e.m_invMass,q=d.m_invMass,p=e.m_invI,m=d.m_invI;b=e.m_xf.R;var A=this.m_localAnchorA.x-e.m_sweep.localCenter.x,n=this.m_localAnchorA.y-e.m_sweep.localCenter.y,c=b.col1.x*A+b.col2.x*
n,n=b.col1.y*A+b.col2.y*n,A=c;b=d.m_xf.R;var B=this.m_localAnchorB.x-d.m_sweep.localCenter.x,t=this.m_localAnchorB.y-d.m_sweep.localCenter.y,c=b.col1.x*B+b.col2.x*t,t=b.col1.y*B+b.col2.y*t,B=c,c=-this.m_angularMass*(j-g),v=this.m_angularImpulse;b=a.dt*this.m_maxTorque;this.m_angularImpulse=o.Clamp(this.m_angularImpulse+c,-b,b);c=this.m_angularImpulse-v;g-=p*c;j+=m*c;b=o.MulMV(this.m_linearMass,new k(-(h.x-j*t-f.x+g*n),-(h.y+j*B-f.y-g*A)));c=this.m_linearImpulse.Copy();this.m_linearImpulse.Add(b);
b=a.dt*this.m_maxForce;this.m_linearImpulse.LengthSquared()>b*b&&(this.m_linearImpulse.Normalize(),this.m_linearImpulse.Multiply(b));b=o.SubtractVV(this.m_linearImpulse,c);f.x-=l*b.x;f.y-=l*b.y;g-=p*(A*b.y-n*b.x);h.x+=q*b.x;h.y+=q*b.y;j+=m*(B*b.y-t*b.x);e.m_angularVelocity=g;d.m_angularVelocity=j};d.prototype.SolvePositionConstraints=function(){return!0};Box2D.inherit(f,Box2D.Dynamics.Joints.b2JointDef);f.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;f.b2FrictionJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,
arguments);this.localAnchorA=new k;this.localAnchorB=new k};f.prototype.b2FrictionJointDef=function(){this.__super.b2JointDef.call(this);this.type=q.e_frictionJoint;this.maxTorque=this.maxForce=0};f.prototype.Initialize=function(a,b,c){this.bodyA=a;this.bodyB=b;this.localAnchorA.SetV(this.bodyA.GetLocalPoint(c));this.localAnchorB.SetV(this.bodyB.GetLocalPoint(c))};Box2D.inherit(h,Box2D.Dynamics.Joints.b2Joint);h.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;h.b2GearJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,
arguments);this.m_groundAnchor1=new k;this.m_groundAnchor2=new k;this.m_localAnchor1=new k;this.m_localAnchor2=new k;this.m_J=new j};h.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};h.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};h.prototype.GetReactionForce=function(a){void 0===a&&(a=0);return new k(a*this.m_impulse*this.m_J.linearB.x,a*this.m_impulse*this.m_J.linearB.y)};h.prototype.GetReactionTorque=function(a){void 0===
a&&(a=0);var b=this.m_bodyB.m_xf.R,c=this.m_localAnchor1.x-this.m_bodyB.m_sweep.localCenter.x,e=this.m_localAnchor1.y-this.m_bodyB.m_sweep.localCenter.y,d=b.col1.x*c+b.col2.x*e,e=b.col1.y*c+b.col2.y*e;return a*(this.m_impulse*this.m_J.angularB-d*this.m_impulse*this.m_J.linearB.y+e*this.m_impulse*this.m_J.linearB.x)};h.prototype.GetRatio=function(){return this.m_ratio};h.prototype.SetRatio=function(a){void 0===a&&(a=0);this.m_ratio=a};h.prototype.b2GearJoint=function(a){this.__super.b2Joint.call(this,
a);var b=parseInt(a.joint1.m_type),c=parseInt(a.joint2.m_type);this.m_prismatic2=this.m_revolute2=this.m_prismatic1=this.m_revolute1=null;var e=0,d=0;this.m_ground1=a.joint1.GetBodyA();this.m_bodyA=a.joint1.GetBodyB();b==q.e_revoluteJoint?(this.m_revolute1=a.joint1 instanceof D?a.joint1:null,this.m_groundAnchor1.SetV(this.m_revolute1.m_localAnchor1),this.m_localAnchor1.SetV(this.m_revolute1.m_localAnchor2),e=this.m_revolute1.GetJointAngle()):(this.m_prismatic1=a.joint1 instanceof v?a.joint1:null,
this.m_groundAnchor1.SetV(this.m_prismatic1.m_localAnchor1),this.m_localAnchor1.SetV(this.m_prismatic1.m_localAnchor2),e=this.m_prismatic1.GetJointTranslation());this.m_ground2=a.joint2.GetBodyA();this.m_bodyB=a.joint2.GetBodyB();c==q.e_revoluteJoint?(this.m_revolute2=a.joint2 instanceof D?a.joint2:null,this.m_groundAnchor2.SetV(this.m_revolute2.m_localAnchor1),this.m_localAnchor2.SetV(this.m_revolute2.m_localAnchor2),d=this.m_revolute2.GetJointAngle()):(this.m_prismatic2=a.joint2 instanceof v?a.joint2:
null,this.m_groundAnchor2.SetV(this.m_prismatic2.m_localAnchor1),this.m_localAnchor2.SetV(this.m_prismatic2.m_localAnchor2),d=this.m_prismatic2.GetJointTranslation());this.m_ratio=a.ratio;this.m_constant=e+this.m_ratio*d;this.m_impulse=0};h.prototype.InitVelocityConstraints=function(a){var b=this.m_ground1,c=this.m_ground2,e=this.m_bodyA,d=this.m_bodyB,f=0,g=0,h=0,j=0,l=0,q=0;this.m_J.SetZero();this.m_revolute1?(this.m_J.angularA=-1,q+=e.m_invI):(b=b.m_xf.R,g=this.m_prismatic1.m_localXAxis1,f=b.col1.x*
g.x+b.col2.x*g.y,g=b.col1.y*g.x+b.col2.y*g.y,b=e.m_xf.R,h=this.m_localAnchor1.x-e.m_sweep.localCenter.x,j=this.m_localAnchor1.y-e.m_sweep.localCenter.y,l=b.col1.x*h+b.col2.x*j,j=b.col1.y*h+b.col2.y*j,h=l*g-j*f,this.m_J.linearA.Set(-f,-g),this.m_J.angularA=-h,q+=e.m_invMass+e.m_invI*h*h);this.m_revolute2?(this.m_J.angularB=-this.m_ratio,q+=this.m_ratio*this.m_ratio*d.m_invI):(b=c.m_xf.R,g=this.m_prismatic2.m_localXAxis1,f=b.col1.x*g.x+b.col2.x*g.y,g=b.col1.y*g.x+b.col2.y*g.y,b=d.m_xf.R,h=this.m_localAnchor2.x-
d.m_sweep.localCenter.x,j=this.m_localAnchor2.y-d.m_sweep.localCenter.y,l=b.col1.x*h+b.col2.x*j,j=b.col1.y*h+b.col2.y*j,h=l*g-j*f,this.m_J.linearB.Set(-this.m_ratio*f,-this.m_ratio*g),this.m_J.angularB=-this.m_ratio*h,q+=this.m_ratio*this.m_ratio*(d.m_invMass+d.m_invI*h*h));this.m_mass=0<q?1/q:0;a.warmStarting?(e.m_linearVelocity.x+=e.m_invMass*this.m_impulse*this.m_J.linearA.x,e.m_linearVelocity.y+=e.m_invMass*this.m_impulse*this.m_J.linearA.y,e.m_angularVelocity+=e.m_invI*this.m_impulse*this.m_J.angularA,
d.m_linearVelocity.x+=d.m_invMass*this.m_impulse*this.m_J.linearB.x,d.m_linearVelocity.y+=d.m_invMass*this.m_impulse*this.m_J.linearB.y,d.m_angularVelocity+=d.m_invI*this.m_impulse*this.m_J.angularB):this.m_impulse=0};h.prototype.SolveVelocityConstraints=function(){var a=this.m_bodyA,b=this.m_bodyB,c=-this.m_mass*this.m_J.Compute(a.m_linearVelocity,a.m_angularVelocity,b.m_linearVelocity,b.m_angularVelocity);this.m_impulse+=c;a.m_linearVelocity.x+=a.m_invMass*c*this.m_J.linearA.x;a.m_linearVelocity.y+=
a.m_invMass*c*this.m_J.linearA.y;a.m_angularVelocity+=a.m_invI*c*this.m_J.angularA;b.m_linearVelocity.x+=b.m_invMass*c*this.m_J.linearB.x;b.m_linearVelocity.y+=b.m_invMass*c*this.m_J.linearB.y;b.m_angularVelocity+=b.m_invI*c*this.m_J.angularB};h.prototype.SolvePositionConstraints=function(){var a=this.m_bodyA,b=this.m_bodyB,e=0,d=0,e=this.m_revolute1?this.m_revolute1.GetJointAngle():this.m_prismatic1.GetJointTranslation(),d=this.m_revolute2?this.m_revolute2.GetJointAngle():this.m_prismatic2.GetJointTranslation(),
e=-this.m_mass*(this.m_constant-(e+this.m_ratio*d));a.m_sweep.c.x+=a.m_invMass*e*this.m_J.linearA.x;a.m_sweep.c.y+=a.m_invMass*e*this.m_J.linearA.y;a.m_sweep.a+=a.m_invI*e*this.m_J.angularA;b.m_sweep.c.x+=b.m_invMass*e*this.m_J.linearB.x;b.m_sweep.c.y+=b.m_invMass*e*this.m_J.linearB.y;b.m_sweep.a+=b.m_invI*e*this.m_J.angularB;a.SynchronizeTransform();b.SynchronizeTransform();return 0<c.b2_linearSlop};Box2D.inherit(g,Box2D.Dynamics.Joints.b2JointDef);g.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;
g.b2GearJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments)};g.prototype.b2GearJointDef=function(){this.__super.b2JointDef.call(this);this.type=q.e_gearJoint;this.joint2=this.joint1=null;this.ratio=1};j.b2Jacobian=function(){this.linearA=new k;this.linearB=new k};j.prototype.SetZero=function(){this.linearA.SetZero();this.angularA=0;this.linearB.SetZero();this.angularB=0};j.prototype.Set=function(a,b,c,e){void 0===b&&(b=0);void 0===e&&(e=0);this.linearA.SetV(a);this.angularA=
b;this.linearB.SetV(c);this.angularB=e};j.prototype.Compute=function(a,b,c,e){void 0===b&&(b=0);void 0===e&&(e=0);return this.linearA.x*a.x+this.linearA.y*a.y+this.angularA*b+(this.linearB.x*c.x+this.linearB.y*c.y)+this.angularB*e};q.b2Joint=function(){this.m_edgeA=new A;this.m_edgeB=new A;this.m_localCenterA=new k;this.m_localCenterB=new k};q.prototype.GetType=function(){return this.m_type};q.prototype.GetAnchorA=function(){return null};q.prototype.GetAnchorB=function(){return null};q.prototype.GetReactionForce=
function(){return null};q.prototype.GetReactionTorque=function(){return 0};q.prototype.GetBodyA=function(){return this.m_bodyA};q.prototype.GetBodyB=function(){return this.m_bodyB};q.prototype.GetNext=function(){return this.m_next};q.prototype.GetUserData=function(){return this.m_userData};q.prototype.SetUserData=function(a){this.m_userData=a};q.prototype.IsActive=function(){return this.m_bodyA.IsActive()&&this.m_bodyB.IsActive()};q.Create=function(a){var c=null;switch(a.type){case q.e_distanceJoint:c=
new b(a instanceof e?a:null);break;case q.e_mouseJoint:c=new t(a instanceof x?a:null);break;case q.e_prismaticJoint:c=new v(a instanceof y?a:null);break;case q.e_revoluteJoint:c=new D(a instanceof F?a:null);break;case q.e_pulleyJoint:c=new z(a instanceof G?a:null);break;case q.e_gearJoint:c=new h(a instanceof g?a:null);break;case q.e_lineJoint:c=new l(a instanceof B?a:null);break;case q.e_weldJoint:c=new K(a instanceof J?a:null);break;case q.e_frictionJoint:c=new d(a instanceof f?a:null)}return c};
q.Destroy=function(){};q.prototype.b2Joint=function(a){c.b2Assert(a.bodyA!=a.bodyB);this.m_type=a.type;this.m_next=this.m_prev=null;this.m_bodyA=a.bodyA;this.m_bodyB=a.bodyB;this.m_collideConnected=a.collideConnected;this.m_islandFlag=!1;this.m_userData=a.userData};q.prototype.InitVelocityConstraints=function(){};q.prototype.SolveVelocityConstraints=function(){};q.prototype.FinalizeVelocityConstraints=function(){};q.prototype.SolvePositionConstraints=function(){return!1};Box2D.postDefs.push(function(){Box2D.Dynamics.Joints.b2Joint.e_unknownJoint=
0;Box2D.Dynamics.Joints.b2Joint.e_revoluteJoint=1;Box2D.Dynamics.Joints.b2Joint.e_prismaticJoint=2;Box2D.Dynamics.Joints.b2Joint.e_distanceJoint=3;Box2D.Dynamics.Joints.b2Joint.e_pulleyJoint=4;Box2D.Dynamics.Joints.b2Joint.e_mouseJoint=5;Box2D.Dynamics.Joints.b2Joint.e_gearJoint=6;Box2D.Dynamics.Joints.b2Joint.e_lineJoint=7;Box2D.Dynamics.Joints.b2Joint.e_weldJoint=8;Box2D.Dynamics.Joints.b2Joint.e_frictionJoint=9;Box2D.Dynamics.Joints.b2Joint.e_inactiveLimit=0;Box2D.Dynamics.Joints.b2Joint.e_atLowerLimit=
1;Box2D.Dynamics.Joints.b2Joint.e_atUpperLimit=2;Box2D.Dynamics.Joints.b2Joint.e_equalLimits=3});p.b2JointDef=function(){};p.prototype.b2JointDef=function(){this.type=q.e_unknownJoint;this.bodyB=this.bodyA=this.userData=null;this.collideConnected=!1};A.b2JointEdge=function(){};Box2D.inherit(l,Box2D.Dynamics.Joints.b2Joint);l.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;l.b2LineJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_localAnchor1=new k;this.m_localAnchor2=
new k;this.m_localXAxis1=new k;this.m_localYAxis1=new k;this.m_axis=new k;this.m_perp=new k;this.m_K=new m;this.m_impulse=new k};l.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};l.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};l.prototype.GetReactionForce=function(a){void 0===a&&(a=0);return new k(a*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.x),a*(this.m_impulse.x*this.m_perp.y+
(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.y))};l.prototype.GetReactionTorque=function(a){void 0===a&&(a=0);return a*this.m_impulse.y};l.prototype.GetJointTranslation=function(){var a=this.m_bodyA,b=this.m_bodyB,c=a.GetWorldPoint(this.m_localAnchor1),e=b.GetWorldPoint(this.m_localAnchor2),b=e.x-c.x,c=e.y-c.y,a=a.GetWorldVector(this.m_localXAxis1);return a.x*b+a.y*c};l.prototype.GetJointSpeed=function(){var a=this.m_bodyA,b=this.m_bodyB,c;c=a.m_xf.R;var e=this.m_localAnchor1.x-a.m_sweep.localCenter.x,
d=this.m_localAnchor1.y-a.m_sweep.localCenter.y,f=c.col1.x*e+c.col2.x*d,d=c.col1.y*e+c.col2.y*d,e=f;c=b.m_xf.R;var g=this.m_localAnchor2.x-b.m_sweep.localCenter.x,h=this.m_localAnchor2.y-b.m_sweep.localCenter.y,f=c.col1.x*g+c.col2.x*h,h=c.col1.y*g+c.col2.y*h,g=f;c=b.m_sweep.c.x+g-(a.m_sweep.c.x+e);var f=b.m_sweep.c.y+h-(a.m_sweep.c.y+d),j=a.GetWorldVector(this.m_localXAxis1),l=a.m_linearVelocity,q=b.m_linearVelocity,a=a.m_angularVelocity,b=b.m_angularVelocity;return c*-a*j.y+f*a*j.x+(j.x*(q.x+-b*
h-l.x- -a*d)+j.y*(q.y+b*g-l.y-a*e))};l.prototype.IsLimitEnabled=function(){return this.m_enableLimit};l.prototype.EnableLimit=function(a){this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_enableLimit=a};l.prototype.GetLowerLimit=function(){return this.m_lowerTranslation};l.prototype.GetUpperLimit=function(){return this.m_upperTranslation};l.prototype.SetLimits=function(a,b){void 0===a&&(a=0);void 0===b&&(b=0);this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_lowerTranslation=a;this.m_upperTranslation=
b};l.prototype.IsMotorEnabled=function(){return this.m_enableMotor};l.prototype.EnableMotor=function(a){this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_enableMotor=a};l.prototype.SetMotorSpeed=function(a){void 0===a&&(a=0);this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_motorSpeed=a};l.prototype.GetMotorSpeed=function(){return this.m_motorSpeed};l.prototype.SetMaxMotorForce=function(a){void 0===a&&(a=0);this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_maxMotorForce=
a};l.prototype.GetMaxMotorForce=function(){return this.m_maxMotorForce};l.prototype.GetMotorForce=function(){return this.m_motorImpulse};l.prototype.b2LineJoint=function(a){this.__super.b2Joint.call(this,a);this.m_localAnchor1.SetV(a.localAnchorA);this.m_localAnchor2.SetV(a.localAnchorB);this.m_localXAxis1.SetV(a.localAxisA);this.m_localYAxis1.x=-this.m_localXAxis1.y;this.m_localYAxis1.y=this.m_localXAxis1.x;this.m_impulse.SetZero();this.m_motorImpulse=this.m_motorMass=0;this.m_lowerTranslation=a.lowerTranslation;
this.m_upperTranslation=a.upperTranslation;this.m_maxMotorForce=a.maxMotorForce;this.m_motorSpeed=a.motorSpeed;this.m_enableLimit=a.enableLimit;this.m_enableMotor=a.enableMotor;this.m_limitState=q.e_inactiveLimit;this.m_axis.SetZero();this.m_perp.SetZero()};l.prototype.InitVelocityConstraints=function(a){var b=this.m_bodyA,e=this.m_bodyB,d,f=0;this.m_localCenterA.SetV(b.GetLocalCenter());this.m_localCenterB.SetV(e.GetLocalCenter());var g=b.GetTransform();e.GetTransform();d=b.m_xf.R;var h=this.m_localAnchor1.x-
this.m_localCenterA.x,j=this.m_localAnchor1.y-this.m_localCenterA.y,f=d.col1.x*h+d.col2.x*j,j=d.col1.y*h+d.col2.y*j,h=f;d=e.m_xf.R;var l=this.m_localAnchor2.x-this.m_localCenterB.x,k=this.m_localAnchor2.y-this.m_localCenterB.y,f=d.col1.x*l+d.col2.x*k,k=d.col1.y*l+d.col2.y*k,l=f;d=e.m_sweep.c.x+l-b.m_sweep.c.x-h;f=e.m_sweep.c.y+k-b.m_sweep.c.y-j;this.m_invMassA=b.m_invMass;this.m_invMassB=e.m_invMass;this.m_invIA=b.m_invI;this.m_invIB=e.m_invI;this.m_axis.SetV(o.MulMV(g.R,this.m_localXAxis1));this.m_a1=
(d+h)*this.m_axis.y-(f+j)*this.m_axis.x;this.m_a2=l*this.m_axis.y-k*this.m_axis.x;this.m_motorMass=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_a1*this.m_a1+this.m_invIB*this.m_a2*this.m_a2;this.m_motorMass=this.m_motorMass>Number.MIN_VALUE?1/this.m_motorMass:0;this.m_perp.SetV(o.MulMV(g.R,this.m_localYAxis1));this.m_s1=(d+h)*this.m_perp.y-(f+j)*this.m_perp.x;this.m_s2=l*this.m_perp.y-k*this.m_perp.x;g=this.m_invMassA;h=this.m_invMassB;j=this.m_invIA;l=this.m_invIB;this.m_K.col1.x=g+h+j*this.m_s1*
this.m_s1+l*this.m_s2*this.m_s2;this.m_K.col1.y=j*this.m_s1*this.m_a1+l*this.m_s2*this.m_a2;this.m_K.col2.x=this.m_K.col1.y;this.m_K.col2.y=g+h+j*this.m_a1*this.m_a1+l*this.m_a2*this.m_a2;if(this.m_enableLimit)if(d=this.m_axis.x*d+this.m_axis.y*f,o.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*c.b2_linearSlop)this.m_limitState=q.e_equalLimits;else if(d<=this.m_lowerTranslation){if(this.m_limitState!=q.e_atLowerLimit)this.m_limitState=q.e_atLowerLimit,this.m_impulse.y=0}else if(d>=this.m_upperTranslation){if(this.m_limitState!=
q.e_atUpperLimit)this.m_limitState=q.e_atUpperLimit,this.m_impulse.y=0}else this.m_limitState=q.e_inactiveLimit,this.m_impulse.y=0;else this.m_limitState=q.e_inactiveLimit;if(!1==this.m_enableMotor)this.m_motorImpulse=0;a.warmStarting?(this.m_impulse.x*=a.dtRatio,this.m_impulse.y*=a.dtRatio,this.m_motorImpulse*=a.dtRatio,a=this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.x,d=this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.y,f=this.m_impulse.x*
this.m_s1+(this.m_motorImpulse+this.m_impulse.y)*this.m_a1,g=this.m_impulse.x*this.m_s2+(this.m_motorImpulse+this.m_impulse.y)*this.m_a2,b.m_linearVelocity.x-=this.m_invMassA*a,b.m_linearVelocity.y-=this.m_invMassA*d,b.m_angularVelocity-=this.m_invIA*f,e.m_linearVelocity.x+=this.m_invMassB*a,e.m_linearVelocity.y+=this.m_invMassB*d,e.m_angularVelocity+=this.m_invIB*g):(this.m_impulse.SetZero(),this.m_motorImpulse=0)};l.prototype.SolveVelocityConstraints=function(a){var b=this.m_bodyA,c=this.m_bodyB,
e=b.m_linearVelocity,d=b.m_angularVelocity,f=c.m_linearVelocity,g=c.m_angularVelocity,h=0,j=0,l=0,p=0;if(this.m_enableMotor&&this.m_limitState!=q.e_equalLimits)p=this.m_motorMass*(this.m_motorSpeed-(this.m_axis.x*(f.x-e.x)+this.m_axis.y*(f.y-e.y)+this.m_a2*g-this.m_a1*d)),h=this.m_motorImpulse,j=a.dt*this.m_maxMotorForce,this.m_motorImpulse=o.Clamp(this.m_motorImpulse+p,-j,j),p=this.m_motorImpulse-h,h=p*this.m_axis.x,j=p*this.m_axis.y,l=p*this.m_a1,p*=this.m_a2,e.x-=this.m_invMassA*h,e.y-=this.m_invMassA*
j,d-=this.m_invIA*l,f.x+=this.m_invMassB*h,f.y+=this.m_invMassB*j,g+=this.m_invIB*p;j=this.m_perp.x*(f.x-e.x)+this.m_perp.y*(f.y-e.y)+this.m_s2*g-this.m_s1*d;if(this.m_enableLimit&&this.m_limitState!=q.e_inactiveLimit){l=this.m_axis.x*(f.x-e.x)+this.m_axis.y*(f.y-e.y)+this.m_a2*g-this.m_a1*d;h=this.m_impulse.Copy();a=this.m_K.Solve(new k,-j,-l);this.m_impulse.Add(a);if(this.m_limitState==q.e_atLowerLimit)this.m_impulse.y=o.Max(this.m_impulse.y,0);else if(this.m_limitState==q.e_atUpperLimit)this.m_impulse.y=
o.Min(this.m_impulse.y,0);j=-j-(this.m_impulse.y-h.y)*this.m_K.col2.x;l=0!=this.m_K.col1.x?j/this.m_K.col1.x+h.x:h.x;this.m_impulse.x=l;a.x=this.m_impulse.x-h.x;a.y=this.m_impulse.y-h.y;h=a.x*this.m_perp.x+a.y*this.m_axis.x;j=a.x*this.m_perp.y+a.y*this.m_axis.y;l=a.x*this.m_s1+a.y*this.m_a1;p=a.x*this.m_s2+a.y*this.m_a2}else a=0!=this.m_K.col1.x?-j/this.m_K.col1.x:0,this.m_impulse.x+=a,h=a*this.m_perp.x,j=a*this.m_perp.y,l=a*this.m_s1,p=a*this.m_s2;e.x-=this.m_invMassA*h;e.y-=this.m_invMassA*j;d-=
this.m_invIA*l;f.x+=this.m_invMassB*h;f.y+=this.m_invMassB*j;g+=this.m_invIB*p;b.m_linearVelocity.SetV(e);b.m_angularVelocity=d;c.m_linearVelocity.SetV(f);c.m_angularVelocity=g};l.prototype.SolvePositionConstraints=function(){var a=this.m_bodyA,b=this.m_bodyB,e=a.m_sweep.c,d=a.m_sweep.a,f=b.m_sweep.c,g=b.m_sweep.a,h,j=0,l=0,q=0,p=0,A=0,n=0,l=!1,B=0,t=m.FromAngle(d),q=m.FromAngle(g);h=t;var n=this.m_localAnchor1.x-this.m_localCenterA.x,v=this.m_localAnchor1.y-this.m_localCenterA.y,j=h.col1.x*n+h.col2.x*
v,v=h.col1.y*n+h.col2.y*v,n=j;h=q;q=this.m_localAnchor2.x-this.m_localCenterB.x;p=this.m_localAnchor2.y-this.m_localCenterB.y;j=h.col1.x*q+h.col2.x*p;p=h.col1.y*q+h.col2.y*p;q=j;h=f.x+q-e.x-n;j=f.y+p-e.y-v;if(this.m_enableLimit){this.m_axis=o.MulMV(t,this.m_localXAxis1);this.m_a1=(h+n)*this.m_axis.y-(j+v)*this.m_axis.x;this.m_a2=q*this.m_axis.y-p*this.m_axis.x;var x=this.m_axis.x*h+this.m_axis.y*j;o.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*c.b2_linearSlop?(B=o.Clamp(x,-c.b2_maxLinearCorrection,
c.b2_maxLinearCorrection),A=o.Abs(x),l=!0):x<=this.m_lowerTranslation?(B=o.Clamp(x-this.m_lowerTranslation+c.b2_linearSlop,-c.b2_maxLinearCorrection,0),A=this.m_lowerTranslation-x,l=!0):x>=this.m_upperTranslation&&(B=o.Clamp(x-this.m_upperTranslation+c.b2_linearSlop,0,c.b2_maxLinearCorrection),A=x-this.m_upperTranslation,l=!0)}this.m_perp=o.MulMV(t,this.m_localYAxis1);this.m_s1=(h+n)*this.m_perp.y-(j+v)*this.m_perp.x;this.m_s2=q*this.m_perp.y-p*this.m_perp.x;t=new k;v=this.m_perp.x*h+this.m_perp.y*
j;A=o.Max(A,o.Abs(v));n=0;l?(l=this.m_invMassA,q=this.m_invMassB,p=this.m_invIA,h=this.m_invIB,this.m_K.col1.x=l+q+p*this.m_s1*this.m_s1+h*this.m_s2*this.m_s2,this.m_K.col1.y=p*this.m_s1*this.m_a1+h*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=l+q+p*this.m_a1*this.m_a1+h*this.m_a2*this.m_a2,this.m_K.Solve(t,-v,-B)):(l=this.m_invMassA,q=this.m_invMassB,p=this.m_invIA,h=this.m_invIB,B=l+q+p*this.m_s1*this.m_s1+h*this.m_s2*this.m_s2,t.x=0!=B?-v/B:0,t.y=0);B=t.x*this.m_perp.x+t.y*
this.m_axis.x;l=t.x*this.m_perp.y+t.y*this.m_axis.y;v=t.x*this.m_s1+t.y*this.m_a1;t=t.x*this.m_s2+t.y*this.m_a2;e.x-=this.m_invMassA*B;e.y-=this.m_invMassA*l;d-=this.m_invIA*v;f.x+=this.m_invMassB*B;f.y+=this.m_invMassB*l;g+=this.m_invIB*t;a.m_sweep.a=d;b.m_sweep.a=g;a.SynchronizeTransform();b.SynchronizeTransform();return A<=c.b2_linearSlop&&n<=c.b2_angularSlop};Box2D.inherit(B,Box2D.Dynamics.Joints.b2JointDef);B.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;B.b2LineJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,
arguments);this.localAnchorA=new k;this.localAnchorB=new k;this.localAxisA=new k};B.prototype.b2LineJointDef=function(){this.__super.b2JointDef.call(this);this.type=q.e_lineJoint;this.localAxisA.Set(1,0);this.enableLimit=!1;this.upperTranslation=this.lowerTranslation=0;this.enableMotor=!1;this.motorSpeed=this.maxMotorForce=0};B.prototype.Initialize=function(a,b,c,e){this.bodyA=a;this.bodyB=b;this.localAnchorA=this.bodyA.GetLocalPoint(c);this.localAnchorB=this.bodyB.GetLocalPoint(c);this.localAxisA=
this.bodyA.GetLocalVector(e)};Box2D.inherit(t,Box2D.Dynamics.Joints.b2Joint);t.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;t.b2MouseJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.K=new m;this.K1=new m;this.K2=new m;this.m_localAnchor=new k;this.m_target=new k;this.m_impulse=new k;this.m_mass=new m;this.m_C=new k};t.prototype.GetAnchorA=function(){return this.m_target};t.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor)};
t.prototype.GetReactionForce=function(a){void 0===a&&(a=0);return new k(a*this.m_impulse.x,a*this.m_impulse.y)};t.prototype.GetReactionTorque=function(){return 0};t.prototype.GetTarget=function(){return this.m_target};t.prototype.SetTarget=function(a){!1==this.m_bodyB.IsAwake()&&this.m_bodyB.SetAwake(!0);this.m_target=a};t.prototype.GetMaxForce=function(){return this.m_maxForce};t.prototype.SetMaxForce=function(a){void 0===a&&(a=0);this.m_maxForce=a};t.prototype.GetFrequency=function(){return this.m_frequencyHz};
t.prototype.SetFrequency=function(a){void 0===a&&(a=0);this.m_frequencyHz=a};t.prototype.GetDampingRatio=function(){return this.m_dampingRatio};t.prototype.SetDampingRatio=function(a){void 0===a&&(a=0);this.m_dampingRatio=a};t.prototype.b2MouseJoint=function(a){this.__super.b2Joint.call(this,a);this.m_target.SetV(a.target);var b=this.m_target.x-this.m_bodyB.m_xf.position.x,c=this.m_target.y-this.m_bodyB.m_xf.position.y,e=this.m_bodyB.m_xf.R;this.m_localAnchor.x=b*e.col1.x+c*e.col1.y;this.m_localAnchor.y=
b*e.col2.x+c*e.col2.y;this.m_maxForce=a.maxForce;this.m_impulse.SetZero();this.m_frequencyHz=a.frequencyHz;this.m_dampingRatio=a.dampingRatio;this.m_gamma=this.m_beta=0};t.prototype.InitVelocityConstraints=function(a){var b=this.m_bodyB,c=b.GetMass(),e=2*Math.PI*this.m_frequencyHz,d=c*e*e;this.m_gamma=a.dt*(2*c*this.m_dampingRatio*e+a.dt*d);this.m_gamma=0!=this.m_gamma?1/this.m_gamma:0;this.m_beta=a.dt*d*this.m_gamma;var d=b.m_xf.R,c=this.m_localAnchor.x-b.m_sweep.localCenter.x,e=this.m_localAnchor.y-
b.m_sweep.localCenter.y,f=d.col1.x*c+d.col2.x*e,e=d.col1.y*c+d.col2.y*e,c=f,d=b.m_invMass,f=b.m_invI;this.K1.col1.x=d;this.K1.col2.x=0;this.K1.col1.y=0;this.K1.col2.y=d;this.K2.col1.x=f*e*e;this.K2.col2.x=-f*c*e;this.K2.col1.y=-f*c*e;this.K2.col2.y=f*c*c;this.K.SetM(this.K1);this.K.AddM(this.K2);this.K.col1.x+=this.m_gamma;this.K.col2.y+=this.m_gamma;this.K.GetInverse(this.m_mass);this.m_C.x=b.m_sweep.c.x+c-this.m_target.x;this.m_C.y=b.m_sweep.c.y+e-this.m_target.y;b.m_angularVelocity*=0.98;this.m_impulse.x*=
a.dtRatio;this.m_impulse.y*=a.dtRatio;b.m_linearVelocity.x+=d*this.m_impulse.x;b.m_linearVelocity.y+=d*this.m_impulse.y;b.m_angularVelocity+=f*(c*this.m_impulse.y-e*this.m_impulse.x)};t.prototype.SolveVelocityConstraints=function(a){var b=this.m_bodyB,c,e=0,d=0;c=b.m_xf.R;var f=this.m_localAnchor.x-b.m_sweep.localCenter.x,g=this.m_localAnchor.y-b.m_sweep.localCenter.y,e=c.col1.x*f+c.col2.x*g,g=c.col1.y*f+c.col2.y*g,f=e,e=b.m_linearVelocity.x+-b.m_angularVelocity*g,h=b.m_linearVelocity.y+b.m_angularVelocity*
f;c=this.m_mass;e=e+this.m_beta*this.m_C.x+this.m_gamma*this.m_impulse.x;d=h+this.m_beta*this.m_C.y+this.m_gamma*this.m_impulse.y;h=-(c.col1.x*e+c.col2.x*d);d=-(c.col1.y*e+c.col2.y*d);c=this.m_impulse.x;e=this.m_impulse.y;this.m_impulse.x+=h;this.m_impulse.y+=d;a=a.dt*this.m_maxForce;this.m_impulse.LengthSquared()>a*a&&this.m_impulse.Multiply(a/this.m_impulse.Length());h=this.m_impulse.x-c;d=this.m_impulse.y-e;b.m_linearVelocity.x+=b.m_invMass*h;b.m_linearVelocity.y+=b.m_invMass*d;b.m_angularVelocity+=
b.m_invI*(f*d-g*h)};t.prototype.SolvePositionConstraints=function(){return!0};Box2D.inherit(x,Box2D.Dynamics.Joints.b2JointDef);x.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;x.b2MouseJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.target=new k};x.prototype.b2MouseJointDef=function(){this.__super.b2JointDef.call(this);this.type=q.e_mouseJoint;this.maxForce=0;this.frequencyHz=5;this.dampingRatio=0.7};Box2D.inherit(v,Box2D.Dynamics.Joints.b2Joint);
v.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;v.b2PrismaticJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_localAnchor1=new k;this.m_localAnchor2=new k;this.m_localXAxis1=new k;this.m_localYAxis1=new k;this.m_axis=new k;this.m_perp=new k;this.m_K=new n;this.m_impulse=new a};v.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};v.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};
v.prototype.GetReactionForce=function(a){void 0===a&&(a=0);return new k(a*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x),a*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y))};v.prototype.GetReactionTorque=function(a){void 0===a&&(a=0);return a*this.m_impulse.y};v.prototype.GetJointTranslation=function(){var a=this.m_bodyA,b=this.m_bodyB,c=a.GetWorldPoint(this.m_localAnchor1),e=b.GetWorldPoint(this.m_localAnchor2),b=e.x-c.x,
c=e.y-c.y,a=a.GetWorldVector(this.m_localXAxis1);return a.x*b+a.y*c};v.prototype.GetJointSpeed=function(){var a=this.m_bodyA,b=this.m_bodyB,c;c=a.m_xf.R;var e=this.m_localAnchor1.x-a.m_sweep.localCenter.x,d=this.m_localAnchor1.y-a.m_sweep.localCenter.y,f=c.col1.x*e+c.col2.x*d,d=c.col1.y*e+c.col2.y*d,e=f;c=b.m_xf.R;var g=this.m_localAnchor2.x-b.m_sweep.localCenter.x,h=this.m_localAnchor2.y-b.m_sweep.localCenter.y,f=c.col1.x*g+c.col2.x*h,h=c.col1.y*g+c.col2.y*h,g=f;c=b.m_sweep.c.x+g-(a.m_sweep.c.x+
e);var f=b.m_sweep.c.y+h-(a.m_sweep.c.y+d),j=a.GetWorldVector(this.m_localXAxis1),l=a.m_linearVelocity,q=b.m_linearVelocity,a=a.m_angularVelocity,b=b.m_angularVelocity;return c*-a*j.y+f*a*j.x+(j.x*(q.x+-b*h-l.x- -a*d)+j.y*(q.y+b*g-l.y-a*e))};v.prototype.IsLimitEnabled=function(){return this.m_enableLimit};v.prototype.EnableLimit=function(a){this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_enableLimit=a};v.prototype.GetLowerLimit=function(){return this.m_lowerTranslation};v.prototype.GetUpperLimit=
function(){return this.m_upperTranslation};v.prototype.SetLimits=function(a,b){void 0===a&&(a=0);void 0===b&&(b=0);this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_lowerTranslation=a;this.m_upperTranslation=b};v.prototype.IsMotorEnabled=function(){return this.m_enableMotor};v.prototype.EnableMotor=function(a){this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_enableMotor=a};v.prototype.SetMotorSpeed=function(a){void 0===a&&(a=0);this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);
this.m_motorSpeed=a};v.prototype.GetMotorSpeed=function(){return this.m_motorSpeed};v.prototype.SetMaxMotorForce=function(a){void 0===a&&(a=0);this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_maxMotorForce=a};v.prototype.GetMotorForce=function(){return this.m_motorImpulse};v.prototype.b2PrismaticJoint=function(a){this.__super.b2Joint.call(this,a);this.m_localAnchor1.SetV(a.localAnchorA);this.m_localAnchor2.SetV(a.localAnchorB);this.m_localXAxis1.SetV(a.localAxisA);this.m_localYAxis1.x=-this.m_localXAxis1.y;
this.m_localYAxis1.y=this.m_localXAxis1.x;this.m_refAngle=a.referenceAngle;this.m_impulse.SetZero();this.m_motorImpulse=this.m_motorMass=0;this.m_lowerTranslation=a.lowerTranslation;this.m_upperTranslation=a.upperTranslation;this.m_maxMotorForce=a.maxMotorForce;this.m_motorSpeed=a.motorSpeed;this.m_enableLimit=a.enableLimit;this.m_enableMotor=a.enableMotor;this.m_limitState=q.e_inactiveLimit;this.m_axis.SetZero();this.m_perp.SetZero()};v.prototype.InitVelocityConstraints=function(a){var b=this.m_bodyA,
e=this.m_bodyB,d,f=0;this.m_localCenterA.SetV(b.GetLocalCenter());this.m_localCenterB.SetV(e.GetLocalCenter());var g=b.GetTransform();e.GetTransform();d=b.m_xf.R;var h=this.m_localAnchor1.x-this.m_localCenterA.x,j=this.m_localAnchor1.y-this.m_localCenterA.y,f=d.col1.x*h+d.col2.x*j,j=d.col1.y*h+d.col2.y*j,h=f;d=e.m_xf.R;var l=this.m_localAnchor2.x-this.m_localCenterB.x,k=this.m_localAnchor2.y-this.m_localCenterB.y,f=d.col1.x*l+d.col2.x*k,k=d.col1.y*l+d.col2.y*k,l=f;d=e.m_sweep.c.x+l-b.m_sweep.c.x-
h;f=e.m_sweep.c.y+k-b.m_sweep.c.y-j;this.m_invMassA=b.m_invMass;this.m_invMassB=e.m_invMass;this.m_invIA=b.m_invI;this.m_invIB=e.m_invI;this.m_axis.SetV(o.MulMV(g.R,this.m_localXAxis1));this.m_a1=(d+h)*this.m_axis.y-(f+j)*this.m_axis.x;this.m_a2=l*this.m_axis.y-k*this.m_axis.x;this.m_motorMass=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_a1*this.m_a1+this.m_invIB*this.m_a2*this.m_a2;if(this.m_motorMass>Number.MIN_VALUE)this.m_motorMass=1/this.m_motorMass;this.m_perp.SetV(o.MulMV(g.R,this.m_localYAxis1));
this.m_s1=(d+h)*this.m_perp.y-(f+j)*this.m_perp.x;this.m_s2=l*this.m_perp.y-k*this.m_perp.x;g=this.m_invMassA;h=this.m_invMassB;j=this.m_invIA;l=this.m_invIB;this.m_K.col1.x=g+h+j*this.m_s1*this.m_s1+l*this.m_s2*this.m_s2;this.m_K.col1.y=j*this.m_s1+l*this.m_s2;this.m_K.col1.z=j*this.m_s1*this.m_a1+l*this.m_s2*this.m_a2;this.m_K.col2.x=this.m_K.col1.y;this.m_K.col2.y=j+l;this.m_K.col2.z=j*this.m_a1+l*this.m_a2;this.m_K.col3.x=this.m_K.col1.z;this.m_K.col3.y=this.m_K.col2.z;this.m_K.col3.z=g+h+j*this.m_a1*
this.m_a1+l*this.m_a2*this.m_a2;if(this.m_enableLimit)if(d=this.m_axis.x*d+this.m_axis.y*f,o.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*c.b2_linearSlop)this.m_limitState=q.e_equalLimits;else if(d<=this.m_lowerTranslation){if(this.m_limitState!=q.e_atLowerLimit)this.m_limitState=q.e_atLowerLimit,this.m_impulse.z=0}else if(d>=this.m_upperTranslation){if(this.m_limitState!=q.e_atUpperLimit)this.m_limitState=q.e_atUpperLimit,this.m_impulse.z=0}else this.m_limitState=q.e_inactiveLimit,this.m_impulse.z=
0;else this.m_limitState=q.e_inactiveLimit;if(!1==this.m_enableMotor)this.m_motorImpulse=0;a.warmStarting?(this.m_impulse.x*=a.dtRatio,this.m_impulse.y*=a.dtRatio,this.m_motorImpulse*=a.dtRatio,a=this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x,d=this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y,f=this.m_impulse.x*this.m_s1+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a1,g=this.m_impulse.x*this.m_s2+this.m_impulse.y+
(this.m_motorImpulse+this.m_impulse.z)*this.m_a2,b.m_linearVelocity.x-=this.m_invMassA*a,b.m_linearVelocity.y-=this.m_invMassA*d,b.m_angularVelocity-=this.m_invIA*f,e.m_linearVelocity.x+=this.m_invMassB*a,e.m_linearVelocity.y+=this.m_invMassB*d,e.m_angularVelocity+=this.m_invIB*g):(this.m_impulse.SetZero(),this.m_motorImpulse=0)};v.prototype.SolveVelocityConstraints=function(b){var c=this.m_bodyA,e=this.m_bodyB,d=c.m_linearVelocity,f=c.m_angularVelocity,g=e.m_linearVelocity,h=e.m_angularVelocity,
j=0,l=0,p=0,m=0;if(this.m_enableMotor&&this.m_limitState!=q.e_equalLimits)m=this.m_motorMass*(this.m_motorSpeed-(this.m_axis.x*(g.x-d.x)+this.m_axis.y*(g.y-d.y)+this.m_a2*h-this.m_a1*f)),j=this.m_motorImpulse,b=b.dt*this.m_maxMotorForce,this.m_motorImpulse=o.Clamp(this.m_motorImpulse+m,-b,b),m=this.m_motorImpulse-j,j=m*this.m_axis.x,l=m*this.m_axis.y,p=m*this.m_a1,m*=this.m_a2,d.x-=this.m_invMassA*j,d.y-=this.m_invMassA*l,f-=this.m_invIA*p,g.x+=this.m_invMassB*j,g.y+=this.m_invMassB*l,h+=this.m_invIB*
m;p=this.m_perp.x*(g.x-d.x)+this.m_perp.y*(g.y-d.y)+this.m_s2*h-this.m_s1*f;l=h-f;if(this.m_enableLimit&&this.m_limitState!=q.e_inactiveLimit){b=this.m_axis.x*(g.x-d.x)+this.m_axis.y*(g.y-d.y)+this.m_a2*h-this.m_a1*f;j=this.m_impulse.Copy();b=this.m_K.Solve33(new a,-p,-l,-b);this.m_impulse.Add(b);if(this.m_limitState==q.e_atLowerLimit)this.m_impulse.z=o.Max(this.m_impulse.z,0);else if(this.m_limitState==q.e_atUpperLimit)this.m_impulse.z=o.Min(this.m_impulse.z,0);p=-p-(this.m_impulse.z-j.z)*this.m_K.col3.x;
l=-l-(this.m_impulse.z-j.z)*this.m_K.col3.y;l=this.m_K.Solve22(new k,p,l);l.x+=j.x;l.y+=j.y;this.m_impulse.x=l.x;this.m_impulse.y=l.y;b.x=this.m_impulse.x-j.x;b.y=this.m_impulse.y-j.y;b.z=this.m_impulse.z-j.z;j=b.x*this.m_perp.x+b.z*this.m_axis.x;l=b.x*this.m_perp.y+b.z*this.m_axis.y;p=b.x*this.m_s1+b.y+b.z*this.m_a1;m=b.x*this.m_s2+b.y+b.z*this.m_a2}else b=this.m_K.Solve22(new k,-p,-l),this.m_impulse.x+=b.x,this.m_impulse.y+=b.y,j=b.x*this.m_perp.x,l=b.x*this.m_perp.y,p=b.x*this.m_s1+b.y,m=b.x*this.m_s2+
b.y;d.x-=this.m_invMassA*j;d.y-=this.m_invMassA*l;f-=this.m_invIA*p;g.x+=this.m_invMassB*j;g.y+=this.m_invMassB*l;h+=this.m_invIB*m;c.m_linearVelocity.SetV(d);c.m_angularVelocity=f;e.m_linearVelocity.SetV(g);e.m_angularVelocity=h};v.prototype.SolvePositionConstraints=function(){var b=this.m_bodyA,e=this.m_bodyB,d=b.m_sweep.c,f=b.m_sweep.a,g=e.m_sweep.c,h=e.m_sweep.a,j,l=0,q=0,p=0,A=0,n=0,q=!1,B=0,t=m.FromAngle(f),v=m.FromAngle(h);j=t;var n=this.m_localAnchor1.x-this.m_localCenterA.x,x=this.m_localAnchor1.y-
this.m_localCenterA.y,l=j.col1.x*n+j.col2.x*x,x=j.col1.y*n+j.col2.y*x,n=l;j=v;v=this.m_localAnchor2.x-this.m_localCenterB.x;p=this.m_localAnchor2.y-this.m_localCenterB.y;l=j.col1.x*v+j.col2.x*p;p=j.col1.y*v+j.col2.y*p;v=l;j=g.x+v-d.x-n;l=g.y+p-d.y-x;if(this.m_enableLimit){this.m_axis=o.MulMV(t,this.m_localXAxis1);this.m_a1=(j+n)*this.m_axis.y-(l+x)*this.m_axis.x;this.m_a2=v*this.m_axis.y-p*this.m_axis.x;var y=this.m_axis.x*j+this.m_axis.y*l;o.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*
c.b2_linearSlop?(B=o.Clamp(y,-c.b2_maxLinearCorrection,c.b2_maxLinearCorrection),A=o.Abs(y),q=!0):y<=this.m_lowerTranslation?(B=o.Clamp(y-this.m_lowerTranslation+c.b2_linearSlop,-c.b2_maxLinearCorrection,0),A=this.m_lowerTranslation-y,q=!0):y>=this.m_upperTranslation&&(B=o.Clamp(y-this.m_upperTranslation+c.b2_linearSlop,0,c.b2_maxLinearCorrection),A=y-this.m_upperTranslation,q=!0)}this.m_perp=o.MulMV(t,this.m_localYAxis1);this.m_s1=(j+n)*this.m_perp.y-(l+x)*this.m_perp.x;this.m_s2=v*this.m_perp.y-
p*this.m_perp.x;t=new a;x=this.m_perp.x*j+this.m_perp.y*l;v=h-f-this.m_refAngle;A=o.Max(A,o.Abs(x));n=o.Abs(v);q?(q=this.m_invMassA,p=this.m_invMassB,j=this.m_invIA,l=this.m_invIB,this.m_K.col1.x=q+p+j*this.m_s1*this.m_s1+l*this.m_s2*this.m_s2,this.m_K.col1.y=j*this.m_s1+l*this.m_s2,this.m_K.col1.z=j*this.m_s1*this.m_a1+l*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=j+l,this.m_K.col2.z=j*this.m_a1+l*this.m_a2,this.m_K.col3.x=this.m_K.col1.z,this.m_K.col3.y=this.m_K.col2.z,this.m_K.col3.z=
q+p+j*this.m_a1*this.m_a1+l*this.m_a2*this.m_a2,this.m_K.Solve33(t,-x,-v,-B)):(q=this.m_invMassA,p=this.m_invMassB,j=this.m_invIA,l=this.m_invIB,B=j*this.m_s1+l*this.m_s2,y=j+l,this.m_K.col1.Set(q+p+j*this.m_s1*this.m_s1+l*this.m_s2*this.m_s2,B,0),this.m_K.col2.Set(B,y,0),B=this.m_K.Solve22(new k,-x,-v),t.x=B.x,t.y=B.y,t.z=0);B=t.x*this.m_perp.x+t.z*this.m_axis.x;q=t.x*this.m_perp.y+t.z*this.m_axis.y;x=t.x*this.m_s1+t.y+t.z*this.m_a1;t=t.x*this.m_s2+t.y+t.z*this.m_a2;d.x-=this.m_invMassA*B;d.y-=this.m_invMassA*
q;f-=this.m_invIA*x;g.x+=this.m_invMassB*B;g.y+=this.m_invMassB*q;h+=this.m_invIB*t;b.m_sweep.a=f;e.m_sweep.a=h;b.SynchronizeTransform();e.SynchronizeTransform();return A<=c.b2_linearSlop&&n<=c.b2_angularSlop};Box2D.inherit(y,Box2D.Dynamics.Joints.b2JointDef);y.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;y.b2PrismaticJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.localAnchorA=new k;this.localAnchorB=new k;this.localAxisA=new k};y.prototype.b2PrismaticJointDef=
function(){this.__super.b2JointDef.call(this);this.type=q.e_prismaticJoint;this.localAxisA.Set(1,0);this.referenceAngle=0;this.enableLimit=!1;this.upperTranslation=this.lowerTranslation=0;this.enableMotor=!1;this.motorSpeed=this.maxMotorForce=0};y.prototype.Initialize=function(a,b,c,e){this.bodyA=a;this.bodyB=b;this.localAnchorA=this.bodyA.GetLocalPoint(c);this.localAnchorB=this.bodyB.GetLocalPoint(c);this.localAxisA=this.bodyA.GetLocalVector(e);this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()};
Box2D.inherit(z,Box2D.Dynamics.Joints.b2Joint);z.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;z.b2PulleyJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_groundAnchor1=new k;this.m_groundAnchor2=new k;this.m_localAnchor1=new k;this.m_localAnchor2=new k;this.m_u1=new k;this.m_u2=new k};z.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};z.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};
z.prototype.GetReactionForce=function(a){void 0===a&&(a=0);return new k(a*this.m_impulse*this.m_u2.x,a*this.m_impulse*this.m_u2.y)};z.prototype.GetReactionTorque=function(){return 0};z.prototype.GetGroundAnchorA=function(){var a=this.m_ground.m_xf.position.Copy();a.Add(this.m_groundAnchor1);return a};z.prototype.GetGroundAnchorB=function(){var a=this.m_ground.m_xf.position.Copy();a.Add(this.m_groundAnchor2);return a};z.prototype.GetLength1=function(){var a=this.m_bodyA.GetWorldPoint(this.m_localAnchor1),
b=a.x-(this.m_ground.m_xf.position.x+this.m_groundAnchor1.x),a=a.y-(this.m_ground.m_xf.position.y+this.m_groundAnchor1.y);return Math.sqrt(b*b+a*a)};z.prototype.GetLength2=function(){var a=this.m_bodyB.GetWorldPoint(this.m_localAnchor2),b=a.x-(this.m_ground.m_xf.position.x+this.m_groundAnchor2.x),a=a.y-(this.m_ground.m_xf.position.y+this.m_groundAnchor2.y);return Math.sqrt(b*b+a*a)};z.prototype.GetRatio=function(){return this.m_ratio};z.prototype.b2PulleyJoint=function(a){this.__super.b2Joint.call(this,
a);this.m_ground=this.m_bodyA.m_world.m_groundBody;this.m_groundAnchor1.x=a.groundAnchorA.x-this.m_ground.m_xf.position.x;this.m_groundAnchor1.y=a.groundAnchorA.y-this.m_ground.m_xf.position.y;this.m_groundAnchor2.x=a.groundAnchorB.x-this.m_ground.m_xf.position.x;this.m_groundAnchor2.y=a.groundAnchorB.y-this.m_ground.m_xf.position.y;this.m_localAnchor1.SetV(a.localAnchorA);this.m_localAnchor2.SetV(a.localAnchorB);this.m_ratio=a.ratio;this.m_constant=a.lengthA+this.m_ratio*a.lengthB;this.m_maxLength1=
o.Min(a.maxLengthA,this.m_constant-this.m_ratio*z.b2_minPulleyLength);this.m_maxLength2=o.Min(a.maxLengthB,(this.m_constant-z.b2_minPulleyLength)/this.m_ratio);this.m_limitImpulse2=this.m_limitImpulse1=this.m_impulse=0};z.prototype.InitVelocityConstraints=function(a){var b=this.m_bodyA,e=this.m_bodyB,d;d=b.m_xf.R;var f=this.m_localAnchor1.x-b.m_sweep.localCenter.x,g=this.m_localAnchor1.y-b.m_sweep.localCenter.y,h=d.col1.x*f+d.col2.x*g,g=d.col1.y*f+d.col2.y*g,f=h;d=e.m_xf.R;var j=this.m_localAnchor2.x-
e.m_sweep.localCenter.x,l=this.m_localAnchor2.y-e.m_sweep.localCenter.y,h=d.col1.x*j+d.col2.x*l,l=d.col1.y*j+d.col2.y*l,j=h;d=e.m_sweep.c.x+j;var h=e.m_sweep.c.y+l,k=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x,p=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y;this.m_u1.Set(b.m_sweep.c.x+f-(this.m_ground.m_xf.position.x+this.m_groundAnchor1.x),b.m_sweep.c.y+g-(this.m_ground.m_xf.position.y+this.m_groundAnchor1.y));this.m_u2.Set(d-k,h-p);d=this.m_u1.Length();h=this.m_u2.Length();d>c.b2_linearSlop?
this.m_u1.Multiply(1/d):this.m_u1.SetZero();h>c.b2_linearSlop?this.m_u2.Multiply(1/h):this.m_u2.SetZero();0<this.m_constant-d-this.m_ratio*h?(this.m_state=q.e_inactiveLimit,this.m_impulse=0):this.m_state=q.e_atUpperLimit;d<this.m_maxLength1?(this.m_limitState1=q.e_inactiveLimit,this.m_limitImpulse1=0):this.m_limitState1=q.e_atUpperLimit;h<this.m_maxLength2?(this.m_limitState2=q.e_inactiveLimit,this.m_limitImpulse2=0):this.m_limitState2=q.e_atUpperLimit;d=f*this.m_u1.y-g*this.m_u1.x;h=j*this.m_u2.y-
l*this.m_u2.x;this.m_limitMass1=b.m_invMass+b.m_invI*d*d;this.m_limitMass2=e.m_invMass+e.m_invI*h*h;this.m_pulleyMass=this.m_limitMass1+this.m_ratio*this.m_ratio*this.m_limitMass2;this.m_limitMass1=1/this.m_limitMass1;this.m_limitMass2=1/this.m_limitMass2;this.m_pulleyMass=1/this.m_pulleyMass;a.warmStarting?(this.m_impulse*=a.dtRatio,this.m_limitImpulse1*=a.dtRatio,this.m_limitImpulse2*=a.dtRatio,a=(-this.m_impulse-this.m_limitImpulse1)*this.m_u1.x,d=(-this.m_impulse-this.m_limitImpulse1)*this.m_u1.y,
h=(-this.m_ratio*this.m_impulse-this.m_limitImpulse2)*this.m_u2.x,k=(-this.m_ratio*this.m_impulse-this.m_limitImpulse2)*this.m_u2.y,b.m_linearVelocity.x+=b.m_invMass*a,b.m_linearVelocity.y+=b.m_invMass*d,b.m_angularVelocity+=b.m_invI*(f*d-g*a),e.m_linearVelocity.x+=e.m_invMass*h,e.m_linearVelocity.y+=e.m_invMass*k,e.m_angularVelocity+=e.m_invI*(j*k-l*h)):this.m_limitImpulse2=this.m_limitImpulse1=this.m_impulse=0};z.prototype.SolveVelocityConstraints=function(){var a=this.m_bodyA,b=this.m_bodyB,c;
c=a.m_xf.R;var e=this.m_localAnchor1.x-a.m_sweep.localCenter.x,d=this.m_localAnchor1.y-a.m_sweep.localCenter.y,f=c.col1.x*e+c.col2.x*d,d=c.col1.y*e+c.col2.y*d,e=f;c=b.m_xf.R;var g=this.m_localAnchor2.x-b.m_sweep.localCenter.x,h=this.m_localAnchor2.y-b.m_sweep.localCenter.y,f=c.col1.x*g+c.col2.x*h,h=c.col1.y*g+c.col2.y*h,g=f,j=0,l=0;if(this.m_state==q.e_atUpperLimit)c=a.m_linearVelocity.x+-a.m_angularVelocity*d,f=a.m_linearVelocity.y+a.m_angularVelocity*e,j=b.m_linearVelocity.x+-b.m_angularVelocity*
h,l=b.m_linearVelocity.y+b.m_angularVelocity*g,c=-(this.m_u1.x*c+this.m_u1.y*f)-this.m_ratio*(this.m_u2.x*j+this.m_u2.y*l),l=this.m_pulleyMass*-c,c=this.m_impulse,this.m_impulse=o.Max(0,this.m_impulse+l),l=this.m_impulse-c,c=-l*this.m_u1.x,f=-l*this.m_u1.y,j=-this.m_ratio*l*this.m_u2.x,l=-this.m_ratio*l*this.m_u2.y,a.m_linearVelocity.x+=a.m_invMass*c,a.m_linearVelocity.y+=a.m_invMass*f,a.m_angularVelocity+=a.m_invI*(e*f-d*c),b.m_linearVelocity.x+=b.m_invMass*j,b.m_linearVelocity.y+=b.m_invMass*l,
b.m_angularVelocity+=b.m_invI*(g*l-h*j);if(this.m_limitState1==q.e_atUpperLimit)c=a.m_linearVelocity.x+-a.m_angularVelocity*d,f=a.m_linearVelocity.y+a.m_angularVelocity*e,c=-(this.m_u1.x*c+this.m_u1.y*f),l=-this.m_limitMass1*c,c=this.m_limitImpulse1,this.m_limitImpulse1=o.Max(0,this.m_limitImpulse1+l),l=this.m_limitImpulse1-c,c=-l*this.m_u1.x,f=-l*this.m_u1.y,a.m_linearVelocity.x+=a.m_invMass*c,a.m_linearVelocity.y+=a.m_invMass*f,a.m_angularVelocity+=a.m_invI*(e*f-d*c);if(this.m_limitState2==q.e_atUpperLimit)j=
b.m_linearVelocity.x+-b.m_angularVelocity*h,l=b.m_linearVelocity.y+b.m_angularVelocity*g,c=-(this.m_u2.x*j+this.m_u2.y*l),l=-this.m_limitMass2*c,c=this.m_limitImpulse2,this.m_limitImpulse2=o.Max(0,this.m_limitImpulse2+l),l=this.m_limitImpulse2-c,j=-l*this.m_u2.x,l=-l*this.m_u2.y,b.m_linearVelocity.x+=b.m_invMass*j,b.m_linearVelocity.y+=b.m_invMass*l,b.m_angularVelocity+=b.m_invI*(g*l-h*j)};z.prototype.SolvePositionConstraints=function(){var a=this.m_bodyA,b=this.m_bodyB,e,d=this.m_ground.m_xf.position.x+
this.m_groundAnchor1.x,f=this.m_ground.m_xf.position.y+this.m_groundAnchor1.y,g=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x,h=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y,j=0,l=0,k=0,p=0,m=0,A=0,n=0,B=0;if(this.m_state==q.e_atUpperLimit)e=a.m_xf.R,j=this.m_localAnchor1.x-a.m_sweep.localCenter.x,l=this.m_localAnchor1.y-a.m_sweep.localCenter.y,m=e.col1.x*j+e.col2.x*l,l=e.col1.y*j+e.col2.y*l,j=m,e=b.m_xf.R,k=this.m_localAnchor2.x-b.m_sweep.localCenter.x,p=this.m_localAnchor2.y-b.m_sweep.localCenter.y,
m=e.col1.x*k+e.col2.x*p,p=e.col1.y*k+e.col2.y*p,k=m,e=a.m_sweep.c.x+j,m=a.m_sweep.c.y+l,A=b.m_sweep.c.x+k,n=b.m_sweep.c.y+p,this.m_u1.Set(e-d,m-f),this.m_u2.Set(A-g,n-h),e=this.m_u1.Length(),m=this.m_u2.Length(),e>c.b2_linearSlop?this.m_u1.Multiply(1/e):this.m_u1.SetZero(),m>c.b2_linearSlop?this.m_u2.Multiply(1/m):this.m_u2.SetZero(),e=this.m_constant-e-this.m_ratio*m,B=o.Max(B,-e),e=o.Clamp(e+c.b2_linearSlop,-c.b2_maxLinearCorrection,0),n=-this.m_pulleyMass*e,e=-n*this.m_u1.x,m=-n*this.m_u1.y,A=
-this.m_ratio*n*this.m_u2.x,n=-this.m_ratio*n*this.m_u2.y,a.m_sweep.c.x+=a.m_invMass*e,a.m_sweep.c.y+=a.m_invMass*m,a.m_sweep.a+=a.m_invI*(j*m-l*e),b.m_sweep.c.x+=b.m_invMass*A,b.m_sweep.c.y+=b.m_invMass*n,b.m_sweep.a+=b.m_invI*(k*n-p*A),a.SynchronizeTransform(),b.SynchronizeTransform();if(this.m_limitState1==q.e_atUpperLimit)e=a.m_xf.R,j=this.m_localAnchor1.x-a.m_sweep.localCenter.x,l=this.m_localAnchor1.y-a.m_sweep.localCenter.y,m=e.col1.x*j+e.col2.x*l,l=e.col1.y*j+e.col2.y*l,j=m,e=a.m_sweep.c.x+
j,m=a.m_sweep.c.y+l,this.m_u1.Set(e-d,m-f),e=this.m_u1.Length(),e>c.b2_linearSlop?(this.m_u1.x*=1/e,this.m_u1.y*=1/e):this.m_u1.SetZero(),e=this.m_maxLength1-e,B=o.Max(B,-e),e=o.Clamp(e+c.b2_linearSlop,-c.b2_maxLinearCorrection,0),n=-this.m_limitMass1*e,e=-n*this.m_u1.x,m=-n*this.m_u1.y,a.m_sweep.c.x+=a.m_invMass*e,a.m_sweep.c.y+=a.m_invMass*m,a.m_sweep.a+=a.m_invI*(j*m-l*e),a.SynchronizeTransform();if(this.m_limitState2==q.e_atUpperLimit)e=b.m_xf.R,k=this.m_localAnchor2.x-b.m_sweep.localCenter.x,
p=this.m_localAnchor2.y-b.m_sweep.localCenter.y,m=e.col1.x*k+e.col2.x*p,p=e.col1.y*k+e.col2.y*p,k=m,A=b.m_sweep.c.x+k,n=b.m_sweep.c.y+p,this.m_u2.Set(A-g,n-h),m=this.m_u2.Length(),m>c.b2_linearSlop?(this.m_u2.x*=1/m,this.m_u2.y*=1/m):this.m_u2.SetZero(),e=this.m_maxLength2-m,B=o.Max(B,-e),e=o.Clamp(e+c.b2_linearSlop,-c.b2_maxLinearCorrection,0),n=-this.m_limitMass2*e,A=-n*this.m_u2.x,n=-n*this.m_u2.y,b.m_sweep.c.x+=b.m_invMass*A,b.m_sweep.c.y+=b.m_invMass*n,b.m_sweep.a+=b.m_invI*(k*n-p*A),b.SynchronizeTransform();
return B<c.b2_linearSlop};Box2D.postDefs.push(function(){Box2D.Dynamics.Joints.b2PulleyJoint.b2_minPulleyLength=2});Box2D.inherit(G,Box2D.Dynamics.Joints.b2JointDef);G.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;G.b2PulleyJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.groundAnchorA=new k;this.groundAnchorB=new k;this.localAnchorA=new k;this.localAnchorB=new k};G.prototype.b2PulleyJointDef=function(){this.__super.b2JointDef.call(this);this.type=
q.e_pulleyJoint;this.groundAnchorA.Set(-1,1);this.groundAnchorB.Set(1,1);this.localAnchorA.Set(-1,0);this.localAnchorB.Set(1,0);this.maxLengthB=this.lengthB=this.maxLengthA=this.lengthA=0;this.ratio=1;this.collideConnected=!0};G.prototype.Initialize=function(a,b,c,e,d,f,g){void 0===g&&(g=0);this.bodyA=a;this.bodyB=b;this.groundAnchorA.SetV(c);this.groundAnchorB.SetV(e);this.localAnchorA=this.bodyA.GetLocalPoint(d);this.localAnchorB=this.bodyB.GetLocalPoint(f);a=d.x-c.x;c=d.y-c.y;this.lengthA=Math.sqrt(a*
a+c*c);c=f.x-e.x;e=f.y-e.y;this.lengthB=Math.sqrt(c*c+e*e);this.ratio=g;g=this.lengthA+this.ratio*this.lengthB;this.maxLengthA=g-this.ratio*z.b2_minPulleyLength;this.maxLengthB=(g-z.b2_minPulleyLength)/this.ratio};Box2D.inherit(D,Box2D.Dynamics.Joints.b2Joint);D.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;D.b2RevoluteJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.K=new m;this.K1=new m;this.K2=new m;this.K3=new m;this.impulse3=new a;this.impulse2=new k;
this.reduced=new k;this.m_localAnchor1=new k;this.m_localAnchor2=new k;this.m_impulse=new a;this.m_mass=new n};D.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)};D.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)};D.prototype.GetReactionForce=function(a){void 0===a&&(a=0);return new k(a*this.m_impulse.x,a*this.m_impulse.y)};D.prototype.GetReactionTorque=function(a){void 0===a&&(a=0);return a*this.m_impulse.z};D.prototype.GetJointAngle=
function(){return this.m_bodyB.m_sweep.a-this.m_bodyA.m_sweep.a-this.m_referenceAngle};D.prototype.GetJointSpeed=function(){return this.m_bodyB.m_angularVelocity-this.m_bodyA.m_angularVelocity};D.prototype.IsLimitEnabled=function(){return this.m_enableLimit};D.prototype.EnableLimit=function(a){this.m_enableLimit=a};D.prototype.GetLowerLimit=function(){return this.m_lowerAngle};D.prototype.GetUpperLimit=function(){return this.m_upperAngle};D.prototype.SetLimits=function(a,b){void 0===a&&(a=0);void 0===
b&&(b=0);this.m_lowerAngle=a;this.m_upperAngle=b};D.prototype.IsMotorEnabled=function(){this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);return this.m_enableMotor};D.prototype.EnableMotor=function(a){this.m_enableMotor=a};D.prototype.SetMotorSpeed=function(a){void 0===a&&(a=0);this.m_bodyA.SetAwake(!0);this.m_bodyB.SetAwake(!0);this.m_motorSpeed=a};D.prototype.GetMotorSpeed=function(){return this.m_motorSpeed};D.prototype.SetMaxMotorTorque=function(a){void 0===a&&(a=0);this.m_maxMotorTorque=a};
D.prototype.GetMotorTorque=function(){return this.m_maxMotorTorque};D.prototype.b2RevoluteJoint=function(a){this.__super.b2Joint.call(this,a);this.m_localAnchor1.SetV(a.localAnchorA);this.m_localAnchor2.SetV(a.localAnchorB);this.m_referenceAngle=a.referenceAngle;this.m_impulse.SetZero();this.m_motorImpulse=0;this.m_lowerAngle=a.lowerAngle;this.m_upperAngle=a.upperAngle;this.m_maxMotorTorque=a.maxMotorTorque;this.m_motorSpeed=a.motorSpeed;this.m_enableLimit=a.enableLimit;this.m_enableMotor=a.enableMotor;
this.m_limitState=q.e_inactiveLimit};D.prototype.InitVelocityConstraints=function(a){var b=this.m_bodyA,e=this.m_bodyB,d,f=0;d=b.m_xf.R;var g=this.m_localAnchor1.x-b.m_sweep.localCenter.x,h=this.m_localAnchor1.y-b.m_sweep.localCenter.y,f=d.col1.x*g+d.col2.x*h,h=d.col1.y*g+d.col2.y*h,g=f;d=e.m_xf.R;var j=this.m_localAnchor2.x-e.m_sweep.localCenter.x,l=this.m_localAnchor2.y-e.m_sweep.localCenter.y,f=d.col1.x*j+d.col2.x*l,l=d.col1.y*j+d.col2.y*l,j=f;d=b.m_invMass;var f=e.m_invMass,k=b.m_invI,p=e.m_invI;
this.m_mass.col1.x=d+f+h*h*k+l*l*p;this.m_mass.col2.x=-h*g*k-l*j*p;this.m_mass.col3.x=-h*k-l*p;this.m_mass.col1.y=this.m_mass.col2.x;this.m_mass.col2.y=d+f+g*g*k+j*j*p;this.m_mass.col3.y=g*k+j*p;this.m_mass.col1.z=this.m_mass.col3.x;this.m_mass.col2.z=this.m_mass.col3.y;this.m_mass.col3.z=k+p;this.m_motorMass=1/(k+p);if(!1==this.m_enableMotor)this.m_motorImpulse=0;if(this.m_enableLimit){var m=e.m_sweep.a-b.m_sweep.a-this.m_referenceAngle;if(o.Abs(this.m_upperAngle-this.m_lowerAngle)<2*c.b2_angularSlop)this.m_limitState=
q.e_equalLimits;else if(m<=this.m_lowerAngle){if(this.m_limitState!=q.e_atLowerLimit)this.m_impulse.z=0;this.m_limitState=q.e_atLowerLimit}else if(m>=this.m_upperAngle){if(this.m_limitState!=q.e_atUpperLimit)this.m_impulse.z=0;this.m_limitState=q.e_atUpperLimit}else this.m_limitState=q.e_inactiveLimit,this.m_impulse.z=0}else this.m_limitState=q.e_inactiveLimit;a.warmStarting?(this.m_impulse.x*=a.dtRatio,this.m_impulse.y*=a.dtRatio,this.m_motorImpulse*=a.dtRatio,a=this.m_impulse.x,m=this.m_impulse.y,
b.m_linearVelocity.x-=d*a,b.m_linearVelocity.y-=d*m,b.m_angularVelocity-=k*(g*m-h*a+this.m_motorImpulse+this.m_impulse.z),e.m_linearVelocity.x+=f*a,e.m_linearVelocity.y+=f*m,e.m_angularVelocity+=p*(j*m-l*a+this.m_motorImpulse+this.m_impulse.z)):(this.m_impulse.SetZero(),this.m_motorImpulse=0)};D.prototype.SolveVelocityConstraints=function(a){var b=this.m_bodyA,c=this.m_bodyB,e=0,d=0,f=0,g=0,h=0,j=b.m_linearVelocity,l=b.m_angularVelocity,k=c.m_linearVelocity,p=c.m_angularVelocity,m=b.m_invMass,A=c.m_invMass,
n=b.m_invI,B=c.m_invI;if(this.m_enableMotor&&this.m_limitState!=q.e_equalLimits)d=this.m_motorMass*-(p-l-this.m_motorSpeed),f=this.m_motorImpulse,g=a.dt*this.m_maxMotorTorque,this.m_motorImpulse=o.Clamp(this.m_motorImpulse+d,-g,g),d=this.m_motorImpulse-f,l-=n*d,p+=B*d;if(this.m_enableLimit&&this.m_limitState!=q.e_inactiveLimit){var a=b.m_xf.R,d=this.m_localAnchor1.x-b.m_sweep.localCenter.x,f=this.m_localAnchor1.y-b.m_sweep.localCenter.y,e=a.col1.x*d+a.col2.x*f,f=a.col1.y*d+a.col2.y*f,d=e,a=c.m_xf.R,
g=this.m_localAnchor2.x-c.m_sweep.localCenter.x,h=this.m_localAnchor2.y-c.m_sweep.localCenter.y,e=a.col1.x*g+a.col2.x*h,h=a.col1.y*g+a.col2.y*h,g=e,a=k.x+-p*h-j.x- -l*f,t=k.y+p*g-j.y-l*d;this.m_mass.Solve33(this.impulse3,-a,-t,-(p-l));if(this.m_limitState==q.e_equalLimits)this.m_impulse.Add(this.impulse3);else if(this.m_limitState==q.e_atLowerLimit){if(e=this.m_impulse.z+this.impulse3.z,0>e)this.m_mass.Solve22(this.reduced,-a,-t),this.impulse3.x=this.reduced.x,this.impulse3.y=this.reduced.y,this.impulse3.z=
-this.m_impulse.z,this.m_impulse.x+=this.reduced.x,this.m_impulse.y+=this.reduced.y,this.m_impulse.z=0}else if(this.m_limitState==q.e_atUpperLimit&&(e=this.m_impulse.z+this.impulse3.z,0<e))this.m_mass.Solve22(this.reduced,-a,-t),this.impulse3.x=this.reduced.x,this.impulse3.y=this.reduced.y,this.impulse3.z=-this.m_impulse.z,this.m_impulse.x+=this.reduced.x,this.m_impulse.y+=this.reduced.y,this.m_impulse.z=0;j.x-=m*this.impulse3.x;j.y-=m*this.impulse3.y;l-=n*(d*this.impulse3.y-f*this.impulse3.x+this.impulse3.z);
k.x+=A*this.impulse3.x;k.y+=A*this.impulse3.y;p+=B*(g*this.impulse3.y-h*this.impulse3.x+this.impulse3.z)}else a=b.m_xf.R,d=this.m_localAnchor1.x-b.m_sweep.localCenter.x,f=this.m_localAnchor1.y-b.m_sweep.localCenter.y,e=a.col1.x*d+a.col2.x*f,f=a.col1.y*d+a.col2.y*f,d=e,a=c.m_xf.R,g=this.m_localAnchor2.x-c.m_sweep.localCenter.x,h=this.m_localAnchor2.y-c.m_sweep.localCenter.y,e=a.col1.x*g+a.col2.x*h,h=a.col1.y*g+a.col2.y*h,g=e,this.m_mass.Solve22(this.impulse2,-(k.x+-p*h-j.x- -l*f),-(k.y+p*g-j.y-l*d)),
this.m_impulse.x+=this.impulse2.x,this.m_impulse.y+=this.impulse2.y,j.x-=m*this.impulse2.x,j.y-=m*this.impulse2.y,l-=n*(d*this.impulse2.y-f*this.impulse2.x),k.x+=A*this.impulse2.x,k.y+=A*this.impulse2.y,p+=B*(g*this.impulse2.y-h*this.impulse2.x);b.m_linearVelocity.SetV(j);b.m_angularVelocity=l;c.m_linearVelocity.SetV(k);c.m_angularVelocity=p};D.prototype.SolvePositionConstraints=function(){var a=0,b,e=this.m_bodyA,d=this.m_bodyB,f=0,g=0,h=0,j=0;if(this.m_enableLimit&&this.m_limitState!=q.e_inactiveLimit){var a=
d.m_sweep.a-e.m_sweep.a-this.m_referenceAngle,l=0;this.m_limitState==q.e_equalLimits?(a=o.Clamp(a-this.m_lowerAngle,-c.b2_maxAngularCorrection,c.b2_maxAngularCorrection),l=-this.m_motorMass*a,f=o.Abs(a)):this.m_limitState==q.e_atLowerLimit?(a-=this.m_lowerAngle,f=-a,a=o.Clamp(a+c.b2_angularSlop,-c.b2_maxAngularCorrection,0),l=-this.m_motorMass*a):this.m_limitState==q.e_atUpperLimit&&(f=a-=this.m_upperAngle,a=o.Clamp(a-c.b2_angularSlop,0,c.b2_maxAngularCorrection),l=-this.m_motorMass*a);e.m_sweep.a-=
e.m_invI*l;d.m_sweep.a+=d.m_invI*l;e.SynchronizeTransform();d.SynchronizeTransform()}b=e.m_xf.R;l=this.m_localAnchor1.x-e.m_sweep.localCenter.x;a=this.m_localAnchor1.y-e.m_sweep.localCenter.y;g=b.col1.x*l+b.col2.x*a;a=b.col1.y*l+b.col2.y*a;l=g;b=d.m_xf.R;var k=this.m_localAnchor2.x-d.m_sweep.localCenter.x,p=this.m_localAnchor2.y-d.m_sweep.localCenter.y,g=b.col1.x*k+b.col2.x*p,p=b.col1.y*k+b.col2.y*p,k=g,h=d.m_sweep.c.x+k-e.m_sweep.c.x-l,j=d.m_sweep.c.y+p-e.m_sweep.c.y-a,m=h*h+j*j;b=Math.sqrt(m);var g=
e.m_invMass,A=d.m_invMass,n=e.m_invI,B=d.m_invI,t=10*c.b2_linearSlop;m>t*t&&(m=1/(g+A),h=m*-h,j=m*-j,e.m_sweep.c.x-=0.5*g*h,e.m_sweep.c.y-=0.5*g*j,d.m_sweep.c.x+=0.5*A*h,d.m_sweep.c.y+=0.5*A*j,h=d.m_sweep.c.x+k-e.m_sweep.c.x-l,j=d.m_sweep.c.y+p-e.m_sweep.c.y-a);this.K1.col1.x=g+A;this.K1.col2.x=0;this.K1.col1.y=0;this.K1.col2.y=g+A;this.K2.col1.x=n*a*a;this.K2.col2.x=-n*l*a;this.K2.col1.y=-n*l*a;this.K2.col2.y=n*l*l;this.K3.col1.x=B*p*p;this.K3.col2.x=-B*k*p;this.K3.col1.y=-B*k*p;this.K3.col2.y=B*
k*k;this.K.SetM(this.K1);this.K.AddM(this.K2);this.K.AddM(this.K3);this.K.Solve(D.tImpulse,-h,-j);h=D.tImpulse.x;j=D.tImpulse.y;e.m_sweep.c.x-=e.m_invMass*h;e.m_sweep.c.y-=e.m_invMass*j;e.m_sweep.a-=e.m_invI*(l*j-a*h);d.m_sweep.c.x+=d.m_invMass*h;d.m_sweep.c.y+=d.m_invMass*j;d.m_sweep.a+=d.m_invI*(k*j-p*h);e.SynchronizeTransform();d.SynchronizeTransform();return b<=c.b2_linearSlop&&f<=c.b2_angularSlop};Box2D.postDefs.push(function(){Box2D.Dynamics.Joints.b2RevoluteJoint.tImpulse=new k});Box2D.inherit(F,
Box2D.Dynamics.Joints.b2JointDef);F.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;F.b2RevoluteJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,arguments);this.localAnchorA=new k;this.localAnchorB=new k};F.prototype.b2RevoluteJointDef=function(){this.__super.b2JointDef.call(this);this.type=q.e_revoluteJoint;this.localAnchorA.Set(0,0);this.localAnchorB.Set(0,0);this.motorSpeed=this.maxMotorTorque=this.upperAngle=this.lowerAngle=this.referenceAngle=0;this.enableMotor=
this.enableLimit=!1};F.prototype.Initialize=function(a,b,c){this.bodyA=a;this.bodyB=b;this.localAnchorA=this.bodyA.GetLocalPoint(c);this.localAnchorB=this.bodyB.GetLocalPoint(c);this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()};Box2D.inherit(K,Box2D.Dynamics.Joints.b2Joint);K.prototype.__super=Box2D.Dynamics.Joints.b2Joint.prototype;K.b2WeldJoint=function(){Box2D.Dynamics.Joints.b2Joint.b2Joint.apply(this,arguments);this.m_localAnchorA=new k;this.m_localAnchorB=new k;this.m_impulse=
new a;this.m_mass=new n};K.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)};K.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)};K.prototype.GetReactionForce=function(a){void 0===a&&(a=0);return new k(a*this.m_impulse.x,a*this.m_impulse.y)};K.prototype.GetReactionTorque=function(a){void 0===a&&(a=0);return a*this.m_impulse.z};K.prototype.b2WeldJoint=function(a){this.__super.b2Joint.call(this,a);this.m_localAnchorA.SetV(a.localAnchorA);
this.m_localAnchorB.SetV(a.localAnchorB);this.m_referenceAngle=a.referenceAngle;this.m_impulse.SetZero();this.m_mass=new n};K.prototype.InitVelocityConstraints=function(a){var b,c=0,e=this.m_bodyA,d=this.m_bodyB;b=e.m_xf.R;var f=this.m_localAnchorA.x-e.m_sweep.localCenter.x,g=this.m_localAnchorA.y-e.m_sweep.localCenter.y,c=b.col1.x*f+b.col2.x*g,g=b.col1.y*f+b.col2.y*g,f=c;b=d.m_xf.R;var h=this.m_localAnchorB.x-d.m_sweep.localCenter.x,j=this.m_localAnchorB.y-d.m_sweep.localCenter.y,c=b.col1.x*h+b.col2.x*
j,j=b.col1.y*h+b.col2.y*j,h=c;b=e.m_invMass;var c=d.m_invMass,l=e.m_invI,k=d.m_invI;this.m_mass.col1.x=b+c+g*g*l+j*j*k;this.m_mass.col2.x=-g*f*l-j*h*k;this.m_mass.col3.x=-g*l-j*k;this.m_mass.col1.y=this.m_mass.col2.x;this.m_mass.col2.y=b+c+f*f*l+h*h*k;this.m_mass.col3.y=f*l+h*k;this.m_mass.col1.z=this.m_mass.col3.x;this.m_mass.col2.z=this.m_mass.col3.y;this.m_mass.col3.z=l+k;a.warmStarting?(this.m_impulse.x*=a.dtRatio,this.m_impulse.y*=a.dtRatio,this.m_impulse.z*=a.dtRatio,e.m_linearVelocity.x-=b*
this.m_impulse.x,e.m_linearVelocity.y-=b*this.m_impulse.y,e.m_angularVelocity-=l*(f*this.m_impulse.y-g*this.m_impulse.x+this.m_impulse.z),d.m_linearVelocity.x+=c*this.m_impulse.x,d.m_linearVelocity.y+=c*this.m_impulse.y,d.m_angularVelocity+=k*(h*this.m_impulse.y-j*this.m_impulse.x+this.m_impulse.z)):this.m_impulse.SetZero()};K.prototype.SolveVelocityConstraints=function(){var b,c=0,e=this.m_bodyA,d=this.m_bodyB,f=e.m_linearVelocity,g=e.m_angularVelocity,h=d.m_linearVelocity,j=d.m_angularVelocity,
l=e.m_invMass,k=d.m_invMass,q=e.m_invI,p=d.m_invI;b=e.m_xf.R;var m=this.m_localAnchorA.x-e.m_sweep.localCenter.x,A=this.m_localAnchorA.y-e.m_sweep.localCenter.y,c=b.col1.x*m+b.col2.x*A,A=b.col1.y*m+b.col2.y*A,m=c;b=d.m_xf.R;var n=this.m_localAnchorB.x-d.m_sweep.localCenter.x,o=this.m_localAnchorB.y-d.m_sweep.localCenter.y,c=b.col1.x*n+b.col2.x*o,o=b.col1.y*n+b.col2.y*o,n=c;b=h.x-j*o-f.x+g*A;var c=h.y+j*n-f.y-g*m,B=j-g,t=new a;this.m_mass.Solve33(t,-b,-c,-B);this.m_impulse.Add(t);f.x-=l*t.x;f.y-=l*
t.y;g-=q*(m*t.y-A*t.x+t.z);h.x+=k*t.x;h.y+=k*t.y;j+=p*(n*t.y-o*t.x+t.z);e.m_angularVelocity=g;d.m_angularVelocity=j};K.prototype.SolvePositionConstraints=function(){var b,e=0,d=this.m_bodyA,f=this.m_bodyB;b=d.m_xf.R;var g=this.m_localAnchorA.x-d.m_sweep.localCenter.x,h=this.m_localAnchorA.y-d.m_sweep.localCenter.y,e=b.col1.x*g+b.col2.x*h,h=b.col1.y*g+b.col2.y*h,g=e;b=f.m_xf.R;var j=this.m_localAnchorB.x-f.m_sweep.localCenter.x,l=this.m_localAnchorB.y-f.m_sweep.localCenter.y,e=b.col1.x*j+b.col2.x*
l,l=b.col1.y*j+b.col2.y*l,j=e;b=d.m_invMass;var e=f.m_invMass,k=d.m_invI,q=f.m_invI,p=f.m_sweep.c.x+j-d.m_sweep.c.x-g,m=f.m_sweep.c.y+l-d.m_sweep.c.y-h,A=f.m_sweep.a-d.m_sweep.a-this.m_referenceAngle,n=10*c.b2_linearSlop,B=Math.sqrt(p*p+m*m),t=o.Abs(A);B>n&&(k*=1,q*=1);this.m_mass.col1.x=b+e+h*h*k+l*l*q;this.m_mass.col2.x=-h*g*k-l*j*q;this.m_mass.col3.x=-h*k-l*q;this.m_mass.col1.y=this.m_mass.col2.x;this.m_mass.col2.y=b+e+g*g*k+j*j*q;this.m_mass.col3.y=g*k+j*q;this.m_mass.col1.z=this.m_mass.col3.x;
this.m_mass.col2.z=this.m_mass.col3.y;this.m_mass.col3.z=k+q;n=new a;this.m_mass.Solve33(n,-p,-m,-A);d.m_sweep.c.x-=b*n.x;d.m_sweep.c.y-=b*n.y;d.m_sweep.a-=k*(g*n.y-h*n.x+n.z);f.m_sweep.c.x+=e*n.x;f.m_sweep.c.y+=e*n.y;f.m_sweep.a+=q*(j*n.y-l*n.x+n.z);d.SynchronizeTransform();f.SynchronizeTransform();return B<=c.b2_linearSlop&&t<=c.b2_angularSlop};Box2D.inherit(J,Box2D.Dynamics.Joints.b2JointDef);J.prototype.__super=Box2D.Dynamics.Joints.b2JointDef.prototype;J.b2WeldJointDef=function(){Box2D.Dynamics.Joints.b2JointDef.b2JointDef.apply(this,
arguments);this.localAnchorA=new k;this.localAnchorB=new k};J.prototype.b2WeldJointDef=function(){this.__super.b2JointDef.call(this);this.type=q.e_weldJoint;this.referenceAngle=0};J.prototype.Initialize=function(a,b,c){this.bodyA=a;this.bodyB=b;this.localAnchorA.SetV(this.bodyA.GetLocalPoint(c));this.localAnchorB.SetV(this.bodyB.GetLocalPoint(c));this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()}})();
(function(){var c=Box2D.Dynamics.b2DebugDraw;c.b2DebugDraw=function(){this.m_xformScale=this.m_fillAlpha=this.m_alpha=this.m_lineThickness=this.m_drawScale=1;var c=this;this.m_sprite={graphics:{clear:function(){c.m_ctx.clearRect(0,0,c.m_ctx.canvas.width,c.m_ctx.canvas.height)}}}};c.prototype._color=function(c,n){return"rgba("+((c&16711680)>>16)+","+((c&65280)>>8)+","+(c&255)+","+n+")"};c.prototype.b2DebugDraw=function(){this.m_drawFlags=0};c.prototype.SetFlags=function(c){void 0===c&&(c=0);this.m_drawFlags=
c};c.prototype.GetFlags=function(){return this.m_drawFlags};c.prototype.AppendFlags=function(c){void 0===c&&(c=0);this.m_drawFlags|=c};c.prototype.ClearFlags=function(c){void 0===c&&(c=0);this.m_drawFlags&=~c};c.prototype.SetSprite=function(c){this.m_ctx=c};c.prototype.GetSprite=function(){return this.m_ctx};c.prototype.SetDrawScale=function(c){void 0===c&&(c=0);this.m_drawScale=c};c.prototype.GetDrawScale=function(){return this.m_drawScale};c.prototype.SetLineThickness=function(c){void 0===c&&(c=
0);this.m_lineThickness=c;this.m_ctx.strokeWidth=c};c.prototype.GetLineThickness=function(){return this.m_lineThickness};c.prototype.SetAlpha=function(c){void 0===c&&(c=0);this.m_alpha=c};c.prototype.GetAlpha=function(){return this.m_alpha};c.prototype.SetFillAlpha=function(c){void 0===c&&(c=0);this.m_fillAlpha=c};c.prototype.GetFillAlpha=function(){return this.m_fillAlpha};c.prototype.SetXFormScale=function(c){void 0===c&&(c=0);this.m_xformScale=c};c.prototype.GetXFormScale=function(){return this.m_xformScale};
c.prototype.DrawPolygon=function(c,n,o){if(n){var k=this.m_ctx,a=this.m_drawScale;k.beginPath();k.strokeStyle=this._color(o.color,this.m_alpha);k.moveTo(c[0].x*a,c[0].y*a);for(o=1;o<n;o++)k.lineTo(c[o].x*a,c[o].y*a);k.lineTo(c[0].x*a,c[0].y*a);k.closePath();k.stroke()}};c.prototype.DrawSolidPolygon=function(c,n,o){if(n){var k=this.m_ctx,a=this.m_drawScale;k.beginPath();k.strokeStyle=this._color(o.color,this.m_alpha);k.fillStyle=this._color(o.color,this.m_fillAlpha);k.moveTo(c[0].x*a,c[0].y*a);for(o=
1;o<n;o++)k.lineTo(c[o].x*a,c[o].y*a);k.lineTo(c[0].x*a,c[0].y*a);k.closePath();k.fill();k.stroke()}};c.prototype.DrawCircle=function(c,n,o){if(n){var k=this.m_ctx,a=this.m_drawScale;k.beginPath();k.strokeStyle=this._color(o.color,this.m_alpha);k.arc(c.x*a,c.y*a,n*a,0,2*Math.PI,!0);k.closePath();k.stroke()}};c.prototype.DrawSolidCircle=function(c,n,o,k){if(n){var a=this.m_ctx,b=this.m_drawScale,e=c.x*b,d=c.y*b;a.moveTo(0,0);a.beginPath();a.strokeStyle=this._color(k.color,this.m_alpha);a.fillStyle=
this._color(k.color,this.m_fillAlpha);a.arc(e,d,n*b,0,2*Math.PI,!0);a.moveTo(e,d);a.lineTo((c.x+o.x*n)*b,(c.y+o.y*n)*b);a.closePath();a.fill();a.stroke()}};c.prototype.DrawSegment=function(c,n,o){var k=this.m_ctx,a=this.m_drawScale;k.strokeStyle=this._color(o.color,this.m_alpha);k.beginPath();k.moveTo(c.x*a,c.y*a);k.lineTo(n.x*a,n.y*a);k.closePath();k.stroke()};c.prototype.DrawTransform=function(c){var n=this.m_ctx,o=this.m_drawScale;n.beginPath();n.strokeStyle=this._color(16711680,this.m_alpha);
n.moveTo(c.position.x*o,c.position.y*o);n.lineTo((c.position.x+this.m_xformScale*c.R.col1.x)*o,(c.position.y+this.m_xformScale*c.R.col1.y)*o);n.strokeStyle=this._color(65280,this.m_alpha);n.moveTo(c.position.x*o,c.position.y*o);n.lineTo((c.position.x+this.m_xformScale*c.R.col2.x)*o,(c.position.y+this.m_xformScale*c.R.col2.y)*o);n.closePath();n.stroke()}})();var i;for(i=0;i<Box2D.postDefs.length;++i)Box2D.postDefs[i]();delete Box2D.postDefs;(function(){var c="undefined"!=typeof module&&module.exports,m="undefined"!=typeof Element&&"ALLOW_KEYBOARD_INPUT"in Element,n=function(){var c,a,b=["requestFullscreen,exitFullscreen,fullscreenElement,fullscreenEnabled,fullscreenchange,fullscreenerror".split(","),"webkitRequestFullscreen,webkitExitFullscreen,webkitFullscreenElement,webkitFullscreenEnabled,webkitfullscreenchange,webkitfullscreenerror".split(","),"webkitRequestFullScreen,webkitCancelFullScreen,webkitCurrentFullScreenElement,webkitCancelFullScreen,webkitfullscreenchange,webkitfullscreenerror".split(","),
"mozRequestFullScreen,mozCancelFullScreen,mozFullScreenElement,mozFullScreenEnabled,mozfullscreenchange,mozfullscreenerror".split(","),"msRequestFullscreen,msExitFullscreen,msFullscreenElement,msFullscreenEnabled,MSFullscreenChange,MSFullscreenError".split(",")],e=0;a=b.length;for(var d={};a>e;e++)if(c=b[e],c&&c[1]in document){for(e=0,a=c.length;a>e;e++)d[b[0][e]]=c[e];return d}return!1}(),o={request:function(c){var a=n.requestFullscreen;c=c||document.documentElement;/5\.1[\.\d]* Safari/.test(navigator.userAgent)?
c[a]():c[a](m&&Element.ALLOW_KEYBOARD_INPUT)},exit:function(){document[n.exitFullscreen]()},toggle:function(c){this.isFullscreen?this.exit():this.request(c)},onchange:function(){},onerror:function(){},raw:n};return n?(Object.defineProperties(o,{isFullscreen:{get:function(){return!!document[n.fullscreenElement]}},element:{enumerable:!0,get:function(){return document[n.fullscreenElement]}},enabled:{enumerable:!0,get:function(){return!!document[n.fullscreenEnabled]}}}),document.addEventListener(n.fullscreenchange,
function(c){o.onchange.call(o,c)}),document.addEventListener(n.fullscreenerror,function(c){o.onerror.call(o,c)}),void(c?module.exports=o:window.screenfull=o)):void(c?module.exports=!1:window.screenfull=!1)})();/*

 pixi.js - v1.6.0
 Copyright (c) 2012-2014, Mat Groves
 http://goodboydigital.com/

 Compiled: 2014-07-18

 pixi.js is licensed under the MIT License.
 http://www.opensource.org/licenses/mit-license.php
*/
(function(){var c=c||{};c.WEBGL_RENDERER=0;c.CANVAS_RENDERER=1;c.VERSION="v1.6.1";c.blendModes={NORMAL:0,ADD:1,MULTIPLY:2,SCREEN:3,OVERLAY:4,DARKEN:5,LIGHTEN:6,COLOR_DODGE:7,COLOR_BURN:8,HARD_LIGHT:9,SOFT_LIGHT:10,DIFFERENCE:11,EXCLUSION:12,HUE:13,SATURATION:14,COLOR:15,LUMINOSITY:16};c.scaleModes={DEFAULT:0,LINEAR:0,NEAREST:1};c._UID=0;"undefined"!=typeof Float32Array?(c.Float32Array=Float32Array,c.Uint16Array=Uint16Array):(c.Float32Array=Array,c.Uint16Array=Array);c.INTERACTION_FREQUENCY=30;c.AUTO_PREVENT_DEFAULT=
!0;c.RAD_TO_DEG=180/Math.PI;c.DEG_TO_RAD=Math.PI/180;c.dontSayHello=!1;c.sayHello=function(a){if(!c.dontSayHello)-1<navigator.userAgent.toLowerCase().indexOf("chrome")?console.log.apply(console,["%c %c %c Pixi.js "+c.VERSION+" - "+a+"  %c  %c  http://www.pixijs.com/  %c %c \u2665%c\u2665%c\u2665 ","background: #ff66a5","background: #ff66a5","color: #ff66a5; background: #030307;","background: #ff66a5","background: #ffc3dc","background: #ff66a5","color: #ff2424; background: #fff","color: #ff2424; background: #fff",
"color: #ff2424; background: #fff"]):window.console&&console.log("Pixi.js "+c.VERSION+" - http://www.pixijs.com/"),c.dontSayHello=!0};c.Point=function(a,b){this.x=a||0;this.y=b||0};c.Point.prototype.clone=function(){return new c.Point(this.x,this.y)};c.Point.prototype.set=function(a,b){this.x=a||0;this.y=b||(0!==b?this.x:0)};c.Point.prototype.constructor=c.Point;c.Rectangle=function(a,b,c,d){this.x=a||0;this.y=b||0;this.width=c||0;this.height=d||0};c.Rectangle.prototype.clone=function(){return new c.Rectangle(this.x,
this.y,this.width,this.height)};c.Rectangle.prototype.contains=function(a,b){if(0>=this.width||0>=this.height)return!1;var c=this.x;return a>=c&&a<=c+this.width&&(c=this.y,b>=c&&b<=c+this.height)?!0:!1};c.Rectangle.prototype.constructor=c.Rectangle;c.EmptyRectangle=new c.Rectangle(0,0,0,0);c.Polygon=function(a){if(a instanceof Array||(a=Array.prototype.slice.call(arguments)),"number"==typeof a[0]){for(var b=[],e=0,d=a.length;d>e;e+=2)b.push(new c.Point(a[e],a[e+1]));a=b}this.points=a};c.Polygon.prototype.clone=
function(){for(var a=[],b=0;b<this.points.length;b++)a.push(this.points[b].clone());return new c.Polygon(a)};c.Polygon.prototype.contains=function(a,b){for(var c=!1,d=0,f=this.points.length-1;d<this.points.length;f=d++){var h=this.points[d].x,g=this.points[d].y,j=this.points[f].x,f=this.points[f].y;g>b!=f>b&&(j-h)*(b-g)/(f-g)+h>a&&(c=!c)}return c};c.Polygon.prototype.constructor=c.Polygon;c.Circle=function(a,b,c){this.x=a||0;this.y=b||0;this.radius=c||0};c.Circle.prototype.clone=function(){return new c.Circle(this.x,
this.y,this.radius)};c.Circle.prototype.contains=function(a,b){if(0>=this.radius)return!1;var c=this.x-a,d=this.y-b,f=this.radius*this.radius;return c*=c,d*=d,f>=c+d};c.Circle.prototype.getBounds=function(){return new c.Rectangle(this.x-this.radius,this.y-this.radius,this.width,this.height)};c.Circle.prototype.constructor=c.Circle;c.Ellipse=function(a,b,c,d){this.x=a||0;this.y=b||0;this.width=c||0;this.height=d||0};c.Ellipse.prototype.clone=function(){return new c.Ellipse(this.x,this.y,this.width,
this.height)};c.Ellipse.prototype.contains=function(a,b){if(0>=this.width||0>=this.height)return!1;var c=(a-this.x)/this.width,d=(b-this.y)/this.height;return c*=c,d*=d,1>=c+d};c.Ellipse.prototype.getBounds=function(){return new c.Rectangle(this.x-this.width,this.y-this.height,this.width,this.height)};c.Ellipse.prototype.constructor=c.Ellipse;c.Matrix=function(){this.a=1;this.b=0;this.c=0;this.d=1;this.tx=0;this.ty=0};c.Matrix.prototype.fromArray=function(a){this.a=a[0];this.b=a[1];this.c=a[3];this.d=
a[4];this.tx=a[2];this.ty=a[5]};c.Matrix.prototype.toArray=function(a){this.array||(this.array=new Float32Array(9));var b=this.array;return a?(b[0]=this.a,b[1]=this.c,b[2]=0,b[3]=this.b,b[4]=this.d,b[5]=0,b[6]=this.tx,b[7]=this.ty,b[8]=1):(b[0]=this.a,b[1]=this.b,b[2]=this.tx,b[3]=this.c,b[4]=this.d,b[5]=this.ty,b[6]=0,b[7]=0,b[8]=1),b};c.identityMatrix=new c.Matrix;c.determineMatrixArrayType=function(){return"undefined"!=typeof Float32Array?Float32Array:Array};c.Matrix2=c.determineMatrixArrayType();
c.DisplayObject=function(){this.position=new c.Point;this.scale=new c.Point(1,1);this.pivot=new c.Point(0,0);this.rotation=0;this.alpha=1;this.visible=!0;this.hitArea=null;this.buttonMode=!1;this.renderable=!1;this.parent=null;this.stage=null;this.worldAlpha=1;this._interactive=!1;this.defaultCursor="pointer";this.worldTransform=new c.Matrix;this.color=[];this.dynamic=!0;this._sr=0;this._cr=1;this.filterArea=null;this._bounds=new c.Rectangle(0,0,1,1);this._currentBounds=null;this._mask=null;this._cacheAsBitmap=
!1;this._cacheIsDirty=!1};c.DisplayObject.prototype.constructor=c.DisplayObject;c.DisplayObject.prototype.setInteractive=function(a){this.interactive=a};Object.defineProperty(c.DisplayObject.prototype,"interactive",{get:function(){return this._interactive},set:function(a){this._interactive=a;this.stage&&(this.stage.dirty=!0)}});Object.defineProperty(c.DisplayObject.prototype,"worldVisible",{get:function(){var a=this;do{if(!a.visible)return!1;a=a.parent}while(a);return!0}});Object.defineProperty(c.DisplayObject.prototype,
"mask",{get:function(){return this._mask},set:function(a){this._mask&&(this._mask.isMask=!1);this._mask=a;this._mask&&(this._mask.isMask=!0)}});Object.defineProperty(c.DisplayObject.prototype,"filters",{get:function(){return this._filters},set:function(a){if(a){for(var b=[],c=0;c<a.length;c++)for(var d=a[c].passes,f=0;f<d.length;f++)b.push(d[f]);this._filterBlock={target:this,filterPasses:b}}this._filters=a}});Object.defineProperty(c.DisplayObject.prototype,"cacheAsBitmap",{get:function(){return this._cacheAsBitmap},
set:function(a){this._cacheAsBitmap!==a&&(a?this._generateCachedSprite():this._destroyCachedSprite(),this._cacheAsBitmap=a)}});c.DisplayObject.prototype.updateTransform=function(){this.rotation!==this.rotationCache&&(this.rotationCache=this.rotation,this._sr=Math.sin(this.rotation),this._cr=Math.cos(this.rotation));var a=this.parent.worldTransform,b=this.worldTransform,c=this.pivot.x,d=this.pivot.y,f=this._cr*this.scale.x,h=-this._sr*this.scale.y,g=this._sr*this.scale.x,j=this._cr*this.scale.y,k=
this.position.x-f*c-d*h,c=this.position.y-j*d-c*g,d=a.a,p=a.b,m=a.c,l=a.d;b.a=d*f+p*g;b.b=d*h+p*j;b.tx=d*k+p*c+a.tx;b.c=m*f+l*g;b.d=m*h+l*j;b.ty=m*k+l*c+a.ty;this.worldAlpha=this.alpha*this.parent.worldAlpha};c.DisplayObject.prototype.getBounds=function(){return c.EmptyRectangle};c.DisplayObject.prototype.getLocalBounds=function(){return this.getBounds(c.identityMatrix)};c.DisplayObject.prototype.setStageReference=function(a){this.stage=a;this._interactive&&(this.stage.dirty=!0)};c.DisplayObject.prototype.generateTexture=
function(a){var b=this.getLocalBounds(),a=new c.RenderTexture(0|b.width,0|b.height,a);return a.render(this,new c.Point(-b.x,-b.y)),a};c.DisplayObject.prototype.updateCache=function(){this._generateCachedSprite()};c.DisplayObject.prototype._renderCachedSprite=function(a){this._cachedSprite.worldAlpha=this.worldAlpha;a.gl?c.Sprite.prototype._renderWebGL.call(this._cachedSprite,a):c.Sprite.prototype._renderCanvas.call(this._cachedSprite,a)};c.DisplayObject.prototype._generateCachedSprite=function(){this._cacheAsBitmap=
!1;var a=this.getLocalBounds();if(this._cachedSprite)this._cachedSprite.texture.resize(0|a.width,0|a.height);else{var b=new c.RenderTexture(0|a.width,0|a.height);this._cachedSprite=new c.Sprite(b);this._cachedSprite.worldTransform=this.worldTransform}b=this._filters;this._filters=null;this._cachedSprite.filters=b;this._cachedSprite.texture.render(this,new c.Point(-a.x,-a.y));this._cachedSprite.anchor.x=-(a.x/a.width);this._cachedSprite.anchor.y=-(a.y/a.height);this._filters=b;this._cacheAsBitmap=
!0};c.DisplayObject.prototype._destroyCachedSprite=function(){this._cachedSprite&&(this._cachedSprite.texture.destroy(!0),this._cachedSprite=null)};c.DisplayObject.prototype._renderWebGL=function(){};c.DisplayObject.prototype._renderCanvas=function(){};Object.defineProperty(c.DisplayObject.prototype,"x",{get:function(){return this.position.x},set:function(a){this.position.x=a}});Object.defineProperty(c.DisplayObject.prototype,"y",{get:function(){return this.position.y},set:function(a){this.position.y=
a}});c.DisplayObjectContainer=function(){c.DisplayObject.call(this);this.children=[]};c.DisplayObjectContainer.prototype=Object.create(c.DisplayObject.prototype);c.DisplayObjectContainer.prototype.constructor=c.DisplayObjectContainer;Object.defineProperty(c.DisplayObjectContainer.prototype,"width",{get:function(){return this.scale.x*this.getLocalBounds().width},set:function(a){var b=this.getLocalBounds().width;this.scale.x=0!==b?a/(b/this.scale.x):1;this._width=a}});Object.defineProperty(c.DisplayObjectContainer.prototype,
"height",{get:function(){return this.scale.y*this.getLocalBounds().height},set:function(a){var b=this.getLocalBounds().height;this.scale.y=0!==b?a/(b/this.scale.y):1;this._height=a}});c.DisplayObjectContainer.prototype.addChild=function(a){return this.addChildAt(a,this.children.length)};c.DisplayObjectContainer.prototype.addChildAt=function(a,b){if(0<=b&&b<=this.children.length)return a.parent&&a.parent.removeChild(a),a.parent=this,this.children.splice(b,0,a),this.stage&&a.setStageReference(this.stage),
a;throw Error(a+" The index "+b+" supplied is out of bounds "+this.children.length);};c.DisplayObjectContainer.prototype.swapChildren=function(a,b){if(a!==b){var c=this.children.indexOf(a),d=this.children.indexOf(b);if(0>c||0>d)throw Error("swapChildren: Both the supplied DisplayObjects must be a child of the caller.");this.children[c]=b;this.children[d]=a}};c.DisplayObjectContainer.prototype.getChildAt=function(a){if(0<=a&&a<this.children.length)return this.children[a];throw Error("Supplied index does not exist in the child list, or the supplied DisplayObject must be a child of the caller");
};c.DisplayObjectContainer.prototype.removeChild=function(a){return this.removeChildAt(this.children.indexOf(a))};c.DisplayObjectContainer.prototype.removeChildAt=function(a){var b=this.getChildAt(a);return this.stage&&b.removeStageReference(),b.parent=void 0,this.children.splice(a,1),b};c.DisplayObjectContainer.prototype.removeChildren=function(a,b){var c=a||0,d="number"==typeof b?b:this.children.length,f=d-c;if(0<f&&d>=f){c=this.children.splice(c,f);for(d=0;d<c.length;d++)f=c[d],this.stage&&f.removeStageReference(),
f.parent=void 0;return c}throw Error("Range Error, numeric values are outside the acceptable range");};c.DisplayObjectContainer.prototype.updateTransform=function(){if(this.visible&&(c.DisplayObject.prototype.updateTransform.call(this),!this._cacheAsBitmap))for(var a=0,b=this.children.length;b>a;a++)this.children[a].updateTransform()};c.DisplayObjectContainer.prototype.getBounds=function(a){if(0===this.children.length)return c.EmptyRectangle;if(a){var b=this.worldTransform;this.worldTransform=a;this.updateTransform();
this.worldTransform=b}for(var e,d,f,b=1/0,h=1/0,g=-1/0,j=-1/0,k=!1,p=0,m=this.children.length;m>p;p++)this.children[p].visible&&(k=!0,e=this.children[p].getBounds(a),b=b<e.x?b:e.x,h=h<e.y?h:e.y,d=e.width+e.x,f=e.height+e.y,g=g>d?g:d,j=j>f?j:f);if(!k)return c.EmptyRectangle;a=this._bounds;return a.x=b,a.y=h,a.width=g-b,a.height=j-h,a};c.DisplayObjectContainer.prototype.getLocalBounds=function(){var a=this.worldTransform;this.worldTransform=c.identityMatrix;for(var b=0,e=this.children.length;e>b;b++)this.children[b].updateTransform();
b=this.getBounds();return this.worldTransform=a,b};c.DisplayObjectContainer.prototype.setStageReference=function(a){this.stage=a;this._interactive&&(this.stage.dirty=!0);for(var b=0,c=this.children.length;c>b;b++)this.children[b].setStageReference(a)};c.DisplayObjectContainer.prototype.removeStageReference=function(){for(var a=0,b=this.children.length;b>a;a++)this.children[a].removeStageReference();this._interactive&&(this.stage.dirty=!0);this.stage=null};c.DisplayObjectContainer.prototype._renderWebGL=
function(a){if(this.visible&&!(0>=this.alpha)){if(this._cacheAsBitmap)return this._renderCachedSprite(a),void 0;var b,c;if(this._mask||this._filters){for(this._filters&&(a.spriteBatch.flush(),a.filterManager.pushFilter(this._filterBlock)),this._mask&&(a.spriteBatch.stop(),a.maskManager.pushMask(this.mask,a),a.spriteBatch.start()),b=0,c=this.children.length;c>b;b++)this.children[b]._renderWebGL(a);a.spriteBatch.stop();this._mask&&a.maskManager.popMask(this._mask,a);this._filters&&a.filterManager.popFilter();
a.spriteBatch.start()}else for(b=0,c=this.children.length;c>b;b++)this.children[b]._renderWebGL(a)}};c.DisplayObjectContainer.prototype._renderCanvas=function(a){if(!1!==this.visible&&0!==this.alpha){if(this._cacheAsBitmap)return this._renderCachedSprite(a),void 0;this._mask&&a.maskManager.pushMask(this._mask,a.context);for(var b=0,c=this.children.length;c>b;b++)this.children[b]._renderCanvas(a);this._mask&&a.maskManager.popMask(a.context)}};c.Sprite=function(a){c.DisplayObjectContainer.call(this);
this.anchor=new c.Point;this.texture=a;this._width=0;this._height=0;this.tint=16777215;this.blendMode=c.blendModes.NORMAL;a.baseTexture.hasLoaded?this.onTextureUpdate():(this.onTextureUpdateBind=this.onTextureUpdate.bind(this),this.texture.addEventListener("update",this.onTextureUpdateBind));this.renderable=!0};c.Sprite.prototype=Object.create(c.DisplayObjectContainer.prototype);c.Sprite.prototype.constructor=c.Sprite;Object.defineProperty(c.Sprite.prototype,"width",{get:function(){return this.scale.x*
this.texture.frame.width},set:function(a){this.scale.x=a/this.texture.frame.width;this._width=a}});Object.defineProperty(c.Sprite.prototype,"height",{get:function(){return this.scale.y*this.texture.frame.height},set:function(a){this.scale.y=a/this.texture.frame.height;this._height=a}});c.Sprite.prototype.setTexture=function(a){this.texture=a;this.cachedTint=16777215};c.Sprite.prototype.onTextureUpdate=function(){this._width&&(this.scale.x=this._width/this.texture.frame.width);this._height&&(this.scale.y=
this._height/this.texture.frame.height)};c.Sprite.prototype.getBounds=function(a){var b=this.texture.frame.width,c=this.texture.frame.height,d=b*(1-this.anchor.x),f=b*-this.anchor.x,h=c*(1-this.anchor.y),g=c*-this.anchor.y,a=a||this.worldTransform,j=a.a,k=a.c,p=a.b,m=a.d,l=a.tx,n=a.ty,a=j*f+p*g+l,c=m*g+k*f+n,b=j*d+p*g+l,g=m*g+k*d+n,o=j*d+p*h+l,d=m*h+k*d+n,j=j*f+p*h+l,p=m*h+k*f+n,f=-1/0,h=-1/0,k=1/0,m=1/0;k=k>a?a:k;k=k>b?b:k;k=k>o?o:k;k=k>j?j:k;m=m>c?c:m;m=m>g?g:m;m=m>d?d:m;m=m>p?p:m;f=a>f?a:f;f=b>
f?b:f;f=o>f?o:f;f=j>f?j:f;h=c>h?c:h;h=g>h?g:h;h=d>h?d:h;h=p>h?p:h;a=this._bounds;return a.x=k,a.width=f-k,a.y=m,a.height=h-m,this._currentBounds=a,a};c.Sprite.prototype._renderWebGL=function(a){if(this.visible&&!(0>=this.alpha)){var b,c;if(this._mask||this._filters){var d=a.spriteBatch;for(this._filters&&(d.flush(),a.filterManager.pushFilter(this._filterBlock)),this._mask&&(d.stop(),a.maskManager.pushMask(this.mask,a),d.start()),d.render(this),b=0,c=this.children.length;c>b;b++)this.children[b]._renderWebGL(a);
d.stop();this._mask&&a.maskManager.popMask(this._mask,a);this._filters&&a.filterManager.popFilter();d.start()}else for(a.spriteBatch.render(this),b=0,c=this.children.length;c>b;b++)this.children[b]._renderWebGL(a)}};c.Sprite.prototype._renderCanvas=function(a){if(!1!==this.visible&&0!==this.alpha){if(this.blendMode!==a.currentBlendMode&&(a.currentBlendMode=this.blendMode,a.context.globalCompositeOperation=c.blendModesCanvas[a.currentBlendMode]),this._mask&&a.maskManager.pushMask(this._mask,a.context),
this.texture.valid){a.context.globalAlpha=this.worldAlpha;a.roundPixels?a.context.setTransform(this.worldTransform.a,this.worldTransform.c,this.worldTransform.b,this.worldTransform.d,0|this.worldTransform.tx,0|this.worldTransform.ty):a.context.setTransform(this.worldTransform.a,this.worldTransform.c,this.worldTransform.b,this.worldTransform.d,this.worldTransform.tx,this.worldTransform.ty);a.smoothProperty&&a.scaleMode!==this.texture.baseTexture.scaleMode&&(a.scaleMode=this.texture.baseTexture.scaleMode,
a.context[a.smoothProperty]=a.scaleMode===c.scaleModes.LINEAR);var b=this.texture.trim?this.texture.trim.x-this.anchor.x*this.texture.trim.width:this.anchor.x*-this.texture.frame.width,e=this.texture.trim?this.texture.trim.y-this.anchor.y*this.texture.trim.height:this.anchor.y*-this.texture.frame.height;16777215!==this.tint?(this.cachedTint!==this.tint&&(this.cachedTint=this.tint,this.tintedTexture=c.CanvasTinter.getTintedTexture(this,this.tint)),a.context.drawImage(this.tintedTexture,0,0,this.texture.crop.width,
this.texture.crop.height,b,e,this.texture.crop.width,this.texture.crop.height)):a.context.drawImage(this.texture.baseTexture.source,this.texture.crop.x,this.texture.crop.y,this.texture.crop.width,this.texture.crop.height,b,e,this.texture.crop.width,this.texture.crop.height)}b=0;for(e=this.children.length;e>b;b++)this.children[b]._renderCanvas(a);this._mask&&a.maskManager.popMask(a.context)}};c.Sprite.fromFrame=function(a){var b=c.TextureCache[a];if(!b)throw Error('The frameId "'+a+'" does not exist in the texture cache'+
this);return new c.Sprite(b)};c.Sprite.fromImage=function(a,b,e){a=c.Texture.fromImage(a,b,e);return new c.Sprite(a)};c.SpriteBatch=function(a){c.DisplayObjectContainer.call(this);this.textureThing=a;this.ready=!1};c.SpriteBatch.prototype=Object.create(c.DisplayObjectContainer.prototype);c.SpriteBatch.constructor=c.SpriteBatch;c.SpriteBatch.prototype.initWebGL=function(a){this.fastSpriteBatch=new c.WebGLFastSpriteBatch(a);this.ready=!0};c.SpriteBatch.prototype.updateTransform=function(){c.DisplayObject.prototype.updateTransform.call(this)};
c.SpriteBatch.prototype._renderWebGL=function(a){!this.visible||0>=this.alpha||!this.children.length||(this.ready||this.initWebGL(a.gl),a.spriteBatch.stop(),a.shaderManager.setShader(a.shaderManager.fastShader),this.fastSpriteBatch.begin(this,a),this.fastSpriteBatch.render(this),a.spriteBatch.start())};c.SpriteBatch.prototype._renderCanvas=function(a){var b=a.context;b.globalAlpha=this.worldAlpha;c.DisplayObject.prototype.updateTransform.call(this);for(var e=this.worldTransform,d=!0,f=0;f<this.children.length;f++){var h=
this.children[f];if(h.visible){var g=h.texture,j=g.frame;if(b.globalAlpha=this.worldAlpha*h.alpha,0===h.rotation%(2*Math.PI))d&&(b.setTransform(e.a,e.c,e.b,e.d,e.tx,e.ty),d=!1),b.drawImage(g.baseTexture.source,j.x,j.y,j.width,j.height,h.anchor.x*-j.width*h.scale.x+h.position.x+0.5|0,h.anchor.y*-j.height*h.scale.y+h.position.y+0.5|0,j.width*h.scale.x,j.height*h.scale.y);else{d||(d=!0);c.DisplayObject.prototype.updateTransform.call(h);var k=h.worldTransform;a.roundPixels?b.setTransform(k.a,k.c,k.b,
k.d,0|k.tx,0|k.ty):b.setTransform(k.a,k.c,k.b,k.d,k.tx,k.ty);b.drawImage(g.baseTexture.source,j.x,j.y,j.width,j.height,h.anchor.x*-j.width+0.5|0,h.anchor.y*-j.height+0.5|0,j.width,j.height)}}}};c.MovieClip=function(a){c.Sprite.call(this,a[0]);this.textures=a;this.animationSpeed=1;this.loop=!0;this.onComplete=null;this.currentFrame=0;this.playing=!1};c.MovieClip.prototype=Object.create(c.Sprite.prototype);c.MovieClip.prototype.constructor=c.MovieClip;Object.defineProperty(c.MovieClip.prototype,"totalFrames",
{get:function(){return this.textures.length}});c.MovieClip.prototype.stop=function(){this.playing=!1};c.MovieClip.prototype.play=function(){this.playing=!0};c.MovieClip.prototype.gotoAndStop=function(a){this.playing=!1;this.currentFrame=a;this.setTexture(this.textures[(this.currentFrame+0.5|0)%this.textures.length])};c.MovieClip.prototype.gotoAndPlay=function(a){this.currentFrame=a;this.playing=!0};c.MovieClip.prototype.updateTransform=function(){if(c.Sprite.prototype.updateTransform.call(this),this.playing){this.currentFrame+=
this.animationSpeed;var a=this.currentFrame+0.5|0;this.currentFrame%=this.textures.length;this.loop||a<this.textures.length?this.setTexture(this.textures[a%this.textures.length]):a>=this.textures.length&&(this.gotoAndStop(this.textures.length-1),this.onComplete&&this.onComplete())}};c.MovieClip.fromFrames=function(a){for(var b=[],e=0;e<a.length;e++)b.push(new c.Texture.fromFrame(a[e]));return new c.MovieClip(b)};c.MovieClip.fromImages=function(a){for(var b=[],e=0;e<a.length;e++)b.push(new c.Texture.fromImage(a[e]));
return new c.MovieClip(b)};c.FilterBlock=function(){this.visible=!0;this.renderable=!0};c.Text=function(a,b){this.canvas=document.createElement("canvas");this.context=this.canvas.getContext("2d");c.Sprite.call(this,c.Texture.fromCanvas(this.canvas));this.setText(a);this.setStyle(b)};c.Text.prototype=Object.create(c.Sprite.prototype);c.Text.prototype.constructor=c.Text;Object.defineProperty(c.Text.prototype,"width",{get:function(){return this.dirty&&(this.updateText(),this.dirty=!1),this.scale.x*this.texture.frame.width},
set:function(a){this.scale.x=a/this.texture.frame.width;this._width=a}});Object.defineProperty(c.Text.prototype,"height",{get:function(){return this.dirty&&(this.updateText(),this.dirty=!1),this.scale.y*this.texture.frame.height},set:function(a){this.scale.y=a/this.texture.frame.height;this._height=a}});c.Text.prototype.setStyle=function(a){a=a||{};a.font=a.font||"bold 20pt Arial";a.fill=a.fill||"black";a.align=a.align||"left";a.stroke=a.stroke||"black";a.strokeThickness=a.strokeThickness||0;a.wordWrap=
a.wordWrap||!1;a.wordWrapWidth=a.wordWrapWidth||100;a.wordWrapWidth=a.wordWrapWidth||100;a.dropShadow=a.dropShadow||!1;a.dropShadowAngle=a.dropShadowAngle||Math.PI/6;a.dropShadowDistance=a.dropShadowDistance||4;a.dropShadowColor=a.dropShadowColor||"black";this.style=a;this.dirty=!0};c.Text.prototype.setText=function(a){this.text=a.toString()||" ";this.dirty=!0};c.Text.prototype.updateText=function(){this.context.font=this.style.font;var a=this.text;this.style.wordWrap&&(a=this.wordWrap(this.text));
for(var a=a.split(/(?:\r\n|\r|\n)/),b=[],c=0,d=0;d<a.length;d++){var f=this.context.measureText(a[d]).width;b[d]=f;c=Math.max(c,f)}d=c+this.style.strokeThickness;this.style.dropShadow&&(d+=this.style.dropShadowDistance);this.canvas.width=d+this.context.lineWidth;f=this.determineFontHeight("font: "+this.style.font+";")+this.style.strokeThickness;d=f*a.length;this.style.dropShadow&&(d+=this.style.dropShadowDistance);this.canvas.height=d;navigator.isCocoonJS&&this.context.clearRect(0,0,this.canvas.width,
this.canvas.height);this.context.font=this.style.font;this.context.strokeStyle=this.style.stroke;this.context.lineWidth=this.style.strokeThickness;this.context.textBaseline="top";var h,g;if(this.style.dropShadow){this.context.fillStyle=this.style.dropShadowColor;for(var j=Math.sin(this.style.dropShadowAngle)*this.style.dropShadowDistance,k=Math.cos(this.style.dropShadowAngle)*this.style.dropShadowDistance,d=0;d<a.length;d++)h=this.style.strokeThickness/2,g=this.style.strokeThickness/2+d*f,"right"===
this.style.align?h+=c-b[d]:"center"===this.style.align&&(h+=(c-b[d])/2),this.style.fill&&this.context.fillText(a[d],h+j,g+k)}for(this.context.fillStyle=this.style.fill,d=0;d<a.length;d++)h=this.style.strokeThickness/2,g=this.style.strokeThickness/2+d*f,"right"===this.style.align?h+=c-b[d]:"center"===this.style.align&&(h+=(c-b[d])/2),this.style.stroke&&this.style.strokeThickness&&this.context.strokeText(a[d],h,g),this.style.fill&&this.context.fillText(a[d],h,g);this.updateTexture()};c.Text.prototype.updateTexture=
function(){this.texture.baseTexture.width=this.canvas.width;this.texture.baseTexture.height=this.canvas.height;this.texture.crop.width=this.texture.frame.width=this.canvas.width;this.texture.crop.height=this.texture.frame.height=this.canvas.height;this._width=this.canvas.width;this._height=this.canvas.height;this.requiresUpdate=!0};c.Text.prototype._renderWebGL=function(a){this.requiresUpdate&&(this.requiresUpdate=!1,c.updateWebGLTexture(this.texture.baseTexture,a.gl));c.Sprite.prototype._renderWebGL.call(this,
a)};c.Text.prototype.updateTransform=function(){this.dirty&&(this.updateText(),this.dirty=!1);c.Sprite.prototype.updateTransform.call(this)};c.Text.prototype.determineFontHeight=function(a){var b=c.Text.heightCache[a];if(!b){var e=document.getElementsByTagName("body")[0],d=document.createElement("div"),f=document.createTextNode("M");d.appendChild(f);d.setAttribute("style",a+";position:absolute;top:0;left:0");e.appendChild(d);b=d.offsetHeight;c.Text.heightCache[a]=b;e.removeChild(d)}return b};c.Text.prototype.wordWrap=
function(a){for(var b="",a=a.split("\n"),c=0;c<a.length;c++){for(var d=this.style.wordWrapWidth,f=a[c].split(" "),h=0;h<f.length;h++){var g=this.context.measureText(f[h]).width,j=g+this.context.measureText(" ").width;0===h||j>d?(0<h&&(b+="\n"),b+=f[h],d=this.style.wordWrapWidth-g):(d-=j,b+=" "+f[h])}c<a.length-1&&(b+="\n")}return b};c.Text.prototype.destroy=function(a){this.context=null;this.canvas=null;this.texture.destroy(void 0===a?!0:a)};c.Text.heightCache={};c.BitmapText=function(a,b){c.DisplayObjectContainer.call(this);
this._pool=[];this.setText(a);this.setStyle(b);this.updateText();this.dirty=!1};c.BitmapText.prototype=Object.create(c.DisplayObjectContainer.prototype);c.BitmapText.prototype.constructor=c.BitmapText;c.BitmapText.prototype.setText=function(a){this.text=a||" ";this.dirty=!0};c.BitmapText.prototype.setStyle=function(a){a=a||{};a.align=a.align||"left";this.style=a;var b=a.font.split(" ");this.fontName=b[b.length-1];this.fontSize=2<=b.length?parseInt(b[b.length-2],10):c.BitmapText.fonts[this.fontName].size;
this.dirty=!0;this.tint=a.tint};c.BitmapText.prototype.updateText=function(){for(var a=c.BitmapText.fonts[this.fontName],b=new c.Point,e=null,d=[],f=0,h=[],g=0,j=this.fontSize/a.size,k=0;k<this.text.length;k++){var p=this.text.charCodeAt(k);if(/(?:\r\n|\r|\n)/.test(this.text.charAt(k)))h.push(b.x),f=Math.max(f,b.x),g++,b.x=0,b.y+=a.lineHeight,e=null;else{var m=a.chars[p];m&&(e&&m[e]&&(b.x+=m.kerning[e]),d.push({texture:m.texture,line:g,charCode:p,position:new c.Point(b.x+m.xOffset,b.y+m.yOffset)}),
b.x+=m.xAdvance,e=p)}}h.push(b.x);f=Math.max(f,b.x);e=[];for(k=0;g>=k;k++)p=0,"right"===this.style.align?p=f-h[k]:"center"===this.style.align&&(p=(f-h[k])/2),e.push(p);g=this.children.length;h=d.length;p=this.tint||16777215;for(k=0;h>k;k++)m=g>k?this.children[k]:this._pool.pop(),m?m.setTexture(d[k].texture):m=new c.Sprite(d[k].texture),m.position.x=(d[k].position.x+e[d[k].line])*j,m.position.y=d[k].position.y*j,m.scale.x=m.scale.y=j,m.tint=p,m.parent||this.addChild(m);for(;this.children.length>h;)d=
this.getChildAt(this.children.length-1),this._pool.push(d),this.removeChild(d);this.textWidth=f*j;this.textHeight=(b.y+a.lineHeight)*j};c.BitmapText.prototype.updateTransform=function(){this.dirty&&(this.updateText(),this.dirty=!1);c.DisplayObjectContainer.prototype.updateTransform.call(this)};c.BitmapText.fonts={};c.InteractionData=function(){this.global=new c.Point;this.target=null;this.originalEvent=null};c.InteractionData.prototype.getLocalPosition=function(a){var b=a.worldTransform,a=this.global,
e=b.a,d=b.b,f=b.tx,h=b.c,g=b.d,b=b.ty,j=1/(e*g+d*-h);return new c.Point(g*j*a.x+-d*j*a.y+(b*d-f*g)*j,e*j*a.y+-h*j*a.x+(-b*e+f*h)*j)};c.InteractionData.prototype.constructor=c.InteractionData;c.InteractionManager=function(a){this.stage=a;this.mouse=new c.InteractionData;this.touchs={};this.tempPoint=new c.Point;this.mouseoverEnabled=!0;this.pool=[];this.interactiveItems=[];this.interactionDOMElement=null;this.onMouseMove=this.onMouseMove.bind(this);this.onMouseDown=this.onMouseDown.bind(this);this.onMouseOut=
this.onMouseOut.bind(this);this.onMouseUp=this.onMouseUp.bind(this);this.onTouchStart=this.onTouchStart.bind(this);this.onTouchEnd=this.onTouchEnd.bind(this);this.onTouchMove=this.onTouchMove.bind(this);this.last=0;this.currentCursorStyle="inherit";this.mouseOut=!1};c.InteractionManager.prototype.constructor=c.InteractionManager;c.InteractionManager.prototype.collectInteractiveSprite=function(a,b){for(var c=a.children,d=c.length-1;0<=d;d--){var f=c[d];f._interactive?(b.interactiveChildren=!0,this.interactiveItems.push(f),
0<f.children.length&&this.collectInteractiveSprite(f,f)):(f.__iParent=null,0<f.children.length&&this.collectInteractiveSprite(f,b))}};c.InteractionManager.prototype.setTarget=function(a){this.target=a;null===this.interactionDOMElement&&this.setTargetDomElement(a.view)};c.InteractionManager.prototype.setTargetDomElement=function(a){this.removeEvents();window.navigator.msPointerEnabled&&(a.style["-ms-content-zooming"]="none",a.style["-ms-touch-action"]="none");this.interactionDOMElement=a;a.addEventListener("mousemove",
this.onMouseMove,!0);a.addEventListener("mousedown",this.onMouseDown,!0);a.addEventListener("mouseout",this.onMouseOut,!0);a.addEventListener("touchstart",this.onTouchStart,!0);a.addEventListener("touchend",this.onTouchEnd,!0);a.addEventListener("touchmove",this.onTouchMove,!0);window.addEventListener("mouseup",this.onMouseUp,!0)};c.InteractionManager.prototype.removeEvents=function(){this.interactionDOMElement&&(this.interactionDOMElement.style["-ms-content-zooming"]="",this.interactionDOMElement.style["-ms-touch-action"]=
"",this.interactionDOMElement.removeEventListener("mousemove",this.onMouseMove,!0),this.interactionDOMElement.removeEventListener("mousedown",this.onMouseDown,!0),this.interactionDOMElement.removeEventListener("mouseout",this.onMouseOut,!0),this.interactionDOMElement.removeEventListener("touchstart",this.onTouchStart,!0),this.interactionDOMElement.removeEventListener("touchend",this.onTouchEnd,!0),this.interactionDOMElement.removeEventListener("touchmove",this.onTouchMove,!0),this.interactionDOMElement=
null,window.removeEventListener("mouseup",this.onMouseUp,!0))};c.InteractionManager.prototype.update=function(){if(this.target){var a=Date.now(),b=a-this.last;if(b=b*c.INTERACTION_FREQUENCY/1E3,!(1>b)){this.last=a;a=0;this.dirty&&this.rebuildInteractiveGraph();for(var b=this.interactiveItems.length,e="inherit",d=!1,a=0;b>a;a++){var f=this.interactiveItems[a];f.__hit=this.hitTest(f,this.mouse);this.mouse.target=f;f.__hit&&!d?(f.buttonMode&&(e=f.defaultCursor),f.interactiveChildren||(d=!0),f.__isOver||
(f.mouseover&&f.mouseover(this.mouse),f.__isOver=!0)):f.__isOver&&(f.mouseout&&f.mouseout(this.mouse),f.__isOver=!1)}this.currentCursorStyle!==e&&(this.currentCursorStyle=e,this.interactionDOMElement.style.cursor=e)}}};c.InteractionManager.prototype.rebuildInteractiveGraph=function(){this.dirty=!1;for(var a=this.interactiveItems.length,b=0;a>b;b++)this.interactiveItems[b].interactiveChildren=!1;this.interactiveItems=[];this.stage.interactive&&this.interactiveItems.push(this.stage);this.collectInteractiveSprite(this.stage,
this.stage)};c.InteractionManager.prototype.onMouseMove=function(a){this.dirty&&this.rebuildInteractiveGraph();this.mouse.originalEvent=a||window.event;var b=this.interactionDOMElement.getBoundingClientRect();this.mouse.global.x=(a.clientX-b.left)*(this.target.width/b.width);this.mouse.global.y=(a.clientY-b.top)*(this.target.height/b.height);a=this.interactiveItems.length;for(b=0;a>b;b++){var c=this.interactiveItems[b];c.mousemove&&c.mousemove(this.mouse)}};c.InteractionManager.prototype.onMouseDown=
function(a){this.dirty&&this.rebuildInteractiveGraph();this.mouse.originalEvent=a||window.event;c.AUTO_PREVENT_DEFAULT&&this.mouse.originalEvent.preventDefault();for(var a=this.interactiveItems.length,b=0;a>b;b++){var e=this.interactiveItems[b];if((e.mousedown||e.click)&&(e.__mouseIsDown=!0,e.__hit=this.hitTest(e,this.mouse),e.__hit&&(e.mousedown&&e.mousedown(this.mouse),e.__isDown=!0,!e.interactiveChildren)))break}};c.InteractionManager.prototype.onMouseOut=function(){this.dirty&&this.rebuildInteractiveGraph();
var a=this.interactiveItems.length;this.interactionDOMElement.style.cursor="inherit";for(var b=0;a>b;b++){var c=this.interactiveItems[b];c.__isOver&&(this.mouse.target=c,c.mouseout&&c.mouseout(this.mouse),c.__isOver=!1)}this.mouseOut=!0;this.mouse.global.x=-1E4;this.mouse.global.y=-1E4};c.InteractionManager.prototype.onMouseUp=function(a){this.dirty&&this.rebuildInteractiveGraph();this.mouse.originalEvent=a||window.event;for(var a=this.interactiveItems.length,b=!1,c=0;a>c;c++){var d=this.interactiveItems[c];
d.__hit=this.hitTest(d,this.mouse);d.__hit&&!b?(d.mouseup&&d.mouseup(this.mouse),d.__isDown&&d.click&&d.click(this.mouse),d.interactiveChildren||(b=!0)):d.__isDown&&d.mouseupoutside&&d.mouseupoutside(this.mouse);d.__isDown=!1}};c.InteractionManager.prototype.hitTest=function(a,b){var e=b.global;if(!a.worldVisible)return!1;var d=a instanceof c.Sprite,f=a.worldTransform,h=f.a,g=f.b,j=f.tx,k=f.c,p=f.d,f=f.ty,m=1/(h*p+g*-k),g=p*m*e.x+-g*m*e.y+(f*g-j*p)*m,e=h*m*e.y+-k*m*e.x+(-f*h+j*k)*m;if(b.target=a,
a.hitArea&&a.hitArea.contains)return a.hitArea.contains(g,e)?(b.target=a,!0):!1;if(d){var l,d=a.texture.frame.width,h=a.texture.frame.height,j=-d*a.anchor.x;if(g>j&&j+d>g&&(l=-h*a.anchor.y,e>l&&l+h>e))return b.target=a,!0}l=a.children.length;for(d=0;l>d;d++)if(this.hitTest(a.children[d],b))return b.target=a,!0;return!1};c.InteractionManager.prototype.onTouchMove=function(a){this.dirty&&this.rebuildInteractiveGraph();for(var b,c=this.interactionDOMElement.getBoundingClientRect(),d=a.changedTouches,
f=0,f=0;f<d.length;f++){var h=d[f];b=this.touchs[h.identifier];b.originalEvent=a||window.event;b.global.x=(h.clientX-c.left)*(this.target.width/c.width);b.global.y=(h.clientY-c.top)*(this.target.height/c.height);navigator.isCocoonJS&&(b.global.x=h.clientX,b.global.y=h.clientY);for(var g=0;g<this.interactiveItems.length;g++){var j=this.interactiveItems[g];j.touchmove&&j.__touchData&&j.__touchData[h.identifier]&&j.touchmove(b)}}};c.InteractionManager.prototype.onTouchStart=function(a){this.dirty&&this.rebuildInteractiveGraph();
var b=this.interactionDOMElement.getBoundingClientRect();c.AUTO_PREVENT_DEFAULT&&a.preventDefault();for(var e=a.changedTouches,d=0;d<e.length;d++){var f=e[d],h=this.pool.pop();h||(h=new c.InteractionData);h.originalEvent=a||window.event;this.touchs[f.identifier]=h;h.global.x=(f.clientX-b.left)*(this.target.width/b.width);h.global.y=(f.clientY-b.top)*(this.target.height/b.height);navigator.isCocoonJS&&(h.global.x=f.clientX,h.global.y=f.clientY);for(var g=this.interactiveItems.length,j=0;g>j;j++){var k=
this.interactiveItems[j];if((k.touchstart||k.tap)&&(k.__hit=this.hitTest(k,h),k.__hit&&(k.touchstart&&k.touchstart(h),k.__isDown=!0,k.__touchData=k.__touchData||{},k.__touchData[f.identifier]=h,!k.interactiveChildren)))break}}};c.InteractionManager.prototype.onTouchEnd=function(a){this.dirty&&this.rebuildInteractiveGraph();for(var b=this.interactionDOMElement.getBoundingClientRect(),c=a.changedTouches,d=0;d<c.length;d++){var f=c[d],h=this.touchs[f.identifier],g=!1;h.global.x=(f.clientX-b.left)*(this.target.width/
b.width);h.global.y=(f.clientY-b.top)*(this.target.height/b.height);navigator.isCocoonJS&&(h.global.x=f.clientX,h.global.y=f.clientY);for(var j=this.interactiveItems.length,k=0;j>k;k++){var p=this.interactiveItems[k];p.__touchData&&p.__touchData[f.identifier]&&(p.__hit=this.hitTest(p,p.__touchData[f.identifier]),h.originalEvent=a||window.event,(p.touchend||p.tap)&&(p.__hit&&!g?(p.touchend&&p.touchend(h),p.__isDown&&p.tap&&p.tap(h),p.interactiveChildren||(g=!0)):p.__isDown&&p.touchendoutside&&p.touchendoutside(h),
p.__isDown=!1),p.__touchData[f.identifier]=null)}this.pool.push(h);this.touchs[f.identifier]=null}};c.Stage=function(a){c.DisplayObjectContainer.call(this);this.worldTransform=new c.Matrix;this.interactive=!0;this.interactionManager=new c.InteractionManager(this);this.dirty=!0;this.stage=this;this.stage.hitArea=new c.Rectangle(0,0,1E5,1E5);this.setBackgroundColor(a)};c.Stage.prototype=Object.create(c.DisplayObjectContainer.prototype);c.Stage.prototype.constructor=c.Stage;c.Stage.prototype.setInteractionDelegate=
function(a){this.interactionManager.setTargetDomElement(a)};c.Stage.prototype.updateTransform=function(){this.worldAlpha=1;for(var a=0,b=this.children.length;b>a;a++)this.children[a].updateTransform();this.dirty&&(this.dirty=!1,this.interactionManager.dirty=!0);this.interactive&&this.interactionManager.update()};c.Stage.prototype.setBackgroundColor=function(a){this.backgroundColor=a||0;this.backgroundColorSplit=c.hex2rgb(this.backgroundColor);a=this.backgroundColor.toString(16);a="000000".substr(0,
6-a.length)+a;this.backgroundColorString="#"+a};c.Stage.prototype.getMousePosition=function(){return this.interactionManager.mouse.global};for(var m=0,n=["ms","moz","webkit","o"],o=0;o<n.length&&!window.requestAnimationFrame;++o)window.requestAnimationFrame=window[n[o]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[n[o]+"CancelAnimationFrame"]||window[n[o]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(a){var b=(new Date).getTime(),
c=Math.max(0,16-(b-m)),d=window.setTimeout(function(){a(b+c)},c);return m=b+c,d});window.cancelAnimationFrame||(window.cancelAnimationFrame=function(a){clearTimeout(a)});window.requestAnimFrame=window.requestAnimationFrame;c.hex2rgb=function(a){return[(a>>16&255)/255,(a>>8&255)/255,(255&a)/255]};c.rgb2hex=function(a){return(255*a[0]<<16)+(255*a[1]<<8)+255*a[2]};"function"!=typeof Function.prototype.bind&&(Function.prototype.bind=function(){var a=Array.prototype.slice;return function(b){function c(){var h=
f.concat(a.call(arguments));d.apply(this instanceof c?this:b,h)}var d=this,f=a.call(arguments,1);if("function"!=typeof d)throw new TypeError;return c.prototype=function g(a){return a&&(g.prototype=a),this instanceof g?void 0:new g}(d.prototype),c}}());c.AjaxRequest=function(){var a=["Msxml2.XMLHTTP.6.0","Msxml2.XMLHTTP.3.0","Microsoft.XMLHTTP"];if(!window.ActiveXObject)return window.XMLHttpRequest?new window.XMLHttpRequest:!1;for(var b=0;b<a.length;b++)try{return new window.ActiveXObject(a[b])}catch(c){}};
c.canUseNewCanvasBlendModes=function(){var a=document.createElement("canvas");a.width=1;a.height=1;a=a.getContext("2d");return a.fillStyle="#000",a.fillRect(0,0,1,1),a.globalCompositeOperation="multiply",a.fillStyle="#fff",a.fillRect(0,0,1,1),0===a.getImageData(0,0,1,1).data[0]};c.getNextPowerOfTwo=function(a){if(0<a&&0===(a&a-1))return a;for(var b=1;a>b;)b<<=1;return b};c.EventTarget=function(){var a={};this.addEventListener=this.on=function(b,c){void 0===a[b]&&(a[b]=[]);-1===a[b].indexOf(c)&&a[b].unshift(c)};
this.dispatchEvent=this.emit=function(b){if(a[b.type]&&a[b.type].length)for(var c=a[b.type].length-1;0<=c;c--)a[b.type][c](b)};this.removeEventListener=this.off=function(b,c){if(void 0!==a[b]){var d=a[b].indexOf(c);-1!==d&&a[b].splice(d,1)}};this.removeAllEventListeners=function(b){(b=a[b])&&(b.length=0)}};c.autoDetectRenderer=function(a,b,e,d,f){a||(a=800);b||(b=600);var h;try{var g=document.createElement("canvas");h=!!window.WebGLRenderingContext&&(g.getContext("webgl")||g.getContext("experimental-webgl"))}catch(j){h=
!1}return h?new c.WebGLRenderer(a,b,e,d,f):new c.CanvasRenderer(a,b,e,d)};c.autoDetectRecommendedRenderer=function(a,b,e,d,f){a||(a=800);b||(b=600);var h;try{var g=document.createElement("canvas");h=!!window.WebGLRenderingContext&&(g.getContext("webgl")||g.getContext("experimental-webgl"))}catch(j){h=!1}g=/Android/i.test(navigator.userAgent);return h&&!g?new c.WebGLRenderer(a,b,e,d,f):new c.CanvasRenderer(a,b,e,d)};c.PolyK={};c.PolyK.Triangulate=function(a){var b=!0,e=a.length>>1;if(3>e)return[];
for(var d=[],f=[],h=0;e>h;h++)f.push(h);for(var h=0,g=e;3<g;){var j=f[(h+0)%g],k=f[(h+1)%g],p=f[(h+2)%g],m=a[2*j],l=a[2*j+1],n=a[2*k],o=a[2*k+1],x=a[2*p],v=a[2*p+1],y=!1;if(c.PolyK._convex(m,l,n,o,x,v,b))for(var y=!0,z=0;g>z;z++){var G=f[z];if(G!==j&&G!==k&&G!==p&&c.PolyK._PointInTriangle(a[2*G],a[2*G+1],m,l,n,o,x,v)){y=!1;break}}if(y)d.push(j,k,p),f.splice((h+1)%g,1),g--,h=0;else if(h++>3*g){if(!b)return window.console.log("PIXI Warning: shape too complex to fill"),[];for(d=[],f=[],h=0;e>h;h++)f.push(h);
h=0;g=e;b=!1}}return d.push(f[0],f[1],f[2]),d};c.PolyK._PointInTriangle=function(a,b,c,d,f,h,g,j){g-=c;j-=d;f-=c;h-=d;a-=c;c=b-d;b=g*g+j*j;d=g*f+j*h;g=g*a+j*c;j=f*f+h*h;f=f*a+h*c;h=1/(b*j-d*d);j=(j*g-d*f)*h;g=(b*f-d*g)*h;return 0<=j&&0<=g&&1>j+g};c.PolyK._convex=function(a,b,c,d,f,h,g){return 0<=(b-d)*(f-c)+(c-a)*(h-d)===g};c.initDefaultShaders=function(){};c.CompileVertexShader=function(a,b){return c._CompileShader(a,b,a.VERTEX_SHADER)};c.CompileFragmentShader=function(a,b){return c._CompileShader(a,
b,a.FRAGMENT_SHADER)};c._CompileShader=function(a,b,c){b=b.join("\n");c=a.createShader(c);return a.shaderSource(c,b),a.compileShader(c),a.getShaderParameter(c,a.COMPILE_STATUS)?c:(window.console.log(a.getShaderInfoLog(c)),null)};c.compileProgram=function(a,b,e){var e=c.CompileFragmentShader(a,e),b=c.CompileVertexShader(a,b),d=a.createProgram();return a.attachShader(d,b),a.attachShader(d,e),a.linkProgram(d),a.getProgramParameter(d,a.LINK_STATUS)||window.console.log("Could not initialise shaders"),
d};c.PixiShader=function(a){this._UID=c._UID++;this.gl=a;this.program=null;this.fragmentSrc=["precision lowp float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;","}"];this.textureCount=0;this.attributes=[];this.init()};c.PixiShader.prototype.init=function(){var a=this.gl,b=c.compileProgram(a,this.vertexSrc||c.PixiShader.defaultVertexSrc,this.fragmentSrc);a.useProgram(b);this.uSampler=
a.getUniformLocation(b,"uSampler");this.projectionVector=a.getUniformLocation(b,"projectionVector");this.offsetVector=a.getUniformLocation(b,"offsetVector");this.dimensions=a.getUniformLocation(b,"dimensions");this.aVertexPosition=a.getAttribLocation(b,"aVertexPosition");this.aTextureCoord=a.getAttribLocation(b,"aTextureCoord");this.colorAttribute=a.getAttribLocation(b,"aColor");-1===this.colorAttribute&&(this.colorAttribute=2);this.attributes=[this.aVertexPosition,this.aTextureCoord,this.colorAttribute];
for(var e in this.uniforms)this.uniforms[e].uniformLocation=a.getUniformLocation(b,e);this.initUniforms();this.program=b};c.PixiShader.prototype.initUniforms=function(){this.textureCount=1;var a,b=this.gl,c;for(c in this.uniforms){a=this.uniforms[c];var d=a.type;"sampler2D"===d?(a._init=!1,null!==a.value&&this.initSampler2D(a)):"mat2"===d||"mat3"===d||"mat4"===d?(a.glMatrix=!0,a.glValueLength=1,"mat2"===d?a.glFunc=b.uniformMatrix2fv:"mat3"===d?a.glFunc=b.uniformMatrix3fv:"mat4"===d&&(a.glFunc=b.uniformMatrix4fv)):
(a.glFunc=b["uniform"+d],a.glValueLength="2f"===d||"2i"===d?2:"3f"===d||"3i"===d?3:"4f"===d||"4i"===d?4:1)}};c.PixiShader.prototype.initSampler2D=function(a){if(a.value&&a.value.baseTexture&&a.value.baseTexture.hasLoaded){var b=this.gl;if(b.activeTexture(b["TEXTURE"+this.textureCount]),b.bindTexture(b.TEXTURE_2D,a.value.baseTexture._glTextures[b.id]),a.textureData){var c=a.textureData,d=c.magFilter?c.magFilter:b.LINEAR,f=c.minFilter?c.minFilter:b.LINEAR,h=c.wrapS?c.wrapS:b.CLAMP_TO_EDGE,g=c.wrapT?
c.wrapT:b.CLAMP_TO_EDGE,j=c.luminance?b.LUMINANCE:b.RGBA;(c.repeat&&(h=b.REPEAT,g=b.REPEAT),b.pixelStorei(b.UNPACK_FLIP_Y_WEBGL,!!c.flipY),c.width)?b.texImage2D(b.TEXTURE_2D,0,j,c.width?c.width:512,c.height?c.height:2,c.border?c.border:0,j,b.UNSIGNED_BYTE,null):b.texImage2D(b.TEXTURE_2D,0,j,b.RGBA,b.UNSIGNED_BYTE,a.value.baseTexture.source);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,d);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,f);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,h);b.texParameteri(b.TEXTURE_2D,
b.TEXTURE_WRAP_T,g)}b.uniform1i(a.uniformLocation,this.textureCount);a._init=!0;this.textureCount++}};c.PixiShader.prototype.syncUniforms=function(){this.textureCount=1;var a,b=this.gl,e;for(e in this.uniforms)a=this.uniforms[e],1===a.glValueLength?!0===a.glMatrix?a.glFunc.call(b,a.uniformLocation,a.transpose,a.value):a.glFunc.call(b,a.uniformLocation,a.value):2===a.glValueLength?a.glFunc.call(b,a.uniformLocation,a.value.x,a.value.y):3===a.glValueLength?a.glFunc.call(b,a.uniformLocation,a.value.x,
a.value.y,a.value.z):4===a.glValueLength?a.glFunc.call(b,a.uniformLocation,a.value.x,a.value.y,a.value.z,a.value.w):"sampler2D"===a.type&&(a._init?(b.activeTexture(b["TEXTURE"+this.textureCount]),b.bindTexture(b.TEXTURE_2D,a.value.baseTexture._glTextures[b.id]||c.createWebGLTexture(a.value.baseTexture,b)),b.uniform1i(a.uniformLocation,this.textureCount),this.textureCount++):this.initSampler2D(a))};c.PixiShader.prototype.destroy=function(){this.gl.deleteProgram(this.program);this.uniforms=null;this.gl=
null;this.attributes=null};c.PixiShader.defaultVertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute vec2 aColor;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","varying vec2 vTextureCoord;","varying vec4 vColor;","const vec2 center = vec2(-1.0, 1.0);","void main(void) {","   gl_Position = vec4( ((aVertexPosition + offsetVector) / projectionVector) + center , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vec3 color = mod(vec3(aColor.y/65536.0, aColor.y/256.0, aColor.y), 256.0) / 256.0;",
"   vColor = vec4(color * aColor.x, aColor.x);","}"];c.PixiFastShader=function(a){this._UID=c._UID++;this.gl=a;this.program=null;this.fragmentSrc=["precision lowp float;","varying vec2 vTextureCoord;","varying float vColor;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;","}"];this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aPositionCoord;","attribute vec2 aScale;","attribute float aRotation;","attribute vec2 aTextureCoord;",
"attribute float aColor;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform mat3 uMatrix;","varying vec2 vTextureCoord;","varying float vColor;","const vec2 center = vec2(-1.0, 1.0);","void main(void) {","   vec2 v;","   vec2 sv = aVertexPosition * aScale;","   v.x = (sv.x) * cos(aRotation) - (sv.y) * sin(aRotation);","   v.y = (sv.x) * sin(aRotation) + (sv.y) * cos(aRotation);","   v = ( uMatrix * vec3(v + aPositionCoord , 1.0) ).xy ;","   gl_Position = vec4( ( v / projectionVector) + center , 0.0, 1.0);",
"   vTextureCoord = aTextureCoord;","   vColor = aColor;","}"];this.textureCount=0;this.init()};c.PixiFastShader.prototype.init=function(){var a=this.gl,b=c.compileProgram(a,this.vertexSrc,this.fragmentSrc);a.useProgram(b);this.uSampler=a.getUniformLocation(b,"uSampler");this.projectionVector=a.getUniformLocation(b,"projectionVector");this.offsetVector=a.getUniformLocation(b,"offsetVector");this.dimensions=a.getUniformLocation(b,"dimensions");this.uMatrix=a.getUniformLocation(b,"uMatrix");this.aVertexPosition=
a.getAttribLocation(b,"aVertexPosition");this.aPositionCoord=a.getAttribLocation(b,"aPositionCoord");this.aScale=a.getAttribLocation(b,"aScale");this.aRotation=a.getAttribLocation(b,"aRotation");this.aTextureCoord=a.getAttribLocation(b,"aTextureCoord");this.colorAttribute=a.getAttribLocation(b,"aColor");-1===this.colorAttribute&&(this.colorAttribute=2);this.attributes=[this.aVertexPosition,this.aPositionCoord,this.aScale,this.aRotation,this.aTextureCoord,this.colorAttribute];this.program=b};c.PixiFastShader.prototype.destroy=
function(){this.gl.deleteProgram(this.program);this.uniforms=null;this.gl=null;this.attributes=null};c.StripShader=function(a){this._UID=c._UID++;this.gl=a;this.program=null;this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","uniform float alpha;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y));","}"];this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","uniform mat3 translationMatrix;",
"uniform vec2 projectionVector;","uniform vec2 offsetVector;","varying vec2 vTextureCoord;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, v.y / -projectionVector.y + 1.0 , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","}"];this.init()};c.StripShader.prototype.init=function(){var a=this.gl,b=c.compileProgram(a,this.vertexSrc,this.fragmentSrc);a.useProgram(b);this.uSampler=a.getUniformLocation(b,
"uSampler");this.projectionVector=a.getUniformLocation(b,"projectionVector");this.offsetVector=a.getUniformLocation(b,"offsetVector");this.colorAttribute=a.getAttribLocation(b,"aColor");this.aVertexPosition=a.getAttribLocation(b,"aVertexPosition");this.aTextureCoord=a.getAttribLocation(b,"aTextureCoord");this.attributes=[this.aVertexPosition,this.aTextureCoord];this.translationMatrix=a.getUniformLocation(b,"translationMatrix");this.alpha=a.getUniformLocation(b,"alpha");this.program=b};c.PrimitiveShader=
function(a){this._UID=c._UID++;this.gl=a;this.program=null;this.fragmentSrc=["precision mediump float;","varying vec4 vColor;","void main(void) {","   gl_FragColor = vColor;","}"];this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec4 aColor;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform float alpha;","uniform vec3 tint;","varying vec4 vColor;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);",
"   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, v.y / -projectionVector.y + 1.0 , 0.0, 1.0);","   vColor = aColor * vec4(tint * alpha, alpha);","}"];this.init()};c.PrimitiveShader.prototype.init=function(){var a=this.gl,b=c.compileProgram(a,this.vertexSrc,this.fragmentSrc);a.useProgram(b);this.projectionVector=a.getUniformLocation(b,"projectionVector");this.offsetVector=a.getUniformLocation(b,"offsetVector");this.tintColor=a.getUniformLocation(b,"tint");this.aVertexPosition=
a.getAttribLocation(b,"aVertexPosition");this.colorAttribute=a.getAttribLocation(b,"aColor");this.attributes=[this.aVertexPosition,this.colorAttribute];this.translationMatrix=a.getUniformLocation(b,"translationMatrix");this.alpha=a.getUniformLocation(b,"alpha");this.program=b};c.PrimitiveShader.prototype.destroy=function(){this.gl.deleteProgram(this.program);this.uniforms=null;this.gl=null;this.attribute=null};c.ComplexPrimitiveShader=function(a){this._UID=c._UID++;this.gl=a;this.program=null;this.fragmentSrc=
["precision mediump float;","varying vec4 vColor;","void main(void) {","   gl_FragColor = vColor;","}"];this.vertexSrc=["attribute vec2 aVertexPosition;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform vec3 tint;","uniform float alpha;","uniform vec3 color;","varying vec4 vColor;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, v.y / -projectionVector.y + 1.0 , 0.0, 1.0);",
"   vColor = vec4(color * alpha * tint, alpha);","}"];this.init()};c.ComplexPrimitiveShader.prototype.init=function(){var a=this.gl,b=c.compileProgram(a,this.vertexSrc,this.fragmentSrc);a.useProgram(b);this.projectionVector=a.getUniformLocation(b,"projectionVector");this.offsetVector=a.getUniformLocation(b,"offsetVector");this.tintColor=a.getUniformLocation(b,"tint");this.color=a.getUniformLocation(b,"color");this.aVertexPosition=a.getAttribLocation(b,"aVertexPosition");this.attributes=[this.aVertexPosition,
this.colorAttribute];this.translationMatrix=a.getUniformLocation(b,"translationMatrix");this.alpha=a.getUniformLocation(b,"alpha");this.program=b};c.ComplexPrimitiveShader.prototype.destroy=function(){this.gl.deleteProgram(this.program);this.uniforms=null;this.gl=null;this.attribute=null};c.WebGLGraphics=function(){};c.WebGLGraphics.renderGraphics=function(a,b){var e,d=b.gl,f=b.projection,h=b.offset,g=b.shaderManager.primitiveShader;a.dirty&&c.WebGLGraphics.updateGraphics(a,d);for(var j=a._webGL[d.id],
k=0;k<j.data.length;k++)1===j.data[k].mode?(e=j.data[k],b.stencilManager.pushStencil(a,e,b),d.drawElements(d.TRIANGLE_FAN,4,d.UNSIGNED_SHORT,2*(e.indices.length-4)),b.stencilManager.popStencil(a,e,b),this.last=e.mode):(e=j.data[k],b.shaderManager.setShader(g),g=b.shaderManager.primitiveShader,d.uniformMatrix3fv(g.translationMatrix,!1,a.worldTransform.toArray(!0)),d.uniform2f(g.projectionVector,f.x,-f.y),d.uniform2f(g.offsetVector,-h.x,-h.y),d.uniform3fv(g.tintColor,c.hex2rgb(a.tint)),d.uniform1f(g.alpha,
a.worldAlpha),d.bindBuffer(d.ARRAY_BUFFER,e.buffer),d.vertexAttribPointer(g.aVertexPosition,2,d.FLOAT,!1,24,0),d.vertexAttribPointer(g.colorAttribute,4,d.FLOAT,!1,24,8),d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,e.indexBuffer),d.drawElements(d.TRIANGLE_STRIP,e.indices.length,d.UNSIGNED_SHORT,0))};c.WebGLGraphics.updateGraphics=function(a,b){var e=a._webGL[b.id];e||(e=a._webGL[b.id]={lastIndex:0,data:[],gl:b});a.dirty=!1;var d;if(a.clearDirty){for(a.clearDirty=!1,d=0;d<e.data.length;d++){var f=e.data[d];
f.reset();c.WebGLGraphics.graphicsDataPool.push(f)}e.data=[];e.lastIndex=0}var h;for(d=e.lastIndex;d<a.graphicsData.length;d++)f=a.graphicsData[d],f.type===c.Graphics.POLY?(f.fill&&6<f.points.length&&(10<f.points.length?(h=c.WebGLGraphics.switchMode(e,1),c.WebGLGraphics.buildComplexPoly(f,h)):(h=c.WebGLGraphics.switchMode(e,0),c.WebGLGraphics.buildPoly(f,h))),0<f.lineWidth&&(h=c.WebGLGraphics.switchMode(e,0),c.WebGLGraphics.buildLine(f,h))):(h=c.WebGLGraphics.switchMode(e,0),f.type===c.Graphics.RECT?
c.WebGLGraphics.buildRectangle(f,h):f.type===c.Graphics.CIRC||f.type===c.Graphics.ELIP?c.WebGLGraphics.buildCircle(f,h):f.type===c.Graphics.RREC&&c.WebGLGraphics.buildRoundedRectangle(f,h)),e.lastIndex++;for(d=0;d<e.data.length;d++)h=e.data[d],h.dirty&&h.upload()};c.WebGLGraphics.switchMode=function(a,b){var e;return a.data.length?(e=a.data[a.data.length-1],(e.mode!==b||1===b)&&(e=c.WebGLGraphics.graphicsDataPool.pop()||new c.WebGLGraphicsData(a.gl),e.mode=b,a.data.push(e))):(e=c.WebGLGraphics.graphicsDataPool.pop()||
new c.WebGLGraphicsData(a.gl),e.mode=b,a.data.push(e)),e.dirty=!0,e};c.WebGLGraphics.buildRectangle=function(a,b){var e=a.points,d=e[0],f=e[1],h=e[2],e=e[3];if(a.fill){var g=c.hex2rgb(a.fillColor),j=a.fillAlpha,k=g[0]*j,p=g[1]*j,g=g[2]*j,m=b.points,l=b.indices,n=m.length/6;m.push(d,f);m.push(k,p,g,j);m.push(d+h,f);m.push(k,p,g,j);m.push(d,f+e);m.push(k,p,g,j);m.push(d+h,f+e);m.push(k,p,g,j);l.push(n,n,n+1,n+2,n+3,n+3)}if(a.lineWidth)j=a.points,a.points=[d,f,d+h,f,d+h,f+e,d,f+e,d,f],c.WebGLGraphics.buildLine(a,
b),a.points=j};c.WebGLGraphics.buildRoundedRectangle=function(a,b){var e=a.points,d=e[0],f=e[1],h=e[2],g=e[3],j=e[4],e=[];if(e.push(d,f+j),e=e.concat(c.WebGLGraphics.quadraticBezierCurve(d,f+g-j,d,f+g,d+j,f+g)),e=e.concat(c.WebGLGraphics.quadraticBezierCurve(d+h-j,f+g,d+h,f+g,d+h,f+g-j)),e=e.concat(c.WebGLGraphics.quadraticBezierCurve(d+h,f+j,d+h,f,d+h-j,f)),e=e.concat(c.WebGLGraphics.quadraticBezierCurve(d+j,f,d,f,d,f+j)),a.fill){for(var g=c.hex2rgb(a.fillColor),d=a.fillAlpha,f=g[0]*d,h=g[1]*d,g=
g[2]*d,j=b.points,k=b.indices,p=j.length/6,m=c.PolyK.Triangulate(e),l=0,l=0;l<m.length;l+=3)k.push(m[l]+p),k.push(m[l]+p),k.push(m[l+1]+p),k.push(m[l+2]+p),k.push(m[l+2]+p);for(l=0;l<e.length;l++)j.push(e[l],e[++l],f,h,g,d)}if(a.lineWidth)d=a.points,a.points=e,c.WebGLGraphics.buildLine(a,b),a.points=d};c.WebGLGraphics.quadraticBezierCurve=function(a,b,c,d,f,h){for(var g,j,k,p,m,l,n=[],o=0,x=0;20>=x;x++)o=x/20,g=a+(c-a)*o,j=b+(d-b)*o,k=c+(f-c)*o,p=d+(h-d)*o,m=g+(k-g)*o,l=j+(p-j)*o,n.push(m,l);return n};
c.WebGLGraphics.buildCircle=function(a,b){var e=a.points,d=e[0],f=e[1],h=e[2],e=e[3],g=2*Math.PI/40,j=0;if(a.fill){var j=c.hex2rgb(a.fillColor),k=a.fillAlpha,p=j[0]*k,m=j[1]*k,l=j[2]*k,n=b.points,o=b.indices,x=n.length/6;for(o.push(x),j=0;41>j;j++)n.push(d,f,p,m,l,k),n.push(d+Math.sin(g*j)*h,f+Math.cos(g*j)*e,p,m,l,k),o.push(x++,x++);o.push(x-1)}if(a.lineWidth){k=a.points;for(a.points=[],j=0;41>j;j++)a.points.push(d+Math.sin(g*j)*h,f+Math.cos(g*j)*e);c.WebGLGraphics.buildLine(a,b);a.points=k}};c.WebGLGraphics.buildLine=
function(a,b){var e=0,d=a.points;if(0!==d.length){if(a.lineWidth%2)for(e=0;e<d.length;e++)d[e]+=0.5;var f=new c.Point(d[0],d[1]),h=new c.Point(d[d.length-2],d[d.length-1]);if(f.x===h.x&&f.y===h.y){d=d.slice();d.pop();d.pop();h=new c.Point(d[d.length-2],d[d.length-1]);var g=h.x+0.5*(f.x-h.x),f=h.y+0.5*(f.y-h.y);d.unshift(g,f);d.push(g,f)}var j,k,p,m,l,n,o,x,v,y,z,G,D,F,K,J,s,u,C,E,H,M,L,g=b.points,f=b.indices,h=d.length/2,w=d.length,r=g.length/6,I=a.lineWidth/2,e=c.hex2rgb(a.lineColor),N=a.lineAlpha,
P=e[0]*N,Q=e[1]*N,O=e[2]*N;for(p=d[0],m=d[1],l=d[2],n=d[3],v=-(m-n),y=p-l,L=Math.sqrt(v*v+y*y),v/=L,y/=L,v*=I,y*=I,g.push(p-v,m-y,P,Q,O,N),g.push(p+v,m+y,P,Q,O,N),e=1;h-1>e;e++)p=d[2*(e-1)],m=d[2*(e-1)+1],l=d[2*e],n=d[2*e+1],o=d[2*(e+1)],x=d[2*(e+1)+1],v=-(m-n),y=p-l,L=Math.sqrt(v*v+y*y),v/=L,y/=L,v*=I,y*=I,z=-(n-x),G=l-o,L=Math.sqrt(z*z+G*G),z/=L,G/=L,z*=I,G*=I,K=-y+m-(-y+n),J=-v+l-(-v+p),s=(-v+p)*(-y+n)-(-v+l)*(-y+m),u=-G+x-(-G+n),C=-z+l-(-z+o),E=(-z+o)*(-G+n)-(-z+l)*(-G+x),H=K*C-u*J,0.1>Math.abs(H)?
(H+=10.1,g.push(l-v,n-y,P,Q,O,N),g.push(l+v,n+y,P,Q,O,N)):(j=(J*E-C*s)/H,k=(u*s-K*E)/H,M=(j-l)*(j-l)+(k-n)+(k-n),19600<M?(D=v-z,F=y-G,L=Math.sqrt(D*D+F*F),D/=L,F/=L,D*=I,F*=I,g.push(l-D,n-F),g.push(P,Q,O,N),g.push(l+D,n+F),g.push(P,Q,O,N),g.push(l-D,n-F),g.push(P,Q,O,N),w++):(g.push(j,k),g.push(P,Q,O,N),g.push(l-(j-l),n-(k-n)),g.push(P,Q,O,N)));for(p=d[2*(h-2)],m=d[2*(h-2)+1],l=d[2*(h-1)],n=d[2*(h-1)+1],v=-(m-n),y=p-l,L=Math.sqrt(v*v+y*y),v/=L,y/=L,v*=I,y*=I,g.push(l-v,n-y),g.push(P,Q,O,N),g.push(l+
v,n+y),g.push(P,Q,O,N),f.push(r),e=0;w>e;e++)f.push(r++);f.push(r-1)}};c.WebGLGraphics.buildComplexPoly=function(a,b){var e=a.points.slice();if(!(6>e.length)){var d=b.indices;b.points=e;b.alpha=a.fillAlpha;b.color=c.hex2rgb(a.fillColor);for(var f,h,g=1/0,j=-1/0,k=1/0,p=-1/0,m=0;m<e.length;m+=2)f=e[m],h=e[m+1],g=g>f?f:g,j=f>j?f:j,k=k>h?h:k,p=h>p?h:p;e.push(g,k,j,k,j,p,g,p);e=e.length/2;for(m=0;e>m;m++)d.push(m)}};c.WebGLGraphics.buildPoly=function(a,b){var e=a.points;if(!(6>e.length)){for(var d=b.points,
f=b.indices,h=e.length/2,g=c.hex2rgb(a.fillColor),j=a.fillAlpha,k=g[0]*j,p=g[1]*j,g=g[2]*j,m=c.PolyK.Triangulate(e),l=d.length/6,n=0,n=0;n<m.length;n+=3)f.push(m[n]+l),f.push(m[n]+l),f.push(m[n+1]+l),f.push(m[n+2]+l),f.push(m[n+2]+l);for(n=0;h>n;n++)d.push(e[2*n],e[2*n+1],k,p,g,j)}};c.WebGLGraphics.graphicsDataPool=[];c.WebGLGraphicsData=function(a){this.gl=a;this.color=[0,0,0];this.points=[];this.indices=[];this.lastIndex=0;this.buffer=a.createBuffer();this.indexBuffer=a.createBuffer();this.mode=
1;this.alpha=1;this.dirty=!0};c.WebGLGraphicsData.prototype.reset=function(){this.points=[];this.indices=[];this.lastIndex=0};c.WebGLGraphicsData.prototype.upload=function(){var a=this.gl;this.glPoints=new Float32Array(this.points);a.bindBuffer(a.ARRAY_BUFFER,this.buffer);a.bufferData(a.ARRAY_BUFFER,this.glPoints,a.STATIC_DRAW);this.glIndicies=new Uint16Array(this.indices);a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.indexBuffer);a.bufferData(a.ELEMENT_ARRAY_BUFFER,this.glIndicies,a.STATIC_DRAW);this.dirty=
!1};c.glContexts=[];c.WebGLRenderer=function(a,b,e,d,f,h){c.defaultRenderer||(c.sayHello("webGL"),c.defaultRenderer=this);this.type=c.WEBGL_RENDERER;this.transparent=!!d;this.preserveDrawingBuffer=h;this.width=a||800;this.height=b||600;this.view=e||document.createElement("canvas");this.view.width=this.width;this.view.height=this.height;this.contextLost=this.handleContextLost.bind(this);this.contextRestoredLost=this.handleContextRestored.bind(this);this.view.addEventListener("webglcontextlost",this.contextLost,
!1);this.view.addEventListener("webglcontextrestored",this.contextRestoredLost,!1);this.options={alpha:this.transparent,antialias:!!f,premultipliedAlpha:!!d,stencil:!0,preserveDrawingBuffer:h};var g=null;if(["experimental-webgl","webgl"].forEach(function(a){try{g=g||this.view.getContext(a,this.options)}catch(b){}},this),!g)throw Error("This browser does not support webGL. Try using the canvas renderer"+this);this.gl=g;this.glContextId=g.id=c.WebGLRenderer.glContextId++;c.glContexts[this.glContextId]=
g;c.blendModesWebGL||(c.blendModesWebGL=[],c.blendModesWebGL[c.blendModes.NORMAL]=[g.ONE,g.ONE_MINUS_SRC_ALPHA],c.blendModesWebGL[c.blendModes.ADD]=[g.SRC_ALPHA,g.DST_ALPHA],c.blendModesWebGL[c.blendModes.MULTIPLY]=[g.DST_COLOR,g.ONE_MINUS_SRC_ALPHA],c.blendModesWebGL[c.blendModes.SCREEN]=[g.SRC_ALPHA,g.ONE],c.blendModesWebGL[c.blendModes.OVERLAY]=[g.ONE,g.ONE_MINUS_SRC_ALPHA],c.blendModesWebGL[c.blendModes.DARKEN]=[g.ONE,g.ONE_MINUS_SRC_ALPHA],c.blendModesWebGL[c.blendModes.LIGHTEN]=[g.ONE,g.ONE_MINUS_SRC_ALPHA],
c.blendModesWebGL[c.blendModes.COLOR_DODGE]=[g.ONE,g.ONE_MINUS_SRC_ALPHA],c.blendModesWebGL[c.blendModes.COLOR_BURN]=[g.ONE,g.ONE_MINUS_SRC_ALPHA],c.blendModesWebGL[c.blendModes.HARD_LIGHT]=[g.ONE,g.ONE_MINUS_SRC_ALPHA],c.blendModesWebGL[c.blendModes.SOFT_LIGHT]=[g.ONE,g.ONE_MINUS_SRC_ALPHA],c.blendModesWebGL[c.blendModes.DIFFERENCE]=[g.ONE,g.ONE_MINUS_SRC_ALPHA],c.blendModesWebGL[c.blendModes.EXCLUSION]=[g.ONE,g.ONE_MINUS_SRC_ALPHA],c.blendModesWebGL[c.blendModes.HUE]=[g.ONE,g.ONE_MINUS_SRC_ALPHA],
c.blendModesWebGL[c.blendModes.SATURATION]=[g.ONE,g.ONE_MINUS_SRC_ALPHA],c.blendModesWebGL[c.blendModes.COLOR]=[g.ONE,g.ONE_MINUS_SRC_ALPHA],c.blendModesWebGL[c.blendModes.LUMINOSITY]=[g.ONE,g.ONE_MINUS_SRC_ALPHA]);this.projection=new c.Point;this.projection.x=this.width/2;this.projection.y=-this.height/2;this.offset=new c.Point(0,0);this.resize(this.width,this.height);this.contextLost=!1;this.shaderManager=new c.WebGLShaderManager(g);this.spriteBatch=new c.WebGLSpriteBatch(g);this.maskManager=new c.WebGLMaskManager(g);
this.filterManager=new c.WebGLFilterManager(g,this.transparent);this.stencilManager=new c.WebGLStencilManager(g);this.blendModeManager=new c.WebGLBlendModeManager(g);this.renderSession={};this.renderSession.gl=this.gl;this.renderSession.drawCount=0;this.renderSession.shaderManager=this.shaderManager;this.renderSession.maskManager=this.maskManager;this.renderSession.filterManager=this.filterManager;this.renderSession.blendModeManager=this.blendModeManager;this.renderSession.spriteBatch=this.spriteBatch;
this.renderSession.stencilManager=this.stencilManager;this.renderSession.renderer=this;g.useProgram(this.shaderManager.defaultShader.program);g.disable(g.DEPTH_TEST);g.disable(g.CULL_FACE);g.enable(g.BLEND);g.colorMask(!0,!0,!0,this.transparent)};c.WebGLRenderer.prototype.constructor=c.WebGLRenderer;c.WebGLRenderer.prototype.render=function(a){if(!this.contextLost){this.__stage!==a&&(a.interactive&&a.interactionManager.removeEvents(),this.__stage=a);c.WebGLRenderer.updateTextures();a.updateTransform();
a._interactive&&(a._interactiveEventsAdded||(a._interactiveEventsAdded=!0,a.interactionManager.setTarget(this)));var b=this.gl;b.viewport(0,0,this.width,this.height);b.bindFramebuffer(b.FRAMEBUFFER,null);this.transparent?b.clearColor(0,0,0,0):b.clearColor(a.backgroundColorSplit[0],a.backgroundColorSplit[1],a.backgroundColorSplit[2],1);b.clear(b.COLOR_BUFFER_BIT);this.renderDisplayObject(a,this.projection);a.interactive?a._interactiveEventsAdded||(a._interactiveEventsAdded=!0,a.interactionManager.setTarget(this)):
a._interactiveEventsAdded&&(a._interactiveEventsAdded=!1,a.interactionManager.setTarget(this))}};c.WebGLRenderer.prototype.renderDisplayObject=function(a,b,e){this.renderSession.blendModeManager.setBlendMode(c.blendModes.NORMAL);this.renderSession.drawCount=0;this.renderSession.currentBlendMode=9999;this.renderSession.projection=b;this.renderSession.offset=this.offset;this.spriteBatch.begin(this.renderSession);this.filterManager.begin(this.renderSession,e);a._renderWebGL(this.renderSession);this.spriteBatch.end()};
c.WebGLRenderer.updateTextures=function(){for(var a=0,a=0;a<c.Texture.frameUpdates.length;a++)c.WebGLRenderer.updateTextureFrame(c.Texture.frameUpdates[a]);for(a=0;a<c.texturesToDestroy.length;a++)c.WebGLRenderer.destroyTexture(c.texturesToDestroy[a]);c.texturesToUpdate.length=0;c.texturesToDestroy.length=0;c.Texture.frameUpdates.length=0};c.WebGLRenderer.destroyTexture=function(a){for(var b=a._glTextures.length-1;0<=b;b--){var e=a._glTextures[b],d=c.glContexts[b];d&&e&&d.deleteTexture(e)}a._glTextures.length=
0};c.WebGLRenderer.updateTextureFrame=function(a){a._updateWebGLuvs()};c.WebGLRenderer.prototype.resize=function(a,b){this.width=a;this.height=b;this.view.width=a;this.view.height=b;this.gl.viewport(0,0,this.width,this.height);this.projection.x=this.width/2;this.projection.y=-this.height/2};c.createWebGLTexture=function(a,b){return a.hasLoaded&&(a._glTextures[b.id]=b.createTexture(),b.bindTexture(b.TEXTURE_2D,a._glTextures[b.id]),b.pixelStorei(b.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a.premultipliedAlpha),
b.texImage2D(b.TEXTURE_2D,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,a.source),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,a.scaleMode===c.scaleModes.LINEAR?b.LINEAR:b.NEAREST),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,a.scaleMode===c.scaleModes.LINEAR?b.LINEAR:b.NEAREST),a._powerOf2?(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,b.REPEAT),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,b.REPEAT)):(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,b.CLAMP_TO_EDGE),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,
b.CLAMP_TO_EDGE)),b.bindTexture(b.TEXTURE_2D,null),a._dirty[b.id]=!1),a._glTextures[b.id]};c.updateWebGLTexture=function(a,b){a._glTextures[b.id]&&(b.bindTexture(b.TEXTURE_2D,a._glTextures[b.id]),b.pixelStorei(b.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a.premultipliedAlpha),b.texImage2D(b.TEXTURE_2D,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,a.source),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,a.scaleMode===c.scaleModes.LINEAR?b.LINEAR:b.NEAREST),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,a.scaleMode===
c.scaleModes.LINEAR?b.LINEAR:b.NEAREST),a._powerOf2?(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,b.REPEAT),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,b.REPEAT)):(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,b.CLAMP_TO_EDGE),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,b.CLAMP_TO_EDGE)),a._dirty[b.id]=!1)};c.WebGLRenderer.prototype.handleContextLost=function(a){a.preventDefault();this.contextLost=!0};c.WebGLRenderer.prototype.handleContextRestored=function(){try{this.gl=this.view.getContext("experimental-webgl",
this.options)}catch(a){try{this.gl=this.view.getContext("webgl",this.options)}catch(b){throw Error(" This browser does not support webGL. Try using the canvas renderer"+this);}}var e=this.gl;e.id=c.WebGLRenderer.glContextId++;this.shaderManager.setContext(e);this.spriteBatch.setContext(e);this.primitiveBatch.setContext(e);this.maskManager.setContext(e);this.filterManager.setContext(e);this.renderSession.gl=this.gl;e.disable(e.DEPTH_TEST);e.disable(e.CULL_FACE);e.enable(e.BLEND);e.colorMask(!0,!0,
!0,this.transparent);this.gl.viewport(0,0,this.width,this.height);for(var d in c.TextureCache)c.TextureCache[d].baseTexture._glTextures=[];this.contextLost=!1};c.WebGLRenderer.prototype.destroy=function(){this.view.removeEventListener("webglcontextlost",this.contextLost);this.view.removeEventListener("webglcontextrestored",this.contextRestoredLost);c.glContexts[this.glContextId]=null;this.projection=null;this.offset=null;this.shaderManager.destroy();this.spriteBatch.destroy();this.primitiveBatch.destroy();
this.maskManager.destroy();this.filterManager.destroy();this.shaderManager=null;this.spriteBatch=null;this.maskManager=null;this.filterManager=null;this.gl=null;this.renderSession=null};c.WebGLRenderer.glContextId=0;c.WebGLBlendModeManager=function(a){this.gl=a;this.currentBlendMode=99999};c.WebGLBlendModeManager.prototype.setBlendMode=function(a){if(this.currentBlendMode===a)return!1;this.currentBlendMode=a;a=c.blendModesWebGL[this.currentBlendMode];return this.gl.blendFunc(a[0],a[1]),!0};c.WebGLBlendModeManager.prototype.destroy=
function(){this.gl=null};c.WebGLMaskManager=function(a){this.maskStack=[];this.maskPosition=0;this.setContext(a);this.reverse=!1;this.count=0};c.WebGLMaskManager.prototype.setContext=function(a){this.gl=a};c.WebGLMaskManager.prototype.pushMask=function(a,b){var e=b.gl;a.dirty&&c.WebGLGraphics.updateGraphics(a,e);a._webGL[e.id].data.length&&b.stencilManager.pushStencil(a,a._webGL[e.id].data[0],b)};c.WebGLMaskManager.prototype.popMask=function(a,b){b.stencilManager.popStencil(a,a._webGL[this.gl.id].data[0],
b)};c.WebGLMaskManager.prototype.destroy=function(){this.maskStack=null;this.gl=null};c.WebGLStencilManager=function(a){this.stencilStack=[];this.setContext(a);this.reverse=!0;this.count=0};c.WebGLStencilManager.prototype.setContext=function(a){this.gl=a};c.WebGLStencilManager.prototype.pushStencil=function(a,b,c){var d=this.gl;this.bindGraphics(a,b,c);0===this.stencilStack.length&&(d.enable(d.STENCIL_TEST),d.clear(d.STENCIL_BUFFER_BIT),this.reverse=!0,this.count=0);this.stencilStack.push(b);a=this.count;
d.colorMask(!1,!1,!1,!1);d.stencilFunc(d.ALWAYS,0,255);d.stencilOp(d.KEEP,d.KEEP,d.INVERT);1===b.mode?(d.drawElements(d.TRIANGLE_FAN,b.indices.length-4,d.UNSIGNED_SHORT,0),this.reverse?(d.stencilFunc(d.EQUAL,255-a,255),d.stencilOp(d.KEEP,d.KEEP,d.DECR)):(d.stencilFunc(d.EQUAL,a,255),d.stencilOp(d.KEEP,d.KEEP,d.INCR)),d.drawElements(d.TRIANGLE_FAN,4,d.UNSIGNED_SHORT,2*(b.indices.length-4)),this.reverse?d.stencilFunc(d.EQUAL,255-(a+1),255):d.stencilFunc(d.EQUAL,a+1,255),this.reverse=!this.reverse):
(this.reverse?(d.stencilFunc(d.EQUAL,a,255),d.stencilOp(d.KEEP,d.KEEP,d.INCR)):(d.stencilFunc(d.EQUAL,255-a,255),d.stencilOp(d.KEEP,d.KEEP,d.DECR)),d.drawElements(d.TRIANGLE_STRIP,b.indices.length,d.UNSIGNED_SHORT,0),this.reverse?d.stencilFunc(d.EQUAL,a+1,255):d.stencilFunc(d.EQUAL,255-(a+1),255));d.colorMask(!0,!0,!0,!0);d.stencilOp(d.KEEP,d.KEEP,d.KEEP);this.count++};c.WebGLStencilManager.prototype.bindGraphics=function(a,b,e){this._currentGraphics=a;var d,f=this.gl,h=e.projection,g=e.offset;1===
b.mode?(d=e.shaderManager.complexPrimativeShader,e.shaderManager.setShader(d),f.uniformMatrix3fv(d.translationMatrix,!1,a.worldTransform.toArray(!0)),f.uniform2f(d.projectionVector,h.x,-h.y),f.uniform2f(d.offsetVector,-g.x,-g.y),f.uniform3fv(d.tintColor,c.hex2rgb(a.tint)),f.uniform3fv(d.color,b.color),f.uniform1f(d.alpha,a.worldAlpha*b.alpha),f.bindBuffer(f.ARRAY_BUFFER,b.buffer),f.vertexAttribPointer(d.aVertexPosition,2,f.FLOAT,!1,8,0),f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,b.indexBuffer)):(d=e.shaderManager.primitiveShader,
e.shaderManager.setShader(d),f.uniformMatrix3fv(d.translationMatrix,!1,a.worldTransform.toArray(!0)),f.uniform2f(d.projectionVector,h.x,-h.y),f.uniform2f(d.offsetVector,-g.x,-g.y),f.uniform3fv(d.tintColor,c.hex2rgb(a.tint)),f.uniform1f(d.alpha,a.worldAlpha),f.bindBuffer(f.ARRAY_BUFFER,b.buffer),f.vertexAttribPointer(d.aVertexPosition,2,f.FLOAT,!1,24,0),f.vertexAttribPointer(d.colorAttribute,4,f.FLOAT,!1,24,8),f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,b.indexBuffer))};c.WebGLStencilManager.prototype.popStencil=
function(a,b,c){var d=this.gl;if(this.stencilStack.pop(),this.count--,0===this.stencilStack.length)d.disable(d.STENCIL_TEST);else{var f=this.count;this.bindGraphics(a,b,c);d.colorMask(!1,!1,!1,!1);1===b.mode?(this.reverse=!this.reverse,this.reverse?(d.stencilFunc(d.EQUAL,255-(f+1),255),d.stencilOp(d.KEEP,d.KEEP,d.INCR)):(d.stencilFunc(d.EQUAL,f+1,255),d.stencilOp(d.KEEP,d.KEEP,d.DECR)),d.drawElements(d.TRIANGLE_FAN,4,d.UNSIGNED_SHORT,2*(b.indices.length-4)),d.stencilFunc(d.ALWAYS,0,255),d.stencilOp(d.KEEP,
d.KEEP,d.INVERT),d.drawElements(d.TRIANGLE_FAN,b.indices.length-4,d.UNSIGNED_SHORT,0),this.reverse?d.stencilFunc(d.EQUAL,f,255):d.stencilFunc(d.EQUAL,255-f,255)):(this.reverse?(d.stencilFunc(d.EQUAL,f+1,255),d.stencilOp(d.KEEP,d.KEEP,d.DECR)):(d.stencilFunc(d.EQUAL,255-(f+1),255),d.stencilOp(d.KEEP,d.KEEP,d.INCR)),d.drawElements(d.TRIANGLE_STRIP,b.indices.length,d.UNSIGNED_SHORT,0),this.reverse?d.stencilFunc(d.EQUAL,f,255):d.stencilFunc(d.EQUAL,255-f,255));d.colorMask(!0,!0,!0,!0);d.stencilOp(d.KEEP,
d.KEEP,d.KEEP)}};c.WebGLStencilManager.prototype.destroy=function(){this.maskStack=null;this.gl=null};c.WebGLShaderManager=function(a){this.maxAttibs=10;this.attribState=[];this.tempAttribState=[];this.shaderMap=[];for(var b=0;b<this.maxAttibs;b++)this.attribState[b]=!1;this.setContext(a)};c.WebGLShaderManager.prototype.setContext=function(a){this.gl=a;this.primitiveShader=new c.PrimitiveShader(a);this.complexPrimativeShader=new c.ComplexPrimitiveShader(a);this.defaultShader=new c.PixiShader(a);this.fastShader=
new c.PixiFastShader(a);this.stripShader=new c.StripShader(a);this.setShader(this.defaultShader)};c.WebGLShaderManager.prototype.setAttribs=function(a){var b;for(b=0;b<this.tempAttribState.length;b++)this.tempAttribState[b]=!1;for(b=0;b<a.length;b++)this.tempAttribState[a[b]]=!0;a=this.gl;for(b=0;b<this.attribState.length;b++)this.attribState[b]!==this.tempAttribState[b]&&(this.attribState[b]=this.tempAttribState[b],this.tempAttribState[b]?a.enableVertexAttribArray(b):a.disableVertexAttribArray(b))};
c.WebGLShaderManager.prototype.setShader=function(a){return this._currentId===a._UID?!1:(this._currentId=a._UID,this.currentShader=a,this.gl.useProgram(a.program),this.setAttribs(a.attributes),!0)};c.WebGLShaderManager.prototype.destroy=function(){this.attribState=null;this.tempAttribState=null;this.primitiveShader.destroy();this.defaultShader.destroy();this.fastShader.destroy();this.stripShader.destroy();this.gl=null};c.WebGLSpriteBatch=function(a){this.vertSize=6;this.size=2E3;var b=6*this.size;
this.vertices=new Float32Array(4*this.size*this.vertSize);this.indices=new Uint16Array(b);this.lastIndexCount=0;for(var c=0,d=0;b>c;c+=6,d+=4)this.indices[c+0]=d+0,this.indices[c+1]=d+1,this.indices[c+2]=d+2,this.indices[c+3]=d+0,this.indices[c+4]=d+2,this.indices[c+5]=d+3;this.drawing=!1;this.currentBatchSize=0;this.currentBaseTexture=null;this.setContext(a);this.dirty=!0;this.textures=[];this.blendModes=[]};c.WebGLSpriteBatch.prototype.setContext=function(a){this.gl=a;this.vertexBuffer=a.createBuffer();
this.indexBuffer=a.createBuffer();a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.indexBuffer);a.bufferData(a.ELEMENT_ARRAY_BUFFER,this.indices,a.STATIC_DRAW);a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffer);a.bufferData(a.ARRAY_BUFFER,this.vertices,a.DYNAMIC_DRAW);this.currentBlendMode=99999};c.WebGLSpriteBatch.prototype.begin=function(a){this.renderSession=a;this.shader=this.renderSession.shaderManager.defaultShader;this.start()};c.WebGLSpriteBatch.prototype.end=function(){this.flush()};c.WebGLSpriteBatch.prototype.render=
function(a){var b=a.texture;this.currentBatchSize>=this.size&&(this.flush(),this.currentBaseTexture=b.baseTexture);var c=b._uvs;if(c){var d,f,h,g,j=a.worldAlpha,k=a.tint,p=this.vertices;h=a.anchor.x;var m=a.anchor.y;if(b.trim){var l=b.trim;f=l.x-h*l.width;d=f+b.crop.width;g=l.y-m*l.height;h=g+b.crop.height}else d=b.frame.width*(1-h),f=b.frame.width*-h,h=b.frame.height*(1-m),g=b.frame.height*-m;var b=4*this.currentBatchSize*this.vertSize,n=a.worldTransform,m=n.a,l=n.c,o=n.b,x=n.d,v=n.tx,n=n.ty;p[b++]=
m*f+o*g+v;p[b++]=x*g+l*f+n;p[b++]=c.x0;p[b++]=c.y0;p[b++]=j;p[b++]=k;p[b++]=m*d+o*g+v;p[b++]=x*g+l*d+n;p[b++]=c.x1;p[b++]=c.y1;p[b++]=j;p[b++]=k;p[b++]=m*d+o*h+v;p[b++]=x*h+l*d+n;p[b++]=c.x2;p[b++]=c.y2;p[b++]=j;p[b++]=k;p[b++]=m*f+o*h+v;p[b++]=x*h+l*f+n;p[b++]=c.x3;p[b++]=c.y3;p[b++]=j;p[b++]=k;this.textures[this.currentBatchSize]=a.texture.baseTexture;this.blendModes[this.currentBatchSize]=a.blendMode;this.currentBatchSize++}};c.WebGLSpriteBatch.prototype.renderTilingSprite=function(a){var b=a.tilingTexture;
this.currentBatchSize>=this.size&&(this.flush(),this.currentBaseTexture=b.baseTexture);a._uvs||(a._uvs=new c.TextureUvs);var e=a._uvs;a.tilePosition.x%=b.baseTexture.width*a.tileScaleOffset.x;a.tilePosition.y%=b.baseTexture.height*a.tileScaleOffset.y;var d=a.tilePosition.x/(b.baseTexture.width*a.tileScaleOffset.x),f=a.tilePosition.y/(b.baseTexture.height*a.tileScaleOffset.y),h=a.width/b.baseTexture.width/(a.tileScale.x*a.tileScaleOffset.x),g=a.height/b.baseTexture.height/(a.tileScale.y*a.tileScaleOffset.y);
e.x0=0-d;e.y0=0-f;e.x1=1*h-d;e.y1=0-f;e.x2=1*h-d;e.y2=1*g-f;e.x3=0-d;e.y3=1*g-f;var d=a.worldAlpha,f=a.tint,h=this.vertices,j=a.width,k=a.height,p=a.anchor.x,m=a.anchor.y,g=j*(1-p),j=j*-p,p=k*(1-m),k=k*-m,m=4*this.currentBatchSize*this.vertSize,l=a.worldTransform,n=l.a,o=l.c,x=l.b,v=l.d,y=l.tx,l=l.ty;h[m++]=n*j+x*k+y;h[m++]=v*k+o*j+l;h[m++]=e.x0;h[m++]=e.y0;h[m++]=d;h[m++]=f;h[m++]=n*g+x*k+y;h[m++]=v*k+o*g+l;h[m++]=e.x1;h[m++]=e.y1;h[m++]=d;h[m++]=f;h[m++]=n*g+x*p+y;h[m++]=v*p+o*g+l;h[m++]=e.x2;h[m++]=
e.y2;h[m++]=d;h[m++]=f;h[m++]=n*j+x*p+y;h[m++]=v*p+o*j+l;h[m++]=e.x3;h[m++]=e.y3;h[m++]=d;h[m++]=f;this.textures[this.currentBatchSize]=b.baseTexture;this.blendModes[this.currentBatchSize]=a.blendMode;this.currentBatchSize++};c.WebGLSpriteBatch.prototype.flush=function(){if(0!==this.currentBatchSize){var a=this.gl;if(this.renderSession.shaderManager.setShader(this.renderSession.shaderManager.defaultShader),this.dirty){this.dirty=!1;a.activeTexture(a.TEXTURE0);a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffer);
a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.indexBuffer);var b=this.renderSession.projection;a.uniform2f(this.shader.projectionVector,b.x,b.y);b=4*this.vertSize;a.vertexAttribPointer(this.shader.aVertexPosition,2,a.FLOAT,!1,b,0);a.vertexAttribPointer(this.shader.aTextureCoord,2,a.FLOAT,!1,b,8);a.vertexAttribPointer(this.shader.colorAttribute,2,a.FLOAT,!1,b,16)}this.currentBatchSize>0.5*this.size?a.bufferSubData(a.ARRAY_BUFFER,0,this.vertices):(b=this.vertices.subarray(0,4*this.currentBatchSize*this.vertSize),
a.bufferSubData(a.ARRAY_BUFFER,0,b));for(var c,d,b=a=0,f=null,h=this.renderSession.blendModeManager.currentBlendMode,g=0,j=this.currentBatchSize;j>g;g++)c=this.textures[g],d=this.blendModes[g],(f!==c||h!==d)&&(this.renderBatch(f,a,b),b=g,a=0,f=c,h=d,this.renderSession.blendModeManager.setBlendMode(h)),a++;this.renderBatch(f,a,b);this.currentBatchSize=0}};c.WebGLSpriteBatch.prototype.renderBatch=function(a,b,e){if(0!==b){var d=this.gl;d.bindTexture(d.TEXTURE_2D,a._glTextures[d.id]||c.createWebGLTexture(a,
d));a._dirty[d.id]&&c.updateWebGLTexture(this.currentBaseTexture,d);d.drawElements(d.TRIANGLES,6*b,d.UNSIGNED_SHORT,12*e);this.renderSession.drawCount++}};c.WebGLSpriteBatch.prototype.stop=function(){this.flush()};c.WebGLSpriteBatch.prototype.start=function(){this.dirty=!0};c.WebGLSpriteBatch.prototype.destroy=function(){this.vertices=null;this.indices=null;this.gl.deleteBuffer(this.vertexBuffer);this.gl.deleteBuffer(this.indexBuffer);this.currentBaseTexture=null;this.gl=null};c.WebGLFastSpriteBatch=
function(a){this.vertSize=10;this.maxSize=6E3;this.size=this.maxSize;var b=6*this.maxSize;this.vertices=new Float32Array(4*this.size*this.vertSize);this.indices=new Uint16Array(b);this.vertexBuffer=null;this.indexBuffer=null;this.lastIndexCount=0;for(var c=0,d=0;b>c;c+=6,d+=4)this.indices[c+0]=d+0,this.indices[c+1]=d+1,this.indices[c+2]=d+2,this.indices[c+3]=d+0,this.indices[c+4]=d+2,this.indices[c+5]=d+3;this.drawing=!1;this.currentBatchSize=0;this.currentBaseTexture=null;this.currentBlendMode=0;
this.renderSession=null;this.shader=null;this.matrix=null;this.setContext(a)};c.WebGLFastSpriteBatch.prototype.setContext=function(a){this.gl=a;this.vertexBuffer=a.createBuffer();this.indexBuffer=a.createBuffer();a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.indexBuffer);a.bufferData(a.ELEMENT_ARRAY_BUFFER,this.indices,a.STATIC_DRAW);a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffer);a.bufferData(a.ARRAY_BUFFER,this.vertices,a.DYNAMIC_DRAW)};c.WebGLFastSpriteBatch.prototype.begin=function(a,b){this.renderSession=
b;this.shader=this.renderSession.shaderManager.fastShader;this.matrix=a.worldTransform.toArray(!0);this.start()};c.WebGLFastSpriteBatch.prototype.end=function(){this.flush()};c.WebGLFastSpriteBatch.prototype.render=function(a){var a=a.children,b=a[0];if(b.texture._uvs){this.currentBaseTexture=b.texture.baseTexture;b.blendMode!==this.renderSession.blendModeManager.currentBlendMode&&(this.flush(),this.renderSession.blendModeManager.setBlendMode(b.blendMode));for(var b=0,c=a.length;c>b;b++)this.renderSprite(a[b]);
this.flush()}};c.WebGLFastSpriteBatch.prototype.renderSprite=function(a){if(a.visible&&(a.texture.baseTexture===this.currentBaseTexture||(this.flush(),this.currentBaseTexture=a.texture.baseTexture,a.texture._uvs))){var b,c,d,f,h,g,j=this.vertices;(b=a.texture._uvs,a.texture.trim)?(f=a.texture.trim,d=f.x-a.anchor.x*f.width,c=d+a.texture.crop.width,h=f.y-a.anchor.y*f.height,f=h+a.texture.crop.height):(c=a.texture.frame.width*(1-a.anchor.x),d=a.texture.frame.width*-a.anchor.x,f=a.texture.frame.height*
(1-a.anchor.y),h=a.texture.frame.height*-a.anchor.y);g=4*this.currentBatchSize*this.vertSize;j[g++]=d;j[g++]=h;j[g++]=a.position.x;j[g++]=a.position.y;j[g++]=a.scale.x;j[g++]=a.scale.y;j[g++]=a.rotation;j[g++]=b.x0;j[g++]=b.y1;j[g++]=a.alpha;j[g++]=c;j[g++]=h;j[g++]=a.position.x;j[g++]=a.position.y;j[g++]=a.scale.x;j[g++]=a.scale.y;j[g++]=a.rotation;j[g++]=b.x1;j[g++]=b.y1;j[g++]=a.alpha;j[g++]=c;j[g++]=f;j[g++]=a.position.x;j[g++]=a.position.y;j[g++]=a.scale.x;j[g++]=a.scale.y;j[g++]=a.rotation;
j[g++]=b.x2;j[g++]=b.y2;j[g++]=a.alpha;j[g++]=d;j[g++]=f;j[g++]=a.position.x;j[g++]=a.position.y;j[g++]=a.scale.x;j[g++]=a.scale.y;j[g++]=a.rotation;j[g++]=b.x3;j[g++]=b.y3;j[g++]=a.alpha;this.currentBatchSize++;this.currentBatchSize>=this.size&&this.flush()}};c.WebGLFastSpriteBatch.prototype.flush=function(){if(0!==this.currentBatchSize){var a=this.gl;if(this.currentBaseTexture._glTextures[a.id]||c.createWebGLTexture(this.currentBaseTexture,a),a.bindTexture(a.TEXTURE_2D,this.currentBaseTexture._glTextures[a.id]),
this.currentBatchSize>0.5*this.size)a.bufferSubData(a.ARRAY_BUFFER,0,this.vertices);else{var b=this.vertices.subarray(0,4*this.currentBatchSize*this.vertSize);a.bufferSubData(a.ARRAY_BUFFER,0,b)}a.drawElements(a.TRIANGLES,6*this.currentBatchSize,a.UNSIGNED_SHORT,0);this.currentBatchSize=0;this.renderSession.drawCount++}};c.WebGLFastSpriteBatch.prototype.stop=function(){this.flush()};c.WebGLFastSpriteBatch.prototype.start=function(){var a=this.gl;a.activeTexture(a.TEXTURE0);a.bindBuffer(a.ARRAY_BUFFER,
this.vertexBuffer);a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.indexBuffer);var b=this.renderSession.projection;a.uniform2f(this.shader.projectionVector,b.x,b.y);a.uniformMatrix3fv(this.shader.uMatrix,!1,this.matrix);b=4*this.vertSize;a.vertexAttribPointer(this.shader.aVertexPosition,2,a.FLOAT,!1,b,0);a.vertexAttribPointer(this.shader.aPositionCoord,2,a.FLOAT,!1,b,8);a.vertexAttribPointer(this.shader.aScale,2,a.FLOAT,!1,b,16);a.vertexAttribPointer(this.shader.aRotation,1,a.FLOAT,!1,b,24);a.vertexAttribPointer(this.shader.aTextureCoord,
2,a.FLOAT,!1,b,28);a.vertexAttribPointer(this.shader.colorAttribute,1,a.FLOAT,!1,b,36)};c.WebGLFilterManager=function(a,b){this.transparent=b;this.filterStack=[];this.offsetX=0;this.offsetY=0;this.setContext(a)};c.WebGLFilterManager.prototype.setContext=function(a){this.gl=a;this.texturePool=[];this.initShaderBuffers()};c.WebGLFilterManager.prototype.begin=function(a,b){this.renderSession=a;this.defaultShader=a.shaderManager.defaultShader;var c=this.renderSession.projection;this.width=2*c.x;this.height=
2*-c.y;this.buffer=b};c.WebGLFilterManager.prototype.pushFilter=function(a){var b=this.gl,e=this.renderSession.projection,d=this.renderSession.offset;a._filterArea=a.target.filterArea||a.target.getBounds();this.filterStack.push(a);var f=a.filterPasses[0];this.offsetX+=a._filterArea.x;this.offsetY+=a._filterArea.y;var h=this.texturePool.pop();h?h.resize(this.width,this.height):h=new c.FilterTexture(this.gl,this.width,this.height);b.bindTexture(b.TEXTURE_2D,h.texture);var g=a._filterArea,f=f.padding;
g.x-=f;g.y-=f;g.width+=2*f;g.height+=2*f;0>g.x&&(g.x=0);g.width>this.width&&(g.width=this.width);0>g.y&&(g.y=0);g.height>this.height&&(g.height=this.height);b.bindFramebuffer(b.FRAMEBUFFER,h.frameBuffer);b.viewport(0,0,g.width,g.height);e.x=g.width/2;e.y=-g.height/2;d.x=-g.x;d.y=-g.y;this.renderSession.shaderManager.setShader(this.defaultShader);b.uniform2f(this.defaultShader.projectionVector,g.width/2,-g.height/2);b.uniform2f(this.defaultShader.offsetVector,-g.x,-g.y);b.colorMask(!0,!0,!0,!0);b.clearColor(0,
0,0,0);b.clear(b.COLOR_BUFFER_BIT);a._glFilterTexture=h};c.WebGLFilterManager.prototype.popFilter=function(){var a=this.gl,b=this.filterStack.pop(),e=b._filterArea,d=b._glFilterTexture,f=this.renderSession.projection,h=this.renderSession.offset;if(1<b.filterPasses.length){a.viewport(0,0,e.width,e.height);a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffer);this.vertexArray[0]=0;this.vertexArray[1]=e.height;this.vertexArray[2]=e.width;this.vertexArray[3]=e.height;this.vertexArray[4]=0;this.vertexArray[5]=
0;this.vertexArray[6]=e.width;this.vertexArray[7]=0;a.bufferSubData(a.ARRAY_BUFFER,0,this.vertexArray);a.bindBuffer(a.ARRAY_BUFFER,this.uvBuffer);this.uvArray[2]=e.width/this.width;this.uvArray[5]=e.height/this.height;this.uvArray[6]=e.width/this.width;this.uvArray[7]=e.height/this.height;a.bufferSubData(a.ARRAY_BUFFER,0,this.uvArray);var g=this.texturePool.pop();g||(g=new c.FilterTexture(this.gl,this.width,this.height));g.resize(this.width,this.height);a.bindFramebuffer(a.FRAMEBUFFER,g.frameBuffer);
a.clear(a.COLOR_BUFFER_BIT);a.disable(a.BLEND);for(var j=0;j<b.filterPasses.length-1;j++){var k=b.filterPasses[j];a.bindFramebuffer(a.FRAMEBUFFER,g.frameBuffer);a.activeTexture(a.TEXTURE0);a.bindTexture(a.TEXTURE_2D,d.texture);this.applyFilterPass(k,e,e.width,e.height);k=d;d=g;g=k}a.enable(a.BLEND);this.texturePool.push(g)}g=b.filterPasses[b.filterPasses.length-1];this.offsetX-=e.x;this.offsetY-=e.y;var j=this.width,k=this.height,p=0,m=0,l=this.buffer;0===this.filterStack.length?a.colorMask(!0,!0,
!0,!0):(l=this.filterStack[this.filterStack.length-1],e=l._filterArea,j=e.width,k=e.height,p=e.x,m=e.y,l=l._glFilterTexture.frameBuffer);f.x=j/2;f.y=-k/2;h.x=p;h.y=m;e=b._filterArea;f=e.x-p;h=e.y-m;a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffer);this.vertexArray[0]=f;this.vertexArray[1]=h+e.height;this.vertexArray[2]=f+e.width;this.vertexArray[3]=h+e.height;this.vertexArray[4]=f;this.vertexArray[5]=h;this.vertexArray[6]=f+e.width;this.vertexArray[7]=h;a.bufferSubData(a.ARRAY_BUFFER,0,this.vertexArray);
a.bindBuffer(a.ARRAY_BUFFER,this.uvBuffer);this.uvArray[2]=e.width/this.width;this.uvArray[5]=e.height/this.height;this.uvArray[6]=e.width/this.width;this.uvArray[7]=e.height/this.height;a.bufferSubData(a.ARRAY_BUFFER,0,this.uvArray);a.viewport(0,0,j,k);a.bindFramebuffer(a.FRAMEBUFFER,l);a.activeTexture(a.TEXTURE0);a.bindTexture(a.TEXTURE_2D,d.texture);this.applyFilterPass(g,e,j,k);this.renderSession.shaderManager.setShader(this.defaultShader);a.uniform2f(this.defaultShader.projectionVector,j/2,-k/
2);a.uniform2f(this.defaultShader.offsetVector,-p,-m);this.texturePool.push(d);b._glFilterTexture=null};c.WebGLFilterManager.prototype.applyFilterPass=function(a,b,e,d){var b=this.gl,f=a.shaders[b.id];f||(f=new c.PixiShader(b),f.fragmentSrc=a.fragmentSrc,f.uniforms=a.uniforms,f.init(),a.shaders[b.id]=f);this.renderSession.shaderManager.setShader(f);b.uniform2f(f.projectionVector,e/2,-d/2);b.uniform2f(f.offsetVector,0,0);a.uniforms.dimensions&&(a.uniforms.dimensions.value[0]=this.width,a.uniforms.dimensions.value[1]=
this.height,a.uniforms.dimensions.value[2]=this.vertexArray[0],a.uniforms.dimensions.value[3]=this.vertexArray[5]);f.syncUniforms();b.bindBuffer(b.ARRAY_BUFFER,this.vertexBuffer);b.vertexAttribPointer(f.aVertexPosition,2,b.FLOAT,!1,0,0);b.bindBuffer(b.ARRAY_BUFFER,this.uvBuffer);b.vertexAttribPointer(f.aTextureCoord,2,b.FLOAT,!1,0,0);b.bindBuffer(b.ARRAY_BUFFER,this.colorBuffer);b.vertexAttribPointer(f.colorAttribute,2,b.FLOAT,!1,0,0);b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,this.indexBuffer);b.drawElements(b.TRIANGLES,
6,b.UNSIGNED_SHORT,0);this.renderSession.drawCount++};c.WebGLFilterManager.prototype.initShaderBuffers=function(){var a=this.gl;this.vertexBuffer=a.createBuffer();this.uvBuffer=a.createBuffer();this.colorBuffer=a.createBuffer();this.indexBuffer=a.createBuffer();this.vertexArray=new Float32Array([0,0,1,0,0,1,1,1]);a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffer);a.bufferData(a.ARRAY_BUFFER,this.vertexArray,a.STATIC_DRAW);this.uvArray=new Float32Array([0,0,1,0,0,1,1,1]);a.bindBuffer(a.ARRAY_BUFFER,this.uvBuffer);
a.bufferData(a.ARRAY_BUFFER,this.uvArray,a.STATIC_DRAW);this.colorArray=new Float32Array([1,16777215,1,16777215,1,16777215,1,16777215]);a.bindBuffer(a.ARRAY_BUFFER,this.colorBuffer);a.bufferData(a.ARRAY_BUFFER,this.colorArray,a.STATIC_DRAW);a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.indexBuffer);a.bufferData(a.ELEMENT_ARRAY_BUFFER,new Uint16Array([0,1,2,1,3,2]),a.STATIC_DRAW)};c.WebGLFilterManager.prototype.destroy=function(){var a=this.gl;this.filterStack=null;this.offsetX=0;this.offsetY=0;for(var b=
0;b<this.texturePool.length;b++)this.texturePool[b].destroy();this.texturePool=null;a.deleteBuffer(this.vertexBuffer);a.deleteBuffer(this.uvBuffer);a.deleteBuffer(this.colorBuffer);a.deleteBuffer(this.indexBuffer)};c.FilterTexture=function(a,b,e,d){this.gl=a;this.frameBuffer=a.createFramebuffer();this.texture=a.createTexture();d=d||c.scaleModes.DEFAULT;a.bindTexture(a.TEXTURE_2D,this.texture);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,d===c.scaleModes.LINEAR?a.LINEAR:a.NEAREST);a.texParameteri(a.TEXTURE_2D,
a.TEXTURE_MIN_FILTER,d===c.scaleModes.LINEAR?a.LINEAR:a.NEAREST);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE);a.bindFramebuffer(a.FRAMEBUFFER,this.framebuffer);a.bindFramebuffer(a.FRAMEBUFFER,this.frameBuffer);a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,this.texture,0);this.renderBuffer=a.createRenderbuffer();a.bindRenderbuffer(a.RENDERBUFFER,this.renderBuffer);a.framebufferRenderbuffer(a.FRAMEBUFFER,
a.DEPTH_STENCIL_ATTACHMENT,a.RENDERBUFFER,this.renderBuffer);this.resize(b,e)};c.FilterTexture.prototype.clear=function(){var a=this.gl;a.clearColor(0,0,0,0);a.clear(a.COLOR_BUFFER_BIT)};c.FilterTexture.prototype.resize=function(a,b){if(this.width!==a||this.height!==b){this.width=a;this.height=b;var c=this.gl;c.bindTexture(c.TEXTURE_2D,this.texture);c.texImage2D(c.TEXTURE_2D,0,c.RGBA,a,b,0,c.RGBA,c.UNSIGNED_BYTE,null);c.bindRenderbuffer(c.RENDERBUFFER,this.renderBuffer);c.renderbufferStorage(c.RENDERBUFFER,
c.DEPTH_STENCIL,a,b)}};c.FilterTexture.prototype.destroy=function(){var a=this.gl;a.deleteFramebuffer(this.frameBuffer);a.deleteTexture(this.texture);this.frameBuffer=null;this.texture=null};c.CanvasMaskManager=function(){};c.CanvasMaskManager.prototype.pushMask=function(a,b){b.save();var e=a.alpha,d=a.worldTransform;b.setTransform(d.a,d.c,d.b,d.d,d.tx,d.ty);c.CanvasGraphics.renderGraphicsMask(a,b);b.clip();a.worldAlpha=e};c.CanvasMaskManager.prototype.popMask=function(a){a.restore()};c.CanvasTinter=
function(){};c.CanvasTinter.getTintedTexture=function(a,b){var e=a.texture,b=c.CanvasTinter.roundColor(b),d="#"+("00000"+(0|b).toString(16)).substr(-6);if(e.tintCache=e.tintCache||{},e.tintCache[d])return e.tintCache[d];var f=c.CanvasTinter.canvas||document.createElement("canvas");if(c.CanvasTinter.tintMethod(e,b,f),c.CanvasTinter.convertTintToImage){var h=new Image;h.src=f.toDataURL();e.tintCache[d]=h}else e.tintCache[d]=f,c.CanvasTinter.canvas=null;return f};c.CanvasTinter.tintWithMultiply=function(a,
b,c){var d=c.getContext("2d"),f=a.frame;c.width=f.width;c.height=f.height;d.fillStyle="#"+("00000"+(0|b).toString(16)).substr(-6);d.fillRect(0,0,f.width,f.height);d.globalCompositeOperation="multiply";d.drawImage(a.baseTexture.source,f.x,f.y,f.width,f.height,0,0,f.width,f.height);d.globalCompositeOperation="destination-atop";d.drawImage(a.baseTexture.source,f.x,f.y,f.width,f.height,0,0,f.width,f.height)};c.CanvasTinter.tintWithOverlay=function(a,b,c){var d=c.getContext("2d"),f=a.frame;c.width=f.width;
c.height=f.height;d.globalCompositeOperation="copy";d.fillStyle="#"+("00000"+(0|b).toString(16)).substr(-6);d.fillRect(0,0,f.width,f.height);d.globalCompositeOperation="destination-atop";d.drawImage(a.baseTexture.source,f.x,f.y,f.width,f.height,0,0,f.width,f.height)};c.CanvasTinter.tintWithPerPixel=function(a,b,e){var d=e.getContext("2d"),f=a.frame;e.width=f.width;e.height=f.height;d.globalCompositeOperation="copy";d.drawImage(a.baseTexture.source,f.x,f.y,f.width,f.height,0,0,f.width,f.height);for(var e=
c.hex2rgb(b),a=e[0],b=e[1],e=e[2],f=d.getImageData(0,0,f.width,f.height),h=f.data,g=0;g<h.length;g+=4)h[g+0]*=a,h[g+1]*=b,h[g+2]*=e;d.putImageData(f,0,0)};c.CanvasTinter.roundColor=function(a){var b=c.CanvasTinter.cacheStepsPerColorChannel,a=c.hex2rgb(a);return a[0]=Math.min(255,a[0]/b*b),a[1]=Math.min(255,a[1]/b*b),a[2]=Math.min(255,a[2]/b*b),c.rgb2hex(a)};c.CanvasTinter.cacheStepsPerColorChannel=8;c.CanvasTinter.convertTintToImage=!1;c.CanvasTinter.canUseMultiply=c.canUseNewCanvasBlendModes();c.CanvasTinter.tintMethod=
c.CanvasTinter.canUseMultiply?c.CanvasTinter.tintWithMultiply:c.CanvasTinter.tintWithPerPixel;c.CanvasRenderer=function(a,b,e,d){c.defaultRenderer||(c.sayHello("Canvas"),c.defaultRenderer=this);this.type=c.CANVAS_RENDERER;this.clearBeforeRender=!0;this.transparent=!!d;c.blendModesCanvas||(c.blendModesCanvas=[],c.canUseNewCanvasBlendModes()?(c.blendModesCanvas[c.blendModes.NORMAL]="source-over",c.blendModesCanvas[c.blendModes.ADD]="lighter",c.blendModesCanvas[c.blendModes.MULTIPLY]="multiply",c.blendModesCanvas[c.blendModes.SCREEN]=
"screen",c.blendModesCanvas[c.blendModes.OVERLAY]="overlay",c.blendModesCanvas[c.blendModes.DARKEN]="darken",c.blendModesCanvas[c.blendModes.LIGHTEN]="lighten",c.blendModesCanvas[c.blendModes.COLOR_DODGE]="color-dodge",c.blendModesCanvas[c.blendModes.COLOR_BURN]="color-burn",c.blendModesCanvas[c.blendModes.HARD_LIGHT]="hard-light",c.blendModesCanvas[c.blendModes.SOFT_LIGHT]="soft-light",c.blendModesCanvas[c.blendModes.DIFFERENCE]="difference",c.blendModesCanvas[c.blendModes.EXCLUSION]="exclusion",
c.blendModesCanvas[c.blendModes.HUE]="hue",c.blendModesCanvas[c.blendModes.SATURATION]="saturation",c.blendModesCanvas[c.blendModes.COLOR]="color",c.blendModesCanvas[c.blendModes.LUMINOSITY]="luminosity"):(c.blendModesCanvas[c.blendModes.NORMAL]="source-over",c.blendModesCanvas[c.blendModes.ADD]="lighter",c.blendModesCanvas[c.blendModes.MULTIPLY]="source-over",c.blendModesCanvas[c.blendModes.SCREEN]="source-over",c.blendModesCanvas[c.blendModes.OVERLAY]="source-over",c.blendModesCanvas[c.blendModes.DARKEN]=
"source-over",c.blendModesCanvas[c.blendModes.LIGHTEN]="source-over",c.blendModesCanvas[c.blendModes.COLOR_DODGE]="source-over",c.blendModesCanvas[c.blendModes.COLOR_BURN]="source-over",c.blendModesCanvas[c.blendModes.HARD_LIGHT]="source-over",c.blendModesCanvas[c.blendModes.SOFT_LIGHT]="source-over",c.blendModesCanvas[c.blendModes.DIFFERENCE]="source-over",c.blendModesCanvas[c.blendModes.EXCLUSION]="source-over",c.blendModesCanvas[c.blendModes.HUE]="source-over",c.blendModesCanvas[c.blendModes.SATURATION]=
"source-over",c.blendModesCanvas[c.blendModes.COLOR]="source-over",c.blendModesCanvas[c.blendModes.LUMINOSITY]="source-over"));this.width=a||800;this.height=b||600;this.view=e||document.createElement("canvas");this.context=this.view.getContext("2d",{alpha:this.transparent});this.refresh=!0;this.view.width=this.width;this.view.height=this.height;this.count=0;this.maskManager=new c.CanvasMaskManager;this.renderSession={context:this.context,maskManager:this.maskManager,scaleMode:null,smoothProperty:null,
roundPixels:!1};"imageSmoothingEnabled"in this.context?this.renderSession.smoothProperty="imageSmoothingEnabled":"webkitImageSmoothingEnabled"in this.context?this.renderSession.smoothProperty="webkitImageSmoothingEnabled":"mozImageSmoothingEnabled"in this.context?this.renderSession.smoothProperty="mozImageSmoothingEnabled":"oImageSmoothingEnabled"in this.context&&(this.renderSession.smoothProperty="oImageSmoothingEnabled")};c.CanvasRenderer.prototype.constructor=c.CanvasRenderer;c.CanvasRenderer.prototype.render=
function(a){c.texturesToUpdate.length=0;c.texturesToDestroy.length=0;a.updateTransform();this.context.setTransform(1,0,0,1,0,0);this.context.globalAlpha=1;navigator.isCocoonJS&&this.view.screencanvas&&(this.context.fillStyle="black",this.context.clear());!this.transparent&&this.clearBeforeRender?(this.context.fillStyle=a.backgroundColorString,this.context.fillRect(0,0,this.width,this.height)):this.transparent&&this.clearBeforeRender&&this.context.clearRect(0,0,this.width,this.height);this.renderDisplayObject(a);
a.interactive&&(a._interactiveEventsAdded||(a._interactiveEventsAdded=!0,a.interactionManager.setTarget(this)));0<c.Texture.frameUpdates.length&&(c.Texture.frameUpdates.length=0)};c.CanvasRenderer.prototype.resize=function(a,b){this.width=a;this.height=b;this.view.width=a;this.view.height=b};c.CanvasRenderer.prototype.renderDisplayObject=function(a,b){this.renderSession.context=b||this.context;a._renderCanvas(this.renderSession)};c.CanvasRenderer.prototype.renderStripFlat=function(a){var b=this.context,
a=a.verticies,c=a.length/2;this.count++;b.beginPath();for(var d=1;c-2>d;d++){var f=2*d,h=a[f+2],g=a[f+4],j=a[f+3],k=a[f+5];b.moveTo(a[f],a[f+1]);b.lineTo(h,j);b.lineTo(g,k)}b.fillStyle="#FF0000";b.fill();b.closePath()};c.CanvasRenderer.prototype.renderStrip=function(a){var b=this.context,c=a.verticies,d=a.uvs,f=c.length/2;this.count++;for(var h=1;f-2>h;h++){var g=2*h,j=c[g],k=c[g+2],m=c[g+4],n=c[g+1],l=c[g+3],o=c[g+5],t=d[g]*a.texture.width,x=d[g+2]*a.texture.width,v=d[g+4]*a.texture.width,y=d[g+
1]*a.texture.height,z=d[g+3]*a.texture.height,g=d[g+5]*a.texture.height;b.save();b.beginPath();b.moveTo(j,n);b.lineTo(k,l);b.lineTo(m,o);b.closePath();b.clip();var G=t*z+y*v+x*g-z*v-y*x-t*g;b.transform((j*z+y*m+k*g-z*m-y*k-j*g)/G,(n*z+y*o+l*g-z*o-y*l-n*g)/G,(t*k+j*v+x*m-k*v-j*x-t*m)/G,(t*l+n*v+x*o-l*v-n*x-t*o)/G,(t*z*m+y*k*v+j*x*g-j*z*v-y*x*m-t*k*g)/G,(t*z*o+y*l*v+n*x*g-n*z*v-y*x*o-t*l*g)/G);b.drawImage(a.texture.baseTexture.source,0,0);b.restore()}};c.CanvasBuffer=function(a,b){this.width=a;this.height=
b;this.canvas=document.createElement("canvas");this.context=this.canvas.getContext("2d");this.canvas.width=a;this.canvas.height=b};c.CanvasBuffer.prototype.clear=function(){this.context.clearRect(0,0,this.width,this.height)};c.CanvasBuffer.prototype.resize=function(a,b){this.width=this.canvas.width=a;this.height=this.canvas.height=b};c.CanvasGraphics=function(){};c.CanvasGraphics.renderGraphics=function(a,b){for(var e=a.worldAlpha,d=0;d<a.graphicsData.length;d++){var f=a.graphicsData[d],h=f.points;
if(b.strokeStyle="#"+("00000"+(0|f.lineColor).toString(16)).substr(-6),b.lineWidth=f.lineWidth,f.type===c.Graphics.POLY){b.beginPath();b.moveTo(h[0],h[1]);for(var g=1;g<h.length/2;g++)b.lineTo(h[2*g],h[2*g+1]);h[0]===h[h.length-2]&&h[1]===h[h.length-1]&&b.closePath();f.fill&&(b.globalAlpha=f.fillAlpha*e,b.fillStyle="#"+("00000"+(0|f.fillColor).toString(16)).substr(-6),b.fill());f.lineWidth&&(b.globalAlpha=f.lineAlpha*e,b.stroke())}else if(f.type===c.Graphics.RECT)(f.fillColor||0===f.fillColor)&&(b.globalAlpha=
f.fillAlpha*e,b.fillStyle="#"+("00000"+(0|f.fillColor).toString(16)).substr(-6),b.fillRect(h[0],h[1],h[2],h[3])),f.lineWidth&&(b.globalAlpha=f.lineAlpha*e,b.strokeRect(h[0],h[1],h[2],h[3]));else if(f.type===c.Graphics.CIRC)b.beginPath(),b.arc(h[0],h[1],h[2],0,2*Math.PI),b.closePath(),f.fill&&(b.globalAlpha=f.fillAlpha*e,b.fillStyle="#"+("00000"+(0|f.fillColor).toString(16)).substr(-6),b.fill()),f.lineWidth&&(b.globalAlpha=f.lineAlpha*e,b.stroke());else if(f.type===c.Graphics.ELIP){var j=f.points,
k=2*j[2],m=2*j[3],g=j[0]-k/2,j=j[1]-m/2;b.beginPath();var n=0.5522848*(k/2),h=0.5522848*(m/2),l=g+k,o=j+m,k=g+k/2,m=j+m/2;b.moveTo(g,m);b.bezierCurveTo(g,m-h,k-n,j,k,j);b.bezierCurveTo(k+n,j,l,m-h,l,m);b.bezierCurveTo(l,m+h,k+n,o,k,o);b.bezierCurveTo(k-n,o,g,m+h,g,m);b.closePath();f.fill&&(b.globalAlpha=f.fillAlpha*e,b.fillStyle="#"+("00000"+(0|f.fillColor).toString(16)).substr(-6),b.fill());f.lineWidth&&(b.globalAlpha=f.lineAlpha*e,b.stroke())}else if(f.type===c.Graphics.RREC)g=h[0],m=h[1],j=h[2],
n=h[3],h=h[4],l=Math.min(j,n)/2|0,h=h>l?l:h,b.beginPath(),b.moveTo(g,m+h),b.lineTo(g,m+n-h),b.quadraticCurveTo(g,m+n,g+h,m+n),b.lineTo(g+j-h,m+n),b.quadraticCurveTo(g+j,m+n,g+j,m+n-h),b.lineTo(g+j,m+h),b.quadraticCurveTo(g+j,m,g+j-h,m),b.lineTo(g+h,m),b.quadraticCurveTo(g,m,g,m+h),b.closePath(),(f.fillColor||0===f.fillColor)&&(b.globalAlpha=f.fillAlpha*e,b.fillStyle="#"+("00000"+(0|f.fillColor).toString(16)).substr(-6),b.fill()),f.lineWidth&&(b.globalAlpha=f.lineAlpha*e,b.stroke())}};c.CanvasGraphics.renderGraphicsMask=
function(a,b){var e=a.graphicsData.length;if(0!==e){1<e&&window.console.log("Pixi.js warning: masks in canvas can only mask using the first path in the graphics object");for(e=0;1>e;e++){var d=a.graphicsData[e],f=d.points;if(d.type===c.Graphics.POLY){b.beginPath();b.moveTo(f[0],f[1]);for(d=1;d<f.length/2;d++)b.lineTo(f[2*d],f[2*d+1]);f[0]===f[f.length-2]&&f[1]===f[f.length-1]&&b.closePath()}else if(d.type===c.Graphics.RECT)b.beginPath(),b.rect(f[0],f[1],f[2],f[3]),b.closePath();else if(d.type===c.Graphics.CIRC)b.beginPath(),
b.arc(f[0],f[1],f[2],0,2*Math.PI),b.closePath();else if(d.type===c.Graphics.ELIP){var h=d.points,g=2*h[2],d=2*h[3],f=h[0]-g/2,h=h[1]-d/2;b.beginPath();var j=0.5522848*(g/2),k=0.5522848*(d/2),m=f+g,n=h+d,g=f+g/2,d=h+d/2;b.moveTo(f,d);b.bezierCurveTo(f,d-k,g-j,h,g,h);b.bezierCurveTo(g+j,h,m,d-k,m,d);b.bezierCurveTo(m,d+k,g+j,n,g,n);b.bezierCurveTo(g-j,n,f,d+k,f,d);b.closePath()}else d.type===c.Graphics.RREC&&(d=f[0],h=f[1],j=f[2],k=f[3],f=f[4],m=Math.min(j,k)/2|0,f=f>m?m:f,b.beginPath(),b.moveTo(d,
h+f),b.lineTo(d,h+k-f),b.quadraticCurveTo(d,h+k,d+f,h+k),b.lineTo(d+j-f,h+k),b.quadraticCurveTo(d+j,h+k,d+j,h+k-f),b.lineTo(d+j,h+f),b.quadraticCurveTo(d+j,h,d+j-f,h),b.lineTo(d+f,h),b.quadraticCurveTo(d,h,d,h+f),b.closePath())}}};c.Graphics=function(){c.DisplayObjectContainer.call(this);this.renderable=!0;this.fillAlpha=1;this.lineWidth=0;this.lineColor="black";this.graphicsData=[];this.tint=16777215;this.blendMode=c.blendModes.NORMAL;this.currentPath={points:[]};this._webGL=[];this.isMask=!1;this.bounds=
null;this.boundsPadding=10;this.dirty=!0};c.Graphics.prototype=Object.create(c.DisplayObjectContainer.prototype);c.Graphics.prototype.constructor=c.Graphics;Object.defineProperty(c.Graphics.prototype,"cacheAsBitmap",{get:function(){return this._cacheAsBitmap},set:function(a){this._cacheAsBitmap=a;this._cacheAsBitmap?this._generateCachedSprite():(this.destroyCachedSprite(),this.dirty=!0)}});c.Graphics.prototype.lineStyle=function(a,b,e){return this.currentPath.points.length||this.graphicsData.pop(),
this.lineWidth=a||0,this.lineColor=b||0,this.lineAlpha=3>arguments.length?1:e,this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[],type:c.Graphics.POLY},this.graphicsData.push(this.currentPath),this};c.Graphics.prototype.moveTo=function(a,b){return this.currentPath.points.length||this.graphicsData.pop(),this.currentPath=this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,
lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[],type:c.Graphics.POLY},this.currentPath.points.push(a,b),this.graphicsData.push(this.currentPath),this};c.Graphics.prototype.lineTo=function(a,b){return this.currentPath.points.push(a,b),this.dirty=!0,this};c.Graphics.prototype.quadraticCurveTo=function(a,b,c,d){0===this.currentPath.points.length&&this.moveTo(0,0);var f,h,g=this.currentPath.points;0===g.length&&this.moveTo(0,0);for(var j=g[g.length-
2],k=g[g.length-1],m=0,n=1;20>=n;n++)m=n/20,f=j+(a-j)*m,h=k+(b-k)*m,g.push(f+(a+(c-a)*m-f)*m,h+(b+(d-b)*m-h)*m);return this.dirty=!0,this};c.Graphics.prototype.bezierCurveTo=function(a,b,c,d,f,h){0===this.currentPath.points.length&&this.moveTo(0,0);for(var g,j,k,m,n,l=this.currentPath.points,o=l[l.length-2],t=l[l.length-1],x=0,v=1;20>v;v++)x=v/20,g=1-x,j=g*g,k=j*g,m=x*x,n=m*x,l.push(k*o+3*j*x*a+3*g*m*c+n*f,k*t+3*j*x*b+3*g*m*d+n*h);return this.dirty=!0,this};c.Graphics.prototype.arcTo=function(a,b,
c,d,f){0===this.currentPath.points.length&&this.moveTo(a,b);var h=this.currentPath.points,g=h[h.length-1]-b,j=h[h.length-2]-a,d=d-b,c=c-a,k=Math.abs(g*c-j*d);if(1.0E-8>k||0===f)h.push(a,b);else{var m=g*g+j*j,n=d*d+c*c,l=g*d+j*c,h=f*Math.sqrt(m)/k,k=f*Math.sqrt(n)/k,m=h*l/m,o=k*l/n,n=h*c+k*j,l=h*d+k*g,t=c*(h+o),h=d*(h+o),k=Math.atan2(g*(k+m)-l,j*(k+m)-n),h=Math.atan2(h-l,t-n);this.arc(n+a,l+b,f,k,h,j*d>c*g)}return this.dirty=!0,this};c.Graphics.prototype.arc=function(a,b,c,d,f,h){var g=a+Math.cos(d)*
c,j=b+Math.sin(d)*c,k=this.currentPath.points;if((0!==k.length&&k[k.length-2]!==g||k[k.length-1]!==j)&&(this.moveTo(g,j),k=this.currentPath.points),d===f)return this;!h&&d>=f?f+=2*Math.PI:h&&f>=d&&(d+=2*Math.PI);var f=h?-1*(d-f):f-d,m=40*(Math.abs(f)/(2*Math.PI));if(0===f)return this;for(var f=f/(2*m),h=2*f,g=Math.cos(f),j=Math.sin(f),m=m-1,n=m%1/m,l=0;m>=l;l++){var o=f+d+h*(l+n*l),t=Math.cos(o),o=-Math.sin(o);k.push((g*t+j*o)*c+a,(g*-o+j*t)*c+b)}return this.dirty=!0,this};c.Graphics.prototype.drawPath=
function(a){return this.currentPath.points.length||this.graphicsData.pop(),this.currentPath=this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[],type:c.Graphics.POLY},this.graphicsData.push(this.currentPath),this.currentPath.points=this.currentPath.points.concat(a),this.dirty=!0,this};c.Graphics.prototype.beginFill=function(a,b){return this.filling=!0,this.fillColor=a||0,this.fillAlpha=
2>arguments.length?1:b,this};c.Graphics.prototype.endFill=function(){return this.filling=!1,this.fillColor=null,this.fillAlpha=1,this};c.Graphics.prototype.drawRect=function(a,b,e,d){return this.currentPath.points.length||this.graphicsData.pop(),this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[a,b,e,d],type:c.Graphics.RECT},this.graphicsData.push(this.currentPath),this.dirty=!0,
this};c.Graphics.prototype.drawRoundedRect=function(a,b,e,d,f){return this.currentPath.points.length||this.graphicsData.pop(),this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[a,b,e,d,f],type:c.Graphics.RREC},this.graphicsData.push(this.currentPath),this.dirty=!0,this};c.Graphics.prototype.drawCircle=function(a,b,e){return this.currentPath.points.length||this.graphicsData.pop(),this.currentPath=
{lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[a,b,e,e],type:c.Graphics.CIRC},this.graphicsData.push(this.currentPath),this.dirty=!0,this};c.Graphics.prototype.drawEllipse=function(a,b,e,d){return this.currentPath.points.length||this.graphicsData.pop(),this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,
fill:this.filling,points:[a,b,e,d],type:c.Graphics.ELIP},this.graphicsData.push(this.currentPath),this.dirty=!0,this};c.Graphics.prototype.clear=function(){return this.lineWidth=0,this.filling=!1,this.dirty=!0,this.clearDirty=!0,this.graphicsData=[],this.bounds=null,this};c.Graphics.prototype.generateTexture=function(){var a=this.getBounds(),b=new c.CanvasBuffer(a.width,a.height),e=c.Texture.fromCanvas(b.canvas);return b.context.translate(-a.x,-a.y),c.CanvasGraphics.renderGraphics(this,b.context),
e};c.Graphics.prototype._renderWebGL=function(a){if(!1!==this.visible&&0!==this.alpha&&!0!==this.isMask){if(this._cacheAsBitmap)return this.dirty&&(this._generateCachedSprite(),c.updateWebGLTexture(this._cachedSprite.texture.baseTexture,a.gl),this.dirty=!1),this._cachedSprite.alpha=this.alpha,c.Sprite.prototype._renderWebGL.call(this._cachedSprite,a),void 0;if(a.spriteBatch.stop(),a.blendModeManager.setBlendMode(this.blendMode),this._mask&&a.maskManager.pushMask(this._mask,a),this._filters&&a.filterManager.pushFilter(this._filterBlock),
this.blendMode!==a.spriteBatch.currentBlendMode){a.spriteBatch.currentBlendMode=this.blendMode;var b=c.blendModesWebGL[a.spriteBatch.currentBlendMode];a.spriteBatch.gl.blendFunc(b[0],b[1])}if(c.WebGLGraphics.renderGraphics(this,a),this.children.length){a.spriteBatch.start();for(var b=0,e=this.children.length;e>b;b++)this.children[b]._renderWebGL(a);a.spriteBatch.stop()}this._filters&&a.filterManager.popFilter();this._mask&&a.maskManager.popMask(this.mask,a);a.drawCount++;a.spriteBatch.start()}};c.Graphics.prototype._renderCanvas=
function(a){if(!1!==this.visible&&0!==this.alpha&&!0!==this.isMask){var b=a.context,e=this.worldTransform;this.blendMode!==a.currentBlendMode&&(a.currentBlendMode=this.blendMode,b.globalCompositeOperation=c.blendModesCanvas[a.currentBlendMode]);this._mask&&a.maskManager.pushMask(this._mask,a.context);b.setTransform(e.a,e.c,e.b,e.d,e.tx,e.ty);c.CanvasGraphics.renderGraphics(this,b);b=0;for(e=this.children.length;e>b;b++)this.children[b]._renderCanvas(a);this._mask&&a.maskManager.popMask(a.context)}};
c.Graphics.prototype.getBounds=function(a){this.bounds||this.updateBounds();var b=this.bounds.x,c=this.bounds.width+this.bounds.x,d=this.bounds.y,f=this.bounds.height+this.bounds.y,a=a||this.worldTransform,h=a.a,g=a.c,j=a.b,k=a.d,m=a.tx,n=a.ty,l=h*c+j*f+m,o=k*f+g*c+n,a=h*b+j*f+m,f=k*f+g*b+n,t=h*b+j*d+m,b=k*d+g*b+n,h=h*c+j*d+m,g=k*d+g*c+n,c=l,d=o;l=l>a?a:l;l=l>t?t:l;l=l>h?h:l;o=o>f?f:o;o=o>b?b:o;o=o>g?g:o;c=a>c?a:c;c=t>c?t:c;c=h>c?h:c;d=f>d?f:d;d=b>d?b:d;d=g>d?g:d;a=this._bounds;return a.x=l,a.width=
c-l,a.y=o,a.height=d-o,a};c.Graphics.prototype.updateBounds=function(){for(var a,b,e,d,f,h=1/0,g=-1/0,j=1/0,k=-1/0,m=0;m<this.graphicsData.length;m++){a=this.graphicsData[m];var n=a.type,l=a.lineWidth;if(a=a.points,n===c.Graphics.RECT)b=a[0]-l/2,e=a[1]-l/2,d=a[2]+l,f=a[3]+l,h=h>b?b:h,g=b+d>g?b+d:g,j=j>e?b:j,k=e+f>k?e+f:k;else if(n===c.Graphics.CIRC||n===c.Graphics.ELIP)b=a[0],e=a[1],d=a[2]+l/2,f=a[3]+l/2,h=h>b-d?b-d:h,g=b+d>g?b+d:g,j=j>e-f?e-f:j,k=e+f>k?e+f:k;else for(n=0;n<a.length;n+=2)b=a[n],e=
a[n+1],h=h>b-l?b-l:h,g=b+l>g?b+l:g,j=j>e-l?e-l:j,k=e+l>k?e+l:k}b=this.boundsPadding;this.bounds=new c.Rectangle(h-b,j-b,g-h+2*b,k-j+2*b)};c.Graphics.prototype._generateCachedSprite=function(){var a=this.getLocalBounds();if(this._cachedSprite)this._cachedSprite.buffer.resize(a.width,a.height);else{var b=new c.CanvasBuffer(a.width,a.height),e=c.Texture.fromCanvas(b.canvas);this._cachedSprite=new c.Sprite(e);this._cachedSprite.buffer=b;this._cachedSprite.worldTransform=this.worldTransform}this._cachedSprite.anchor.x=
-(a.x/a.width);this._cachedSprite.anchor.y=-(a.y/a.height);this._cachedSprite.buffer.context.translate(-a.x,-a.y);c.CanvasGraphics.renderGraphics(this,this._cachedSprite.buffer.context);this._cachedSprite.alpha=this.alpha};c.Graphics.prototype.destroyCachedSprite=function(){this._cachedSprite.texture.destroy(!0);this._cachedSprite=null};c.Graphics.POLY=0;c.Graphics.RECT=1;c.Graphics.CIRC=2;c.Graphics.ELIP=3;c.Graphics.RREC=4;c.Strip=function(a){c.DisplayObjectContainer.call(this);this.texture=a;this.uvs=
new c.Float32Array([0,1,1,1,1,0,0,1]);this.verticies=new c.Float32Array([0,0,100,0,100,100,0,100]);this.colors=new c.Float32Array([1,1,1,1]);this.indices=new c.Uint16Array([0,1,2,3]);this.dirty=!0};c.Strip.prototype=Object.create(c.DisplayObjectContainer.prototype);c.Strip.prototype.constructor=c.Strip;c.Strip.prototype._renderWebGL=function(a){!this.visible||0>=this.alpha||(a.spriteBatch.stop(),this._vertexBuffer||this._initWebGL(a),a.shaderManager.setShader(a.shaderManager.stripShader),this._renderStrip(a),
a.spriteBatch.start())};c.Strip.prototype._initWebGL=function(a){a=a.gl;this._vertexBuffer=a.createBuffer();this._indexBuffer=a.createBuffer();this._uvBuffer=a.createBuffer();this._colorBuffer=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,this._vertexBuffer);a.bufferData(a.ARRAY_BUFFER,this.verticies,a.DYNAMIC_DRAW);a.bindBuffer(a.ARRAY_BUFFER,this._uvBuffer);a.bufferData(a.ARRAY_BUFFER,this.uvs,a.STATIC_DRAW);a.bindBuffer(a.ARRAY_BUFFER,this._colorBuffer);a.bufferData(a.ARRAY_BUFFER,this.colors,a.STATIC_DRAW);
a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this._indexBuffer);a.bufferData(a.ELEMENT_ARRAY_BUFFER,this.indices,a.STATIC_DRAW)};c.Strip.prototype._renderStrip=function(a){var b=a.gl,e=a.projection,d=a.offset,a=a.shaderManager.stripShader;b.blendFunc(b.ONE,b.ONE_MINUS_SRC_ALPHA);b.uniformMatrix3fv(a.translationMatrix,!1,this.worldTransform.toArray(!0));b.uniform2f(a.projectionVector,e.x,-e.y);b.uniform2f(a.offsetVector,-d.x,-d.y);b.uniform1f(a.alpha,1);this.dirty?(this.dirty=!1,b.bindBuffer(b.ARRAY_BUFFER,
this._vertexBuffer),b.bufferData(b.ARRAY_BUFFER,this.verticies,b.STATIC_DRAW),b.vertexAttribPointer(a.aVertexPosition,2,b.FLOAT,!1,0,0),b.bindBuffer(b.ARRAY_BUFFER,this._uvBuffer),b.bufferData(b.ARRAY_BUFFER,this.uvs,b.STATIC_DRAW),b.vertexAttribPointer(a.aTextureCoord,2,b.FLOAT,!1,0,0),b.activeTexture(b.TEXTURE0),b.bindTexture(b.TEXTURE_2D,this.texture.baseTexture._glTextures[b.id]||c.createWebGLTexture(this.texture.baseTexture,b)),b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,this._indexBuffer),b.bufferData(b.ELEMENT_ARRAY_BUFFER,
this.indices,b.STATIC_DRAW)):(b.bindBuffer(b.ARRAY_BUFFER,this._vertexBuffer),b.bufferSubData(b.ARRAY_BUFFER,0,this.verticies),b.vertexAttribPointer(a.aVertexPosition,2,b.FLOAT,!1,0,0),b.bindBuffer(b.ARRAY_BUFFER,this._uvBuffer),b.vertexAttribPointer(a.aTextureCoord,2,b.FLOAT,!1,0,0),b.activeTexture(b.TEXTURE0),b.bindTexture(b.TEXTURE_2D,this.texture.baseTexture._glTextures[b.id]||c.createWebGLTexture(this.texture.baseTexture,b)),b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,this._indexBuffer));b.drawElements(b.TRIANGLE_STRIP,
this.indices.length,b.UNSIGNED_SHORT,0)};c.Strip.prototype._renderCanvas=function(a){var b=a.context,c=this.worldTransform;a.roundPixels?b.setTransform(c.a,c.c,c.b,c.d,0|c.tx,0|c.ty):b.setTransform(c.a,c.c,c.b,c.d,c.tx,c.ty);var a=this.verticies,c=this.uvs,d=a.length/2;this.count++;for(var f=0;d-2>f;f++){var h=2*f,g=a[h],j=a[h+2],k=a[h+4],m=a[h+1],n=a[h+3],l=a[h+5],o=(g+j+k)/3,t=(m+n+l)/3,x=g-o,v=m-t,y=Math.sqrt(x*x+v*v);g=o+x/y*(y+3);m=t+v/y*(y+3);x=j-o;v=n-t;y=Math.sqrt(x*x+v*v);j=o+x/y*(y+3);n=
t+v/y*(y+3);x=k-o;v=l-t;y=Math.sqrt(x*x+v*v);k=o+x/y*(y+3);l=t+v/y*(y+3);o=c[h]*this.texture.width;t=c[h+2]*this.texture.width;x=c[h+4]*this.texture.width;v=c[h+1]*this.texture.height;y=c[h+3]*this.texture.height;h=c[h+5]*this.texture.height;b.save();b.beginPath();b.moveTo(g,m);b.lineTo(j,n);b.lineTo(k,l);b.closePath();b.clip();var z=o*y+v*x+t*h-y*x-v*t-o*h;b.transform((g*y+v*k+j*h-y*k-v*j-g*h)/z,(m*y+v*l+n*h-y*l-v*n-m*h)/z,(o*j+g*x+t*k-j*x-g*t-o*k)/z,(o*n+m*x+t*l-n*x-m*t-o*l)/z,(o*y*k+v*j*x+g*t*
h-g*y*x-v*t*k-o*j*h)/z,(o*y*l+v*n*x+m*t*h-m*y*x-v*t*l-o*n*h)/z);b.drawImage(this.texture.baseTexture.source,0,0);b.restore()}};c.Strip.prototype.onTextureUpdate=function(){this.updateFrame=!0};c.Rope=function(a,b){c.Strip.call(this,a);this.points=b;this.verticies=new c.Float32Array(4*b.length);this.uvs=new c.Float32Array(4*b.length);this.colors=new c.Float32Array(2*b.length);this.indices=new c.Uint16Array(2*b.length);this.refresh()};c.Rope.prototype=Object.create(c.Strip.prototype);c.Rope.prototype.constructor=
c.Rope;c.Rope.prototype.refresh=function(){var a=this.points;if(!(1>a.length)){var b=this.uvs,c=this.indices,d=this.colors;this.count-=0.2;b[0]=0;b[1]=0;b[2]=0;b[3]=1;d[0]=1;d[1]=1;c[0]=0;c[1]=1;for(var f,h,a=a.length,g=1;a>g;g++)f=4*g,h=g/(a-1),g%2?(b[f]=h,b[f+1]=0,b[f+2]=h,b[f+3]=1):(b[f]=h,b[f+1]=0,b[f+2]=h,b[f+3]=1),f=2*g,d[f]=1,d[f+1]=1,f=2*g,c[f]=f,c[f+1]=f+1}};c.Rope.prototype.updateTransform=function(){var a=this.points;if(!(1>a.length)){var b,e=a[0],d=0,f=0;this.count-=0.2;for(var h,g,j,
k,m,n=this.verticies,l=a.length,o=0;l>o;o++)h=a[o],g=4*o,b=o<a.length-1?a[o+1]:h,f=-(b.x-e.x),d=b.y-e.y,j=10*(1-o/(l-1)),1<j&&(j=1),k=Math.sqrt(d*d+f*f),m=this.texture.height/2,d/=k,f/=k,d*=m,f*=m,n[g]=h.x+d,n[g+1]=h.y+f,n[g+2]=h.x-d,n[g+3]=h.y-f,e=h;c.DisplayObjectContainer.prototype.updateTransform.call(this)}};c.Rope.prototype.setTexture=function(a){this.texture=a};c.TilingSprite=function(a,b,e){c.Sprite.call(this,a);this._width=b||100;this._height=e||100;this.tileScale=new c.Point(1,1);this.tileScaleOffset=
new c.Point(1,1);this.tilePosition=new c.Point(0,0);this.renderable=!0;this.tint=16777215;this.blendMode=c.blendModes.NORMAL};c.TilingSprite.prototype=Object.create(c.Sprite.prototype);c.TilingSprite.prototype.constructor=c.TilingSprite;Object.defineProperty(c.TilingSprite.prototype,"width",{get:function(){return this._width},set:function(a){this._width=a}});Object.defineProperty(c.TilingSprite.prototype,"height",{get:function(){return this._height},set:function(a){this._height=a}});c.TilingSprite.prototype.setTexture=
function(a){this.texture!==a&&(this.texture=a,this.refreshTexture=!0,this.cachedTint=16777215)};c.TilingSprite.prototype._renderWebGL=function(a){if(!1!==this.visible&&0!==this.alpha){var b,e;for(this._mask&&(a.spriteBatch.stop(),a.maskManager.pushMask(this.mask,a),a.spriteBatch.start()),this._filters&&(a.spriteBatch.flush(),a.filterManager.pushFilter(this._filterBlock)),!this.tilingTexture||this.refreshTexture?(this.generateTilingTexture(!0),this.tilingTexture&&this.tilingTexture.needsUpdate&&(c.updateWebGLTexture(this.tilingTexture.baseTexture,
a.gl),this.tilingTexture.needsUpdate=!1)):a.spriteBatch.renderTilingSprite(this),b=0,e=this.children.length;e>b;b++)this.children[b]._renderWebGL(a);a.spriteBatch.stop();this._filters&&a.filterManager.popFilter();this._mask&&a.maskManager.popMask(a);a.spriteBatch.start()}};c.TilingSprite.prototype._renderCanvas=function(a){if(!1!==this.visible&&0!==this.alpha){var b=a.context;this._mask&&a.maskManager.pushMask(this._mask,b);b.globalAlpha=this.worldAlpha;var e;e=this.worldTransform;if(b.setTransform(e.a,
e.c,e.b,e.d,e.tx,e.ty),!this.__tilePattern||this.refreshTexture){if(this.generateTilingTexture(!1),!this.tilingTexture)return;this.__tilePattern=b.createPattern(this.tilingTexture.baseTexture.source,"repeat")}this.blendMode!==a.currentBlendMode&&(a.currentBlendMode=this.blendMode,b.globalCompositeOperation=c.blendModesCanvas[a.currentBlendMode]);e=this.tilePosition;var d=this.tileScale;for(e.x%=this.tilingTexture.baseTexture.width,e.y%=this.tilingTexture.baseTexture.height,b.scale(d.x,d.y),b.translate(e.x,
e.y),b.fillStyle=this.__tilePattern,b.fillRect(-e.x+this.anchor.x*-this._width,-e.y+this.anchor.y*-this._height,this._width/d.x,this._height/d.y),b.scale(1/d.x,1/d.y),b.translate(-e.x,-e.y),this._mask&&a.maskManager.popMask(a.context),b=0,e=this.children.length;e>b;b++)this.children[b]._renderCanvas(a)}};c.TilingSprite.prototype.getBounds=function(){var a=this._width,b=this._height,c=a*(1-this.anchor.x),d=a*-this.anchor.x,f=b*(1-this.anchor.y),h=b*-this.anchor.y,b=this.worldTransform,g=b.a,j=b.c,
k=b.b,m=b.d,n=b.tx,l=b.ty,b=g*d+k*h+n,a=m*h+j*d+l,o=g*c+k*h+n,h=m*h+j*c+l,t=g*c+k*f+n,c=m*f+j*c+l,g=g*d+k*f+n,k=m*f+j*d+l,d=-1/0,f=-1/0,j=1/0,m=1/0;j=j>b?b:j;j=j>o?o:j;j=j>t?t:j;j=j>g?g:j;m=m>a?a:m;m=m>h?h:m;m=m>c?c:m;m=m>k?k:m;d=b>d?b:d;d=o>d?o:d;d=t>d?t:d;d=g>d?g:d;f=a>f?a:f;f=h>f?h:f;f=c>f?c:f;f=k>f?k:f;b=this._bounds;return b.x=j,b.width=d-j,b.y=m,b.height=f-m,this._currentBounds=b,b};c.TilingSprite.prototype.onTextureUpdate=function(){};c.TilingSprite.prototype.generateTilingTexture=function(a){var b;
if(this.texture.baseTexture.hasLoaded){var e,d,f=this.texture,h=f.frame,g=h.width!==f.baseTexture.width||h.height!==f.baseTexture.height;a?(e=c.getNextPowerOfTwo(h.width),d=c.getNextPowerOfTwo(h.height),(h.width!==e||h.height!==d)&&(a=!0)):g&&(e=h.width,d=h.height,a=!0);this.tilingTexture&&this.tilingTexture.isTiling&&this.tilingTexture.destroy(!0);this.tileScaleOffset.x=1;this.tileScaleOffset.y=1;this.tilingTexture=f;this.refreshTexture=!1;this.tilingTexture.baseTexture._powerOf2=!0}};var k={};k.BoneData=
function(a,b){this.name=a;this.parent=b};k.BoneData.prototype={length:0,x:0,y:0,rotation:0,scaleX:1,scaleY:1};k.SlotData=function(a,b){this.name=a;this.boneData=b};k.SlotData.prototype={r:1,g:1,b:1,a:1,attachmentName:null};k.Bone=function(a,b){this.data=a;this.parent=b;this.setToSetupPose()};k.Bone.yDown=!1;k.Bone.prototype={x:0,y:0,rotation:0,scaleX:1,scaleY:1,m00:0,m01:0,worldX:0,m10:0,m11:0,worldY:0,worldRotation:0,worldScaleX:1,worldScaleY:1,updateWorldTransform:function(a,b){var c=this.parent;
null!=c?(this.worldX=this.x*c.m00+this.y*c.m01+c.worldX,this.worldY=this.x*c.m10+this.y*c.m11+c.worldY,this.worldScaleX=c.worldScaleX*this.scaleX,this.worldScaleY=c.worldScaleY*this.scaleY,this.worldRotation=c.worldRotation+this.rotation):(this.worldX=this.x,this.worldY=this.y,this.worldScaleX=this.scaleX,this.worldScaleY=this.scaleY,this.worldRotation=this.rotation);var d=this.worldRotation*Math.PI/180,c=Math.cos(d),d=Math.sin(d);this.m00=c*this.worldScaleX;this.m10=d*this.worldScaleX;this.m01=-d*
this.worldScaleY;this.m11=c*this.worldScaleY;a&&(this.m00=-this.m00,this.m01=-this.m01);b&&(this.m10=-this.m10,this.m11=-this.m11);k.Bone.yDown&&(this.m10=-this.m10,this.m11=-this.m11)},setToSetupPose:function(){var a=this.data;this.x=a.x;this.y=a.y;this.rotation=a.rotation;this.scaleX=a.scaleX;this.scaleY=a.scaleY}};k.Slot=function(a,b,c){this.data=a;this.skeleton=b;this.bone=c;this.setToSetupPose()};k.Slot.prototype={r:1,g:1,b:1,a:1,_attachmentTime:0,attachment:null,setAttachment:function(a){this.attachment=
a;this._attachmentTime=this.skeleton.time},setAttachmentTime:function(a){this._attachmentTime=this.skeleton.time-a},getAttachmentTime:function(){return this.skeleton.time-this._attachmentTime},setToSetupPose:function(){var a=this.data;this.r=a.r;this.g=a.g;this.b=a.b;this.a=a.a;for(var b=this.skeleton.data.slots,c=0,d=b.length;d>c;c++)if(b[c]==a){this.setAttachment(a.attachmentName?this.skeleton.getAttachmentBySlotIndex(c,a.attachmentName):null);break}}};k.Skin=function(a){this.name=a;this.attachments=
{}};k.Skin.prototype={addAttachment:function(a,b,c){this.attachments[a+":"+b]=c},getAttachment:function(a,b){return this.attachments[a+":"+b]},_attachAll:function(a,b){for(var c in b.attachments){var d=c.indexOf(":"),f=parseInt(c.substring(0,d),10),h=c.substring(d+1),d=a.slots[f];d.attachment&&d.attachment.name==h&&(f=this.getAttachment(f,h))&&d.setAttachment(f)}}};k.Animation=function(a,b,c){this.name=a;this.timelines=b;this.duration=c};k.Animation.prototype={apply:function(a,b,c){c&&this.duration&&
(b%=this.duration);for(var c=this.timelines,d=0,f=c.length;f>d;d++)c[d].apply(a,b,1)},mix:function(a,b,c,d){c&&this.duration&&(b%=this.duration);for(var c=this.timelines,f=0,h=c.length;h>f;f++)c[f].apply(a,b,d)}};k.binarySearch=function(a,b,c){var d=0,f=Math.floor(a.length/c)-2;if(!f)return c;for(var h=f>>>1;;){if(a[(h+1)*c]<=b?d=h+1:f=h,d==f)return(d+1)*c;h=d+f>>>1}};k.linearSearch=function(a,b,c){for(var d=0,f=a.length-c;f>=d;d+=c)if(a[d]>b)return d;return-1};k.Curves=function(a){this.curves=[];
this.curves.length=6*(a-1)};k.Curves.prototype={setLinear:function(a){this.curves[6*a]=0},setStepped:function(a){this.curves[6*a]=-1},setCurve:function(a,b,c,d,f){var h=0.1*0.1,g=0.1*h,j=3*0.1,k=3*h,h=6*h,m=6*g,n=2*-b+d,l=2*-c+f,d=3*(b-d)+1,f=3*(c-f)+1,a=6*a,o=this.curves;o[a]=b*j+n*k+d*g;o[a+1]=c*j+l*k+f*g;o[a+2]=n*h+d*m;o[a+3]=l*h+f*m;o[a+4]=d*m;o[a+5]=f*m},getCurvePercent:function(a,b){var b=0>b?0:1<b?1:b,c=6*a,d=this.curves,f=d[c];if(!f)return b;if(-1==f)return 0;for(var h=d[c+1],g=d[c+2],j=d[c+
3],k=d[c+4],m=d[c+5],c=f,d=h,n=8;;){if(c>=b)return f=c-f,h=d-h,h+(d-h)*(b-f)/(c-f);if(!n)break;n--;f+=g;h+=j;g+=k;j+=m;c+=f;d+=h}return d+(1-d)*(b-c)/(1-c)}};k.RotateTimeline=function(a){this.curves=new k.Curves(a);this.frames=[];this.frames.length=2*a};k.RotateTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/2},setFrame:function(a,b,c){a*=2;this.frames[a]=b;this.frames[a+1]=c},apply:function(a,b,c){var d;d=this.frames;if(!(b<d[0])){a=a.bones[this.boneIndex];if(b>=
d[d.length-2]){for(d=a.data.rotation+d[d.length-1]-a.rotation;180<d;)d-=360;for(;-180>d;)d+=360;return a.rotation+=d*c,void 0}var f=k.binarySearch(d,b,2),h=d[f-1],g=d[f],b=1-(b-g)/(d[f-2]-g);for(b=this.curves.getCurvePercent(f/2-1,b),d=d[f+1]-h;180<d;)d-=360;for(;-180>d;)d+=360;for(d=a.data.rotation+(h+d*b)-a.rotation;180<d;)d-=360;for(;-180>d;)d+=360;a.rotation+=d*c}}};k.TranslateTimeline=function(a){this.curves=new k.Curves(a);this.frames=[];this.frames.length=3*a};k.TranslateTimeline.prototype=
{boneIndex:0,getFrameCount:function(){return this.frames.length/3},setFrame:function(a,b,c,d){a*=3;this.frames[a]=b;this.frames[a+1]=c;this.frames[a+2]=d},apply:function(a,b,c){var d=this.frames;if(!(b<d[0])){a=a.bones[this.boneIndex];if(b>=d[d.length-3])return a.x+=(a.data.x+d[d.length-2]-a.x)*c,a.y+=(a.data.y+d[d.length-1]-a.y)*c,void 0;var f=k.binarySearch(d,b,3),h=d[f-2],g=d[f-1],j=d[f],b=1-(b-j)/(d[f+-3]-j);b=this.curves.getCurvePercent(f/3-1,b);a.x+=(a.data.x+h+(d[f+1]-h)*b-a.x)*c;a.y+=(a.data.y+
g+(d[f+2]-g)*b-a.y)*c}}};k.ScaleTimeline=function(a){this.curves=new k.Curves(a);this.frames=[];this.frames.length=3*a};k.ScaleTimeline.prototype={boneIndex:0,getFrameCount:function(){return this.frames.length/3},setFrame:function(a,b,c,d){a*=3;this.frames[a]=b;this.frames[a+1]=c;this.frames[a+2]=d},apply:function(a,b,c){var d=this.frames;if(!(b<d[0])){a=a.bones[this.boneIndex];if(b>=d[d.length-3])return a.scaleX+=(a.data.scaleX-1+d[d.length-2]-a.scaleX)*c,a.scaleY+=(a.data.scaleY-1+d[d.length-1]-
a.scaleY)*c,void 0;var f=k.binarySearch(d,b,3),h=d[f-2],g=d[f-1],j=d[f],b=1-(b-j)/(d[f+-3]-j);b=this.curves.getCurvePercent(f/3-1,b);a.scaleX+=(a.data.scaleX-1+h+(d[f+1]-h)*b-a.scaleX)*c;a.scaleY+=(a.data.scaleY-1+g+(d[f+2]-g)*b-a.scaleY)*c}}};k.ColorTimeline=function(a){this.curves=new k.Curves(a);this.frames=[];this.frames.length=5*a};k.ColorTimeline.prototype={slotIndex:0,getFrameCount:function(){return this.frames.length/5},setFrame:function(a,b,c,d,f,h){a*=5;this.frames[a]=b;this.frames[a+1]=
c;this.frames[a+2]=d;this.frames[a+3]=f;this.frames[a+4]=h},apply:function(a,b,c){var d=this.frames;if(!(b<d[0])){a=a.slots[this.slotIndex];if(b>=d[d.length-5])return c=d.length-1,a.r=d[c-3],a.g=d[c-2],a.b=d[c-1],a.a=d[c],void 0;var f=k.binarySearch(d,b,5),h=d[f-4],g=d[f-3],j=d[f-2],m=d[f-1],n=d[f],b=1-(b-n)/(d[f-5]-n),b=this.curves.getCurvePercent(f/5-1,b),h=h+(d[f+1]-h)*b,g=g+(d[f+2]-g)*b,j=j+(d[f+3]-j)*b,d=m+(d[f+4]-m)*b;1>c?(a.r+=(h-a.r)*c,a.g+=(g-a.g)*c,a.b+=(j-a.b)*c,a.a+=(d-a.a)*c):(a.r=h,
a.g=g,a.b=j,a.a=d)}}};k.AttachmentTimeline=function(a){this.curves=new k.Curves(a);this.frames=[];this.frames.length=a;this.attachmentNames=[];this.attachmentNames.length=a};k.AttachmentTimeline.prototype={slotIndex:0,getFrameCount:function(){return this.frames.length},setFrame:function(a,b,c){this.frames[a]=b;this.attachmentNames[a]=c},apply:function(a,b){var c=this.frames;b<c[0]||(c=this.attachmentNames[b>=c[c.length-1]?c.length-1:k.binarySearch(c,b,1)-1],a.slots[this.slotIndex].setAttachment(c?
a.getAttachmentBySlotIndex(this.slotIndex,c):null))}};k.SkeletonData=function(){this.bones=[];this.slots=[];this.skins=[];this.animations=[]};k.SkeletonData.prototype={defaultSkin:null,findBone:function(a){for(var b=this.bones,c=0,d=b.length;d>c;c++)if(b[c].name==a)return b[c];return null},findBoneIndex:function(a){for(var b=this.bones,c=0,d=b.length;d>c;c++)if(b[c].name==a)return c;return-1},findSlot:function(a){for(var b=this.slots,c=0,d=b.length;d>c;c++)if(b[c].name==a)return slot[c];return null},
findSlotIndex:function(a){for(var b=this.slots,c=0,d=b.length;d>c;c++)if(b[c].name==a)return c;return-1},findSkin:function(a){for(var b=this.skins,c=0,d=b.length;d>c;c++)if(b[c].name==a)return b[c];return null},findAnimation:function(a){for(var b=this.animations,c=0,d=b.length;d>c;c++)if(b[c].name==a)return b[c];return null}};k.Skeleton=function(a){this.data=a;this.bones=[];for(var b=0,c=a.bones.length;c>b;b++){var d=a.bones[b],f=d.parent?this.bones[a.bones.indexOf(d.parent)]:null;this.bones.push(new k.Bone(d,
f))}for(this.slots=[],this.drawOrder=[],b=0,c=a.slots.length;c>b;b++)d=a.slots[b],f=this.bones[a.bones.indexOf(d.boneData)],d=new k.Slot(d,this,f),this.slots.push(d),this.drawOrder.push(d)};k.Skeleton.prototype={x:0,y:0,skin:null,r:1,g:1,b:1,a:1,time:0,flipX:!1,flipY:!1,updateWorldTransform:function(){for(var a=this.flipX,b=this.flipY,c=this.bones,d=0,f=c.length;f>d;d++)c[d].updateWorldTransform(a,b)},setToSetupPose:function(){this.setBonesToSetupPose();this.setSlotsToSetupPose()},setBonesToSetupPose:function(){for(var a=
this.bones,b=0,c=a.length;c>b;b++)a[b].setToSetupPose()},setSlotsToSetupPose:function(){for(var a=this.slots,b=0,c=a.length;c>b;b++)a[b].setToSetupPose(b)},getRootBone:function(){return this.bones.length?this.bones[0]:null},findBone:function(a){for(var b=this.bones,c=0,d=b.length;d>c;c++)if(b[c].data.name==a)return b[c];return null},findBoneIndex:function(a){for(var b=this.bones,c=0,d=b.length;d>c;c++)if(b[c].data.name==a)return c;return-1},findSlot:function(a){for(var b=this.slots,c=0,d=b.length;d>
c;c++)if(b[c].data.name==a)return b[c];return null},findSlotIndex:function(a){for(var b=this.slots,c=0,d=b.length;d>c;c++)if(b[c].data.name==a)return c;return-1},setSkinByName:function(a){var b=this.data.findSkin(a);if(!b)throw"Skin not found: "+a;this.setSkin(b)},setSkin:function(a){this.skin&&a&&a._attachAll(this,this.skin);this.skin=a},getAttachmentBySlotName:function(a,b){return this.getAttachmentBySlotIndex(this.data.findSlotIndex(a),b)},getAttachmentBySlotIndex:function(a,b){if(this.skin){var c=
this.skin.getAttachment(a,b);if(c)return c}return this.data.defaultSkin?this.data.defaultSkin.getAttachment(a,b):null},setAttachment:function(a,b){for(var c=this.slots,d=0,f=c.size;f>d;d++){var h=c[d];if(h.data.name==a){c=null;if(b&&(c=this.getAttachment(d,b),null==c))throw"Attachment not found: "+b+", for slot: "+a;return h.setAttachment(c),void 0}}throw"Slot not found: "+a;},update:function(a){time+=a}};k.AttachmentType={region:0};k.RegionAttachment=function(){this.offset=[];this.offset.length=
8;this.uvs=[];this.uvs.length=8};k.RegionAttachment.prototype={x:0,y:0,rotation:0,scaleX:1,scaleY:1,width:0,height:0,rendererObject:null,regionOffsetX:0,regionOffsetY:0,regionWidth:0,regionHeight:0,regionOriginalWidth:0,regionOriginalHeight:0,setUVs:function(a,b,c,d,f){var h=this.uvs;f?(h[2]=a,h[3]=d,h[4]=a,h[5]=b,h[6]=c,h[7]=b,h[0]=c,h[1]=d):(h[0]=a,h[1]=d,h[2]=a,h[3]=b,h[4]=c,h[5]=b,h[6]=c,h[7]=d)},updateOffset:function(){var a=this.width/this.regionOriginalWidth*this.scaleX,b=this.height/this.regionOriginalHeight*
this.scaleY,c=-this.width/2*this.scaleX+this.regionOffsetX*a,d=-this.height/2*this.scaleY+this.regionOffsetY*b,f=c+this.regionWidth*a,a=d+this.regionHeight*b,b=this.rotation*Math.PI/180,h=Math.cos(b),g=Math.sin(b),b=c*h+this.x,c=c*g,j=d*h+this.y,d=d*g,k=f*h+this.x,f=f*g,h=a*h+this.y,a=a*g,g=this.offset;g[0]=b-d;g[1]=j+c;g[2]=b-a;g[3]=h+c;g[4]=k-a;g[5]=h+f;g[6]=k-d;g[7]=j+f},computeVertices:function(a,b,c,d){a+=c.worldX;b+=c.worldY;var f=c.m00,h=c.m01,g=c.m10,c=c.m11,j=this.offset;d[0]=j[0]*f+j[1]*
h+a;d[1]=j[0]*g+j[1]*c+b;d[2]=j[2]*f+j[3]*h+a;d[3]=j[2]*g+j[3]*c+b;d[4]=j[4]*f+j[5]*h+a;d[5]=j[4]*g+j[5]*c+b;d[6]=j[6]*f+j[7]*h+a;d[7]=j[6]*g+j[7]*c+b}};k.AnimationStateData=function(a){this.skeletonData=a;this.animationToMixTime={}};k.AnimationStateData.prototype={defaultMix:0,setMixByName:function(a,b,c){var d=this.skeletonData.findAnimation(a);if(!d)throw"Animation not found: "+a;a=this.skeletonData.findAnimation(b);if(!a)throw"Animation not found: "+b;this.setMix(d,a,c)},setMix:function(a,b,c){this.animationToMixTime[a.name+
":"+b.name]=c},getMix:function(a,b){var c=this.animationToMixTime[a.name+":"+b.name];return c?c:this.defaultMix}};k.AnimationState=function(a){this.data=a;this.queue=[]};k.AnimationState.prototype={animationSpeed:1,current:null,previous:null,currentTime:0,previousTime:0,currentLoop:!1,previousLoop:!1,mixTime:0,mixDuration:0,update:function(a){if(this.currentTime+=a*this.animationSpeed,this.previousTime+=a,this.mixTime+=a,0<this.queue.length)a=this.queue[0],this.currentTime>=a.delay&&(this._setAnimation(a.animation,
a.loop),this.queue.shift())},apply:function(a){if(this.current)if(this.previous){this.previous.apply(a,this.previousTime,this.previousLoop);var b=this.mixTime/this.mixDuration;1<=b&&(b=1,this.previous=null);this.current.mix(a,this.currentTime,this.currentLoop,b)}else this.current.apply(a,this.currentTime,this.currentLoop)},clearAnimation:function(){this.previous=null;this.current=null;this.queue.length=0},_setAnimation:function(a,b){this.previous=null;a&&this.current&&(this.mixDuration=this.data.getMix(this.current,
a),0<this.mixDuration&&(this.mixTime=0,this.previous=this.current,this.previousTime=this.currentTime,this.previousLoop=this.currentLoop));this.current=a;this.currentLoop=b;this.currentTime=0},setAnimationByName:function(a,b){var c=this.data.skeletonData.findAnimation(a);if(!c)throw"Animation not found: "+a;this.setAnimation(c,b)},setAnimation:function(a,b){this.queue.length=0;this._setAnimation(a,b)},addAnimationByName:function(a,b,c){var d=this.data.skeletonData.findAnimation(a);if(!d)throw"Animation not found: "+
a;this.addAnimation(d,b,c)},addAnimation:function(a,b,c){var d={};if(d.animation=a,d.loop=b,!c||0>=c)b=this.queue.length?this.queue[this.queue.length-1].animation:this.current,c=null!=b?b.duration-this.data.getMix(b,a)+(c||0):0;d.delay=c;this.queue.push(d)},isComplete:function(){return!this.current||this.currentTime>=this.current.duration}};k.SkeletonJson=function(a){this.attachmentLoader=a};k.SkeletonJson.prototype={scale:1,readSkeletonData:function(a){for(var b,c=new k.SkeletonData,d=a.bones,f=
0,h=d.length;h>f;f++){var g=d[f],j=null;if(g.parent&&(j=c.findBone(g.parent),!j))throw"Parent bone not found: "+g.parent;b=new k.BoneData(g.name,j);b.length=(g.length||0)*this.scale;b.x=(g.x||0)*this.scale;b.y=(g.y||0)*this.scale;b.rotation=g.rotation||0;b.scaleX=g.scaleX||1;b.scaleY=g.scaleY||1;c.bones.push(b)}d=a.slots;for(f=0,h=d.length;h>f;f++){g=d[f];if(b=c.findBone(g.bone),!b)throw"Slot bone not found: "+g.bone;var j=new k.SlotData(g.name,b),m=g.color;m&&(j.r=k.SkeletonJson.toColor(m,0),j.g=
k.SkeletonJson.toColor(m,1),j.b=k.SkeletonJson.toColor(m,2),j.a=k.SkeletonJson.toColor(m,3));j.attachmentName=g.attachment;c.slots.push(j)}b=a.skins;for(var n in b)if(b.hasOwnProperty(n)){var f=b[n],h=new k.Skin(n),o;for(o in f)if(f.hasOwnProperty(o)){var d=c.findSlotIndex(o),g=f[o],l;for(l in g)g.hasOwnProperty(l)&&(j=this.readAttachment(h,l,g[l]),null!=j&&h.addAttachment(d,l,j))}c.skins.push(h);"default"==h.name&&(c.defaultSkin=h)}var a=a.animations,B;for(B in a)a.hasOwnProperty(B)&&this.readAnimation(B,
a[B],c);return c},readAttachment:function(a,b,c){b=c.name||b;a=k.AttachmentType[c.type||"region"];if(a==k.AttachmentType.region)return a=new k.RegionAttachment,a.x=(c.x||0)*this.scale,a.y=(c.y||0)*this.scale,a.scaleX=c.scaleX||1,a.scaleY=c.scaleY||1,a.rotation=c.rotation||0,a.width=(c.width||32)*this.scale,a.height=(c.height||32)*this.scale,a.updateOffset(),a.rendererObject={},a.rendererObject.name=b,a.rendererObject.scale={},a.rendererObject.scale.x=a.scaleX,a.rendererObject.scale.y=a.scaleY,a.rendererObject.rotation=
-a.rotation*Math.PI/180,a;throw"Unknown attachment type: "+a;},readAnimation:function(a,b,c){var d,f,h,g,j,m,n,o=[],l=0,B=b.bones,t;for(t in B)if(B.hasOwnProperty(t)){var x=c.findBoneIndex(t);if(-1==x)throw"Bone not found: "+t;var v=B[t];for(h in v)if(v.hasOwnProperty(h))if(j=v[h],"rotate"==h){for(f=new k.RotateTimeline(j.length),f.boneIndex=x,d=0,m=0,n=j.length;n>m;m++)g=j[m],f.setFrame(d,g.time,g.angle),k.SkeletonJson.readCurve(f,d,g),d++;o.push(f);l=Math.max(l,f.frames[2*f.getFrameCount()-2])}else{if("translate"!=
h&&"scale"!=h)throw"Invalid timeline type for a bone: "+h+" ("+t+")";var y=1;for("scale"==h?f=new k.ScaleTimeline(j.length):(f=new k.TranslateTimeline(j.length),y=this.scale),f.boneIndex=x,d=0,m=0,n=j.length;n>m;m++)g=j[m],f.setFrame(d,g.time,(g.x||0)*y,(g.y||0)*y),k.SkeletonJson.readCurve(f,d,g),d++;o.push(f);l=Math.max(l,f.frames[3*f.getFrameCount()-3])}}var b=b.slots,z;for(z in b)if(b.hasOwnProperty(z))for(h in B=b[z],t=c.findSlotIndex(z),B)if(B.hasOwnProperty(h))if(j=B[h],"color"==h){for(f=new k.ColorTimeline(j.length),
f.slotIndex=t,d=0,m=0,n=j.length;n>m;m++){g=j[m];var G=g.color,x=k.SkeletonJson.toColor(G,0),v=k.SkeletonJson.toColor(G,1),y=k.SkeletonJson.toColor(G,2),G=k.SkeletonJson.toColor(G,3);f.setFrame(d,g.time,x,v,y,G);k.SkeletonJson.readCurve(f,d,g);d++}o.push(f);l=Math.max(l,f.frames[5*f.getFrameCount()-5])}else{if("attachment"!=h)throw"Invalid timeline type for a slot: "+h+" ("+z+")";for(f=new k.AttachmentTimeline(j.length),f.slotIndex=t,d=0,m=0,n=j.length;n>m;m++)g=j[m],f.setFrame(d++,g.time,g.name);
o.push(f);l=Math.max(l,f.frames[f.getFrameCount()-1])}c.animations.push(new k.Animation(a,o,l))}};k.SkeletonJson.readCurve=function(a,b,c){(c=c.curve)&&("stepped"==c?a.curves.setStepped(b):c instanceof Array&&a.curves.setCurve(b,c[0],c[1],c[2],c[3]))};k.SkeletonJson.toColor=function(a,b){if(8!=a.length)throw"Color hexidecimal length must be 8, recieved: "+a;return parseInt(a.substr(2*b,2),16)/255};k.Atlas=function(a,b){this.textureLoader=b;this.pages=[];this.regions=[];var c=new k.AtlasReader(a),
d=[];d.length=4;for(var f=null;;){var h=c.readLine();if(null==h)break;if(h=c.trim(h),h.length)if(f){var g=new k.AtlasRegion;g.name=h;g.page=f;g.rotate="true"==c.readValue();c.readTuple(d);var h=parseInt(d[0],10),j=parseInt(d[1],10);c.readTuple(d);var m=parseInt(d[0],10),n=parseInt(d[1],10);g.u=h/f.width;g.v=j/f.height;g.rotate?(g.u2=(h+n)/f.width,g.v2=(j+m)/f.height):(g.u2=(h+m)/f.width,g.v2=(j+n)/f.height);g.x=h;g.y=j;g.width=Math.abs(m);g.height=Math.abs(n);4==c.readTuple(d)&&(g.splits=[parseInt(d[0],
10),parseInt(d[1],10),parseInt(d[2],10),parseInt(d[3],10)],4==c.readTuple(d)&&(g.pads=[parseInt(d[0],10),parseInt(d[1],10),parseInt(d[2],10),parseInt(d[3],10)],c.readTuple(d)));g.originalWidth=parseInt(d[0],10);g.originalHeight=parseInt(d[1],10);c.readTuple(d);g.offsetX=parseInt(d[0],10);g.offsetY=parseInt(d[1],10);g.index=parseInt(c.readValue(),10);this.regions.push(g)}else f=new k.AtlasPage,f.name=h,f.format=k.Atlas.Format[c.readValue()],c.readTuple(d),f.minFilter=k.Atlas.TextureFilter[d[0]],f.magFilter=
k.Atlas.TextureFilter[d[1]],g=c.readValue(),f.uWrap=k.Atlas.TextureWrap.clampToEdge,f.vWrap=k.Atlas.TextureWrap.clampToEdge,"x"==g?f.uWrap=k.Atlas.TextureWrap.repeat:"y"==g?f.vWrap=k.Atlas.TextureWrap.repeat:"xy"==g&&(f.uWrap=f.vWrap=k.Atlas.TextureWrap.repeat),b.load(f,h),this.pages.push(f);else f=null}};k.Atlas.prototype={findRegion:function(a){for(var b=this.regions,c=0,d=b.length;d>c;c++)if(b[c].name==a)return b[c];return null},dispose:function(){for(var a=this.pages,b=0,c=a.length;c>b;b++)this.textureLoader.unload(a[b].rendererObject)},
updateUVs:function(a){for(var b=this.regions,c=0,d=b.length;d>c;c++){var f=b[c];f.page==a&&(f.u=f.x/a.width,f.v=f.y/a.height,f.rotate?(f.u2=(f.x+f.height)/a.width,f.v2=(f.y+f.width)/a.height):(f.u2=(f.x+f.width)/a.width,f.v2=(f.y+f.height)/a.height))}}};k.Atlas.Format={alpha:0,intensity:1,luminanceAlpha:2,rgb565:3,rgba4444:4,rgb888:5,rgba8888:6};k.Atlas.TextureFilter={nearest:0,linear:1,mipMap:2,mipMapNearestNearest:3,mipMapLinearNearest:4,mipMapNearestLinear:5,mipMapLinearLinear:6};k.Atlas.TextureWrap=
{mirroredRepeat:0,clampToEdge:1,repeat:2};k.AtlasPage=function(){};k.AtlasPage.prototype={name:null,format:null,minFilter:null,magFilter:null,uWrap:null,vWrap:null,rendererObject:null,width:0,height:0};k.AtlasRegion=function(){};k.AtlasRegion.prototype={page:null,name:null,x:0,y:0,width:0,height:0,u:0,v:0,u2:0,v2:0,offsetX:0,offsetY:0,originalWidth:0,originalHeight:0,index:0,rotate:!1,splits:null,pads:null};k.AtlasReader=function(a){this.lines=a.split(/\r\n|\r|\n/)};k.AtlasReader.prototype={index:0,
trim:function(a){return a.replace(/^\s+|\s+$/g,"")},readLine:function(){return this.index>=this.lines.length?null:this.lines[this.index++]},readValue:function(){var a=this.readLine(),b=a.indexOf(":");if(-1==b)throw"Invalid line: "+a;return this.trim(a.substring(b+1))},readTuple:function(a){var b=this.readLine(),c=b.indexOf(":");if(-1==c)throw"Invalid line: "+b;for(var d=0,c=c+1;3>d;d++){var f=b.indexOf(",",c);if(-1==f){if(!d)throw"Invalid line: "+b;break}a[d]=this.trim(b.substr(c,f-c));c=f+1}return a[d]=
this.trim(b.substring(c)),d+1}};k.AtlasAttachmentLoader=function(a){this.atlas=a};k.AtlasAttachmentLoader.prototype={newAttachment:function(a,b,c){switch(b){case k.AttachmentType.region:a=this.atlas.findRegion(c);if(!a)throw"Region not found in atlas: "+c+" ("+b+")";b=new k.RegionAttachment(c);return b.rendererObject=a,b.setUVs(a.u,a.v,a.u2,a.v2,a.rotate),b.regionOffsetX=a.offsetX,b.regionOffsetY=a.offsetY,b.regionWidth=a.width,b.regionHeight=a.height,b.regionOriginalWidth=a.originalWidth,b.regionOriginalHeight=
a.originalHeight,b}throw"Unknown attachment type: "+b;}};k.Bone.yDown=!0;c.AnimCache={};c.Spine=function(a){if(c.DisplayObjectContainer.call(this),this.spineData=c.AnimCache[a],!this.spineData)throw Error("Spine data must be preloaded using PIXI.SpineLoader or PIXI.AssetLoader: "+a);this.skeleton=new k.Skeleton(this.spineData);this.skeleton.updateWorldTransform();this.stateData=new k.AnimationStateData(this.spineData);this.state=new k.AnimationState(this.stateData);this.slotContainers=[];for(var a=
0,b=this.skeleton.drawOrder.length;b>a;a++){var e=this.skeleton.drawOrder[a],d=e.attachment,f=new c.DisplayObjectContainer;if(this.slotContainers.push(f),this.addChild(f),d instanceof k.RegionAttachment){var h=d.rendererObject.name,d=this.createSprite(e,d.rendererObject);e.currentSprite=d;e.currentSpriteName=h;f.addChild(d)}}};c.Spine.prototype=Object.create(c.DisplayObjectContainer.prototype);c.Spine.prototype.constructor=c.Spine;c.Spine.prototype.updateTransform=function(){this.lastTime=this.lastTime||
Date.now();var a=0.0010*(Date.now()-this.lastTime);this.lastTime=Date.now();this.state.update(a);this.state.apply(this.skeleton);this.skeleton.updateWorldTransform();for(var a=this.skeleton.drawOrder,b=0,e=a.length;e>b;b++){var d=a[b],f=d.attachment,h=this.slotContainers[b];if(f instanceof k.RegionAttachment){if(f.rendererObject&&(!d.currentSpriteName||d.currentSpriteName!=f.name)){var g=f.rendererObject.name;if(void 0!==d.currentSprite&&(d.currentSprite.visible=!1),d.sprites=d.sprites||{},void 0!==
d.sprites[g])d.sprites[g].visible=!0;else{var j=this.createSprite(d,f.rendererObject);h.addChild(j)}d.currentSprite=d.sprites[g];d.currentSpriteName=g}h.visible=!0;g=d.bone;h.position.x=g.worldX+f.x*g.m00+f.y*g.m01;h.position.y=g.worldY+f.x*g.m10+f.y*g.m11;h.scale.x=g.worldScaleX;h.scale.y=g.worldScaleY;h.rotation=-(d.bone.worldRotation*Math.PI/180);h.alpha=d.a;d.currentSprite.tint=c.rgb2hex([d.r,d.g,d.b])}else h.visible=!1}c.DisplayObjectContainer.prototype.updateTransform.call(this)};c.Spine.prototype.createSprite=
function(a,b){var e=new c.Sprite(c.Texture.fromFrame(c.TextureCache[b.name]?b.name:b.name+".png"));return e.scale=b.scale,e.rotation=b.rotation,e.anchor.x=e.anchor.y=0.5,a.sprites=a.sprites||{},a.sprites[b.name]=e,e};c.BaseTextureCache={};c.texturesToUpdate=[];c.texturesToDestroy=[];c.BaseTextureCacheIdGenerator=0;c.BaseTexture=function(a,b){if(c.EventTarget.call(this),this.width=100,this.height=100,this.scaleMode=b||c.scaleModes.DEFAULT,this.hasLoaded=!1,this.source=a,this.id=c.BaseTextureCacheIdGenerator++,
this.premultipliedAlpha=!0,this._glTextures=[],this._dirty=[],a){if((this.source.complete||this.source.getContext)&&this.source.width&&this.source.height)this.hasLoaded=!0,this.width=this.source.width,this.height=this.source.height,c.texturesToUpdate.push(this);else{var e=this;this.source.onload=function(){e.hasLoaded=!0;e.width=e.source.width;e.height=e.source.height;for(var a=0;a<e._glTextures.length;a++)e._dirty[a]=!0;e.dispatchEvent({type:"loaded",content:e})};this.source.onerror=function(){e.dispatchEvent({type:"error",
content:e})}}this.imageUrl=null;this._powerOf2=!1}};c.BaseTexture.prototype.constructor=c.BaseTexture;c.BaseTexture.prototype.destroy=function(){this.imageUrl?(delete c.BaseTextureCache[this.imageUrl],delete c.TextureCache[this.imageUrl],this.imageUrl=null,this.source.src=null):this.source&&this.source._pixiId&&delete c.BaseTextureCache[this.source._pixiId];this.source=null;c.texturesToDestroy.push(this)};c.BaseTexture.prototype.updateSourceImage=function(a){this.hasLoaded=!1;this.source.src=null;
this.source.src=a};c.BaseTexture.fromImage=function(a,b,e){var d=c.BaseTextureCache[a];if(void 0===b&&-1===a.indexOf("data:")&&(b=!0),!d){var f=new Image;b&&(f.crossOrigin="");f.src=a;d=new c.BaseTexture(f,e);d.imageUrl=a;c.BaseTextureCache[a]=d}return d};c.BaseTexture.fromCanvas=function(a,b){a._pixiId||(a._pixiId="canvas_"+c.TextureCacheIdGenerator++);var e=c.BaseTextureCache[a._pixiId];return e||(e=new c.BaseTexture(a,b),c.BaseTextureCache[a._pixiId]=e),e};c.TextureCache={};c.FrameCache={};c.TextureCacheIdGenerator=
0;c.Texture=function(a,b){if(c.EventTarget.call(this),this.noFrame=!1,b||(this.noFrame=!0,b=new c.Rectangle(0,0,1,1)),a instanceof c.Texture&&(a=a.baseTexture),this.baseTexture=a,this.frame=b,this.trim=null,this.valid=!1,this.scope=this,this._uvs=null,this.width=0,this.height=0,this.crop=new c.Rectangle(0,0,1,1),a.hasLoaded)this.noFrame&&(b=new c.Rectangle(0,0,a.width,a.height)),this.setFrame(b);else{var e=this;a.addEventListener("loaded",function(){e.onBaseTextureLoaded()})}};c.Texture.prototype.constructor=
c.Texture;c.Texture.prototype.onBaseTextureLoaded=function(){var a=this.baseTexture;a.removeEventListener("loaded",this.onLoaded);this.noFrame&&(this.frame=new c.Rectangle(0,0,a.width,a.height));this.setFrame(this.frame);this.scope.dispatchEvent({type:"update",content:this})};c.Texture.prototype.destroy=function(a){a&&this.baseTexture.destroy();this.valid=!1};c.Texture.prototype.setFrame=function(a){if(this.noFrame=!1,this.frame=a,this.width=a.width,this.height=a.height,this.crop.x=a.x,this.crop.y=
a.y,this.crop.width=a.width,this.crop.height=a.height,!this.trim&&(a.x+a.width>this.baseTexture.width||a.y+a.height>this.baseTexture.height))throw Error("Texture Error: frame does not fit inside the base Texture dimensions "+this);this.valid=a&&a.width&&a.height&&this.baseTexture.source&&this.baseTexture.hasLoaded;this.trim&&(this.width=this.trim.width,this.height=this.trim.height,this.frame.width=this.trim.width,this.frame.height=this.trim.height);this.valid&&c.Texture.frameUpdates.push(this)};c.Texture.prototype._updateWebGLuvs=
function(){this._uvs||(this._uvs=new c.TextureUvs);var a=this.crop,b=this.baseTexture.width,e=this.baseTexture.height;this._uvs.x0=a.x/b;this._uvs.y0=a.y/e;this._uvs.x1=(a.x+a.width)/b;this._uvs.y1=a.y/e;this._uvs.x2=(a.x+a.width)/b;this._uvs.y2=(a.y+a.height)/e;this._uvs.x3=a.x/b;this._uvs.y3=(a.y+a.height)/e};c.Texture.fromImage=function(a,b,e){var d=c.TextureCache[a];return d||(d=new c.Texture(c.BaseTexture.fromImage(a,b,e)),c.TextureCache[a]=d),d};c.Texture.fromFrame=function(a){var b=c.TextureCache[a];
if(!b)throw Error('The frameId "'+a+'" does not exist in the texture cache ');return b};c.Texture.fromCanvas=function(a,b){var e=c.BaseTexture.fromCanvas(a,b);return new c.Texture(e)};c.Texture.addTextureToCache=function(a,b){c.TextureCache[b]=a};c.Texture.removeTextureFromCache=function(a){var b=c.TextureCache[a];return delete c.TextureCache[a],delete c.BaseTextureCache[a],b};c.Texture.frameUpdates=[];c.TextureUvs=function(){this.x0=0;this.y0=0;this.x1=0;this.y1=0;this.x2=0;this.y2=0;this.x3=0;this.y3=
0};c.RenderTexture=function(a,b,e,d){(c.EventTarget.call(this),this.width=a||100,this.height=b||100,this.frame=new c.Rectangle(0,0,this.width,this.height),this.crop=new c.Rectangle(0,0,this.width,this.height),this.baseTexture=new c.BaseTexture,this.baseTexture.width=this.width,this.baseTexture.height=this.height,this.baseTexture._glTextures=[],this.baseTexture.scaleMode=d||c.scaleModes.DEFAULT,this.baseTexture.hasLoaded=!0,this.renderer=e||c.defaultRenderer,this.renderer.type===c.WEBGL_RENDERER)?
(a=this.renderer.gl,this.textureBuffer=new c.FilterTexture(a,this.width,this.height,this.baseTexture.scaleMode),this.baseTexture._glTextures[a.id]=this.textureBuffer.texture,this.render=this.renderWebGL,this.projection=new c.Point(this.width/2,-this.height/2)):(this.render=this.renderCanvas,this.textureBuffer=new c.CanvasBuffer(this.width,this.height),this.baseTexture.source=this.textureBuffer.canvas);this.valid=!0;c.Texture.frameUpdates.push(this)};c.RenderTexture.prototype=Object.create(c.Texture.prototype);
c.RenderTexture.prototype.constructor=c.RenderTexture;c.RenderTexture.prototype.resize=function(a,b,e){(a!==this.width||b!==this.height)&&(this.width=this.frame.width=this.crop.width=a,this.height=this.frame.height=this.crop.height=b,e&&(this.baseTexture.width=this.width,this.baseTexture.height=this.height),this.renderer.type===c.WEBGL_RENDERER&&(this.projection.x=this.width/2,this.projection.y=-this.height/2),this.textureBuffer.resize(this.width,this.height))};c.RenderTexture.prototype.clear=function(){this.renderer.type===
c.WEBGL_RENDERER&&this.renderer.gl.bindFramebuffer(this.renderer.gl.FRAMEBUFFER,this.textureBuffer.frameBuffer);this.textureBuffer.clear()};c.RenderTexture.prototype.renderWebGL=function(a,b,e){var d=this.renderer.gl;d.colorMask(!0,!0,!0,!0);d.viewport(0,0,this.width,this.height);d.bindFramebuffer(d.FRAMEBUFFER,this.textureBuffer.frameBuffer);e&&this.textureBuffer.clear();e=a.children;d=a.worldTransform;a.worldTransform=c.RenderTexture.tempMatrix;a.worldTransform.d=-1;a.worldTransform.ty=-2*this.projection.y;
b&&(a.worldTransform.tx=b.x,a.worldTransform.ty-=b.y);for(var b=0,f=e.length;f>b;b++)e[b].updateTransform();c.WebGLRenderer.updateTextures();this.renderer.spriteBatch.dirty=!0;this.renderer.renderDisplayObject(a,this.projection,this.textureBuffer.frameBuffer);a.worldTransform=d;this.renderer.spriteBatch.dirty=!0};c.RenderTexture.prototype.renderCanvas=function(a,b,e){var d=a.children,f=a.worldTransform;a.worldTransform=c.RenderTexture.tempMatrix;b?(a.worldTransform.tx=b.x,a.worldTransform.ty=b.y):
(a.worldTransform.tx=0,a.worldTransform.ty=0);for(var b=0,h=d.length;h>b;b++)d[b].updateTransform();e&&this.textureBuffer.clear();e=this.textureBuffer.context;this.renderer.renderDisplayObject(a,e);e.setTransform(1,0,0,1,0,0);a.worldTransform=f};c.RenderTexture.tempMatrix=new c.Matrix;c.AssetLoader=function(a,b){c.EventTarget.call(this);this.assetURLs=a;this.crossorigin=b;this.loadersByType={jpg:c.ImageLoader,jpeg:c.ImageLoader,png:c.ImageLoader,gif:c.ImageLoader,webp:c.ImageLoader,json:c.JsonLoader,
atlas:c.AtlasLoader,anim:c.SpineLoader,xml:c.BitmapFontLoader,fnt:c.BitmapFontLoader}};c.AssetLoader.prototype.constructor=c.AssetLoader;c.AssetLoader.prototype._getDataType=function(a){if("data:"===a.slice(0,5).toLowerCase()){var a=a.slice(5),b=a.indexOf(",");return-1===b?null:(a=a.slice(0,b).split(";")[0])&&"text/plain"!==a.toLowerCase()?a.split("/").pop().toLowerCase():"txt"}return null};c.AssetLoader.prototype.load=function(){function a(a){b.onAssetLoaded(a.content)}var b=this;this.loadCount=
this.assetURLs.length;for(var c=0;c<this.assetURLs.length;c++){var d=this.assetURLs[c],f=this._getDataType(d);f||(f=d.split("?").shift().split(".").pop().toLowerCase());var h=this.loadersByType[f];if(!h)throw Error(f+" is an unsupported file type");d=new h(d,this.crossorigin);d.addEventListener("loaded",a);d.load()}};c.AssetLoader.prototype.onAssetLoaded=function(a){this.loadCount--;this.dispatchEvent({type:"onProgress",content:this,loader:a});this.onProgress&&this.onProgress(a);this.loadCount||(this.dispatchEvent({type:"onComplete",
content:this}),this.onComplete&&this.onComplete())};c.JsonLoader=function(a,b){c.EventTarget.call(this);this.url=a;this.crossorigin=b;this.baseUrl=a.replace(/[^\/]*$/,"");this.loaded=!1};c.JsonLoader.prototype.constructor=c.JsonLoader;c.JsonLoader.prototype.load=function(){var a=this;window.XDomainRequest&&a.crossorigin?(this.ajaxRequest=new window.XDomainRequest,this.ajaxRequest.timeout=3E3,this.ajaxRequest.onerror=function(){a.onError()},this.ajaxRequest.ontimeout=function(){a.onError()},this.ajaxRequest.onprogress=
function(){}):this.ajaxRequest=window.XMLHttpRequest?new window.XMLHttpRequest:new window.ActiveXObject("Microsoft.XMLHTTP");this.ajaxRequest.onload=function(){a.onJSONLoaded()};this.ajaxRequest.open("GET",this.url,!0);this.ajaxRequest.send()};c.JsonLoader.prototype.onJSONLoaded=function(){if(!this.ajaxRequest.responseText)return this.onError(),void 0;if(this.json=JSON.parse(this.ajaxRequest.responseText),this.json.frames){var a=this,b=new c.ImageLoader(this.baseUrl+this.json.meta.image,this.crossorigin),
e=this.json.frames;this.texture=b.texture.baseTexture;b.addEventListener("loaded",function(){a.onLoaded()});for(var d in e){var f=e[d].frame;if(f&&(c.TextureCache[d]=new c.Texture(this.texture,{x:f.x,y:f.y,width:f.w,height:f.h}),c.TextureCache[d].crop=new c.Rectangle(f.x,f.y,f.w,f.h),e[d].trimmed)){var f=e[d].sourceSize,h=e[d].spriteSourceSize;c.TextureCache[d].trim=new c.Rectangle(h.x,h.y,f.w,f.h)}}b.load()}else if(this.json.bones)b=(new k.SkeletonJson).readSkeletonData(this.json),c.AnimCache[this.url]=
b,this.onLoaded();else this.onLoaded()};c.JsonLoader.prototype.onLoaded=function(){this.loaded=!0;this.dispatchEvent({type:"loaded",content:this})};c.JsonLoader.prototype.onError=function(){this.dispatchEvent({type:"error",content:this})};c.AtlasLoader=function(a,b){c.EventTarget.call(this);this.url=a;this.baseUrl=a.replace(/[^\/]*$/,"");this.crossorigin=b;this.loaded=!1};c.AtlasLoader.constructor=c.AtlasLoader;c.AtlasLoader.prototype.load=function(){this.ajaxRequest=new c.AjaxRequest;this.ajaxRequest.onreadystatechange=
this.onAtlasLoaded.bind(this);this.ajaxRequest.open("GET",this.url,!0);this.ajaxRequest.overrideMimeType&&this.ajaxRequest.overrideMimeType("application/json");this.ajaxRequest.send(null)};c.AtlasLoader.prototype.onAtlasLoaded=function(){if(4===this.ajaxRequest.readyState)if(200===this.ajaxRequest.status||-1===window.location.href.indexOf("http")){this.atlas={meta:{image:[]},frames:[]};for(var a=this.ajaxRequest.responseText.split(/\r?\n/),b=-3,e=0,d=null,f=!1,h=0,g=0,j=this.onLoaded.bind(this),h=
0;h<a.length;h++)if(a[h]=a[h].replace(/^\s+|\s+$/g,""),""===a[h]&&(f=h+1),0<a[h].length){if(f===h)this.atlas.meta.image.push(a[h]),e=this.atlas.meta.image.length-1,this.atlas.frames.push({}),b=-3;else if(0<b)if(1===b%7)null!=d&&(this.atlas.frames[e][d.name]=d),d={name:a[h],frame:{}};else if(g=a[h].split(" "),3===b%7)d.frame.x=Number(g[1].replace(",","")),d.frame.y=Number(g[2]);else if(4===b%7)d.frame.w=Number(g[1].replace(",","")),d.frame.h=Number(g[2]);else if(5===b%7)g={x:0,y:0,w:Number(g[1].replace(",",
"")),h:Number(g[2])},g.w>d.frame.w||g.h>d.frame.h?(d.trimmed=!0,d.realSize=g):d.trimmed=!1;b++}if(null!=d&&(this.atlas.frames[e][d.name]=d),0<this.atlas.meta.image.length){for(this.images=[],g=0;g<this.atlas.meta.image.length;g++)for(h in a=this.atlas.frames[g],this.images.push(new c.ImageLoader(this.baseUrl+this.atlas.meta.image[g],this.crossorigin)),a)(b=a[h].frame)&&(c.TextureCache[h]=new c.Texture(this.images[g].texture.baseTexture,{x:b.x,y:b.y,width:b.w,height:b.h}),a[h].trimmed&&(c.TextureCache[h].realSize=
a[h].realSize,c.TextureCache[h].trim.x=0,c.TextureCache[h].trim.y=0));for(this.currentImageId=0,g=0;g<this.images.length;g++)this.images[g].addEventListener("loaded",j);this.images[this.currentImageId].load()}else this.onLoaded()}else this.onError()};c.AtlasLoader.prototype.onLoaded=function(){this.images.length-1>this.currentImageId?(this.currentImageId++,this.images[this.currentImageId].load()):(this.loaded=!0,this.dispatchEvent({type:"loaded",content:this}))};c.AtlasLoader.prototype.onError=function(){this.dispatchEvent({type:"error",
content:this})};c.SpriteSheetLoader=function(a,b){c.EventTarget.call(this);this.url=a;this.crossorigin=b;this.baseUrl=a.replace(/[^\/]*$/,"");this.texture=null;this.frames={}};c.SpriteSheetLoader.prototype.constructor=c.SpriteSheetLoader;c.SpriteSheetLoader.prototype.load=function(){var a=this,b=new c.JsonLoader(this.url,this.crossorigin);b.addEventListener("loaded",function(b){a.json=b.content.json;a.onLoaded()});b.load()};c.SpriteSheetLoader.prototype.onLoaded=function(){this.dispatchEvent({type:"loaded",
content:this})};c.ImageLoader=function(a,b){c.EventTarget.call(this);this.texture=c.Texture.fromImage(a,b);this.frames=[]};c.ImageLoader.prototype.constructor=c.ImageLoader;c.ImageLoader.prototype.load=function(){if(this.texture.baseTexture.hasLoaded)this.onLoaded();else{var a=this;this.texture.baseTexture.addEventListener("loaded",function(){a.onLoaded()})}};c.ImageLoader.prototype.onLoaded=function(){this.dispatchEvent({type:"loaded",content:this})};c.ImageLoader.prototype.loadFramedSpriteSheet=
function(a,b,e){this.frames=[];for(var d=Math.floor(this.texture.width/a),f=Math.floor(this.texture.height/b),h=0,g=0;f>g;g++)for(var j=0;d>j;j++,h++){var k=new c.Texture(this.texture,{x:j*a,y:g*b,width:a,height:b});this.frames.push(k);e&&(c.TextureCache[e+"-"+h]=k)}if(this.texture.baseTexture.hasLoaded)this.onLoaded();else{var m=this;this.texture.baseTexture.addEventListener("loaded",function(){m.onLoaded()})}};c.BitmapFontLoader=function(a,b){c.EventTarget.call(this);this.url=a;this.crossorigin=
b;this.baseUrl=a.replace(/[^\/]*$/,"");this.texture=null};c.BitmapFontLoader.prototype.constructor=c.BitmapFontLoader;c.BitmapFontLoader.prototype.load=function(){this.ajaxRequest=new c.AjaxRequest;var a=this;this.ajaxRequest.onreadystatechange=function(){a.onXMLLoaded()};this.ajaxRequest.open("GET",this.url,!0);this.ajaxRequest.overrideMimeType&&this.ajaxRequest.overrideMimeType("application/xml");this.ajaxRequest.send(null)};c.BitmapFontLoader.prototype.onXMLLoaded=function(){if(4===this.ajaxRequest.readyState&&
(200===this.ajaxRequest.status||-1===window.location.protocol.indexOf("http"))){var a=this.ajaxRequest.responseXML;if(!a||/MSIE 9/i.test(navigator.userAgent)||navigator.isCocoonJS)if("function"==typeof window.DOMParser)a=(new DOMParser).parseFromString(this.ajaxRequest.responseText,"text/xml");else{var b=document.createElement("div");b.innerHTML=this.ajaxRequest.responseText;a=b}b=this.baseUrl+a.getElementsByTagName("page")[0].getAttribute("file");b=new c.ImageLoader(b,this.crossorigin);this.texture=
b.texture.baseTexture;var e={},d=a.getElementsByTagName("info")[0],f=a.getElementsByTagName("common")[0];e.font=d.getAttribute("face");e.size=parseInt(d.getAttribute("size"),10);e.lineHeight=parseInt(f.getAttribute("lineHeight"),10);e.chars={};f=a.getElementsByTagName("char");for(d=0;d<f.length;d++){var h=parseInt(f[d].getAttribute("id"),10),g=new c.Rectangle(parseInt(f[d].getAttribute("x"),10),parseInt(f[d].getAttribute("y"),10),parseInt(f[d].getAttribute("width"),10),parseInt(f[d].getAttribute("height"),
10));e.chars[h]={xOffset:parseInt(f[d].getAttribute("xoffset"),10),yOffset:parseInt(f[d].getAttribute("yoffset"),10),xAdvance:parseInt(f[d].getAttribute("xadvance"),10),kerning:{},texture:c.TextureCache[h]=new c.Texture(this.texture,g)}}a=a.getElementsByTagName("kerning");for(d=0;d<a.length;d++)f=parseInt(a[d].getAttribute("first"),10),h=parseInt(a[d].getAttribute("second"),10),g=parseInt(a[d].getAttribute("amount"),10),e.chars[h].kerning[f]=g;c.BitmapText.fonts[e.font]=e;var j=this;b.addEventListener("loaded",
function(){j.onLoaded()});b.load()}};c.BitmapFontLoader.prototype.onLoaded=function(){this.dispatchEvent({type:"loaded",content:this})};c.SpineLoader=function(a,b){c.EventTarget.call(this);this.url=a;this.crossorigin=b;this.loaded=!1};c.SpineLoader.prototype.constructor=c.SpineLoader;c.SpineLoader.prototype.load=function(){var a=this,b=new c.JsonLoader(this.url,this.crossorigin);b.addEventListener("loaded",function(b){a.json=b.content.json;a.onLoaded()});b.load()};c.SpineLoader.prototype.onLoaded=
function(){this.loaded=!0;this.dispatchEvent({type:"loaded",content:this})};c.AbstractFilter=function(a,b){this.passes=[this];this.shaders=[];this.dirty=!0;this.padding=0;this.uniforms=b||{};this.fragmentSrc=a||[]};c.AlphaMaskFilter=function(a){c.AbstractFilter.call(this);this.passes=[this];a.baseTexture._powerOf2=!0;this.uniforms={mask:{type:"sampler2D",value:a},mapDimensions:{type:"2f",value:{x:1,y:5112}},dimensions:{type:"4fv",value:[0,0,0,0]}};a.baseTexture.hasLoaded?(this.uniforms.mask.value.x=
a.width,this.uniforms.mask.value.y=a.height):(this.boundLoadedFunction=this.onTextureLoaded.bind(this),a.baseTexture.on("loaded",this.boundLoadedFunction));this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D mask;","uniform sampler2D uSampler;","uniform vec2 offset;","uniform vec4 dimensions;","uniform vec2 mapDimensions;","void main(void) {","   vec2 mapCords = vTextureCoord.xy;","   mapCords += (dimensions.zw + offset)/ dimensions.xy ;",
"   mapCords.y *= -1.0;","   mapCords.y += 1.0;","   mapCords *= dimensions.xy / mapDimensions;","   vec4 original =  texture2D(uSampler, vTextureCoord);","   float maskAlpha =  texture2D(mask, mapCords).r;","   original *= maskAlpha;","   gl_FragColor =  original;","}"]};c.AlphaMaskFilter.prototype=Object.create(c.AbstractFilter.prototype);c.AlphaMaskFilter.prototype.constructor=c.AlphaMaskFilter;c.AlphaMaskFilter.prototype.onTextureLoaded=function(){this.uniforms.mapDimensions.value.x=this.uniforms.mask.value.width;
this.uniforms.mapDimensions.value.y=this.uniforms.mask.value.height;this.uniforms.mask.value.baseTexture.off("loaded",this.boundLoadedFunction)};Object.defineProperty(c.AlphaMaskFilter.prototype,"map",{get:function(){return this.uniforms.mask.value},set:function(a){this.uniforms.mask.value=a}});c.ColorMatrixFilter=function(){c.AbstractFilter.call(this);this.passes=[this];this.uniforms={matrix:{type:"mat4",value:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}};this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;",
"varying vec4 vColor;","uniform float invert;","uniform mat4 matrix;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * matrix;","}"]};c.ColorMatrixFilter.prototype=Object.create(c.AbstractFilter.prototype);c.ColorMatrixFilter.prototype.constructor=c.ColorMatrixFilter;Object.defineProperty(c.ColorMatrixFilter.prototype,"matrix",{get:function(){return this.uniforms.matrix.value},set:function(a){this.uniforms.matrix.value=a}});c.GrayFilter=function(){c.AbstractFilter.call(this);
this.passes=[this];this.uniforms={gray:{type:"1f",value:1}};this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","uniform float gray;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord);","   gl_FragColor.rgb = mix(gl_FragColor.rgb, vec3(0.2126*gl_FragColor.r + 0.7152*gl_FragColor.g + 0.0722*gl_FragColor.b), gray);","}"]};c.GrayFilter.prototype=Object.create(c.AbstractFilter.prototype);c.GrayFilter.prototype.constructor=
c.GrayFilter;Object.defineProperty(c.GrayFilter.prototype,"gray",{get:function(){return this.uniforms.gray.value},set:function(a){this.uniforms.gray.value=a}});c.DisplacementFilter=function(a){c.AbstractFilter.call(this);this.passes=[this];a.baseTexture._powerOf2=!0;this.uniforms={displacementMap:{type:"sampler2D",value:a},scale:{type:"2f",value:{x:30,y:30}},offset:{type:"2f",value:{x:0,y:0}},mapDimensions:{type:"2f",value:{x:1,y:5112}},dimensions:{type:"4fv",value:[0,0,0,0]}};a.baseTexture.hasLoaded?
(this.uniforms.mapDimensions.value.x=a.width,this.uniforms.mapDimensions.value.y=a.height):(this.boundLoadedFunction=this.onTextureLoaded.bind(this),a.baseTexture.on("loaded",this.boundLoadedFunction));this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D displacementMap;","uniform sampler2D uSampler;","uniform vec2 scale;","uniform vec2 offset;","uniform vec4 dimensions;","uniform vec2 mapDimensions;","void main(void) {","   vec2 mapCords = vTextureCoord.xy;",
"   mapCords += (dimensions.zw + offset)/ dimensions.xy ;","   mapCords.y *= -1.0;","   mapCords.y += 1.0;","   vec2 matSample = texture2D(displacementMap, mapCords).xy;","   matSample -= 0.5;","   matSample *= scale;","   matSample /= mapDimensions;","   gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.x + matSample.x, vTextureCoord.y + matSample.y));","   gl_FragColor.rgb = mix( gl_FragColor.rgb, gl_FragColor.rgb, 1.0);","   vec2 cord = vTextureCoord;","}"]};c.DisplacementFilter.prototype=
Object.create(c.AbstractFilter.prototype);c.DisplacementFilter.prototype.constructor=c.DisplacementFilter;c.DisplacementFilter.prototype.onTextureLoaded=function(){this.uniforms.mapDimensions.value.x=this.uniforms.displacementMap.value.width;this.uniforms.mapDimensions.value.y=this.uniforms.displacementMap.value.height;this.uniforms.displacementMap.value.baseTexture.off("loaded",this.boundLoadedFunction)};Object.defineProperty(c.DisplacementFilter.prototype,"map",{get:function(){return this.uniforms.displacementMap.value},
set:function(a){this.uniforms.displacementMap.value=a}});Object.defineProperty(c.DisplacementFilter.prototype,"scale",{get:function(){return this.uniforms.scale.value},set:function(a){this.uniforms.scale.value=a}});Object.defineProperty(c.DisplacementFilter.prototype,"offset",{get:function(){return this.uniforms.offset.value},set:function(a){this.uniforms.offset.value=a}});c.PixelateFilter=function(){c.AbstractFilter.call(this);this.passes=[this];this.uniforms={invert:{type:"1f",value:0},dimensions:{type:"4fv",
value:new Float32Array([1E4,100,10,10])},pixelSize:{type:"2f",value:{x:10,y:10}}};this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform vec2 testDim;","uniform vec4 dimensions;","uniform vec2 pixelSize;","uniform sampler2D uSampler;","void main(void) {","   vec2 coord = vTextureCoord;","   vec2 size = dimensions.xy/pixelSize;","   vec2 color = floor( ( vTextureCoord * size ) ) / size + pixelSize/dimensions.xy * 0.5;","   gl_FragColor = texture2D(uSampler, color);",
"}"]};c.PixelateFilter.prototype=Object.create(c.AbstractFilter.prototype);c.PixelateFilter.prototype.constructor=c.PixelateFilter;Object.defineProperty(c.PixelateFilter.prototype,"size",{get:function(){return this.uniforms.pixelSize.value},set:function(a){this.dirty=!0;this.uniforms.pixelSize.value=a}});c.BlurXFilter=function(){c.AbstractFilter.call(this);this.passes=[this];this.uniforms={blur:{type:"1f",value:1/512}};this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;",
"uniform float blur;","uniform sampler2D uSampler;","void main(void) {","   vec4 sum = vec4(0.0);","   sum += texture2D(uSampler, vec2(vTextureCoord.x - 4.0*blur, vTextureCoord.y)) * 0.05;","   sum += texture2D(uSampler, vec2(vTextureCoord.x - 3.0*blur, vTextureCoord.y)) * 0.09;","   sum += texture2D(uSampler, vec2(vTextureCoord.x - 2.0*blur, vTextureCoord.y)) * 0.12;","   sum += texture2D(uSampler, vec2(vTextureCoord.x - blur, vTextureCoord.y)) * 0.15;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y)) * 0.16;",
"   sum += texture2D(uSampler, vec2(vTextureCoord.x + blur, vTextureCoord.y)) * 0.15;","   sum += texture2D(uSampler, vec2(vTextureCoord.x + 2.0*blur, vTextureCoord.y)) * 0.12;","   sum += texture2D(uSampler, vec2(vTextureCoord.x + 3.0*blur, vTextureCoord.y)) * 0.09;","   sum += texture2D(uSampler, vec2(vTextureCoord.x + 4.0*blur, vTextureCoord.y)) * 0.05;","   gl_FragColor = sum;","}"]};c.BlurXFilter.prototype=Object.create(c.AbstractFilter.prototype);c.BlurXFilter.prototype.constructor=c.BlurXFilter;
Object.defineProperty(c.BlurXFilter.prototype,"blur",{get:function(){return this.uniforms.blur.value/(1/7E3)},set:function(a){this.dirty=!0;this.uniforms.blur.value=1/7E3*a}});c.BlurYFilter=function(){c.AbstractFilter.call(this);this.passes=[this];this.uniforms={blur:{type:"1f",value:1/512}};this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float blur;","uniform sampler2D uSampler;","void main(void) {","   vec4 sum = vec4(0.0);","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y - 4.0*blur)) * 0.05;",
"   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y - 3.0*blur)) * 0.09;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y - 2.0*blur)) * 0.12;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y - blur)) * 0.15;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y)) * 0.16;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y + blur)) * 0.15;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y + 2.0*blur)) * 0.12;",
"   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y + 3.0*blur)) * 0.09;","   sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y + 4.0*blur)) * 0.05;","   gl_FragColor = sum;","}"]};c.BlurYFilter.prototype=Object.create(c.AbstractFilter.prototype);c.BlurYFilter.prototype.constructor=c.BlurYFilter;Object.defineProperty(c.BlurYFilter.prototype,"blur",{get:function(){return this.uniforms.blur.value/(1/7E3)},set:function(a){this.uniforms.blur.value=1/7E3*a}});c.BlurFilter=
function(){this.blurXFilter=new c.BlurXFilter;this.blurYFilter=new c.BlurYFilter;this.passes=[this.blurXFilter,this.blurYFilter]};Object.defineProperty(c.BlurFilter.prototype,"blur",{get:function(){return this.blurXFilter.blur},set:function(a){this.blurXFilter.blur=this.blurYFilter.blur=a}});Object.defineProperty(c.BlurFilter.prototype,"blurX",{get:function(){return this.blurXFilter.blur},set:function(a){this.blurXFilter.blur=a}});Object.defineProperty(c.BlurFilter.prototype,"blurY",{get:function(){return this.blurYFilter.blur},
set:function(a){this.blurYFilter.blur=a}});c.InvertFilter=function(){c.AbstractFilter.call(this);this.passes=[this];this.uniforms={invert:{type:"1f",value:1}};this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float invert;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord);","   gl_FragColor.rgb = mix( (vec3(1)-gl_FragColor.rgb) * gl_FragColor.a, gl_FragColor.rgb, 1.0 - invert);","}"]};c.InvertFilter.prototype=
Object.create(c.AbstractFilter.prototype);c.InvertFilter.prototype.constructor=c.InvertFilter;Object.defineProperty(c.InvertFilter.prototype,"invert",{get:function(){return this.uniforms.invert.value},set:function(a){this.uniforms.invert.value=a}});c.SepiaFilter=function(){c.AbstractFilter.call(this);this.passes=[this];this.uniforms={sepia:{type:"1f",value:1}};this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float sepia;","uniform sampler2D uSampler;",
"const mat3 sepiaMatrix = mat3(0.3588, 0.7044, 0.1368, 0.2990, 0.5870, 0.1140, 0.2392, 0.4696, 0.0912);","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord);","   gl_FragColor.rgb = mix( gl_FragColor.rgb, gl_FragColor.rgb * sepiaMatrix, sepia);","}"]};c.SepiaFilter.prototype=Object.create(c.AbstractFilter.prototype);c.SepiaFilter.prototype.constructor=c.SepiaFilter;Object.defineProperty(c.SepiaFilter.prototype,"sepia",{get:function(){return this.uniforms.sepia.value},set:function(a){this.uniforms.sepia.value=
a}});c.TwistFilter=function(){c.AbstractFilter.call(this);this.passes=[this];this.uniforms={radius:{type:"1f",value:0.5},angle:{type:"1f",value:5},offset:{type:"2f",value:{x:0.5,y:0.5}}};this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform vec4 dimensions;","uniform sampler2D uSampler;","uniform float radius;","uniform float angle;","uniform vec2 offset;","void main(void) {","   vec2 coord = vTextureCoord - offset;","   float distance = length(coord);",
"   if (distance < radius) {","       float ratio = (radius - distance) / radius;","       float angleMod = ratio * ratio * angle;","       float s = sin(angleMod);","       float c = cos(angleMod);","       coord = vec2(coord.x * c - coord.y * s, coord.x * s + coord.y * c);","   }","   gl_FragColor = texture2D(uSampler, coord+offset);","}"]};c.TwistFilter.prototype=Object.create(c.AbstractFilter.prototype);c.TwistFilter.prototype.constructor=c.TwistFilter;Object.defineProperty(c.TwistFilter.prototype,
"offset",{get:function(){return this.uniforms.offset.value},set:function(a){this.dirty=!0;this.uniforms.offset.value=a}});Object.defineProperty(c.TwistFilter.prototype,"radius",{get:function(){return this.uniforms.radius.value},set:function(a){this.dirty=!0;this.uniforms.radius.value=a}});Object.defineProperty(c.TwistFilter.prototype,"angle",{get:function(){return this.uniforms.angle.value},set:function(a){this.dirty=!0;this.uniforms.angle.value=a}});c.ColorStepFilter=function(){c.AbstractFilter.call(this);
this.passes=[this];this.uniforms={step:{type:"1f",value:5}};this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","uniform float step;","void main(void) {","   vec4 color = texture2D(uSampler, vTextureCoord);","   color = floor(color * step) / step;","   gl_FragColor = color;","}"]};c.ColorStepFilter.prototype=Object.create(c.AbstractFilter.prototype);c.ColorStepFilter.prototype.constructor=c.ColorStepFilter;Object.defineProperty(c.ColorStepFilter.prototype,
"step",{get:function(){return this.uniforms.step.value},set:function(a){this.uniforms.step.value=a}});c.DotScreenFilter=function(){c.AbstractFilter.call(this);this.passes=[this];this.uniforms={scale:{type:"1f",value:1},angle:{type:"1f",value:5},dimensions:{type:"4fv",value:[0,0,0,0]}};this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform vec4 dimensions;","uniform sampler2D uSampler;","uniform float angle;","uniform float scale;","float pattern() {",
"   float s = sin(angle), c = cos(angle);","   vec2 tex = vTextureCoord * dimensions.xy;","   vec2 point = vec2(","       c * tex.x - s * tex.y,","       s * tex.x + c * tex.y","   ) * scale;","   return (sin(point.x) * sin(point.y)) * 4.0;","}","void main() {","   vec4 color = texture2D(uSampler, vTextureCoord);","   float average = (color.r + color.g + color.b) / 3.0;","   gl_FragColor = vec4(vec3(average * 10.0 - 5.0 + pattern()), color.a);","}"]};c.DotScreenFilter.prototype=Object.create(c.AbstractFilter.prototype);
c.DotScreenFilter.prototype.constructor=c.DotScreenFilter;Object.defineProperty(c.DotScreenFilter.prototype,"scale",{get:function(){return this.uniforms.scale.value},set:function(a){this.dirty=!0;this.uniforms.scale.value=a}});Object.defineProperty(c.DotScreenFilter.prototype,"angle",{get:function(){return this.uniforms.angle.value},set:function(a){this.dirty=!0;this.uniforms.angle.value=a}});c.CrossHatchFilter=function(){c.AbstractFilter.call(this);this.passes=[this];this.uniforms={blur:{type:"1f",
value:1/512}};this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float blur;","uniform sampler2D uSampler;","void main(void) {","    float lum = length(texture2D(uSampler, vTextureCoord.xy).rgb);","    gl_FragColor = vec4(1.0, 1.0, 1.0, 1.0);","    if (lum < 1.00) {","        if (mod(gl_FragCoord.x + gl_FragCoord.y, 10.0) == 0.0) {","            gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);","        }","    }","    if (lum < 0.75) {","        if (mod(gl_FragCoord.x - gl_FragCoord.y, 10.0) == 0.0) {",
"            gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);","        }","    }","    if (lum < 0.50) {","        if (mod(gl_FragCoord.x + gl_FragCoord.y - 5.0, 10.0) == 0.0) {","            gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);","        }","    }","    if (lum < 0.3) {","        if (mod(gl_FragCoord.x - gl_FragCoord.y - 5.0, 10.0) == 0.0) {","            gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);","        }","    }","}"]};c.CrossHatchFilter.prototype=Object.create(c.AbstractFilter.prototype);c.CrossHatchFilter.prototype.constructor=
c.BlurYFilter;Object.defineProperty(c.CrossHatchFilter.prototype,"blur",{get:function(){return this.uniforms.blur.value/(1/7E3)},set:function(a){this.uniforms.blur.value=1/7E3*a}});c.RGBSplitFilter=function(){c.AbstractFilter.call(this);this.passes=[this];this.uniforms={red:{type:"2f",value:{x:20,y:20}},green:{type:"2f",value:{x:-20,y:20}},blue:{type:"2f",value:{x:20,y:-20}},dimensions:{type:"4fv",value:[0,0,0,0]}};this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;",
"uniform vec2 red;","uniform vec2 green;","uniform vec2 blue;","uniform vec4 dimensions;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor.r = texture2D(uSampler, vTextureCoord + red/dimensions.xy).r;","   gl_FragColor.g = texture2D(uSampler, vTextureCoord + green/dimensions.xy).g;","   gl_FragColor.b = texture2D(uSampler, vTextureCoord + blue/dimensions.xy).b;","   gl_FragColor.a = texture2D(uSampler, vTextureCoord).a;","}"]};c.RGBSplitFilter.prototype=Object.create(c.AbstractFilter.prototype);
c.RGBSplitFilter.prototype.constructor=c.RGBSplitFilter;Object.defineProperty(c.RGBSplitFilter.prototype,"angle",{get:function(){return this.uniforms.blur.value/(1/7E3)},set:function(a){this.uniforms.blur.value=1/7E3*a}});"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=c),exports.PIXI=c):"undefined"!=typeof define&&define.amd?define(c):this.PIXI=c}).call(this);PIXI.Texture.prototype.scale=1;PIXI.Texture.prototype.setScale=function(c){this.scale=c;this.frame.width*=this.scale;this.frame.height*=this.scale;this.trim&&(this.trim.x*=this.scale,this.trim.y*=this.scale,this.trim.width*=this.scale,this.trim.height*=this.scale);PIXI.defaultRenderer.type==PIXI.WEBGL_RENDERER&&(this.crop.width*=this.scale,this.crop.height*=this.scale,this.crop.x*=this.scale,this.crop.y*=this.scale,this._updateWebGLuvs())};
PIXI.Texture.prototype._updateWebGLuvs=function(){if(!this._uvs)this._uvs=new PIXI.TextureUvs;var c=this.crop,m=this.baseTexture.width*this.scale,n=this.baseTexture.height*this.scale;this._uvs.x0=c.x/m;this._uvs.y0=c.y/n;this._uvs.x1=(c.x+c.width)/m;this._uvs.y1=c.y/n;this._uvs.x2=(c.x+c.width)/m;this._uvs.y2=(c.y+c.height)/n;this._uvs.x3=c.x/m;this._uvs.y3=(c.y+c.height)/n};
PIXI.Sprite.prototype._renderCanvas=function(c){if(!(!1===this.visible||0===this.alpha)){if(this.blendMode!==c.currentBlendMode)c.currentBlendMode=this.blendMode,c.context.globalCompositeOperation=PIXI.blendModesCanvas[c.currentBlendMode];this._mask&&c.maskManager.pushMask(this._mask,c.context);if(this.texture.valid){c.context.globalAlpha=this.worldAlpha;c.roundPixels?c.context.setTransform(this.worldTransform.a,this.worldTransform.c,this.worldTransform.b,this.worldTransform.d,this.worldTransform.tx|
0,this.worldTransform.ty|0):c.context.setTransform(this.worldTransform.a,this.worldTransform.c,this.worldTransform.b,this.worldTransform.d,this.worldTransform.tx,this.worldTransform.ty);if(c.smoothProperty&&c.scaleMode!==this.texture.baseTexture.scaleMode)c.scaleMode=this.texture.baseTexture.scaleMode,c.context[c.smoothProperty]=c.scaleMode===PIXI.scaleModes.LINEAR;var m=this.texture.trim?this.texture.trim.x-this.anchor.x*this.texture.trim.width:this.anchor.x*-this.texture.frame.width,n=this.texture.trim?
this.texture.trim.y-this.anchor.y*this.texture.trim.height:this.anchor.y*-this.texture.frame.height;if(16777215!==this.tint){if(this.cachedTint!==this.tint)this.cachedTint=this.tint,this.tintedTexture=PIXI.CanvasTinter.getTintedTexture(this,this.tint);c.context.drawImage(this.tintedTexture,0,0,this.texture.crop.width,this.texture.crop.height,m,n,this.texture.crop.width*this.texture.scale,this.texture.crop.height*this.texture.scale)}else c.context.drawImage(this.texture.baseTexture.source,this.texture.crop.x,
this.texture.crop.y,this.texture.crop.width,this.texture.crop.height,m,n,this.texture.crop.width*this.texture.scale,this.texture.crop.height*this.texture.scale)}m=0;for(n=this.children.length;m<n;m++)this.children[m]._renderCanvas(c);this._mask&&c.maskManager.popMask(c.context)}};var Stats=function(){var c,m,n=0,o=0,k=Date.now(),a=k,b=k,e=0,d=1E3,f=0,h,g,j,q=[[16,16,48],[0,255,255]],p=0,A=1E3,l=0,B,t,x,v=[[16,48,16],[0,255,0]];c=document.createElement("div");c.style.cursor="pointer";c.style.width="80px";c.style.opacity="0.9";c.style.zIndex="10001";c.addEventListener("mousedown",function(a){a.preventDefault();n=(n+1)%2;0==n?(h.style.display="block",B.style.display="none"):(h.style.display="none",B.style.display="block")},!1);h=document.createElement("div");h.style.textAlign=
"left";h.style.lineHeight="1.2em";h.style.backgroundColor="rgb("+Math.floor(q[0][0]/2)+","+Math.floor(q[0][1]/2)+","+Math.floor(q[0][2]/2)+")";h.style.padding="0 0 3px 3px";c.appendChild(h);g=document.createElement("div");g.style.fontFamily="Helvetica, Arial, sans-serif";g.style.fontSize="9px";g.style.color="rgb("+q[1][0]+","+q[1][1]+","+q[1][2]+")";g.style.fontWeight="bold";g.innerHTML="FPS";h.appendChild(g);j=document.createElement("div");j.style.position="relative";j.style.width="74px";j.style.height=
"30px";j.style.backgroundColor="rgb("+q[1][0]+","+q[1][1]+","+q[1][2]+")";for(h.appendChild(j);74>j.children.length;)m=document.createElement("span"),m.style.width="1px",m.style.height="30px",m.style.cssFloat="left",m.style.backgroundColor="rgb("+q[0][0]+","+q[0][1]+","+q[0][2]+")",j.appendChild(m);B=document.createElement("div");B.style.textAlign="left";B.style.lineHeight="1.2em";B.style.backgroundColor="rgb("+Math.floor(v[0][0]/2)+","+Math.floor(v[0][1]/2)+","+Math.floor(v[0][2]/2)+")";B.style.padding=
"0 0 3px 3px";B.style.display="none";c.appendChild(B);t=document.createElement("div");t.style.fontFamily="Helvetica, Arial, sans-serif";t.style.fontSize="9px";t.style.color="rgb("+v[1][0]+","+v[1][1]+","+v[1][2]+")";t.style.fontWeight="bold";t.innerHTML="MS";B.appendChild(t);x=document.createElement("div");x.style.position="relative";x.style.width="74px";x.style.height="30px";x.style.backgroundColor="rgb("+v[1][0]+","+v[1][1]+","+v[1][2]+")";for(B.appendChild(x);74>x.children.length;)m=document.createElement("span"),
m.style.width="1px",m.style.height=30*Math.random()+"px",m.style.cssFloat="left",m.style.backgroundColor="rgb("+v[0][0]+","+v[0][1]+","+v[0][2]+")",x.appendChild(m);return{domElement:c,update:function(){k=Date.now();p=k-a;A=Math.min(A,p);l=Math.max(l,p);t.textContent=p+" MS ("+A+"-"+l+")";var c=Math.min(30,30-30*(p/200));x.appendChild(x.firstChild).style.height=c+"px";a=k;o++;if(k>b+1E3)e=Math.round(1E3*o/(k-b)),d=Math.min(d,e),f=Math.max(f,e),g.textContent=e+" FPS ("+d+"-"+f+")",c=Math.min(30,30-
30*(e/100)),j.appendChild(j.firstChild).style.height=c+"px",b=k,o=0}}};DetectDevice.smartphones=[/Mobile/i,/Android/i,/iPhone/i,/BlackBerry/i,/Windows Phone/i,/Windows Mobile/i,/Maemo/i,/PalmSource/i,/SymbianOS/i,/SymbOS/i,/Nokia/i,/MOT-/i,/JDME/i,/Series 60/i,/S60/i,/SonyEricsson/i];DetectDevice.tablets=[/Android 3/i,/iPad/i];function DetectDevice(){}
DetectDevice.detect=function(){for(var c=navigator.userAgent,m=DetectDevice.tablets.length,n=0;n<m;n++)if(c.match(DetectDevice.tablets[n]))return"tablet";m=DetectDevice.smartphones.length;for(n=0;n<m;n++)if(c.match(DetectDevice.smartphones[n]))return"smartphone";return"desktop"};DetectDevice.isDesktop=function(){return Number("desktop"==DetectDevice.detect())};DetectDevice.isMobile=function(){return Number("desktop"!=DetectDevice.detect())};MathUtil.RADIANS=Math.PI/180;MathUtil.DEGREES=180/Math.PI;function MathUtil(){}MathUtil.rndRange=function(c,m){return c+Math.random()*(m-c)};MathUtil.rndIntRange=function(c,m){return Math.round(MathUtil.rndRange(c,m))};MathUtil.toRadians=function(c){return c*MathUtil.RADIANS};MathUtil.toDegrees=function(c){return c*MathUtil.DEGREES};MathUtil.clamp=function(c,m,n){return Math.max(m,Math.min(c,n))};MathUtil.hitTest=function(c,m,n,o,k,a,b,e){return c+n>k&&c<k+b&&m+o>a&&m<a+e?!0:!1};
MathUtil.distancePoint=function(c,m,n,o){c-=n;m-=o;return Math.sqrt(c*c+m*m)+0.5|0};MathUtil.distancePoint2=function(c,m,n,o){c-=n;m-=o;return c*c+m*m};ObjectPool.pools=[];function ObjectPool(){}ObjectPool.getPool=function(c){return ObjectPool.pools[c]||(ObjectPool.pools[c]=[])};
ObjectPool.getObject=function(c,m){var n=ObjectPool.getPool(c);if(0<n.length)return n.pop();if(2>arguments.length)return new c;switch(arguments.length){case 1:return new c(arguments[1]);case 2:return new c(arguments[1],arguments[2]);case 3:return new c(arguments[1],arguments[2],arguments[3]);case 4:return new c(arguments[1],arguments[2],arguments[3],arguments[4]);case 5:return new c(arguments[1],arguments[2],arguments[3],arguments[4],arguments[5]);case 6:return new c(arguments[1],arguments[2],arguments[3],
arguments[4],arguments[5],arguments[6]);default:return new c}};ObjectPool.disposeObject=function(c,m){ObjectPool.getPool(m).push(c)};function Actor(c,m){PIXI.Sprite.call(this,m);this.world=c}Actor.prototype=Object.create(PIXI.Sprite.prototype);Actor.prototype.constructor=Actor;function Ball(c){Actor.call(this,c,PIXI.Texture.fromFrame("ball"));this.body=null;this.anchor.x=0.5;this.anchor.y=0.5;var m=new b2FixtureDef;m.shape=new b2CircleShape;m.shape.SetRadius(0.5*this.width/Main.meter);m.restitution=0.8;m.friction=0.2;m.density=1;var n=new b2BodyDef;n.type=b2Body.b2_dynamicBody;n.bullet=!0;(this.body=c.CreateBody(n)).CreateFixture(m)}Ball.prototype=Object.create(Actor.prototype);Ball.prototype.constructor=Ball;
Ball.prototype.setPosition=function(c,m){var n=ObjectPool.getObject(b2Vec2);ObjectPool.disposeObject(n,b2Vec2);n.Set(c/Main.meter,m/Main.meter);this.body.SetPosition(n);this.position.x=c;this.position.y=m};function Basket(c){var a;Actor.call(this,c,PIXI.Texture.fromFrame("basket"));this.body=null;var m=new b2FixtureDef;m.shape=new b2PolygonShape;var n=new b2BodyDef;n.type=b2Body.b2_staticBody;n.userData=this;a=this.body=c.CreateBody(n),c=a;m.shape.SetAsOrientedBox(5/Main.meter,5/Main.meter,new b2Vec2(3/Main.meter,139/Main.meter));c.CreateFixture(m);m.shape.SetAsOrientedBox(11.5/Main.meter,90/Main.meter,new b2Vec2(134/Main.meter,91/Main.meter));c.CreateFixture(m)}Basket.prototype=Object.create(Actor.prototype);
Basket.prototype.constructor=Basket;Basket.prototype.setPosition=function(c,m){var n=ObjectPool.getObject(b2Vec2);ObjectPool.disposeObject(n,b2Vec2);n.Set(c/Main.meter,m/Main.meter);this.body.SetPosition(n);this.position.x=c;this.position.y=m};Box.fixDef=new Box2D.Dynamics.b2FixtureDef;Box.fixDef.shape=new Box2D.Collision.Shapes.b2PolygonShape;Box.fixDef.density=1.5;Box.bodyDef=new Box2D.Dynamics.b2BodyDef;
function Box(c){Actor.call(this,c,PIXI.Texture.fromFrame("box"));this.origin=new PIXI.Point;this.body=null;this.anchor.x=0.5;this.anchor.y=0.5;Box.fixDef.shape.SetAsBox(0.5*this.width/Main.meter,0.5*this.height/Main.meter);Box.bodyDef.type=b2Body.b2_dynamicBody;Box.bodyDef.userData=this;(this.body=c.CreateBody(Box.bodyDef)).CreateFixture(Box.fixDef)}Box.prototype=Object.create(Actor.prototype);Box.prototype.constructor=Box;
Box.prototype.setPosition=function(c,m){var n=ObjectPool.getObject(b2Vec2);ObjectPool.disposeObject(n,b2Vec2);n.Set(c/Main.meter,m/Main.meter);this.body.SetPosition(n);this.position.x=c;this.position.y=m};function Main(){this.wasThrow=this.isBegin=this.ball=this.anchor=this.stats=this.world=this.isInitH=this.loader=this.renderer=this.stage=null;this.boxes=[];window.b2CircleShape=Box2D.Collision.Shapes.b2CircleShape;window.b2MassData=Box2D.Collision.Shapes.b2MassData;window.b2PolygonShape=Box2D.Collision.Shapes.b2PolygonShape;window.b2Vec2=Box2D.Common.Math.b2Vec2;window.b2Body=Box2D.Dynamics.b2Body;window.b2BodyDef=Box2D.Dynamics.b2BodyDef;window.b2DebugDraw=Box2D.Dynamics.b2DebugDraw;window.b2Fixture=
Box2D.Dynamics.b2Fixture;window.b2FixtureDef=Box2D.Dynamics.b2FixtureDef;window.b2World=Box2D.Dynamics.b2World;try{window.devicePixelRatio=window.devicePixelRatio||1}catch(c){}var m=Math.max(screen.width,screen.height),n=Math.min(screen.width,screen.height),o=Math.max(window.innerWidth,window.innerHeight),k=Math.min(window.innerWidth,window.innerHeight),m=m/window.devicePixelRatio>=o?m/window.devicePixelRatio:m,n=n/window.devicePixelRatio>=k?n/window.devicePixelRatio:n;Main.scaleView=DetectDevice.isDesktop()||
Math.min(m*window.devicePixelRatio/960,n*window.devicePixelRatio/640);Main.scaleAsset=DetectDevice.isDesktop()?MathUtil.clamp(Math.round(2*window.devicePixelRatio)/2,0.5,2):MathUtil.clamp(Math.round(4*Main.scaleView)/4,0.5,2);Main.meter=30;window.onload=this.onLoad.bind(this)}Main.prototype.constructor=Main;
Main.prototype.onLoad=function(){var c=this.stats=new Stats;document.body.appendChild(c.domElement);c.domElement.style.position="absolute";c=this.stage=new PIXI.Stage(3355443);c.worldTransform.a=Main.scaleView;c.worldTransform.d=Main.scaleView;c=this.renderer=PIXI.autoDetectRenderer();document.body.appendChild(c.view);c.view.style.position="absolute";c=this.loader=new PIXI.AssetLoader(["assets/graphics/{0}x/ball.png".replace("{0}",Main.scaleAsset),"assets/graphics/{0}x/basket.png".replace("{0}",Main.scaleAsset),
"assets/graphics/{0}x/box.png".replace("{0}",Main.scaleAsset)],!1);c.onComplete=this.onLoadAssets.bind(this);c.load();window.addEventListener("resize",this.onResize.bind(this));setTimeout(this.onResize.bind(this),0);window.addEventListener("touchstart",function(){screenfull.enabled&&!screenfull.isFullscreen&&screenfull.request()})};
Main.prototype.onLoadAssets=function(){PIXI.Texture.addTextureToCache(PIXI.Texture.removeTextureFromCache("assets/graphics/{0}x/ball.png".replace("{0}",Main.scaleAsset)),"ball");PIXI.Texture.fromFrame("ball").setScale(1/Main.scaleAsset);PIXI.Texture.addTextureToCache(PIXI.Texture.removeTextureFromCache("assets/graphics/{0}x/basket.png".replace("{0}",Main.scaleAsset)),"basket");PIXI.Texture.fromFrame("basket").setScale(1/Main.scaleAsset);PIXI.Texture.addTextureToCache(PIXI.Texture.removeTextureFromCache("assets/graphics/{0}x/box.png".replace("{0}",
Main.scaleAsset)),"box");PIXI.Texture.fromFrame("box").setScale(1/Main.scaleAsset);this.onResize()};
Main.prototype.initHorizontal=function(){var c=this.world=new b2World(new b2Vec2(0,9.8),!0);this.createBorder(window.innerWidth*window.devicePixelRatio/Main.scaleView,window.innerHeight*window.devicePixelRatio/Main.scaleView);this.createBoxes();var m=this.anchor=new PIXI.Graphics;this.stage.addChild(m);m.beginFill(16711680,1);m.drawCircle(0,0,5);m.endFill();m.position.x=200;m.position.y=500;var n=this.ball=new Ball(this.world);this.stage.addChild(n);n.body.SetType(b2Body.b2_staticBody);n.setPosition(m.position.x,
m.position.y);m=new Basket(this.world);this.stage.addChild(m);m.setPosition(window.innerWidth*window.devicePixelRatio/Main.scaleView-160,100);var o=this;(function a(){requestAnimationFrame(a,null);c.Step(1/30,8,3);c.ClearForces();for(var b=c.GetBodyList();b;b=b.GetNext()){var e=b.GetUserData();if(e)e.rotation=b.GetAngle(),e.position.x=b.GetPosition().x*Main.meter,e.position.y=b.GetPosition().y*Main.meter}o.renderer.render(o.stage);o.stats.update()})();this.stage.mousedown=this.stage.touchstart=this.onBegin.bind(this);
this.stage.mouseup=this.stage.touchend=this.onEnd.bind(this);this.stage.mousemove=this.stage.touchmove=this.onMove.bind(this)};
Main.prototype.setDebugDraw=function(){var c=document.createElement("canvas");document.body.appendChild(c);c.style.position="absolute";c.style.pointerEvents="none";c.style.width=window.innerWidth+"px";c.style.height=window.innerHeight+"px";c.width=window.innerWidth;c.height=window.innerHeight;var m=new b2DebugDraw;m.SetSprite(c.getContext("2d"));m.SetDrawScale(Main.meter);m.SetFillAlpha(0.3);m.SetLineThickness(1);m.SetFlags(b2DebugDraw.e_shapeBit|b2DebugDraw.e_jointBit);this.world.SetDebugDraw(m)};
Main.prototype.createBorder=function(c,m){var n=new b2FixtureDef;n.shape=new b2PolygonShape;var o=new b2BodyDef;o.type=b2Body.b2_staticBody;o=this.world.CreateBody(o);n.shape.SetAsOrientedBox(0.5*c/Main.meter,1/Main.meter,new b2Vec2(0.5*c/Main.meter,m/Main.meter));o.CreateFixture(n);n.shape.SetAsOrientedBox(1/Main.meter,m/Main.meter,new b2Vec2);o.CreateFixture(n);n.shape.SetAsOrientedBox(1/Main.meter,m/Main.meter,new b2Vec2(c/Main.meter));o.CreateFixture(n)};
Main.prototype.createBoxes=function(){for(var c=0;11>c;++c){var m=new Box(this.world);this.stage.addChild(m);m.setPosition(window.innerWidth*window.devicePixelRatio/Main.scaleView-350,window.innerHeight*window.devicePixelRatio/Main.scaleView-50-50*c);m.origin.x=m.position.x;m.origin.y=m.position.y;this.boxes.push(m)}};
Main.prototype.onBegin=function(){if(this.wasThrow){this.wasThrow=!1;this.ball.body.SetType(b2Body.b2_staticBody);this.ball.body.SetUserData(null);this.ball.setPosition(this.anchor.position.x,this.anchor.position.y);for(var c=this.boxes.length,m=0;m<c;++m){var n=this.boxes[m];n.body.SetType(b2Body.b2_staticBody);n.body.SetAngle(0);n.setPosition(n.origin.x,n.origin.y)}this.world.Step(1/30,8,3);this.world.ClearForces();for(m=this.boxes.length-1;0<=m;--m)this.boxes[m].body.SetType(b2Body.b2_dynamicBody)}else this.isBegin=
!0};
Main.prototype.onEnd=function(c){if(this.isBegin){this.isBegin=!1;this.wasThrow=!0;this.ball.body.SetType(b2Body.b2_dynamicBody);this.ball.body.SetUserData(this.ball);this.ball.setPosition(this.ball.position.x,this.ball.position.y);var m=c.global.x/Main.scaleView-this.anchor.position.x,n=c.global.y/Main.scaleView-this.anchor.position.y,c=ObjectPool.getObject(b2Vec2);c.Set(-1*m,-1*n);c.Normalize();m=ObjectPool.getObject(b2Vec2);m.Set(c.x,c.y);m.Multiply(this.ball.body.m_mass);m.Multiply(0.6*MathUtil.distancePoint(this.ball.position.x,this.ball.position.y,
this.anchor.position.x,this.anchor.position.y));n=ObjectPool.getObject(b2Vec2);ObjectPool.disposeObject(c,b2Vec2);ObjectPool.disposeObject(m,b2Vec2);ObjectPool.disposeObject(n,b2Vec2);n.Set(0,0);this.ball.body.ApplyImpulse(m,this.ball.body.GetWorldPoint(n))}};
Main.prototype.onMove=function(c){if(this.isBegin){var m=c.global.x/Main.scaleView-this.anchor.position.x,c=c.global.y/Main.scaleView-this.anchor.position.y,n=MathUtil.clamp(Math.sqrt(m*m+c*c)/500,-0.5,0.5),o=1-Math.abs(n);this.ball.position.x=this.anchor.position.x+200*Math.cos(Math.atan2(c,m))*n*o;this.ball.position.y=this.anchor.position.y+200*Math.sin(Math.atan2(c,m))*n*o}};
Main.prototype.onResize=function(){if(window.innerWidth>window.innerHeight){if(!this.isInitH&&!this.loader.loadCount)if(DetectDevice.isDesktop()||!screenfull.enabled)this.isInitH=!0,this.initHorizontal();else if(screenfull.isFullscreen)this.isInitH=!0,setTimeout(this.initHorizontal.bind(this),100);this.stage.visible=!0}else this.stage.visible=!1;this.renderer.view.style.width=window.innerWidth+"px";this.renderer.view.style.height=window.innerHeight+"px";this.renderer.resize(window.innerWidth*window.devicePixelRatio,
window.innerHeight*window.devicePixelRatio);this.renderer.render(this.stage);window.scrollTo(0,0)};Main.instance=new Main;
</script>
    </head>
</html>
